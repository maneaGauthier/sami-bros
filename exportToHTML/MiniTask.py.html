<html>
<head>
<title>MiniTask.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #cf8e6d;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
MiniTask.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;This module implements a minimum task manager.  It is similar in 
principle to the full-featured task manager implemented in Task.py, 
but it has a sharply reduced feature set--completely bare-bones, in 
fact--and it is designed to be a pure-python implementation that does 
not require any C++ Panda support, so that it can be loaded before 
Panda has been fully downloaded. &quot;&quot;&quot;</span>

<span class="s1">__all__ </span><span class="s2">= [</span><span class="s3">'MiniTask'</span><span class="s2">, </span><span class="s3">'MiniTaskManager'</span><span class="s2">]</span>

<span class="s4">class </span><span class="s1">MiniTask</span><span class="s2">:</span>
    <span class="s1">done </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s1">cont </span><span class="s2">= </span><span class="s5">1</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__call__ </span><span class="s2">= </span><span class="s1">callback</span>

<span class="s4">class </span><span class="s1">MiniTaskManager</span><span class="s2">:</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">taskList </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">running </span><span class="s2">= </span><span class="s5">0</span>

    <span class="s4">def </span><span class="s1">add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">task</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s4">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">task</span><span class="s2">, </span><span class="s1">MiniTask</span><span class="s2">)</span>
        <span class="s1">task</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">name</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">taskList</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">task</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">task</span><span class="s2">):</span>
        <span class="s4">try</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">taskList</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">task</span><span class="s2">)</span>
        <span class="s4">except </span><span class="s1">ValueError</span><span class="s2">:</span>
            <span class="s4">pass</span>

    <span class="s4">def </span><span class="s1">__executeTask</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">task</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">task</span><span class="s2">(</span><span class="s1">task</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">step</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">i </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s4">while </span><span class="s2">(</span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">taskList</span><span class="s2">)):</span>
            <span class="s1">task </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">taskList</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
            <span class="s1">ret </span><span class="s2">= </span><span class="s1">task</span><span class="s2">(</span><span class="s1">task</span><span class="s2">)</span>

            <span class="s6"># See if the task is done</span>
            <span class="s4">if </span><span class="s2">(</span><span class="s1">ret </span><span class="s2">== </span><span class="s1">task</span><span class="s2">.</span><span class="s1">cont</span><span class="s2">):</span>
                <span class="s6"># Leave it for next frame, its not done yet</span>
                <span class="s4">pass</span>

            <span class="s4">else</span><span class="s2">:</span>
                <span class="s6"># Remove the task</span>
                <span class="s4">try</span><span class="s2">:</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">taskList</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">task</span><span class="s2">)</span>
                <span class="s4">except </span><span class="s1">ValueError</span><span class="s2">:</span>
                    <span class="s4">pass</span>
                <span class="s6"># Do not increment the iterator</span>
                <span class="s4">continue</span>

            <span class="s6"># Move to the next element</span>
            <span class="s1">i </span><span class="s2">+= </span><span class="s5">1</span>

    <span class="s4">def </span><span class="s1">run</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">running </span><span class="s2">= </span><span class="s5">1</span>
        <span class="s4">while </span><span class="s1">self</span><span class="s2">.</span><span class="s1">running</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">step</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">stop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># Set a flag so we will stop before beginning next frame</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">running </span><span class="s2">= </span><span class="s5">0</span>

</pre>
</body>
</html>
<html>
<head>
<title>Pool.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #cf8e6d;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Pool.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Pool is a collection of python objects that you can checkin and 
checkout. This is useful for a cache of objects that are expensive to load 
and can be reused over and over, like splashes on cannonballs, or 
bulletholes on walls. The pool is unsorted. Items do not have to be unique 
or be the same type. 
 
Internally the pool is implemented with 2 lists, free items and used items. 
 
Example: 
 
    .. code-block:: python 
 
        p = Pool([1, 2, 3, 4, 5]) 
        x = p.checkout() 
        p.checkin(x) 
 
&quot;&quot;&quot;</span>

<span class="s1">__all__ </span><span class="s2">= [</span><span class="s3">'Pool'</span><span class="s2">]</span>


<span class="s4">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">directnotify </span><span class="s4">import </span><span class="s1">DirectNotifyGlobal</span>


<span class="s4">class </span><span class="s1">Pool</span><span class="s2">:</span>

    <span class="s1">notify </span><span class="s2">= </span><span class="s1">DirectNotifyGlobal</span><span class="s2">.</span><span class="s1">directNotify</span><span class="s2">.</span><span class="s1">newCategory</span><span class="s2">(</span><span class="s3">&quot;Pool&quot;</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">free</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">free</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">__free </span><span class="s2">= </span><span class="s1">free</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">__free </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__used </span><span class="s2">= []</span>

    <span class="s4">def </span><span class="s1">add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">item</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Add an item to the free list. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__free</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">item</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Remove an item. Error is flagged if the item is not in the pool. 
        &quot;&quot;&quot;</span>
        <span class="s4">if </span><span class="s1">item </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__free</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">__free</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>
        <span class="s4">elif </span><span class="s1">item </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__used</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">__used</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">notify</span><span class="s2">.</span><span class="s1">error</span><span class="s2">(</span><span class="s3">&quot;item not in pool&quot;</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">checkout</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Get an arbitrary item from the pool. 
        &quot;&quot;&quot;</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__free</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">notify</span><span class="s2">.</span><span class="s1">error</span><span class="s2">(</span><span class="s3">&quot;no items are free&quot;</span><span class="s2">)</span>
        <span class="s1">item </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__free</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__used</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s1">item</span>

    <span class="s4">def </span><span class="s1">checkin</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">item</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Put back a checked out item. 
        Error if the item is not checked out. 
        &quot;&quot;&quot;</span>
        <span class="s4">if </span><span class="s1">item </span><span class="s4">not in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__used</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">notify</span><span class="s2">.</span><span class="s1">error</span><span class="s2">(</span><span class="s3">&quot;item is not checked out&quot;</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__used</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__free</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">reset</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Resets the pool so all items are free. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__free</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__used</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__used </span><span class="s2">= []</span>

    <span class="s4">def </span><span class="s1">hasFree</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Returns true if there is at least one free item. 
        &quot;&quot;&quot;</span>
        <span class="s4">return </span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__free</span><span class="s2">) != </span><span class="s5">0</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">isFree</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">item</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Returns true if this item is free for check out. 
        &quot;&quot;&quot;</span>
        <span class="s4">return </span><span class="s2">(</span><span class="s1">item </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__free</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">isUsed</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">item</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Returns true if this item has already been checked out. 
        &quot;&quot;&quot;</span>
        <span class="s4">return </span><span class="s2">(</span><span class="s1">item </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__used</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">getNumItems</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Returns the number of free items and the number of used items. 
        &quot;&quot;&quot;</span>
        <span class="s4">return </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__free</span><span class="s2">), </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__used</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">cleanup</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">cleanupFunc</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Completely cleanup the pool and all of its objects. 
        cleanupFunc will be called on every free and used item. 
        &quot;&quot;&quot;</span>
        <span class="s4">if </span><span class="s1">cleanupFunc</span><span class="s2">:</span>
            <span class="s6"># Make a list of all the items first in case the act of</span>
            <span class="s6"># calling cleanupFunc moves some from used to free.</span>
            <span class="s1">allItems </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__free </span><span class="s2">+ </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__used</span>
            <span class="s4">for </span><span class="s1">item </span><span class="s4">in </span><span class="s1">allItems</span><span class="s2">:</span>
                <span class="s1">cleanupFunc</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__free</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__used</span>

    <span class="s4">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s3">&quot;free = %s</span><span class="s4">\n</span><span class="s3">used = %s&quot; </span><span class="s2">% (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__free</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__used</span><span class="s2">)</span>
</pre>
</body>
</html>
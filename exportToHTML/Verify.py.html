<html>
<head>
<title>Verify.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #7a7e85;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Verify.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
You can use :func:`verify()` just like assert, with these small differences: 
 
- you may need to ``import Verify``, if someone hasn't done it for you. 
 
- unlike assert where using parentheses are optional, :func:`verify()` 
  requires them, e.g.:: 
 
    assert foo  # OK 
    verify foo  # Error 
    assert foo  # Not Recomended (may be interpreted as a tuple) 
    verify(foo) # OK 
 
- :func:`verify()` will print something like this before raising an exception:: 
 
    verify failed: 
        File &quot;direct/src/showbase/ShowBase.py&quot;, line 60 
 
- :func:`verify()` will optionally start pdb for you (this is currently false 
  by default).  You can either edit Verify.py to set ``wantVerifyPdb = 1`` or 
  if you are using ShowBase you can set ``want-verify-pdb 1`` in your 
  Config.prc file to start pdb automatically. 
 
- :func:`verify()` will still function in the release build.  It will not be 
  removed by -O like assert will. 
 
:func:`verify()` will also throw an AssertionError, but you can ignore that if 
you like (I don't suggest trying to catch it, it's just doing it so that it can 
replace assert more fully). 
 
Please do not use assert for things that you want run on release builds. 
That is a bad thing to do.  One of the main reasons that assert exists 
is to stip out debug code from a release build.  The fact that it throws 
an exception can get it mistaken for an error handler.  If your code 
needs to handle an error or throw an exception, you should do that 
(and not just assert for it). 
 
If you want to be a super keen software engineer then avoid using 
:func:`verify()`.  If you want to be, or already are, a super keen software 
engineer, but you don't always have the time to write proper error handling, 
go ahead and use :func:`verify()` -- that's what it's for. 
 
Please use assert (properly) and do proper error handling; and use 
:func:`verify()` only when debugging (i.e. when it won't be checked-in) or 
where it helps you resist using assert for error handling. 
&quot;&quot;&quot;</span>

<span class="s2">from </span><span class="s1">panda3d</span><span class="s3">.</span><span class="s1">core </span><span class="s2">import </span><span class="s1">ConfigVariableBool</span>

<span class="s4"># Set to true to load pdb on failure.</span>
<span class="s1">wantVerifyPdb </span><span class="s3">= </span><span class="s1">ConfigVariableBool</span><span class="s3">(</span><span class="s5">'want-verify-pdb'</span><span class="s3">, </span><span class="s2">False</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">verify</span><span class="s3">(</span><span class="s1">assertion</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    verify() is intended to be used in place of assert where you 
    wish to have the assertion checked, even in release (-O) code. 
    &quot;&quot;&quot;</span>
    <span class="s2">if not </span><span class="s1">assertion</span><span class="s3">:</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s2">\n\n</span><span class="s5">verify failed:&quot;</span><span class="s3">)</span>
        <span class="s2">import </span><span class="s1">sys</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s5">&quot;    File </span><span class="s2">\&quot;</span><span class="s5">%s</span><span class="s2">\&quot;</span><span class="s5">, line %d&quot; </span><span class="s3">% (</span>
                <span class="s1">sys</span><span class="s3">.</span><span class="s1">_getframe</span><span class="s3">(</span><span class="s6">1</span><span class="s3">).</span><span class="s1">f_code</span><span class="s3">.</span><span class="s1">co_filename</span><span class="s3">,</span>
                <span class="s1">sys</span><span class="s3">.</span><span class="s1">_getframe</span><span class="s3">(</span><span class="s6">1</span><span class="s3">).</span><span class="s1">f_lineno</span><span class="s3">))</span>
        <span class="s2">if </span><span class="s1">wantVerifyPdb</span><span class="s3">:</span>
            <span class="s2">import </span><span class="s1">pdb</span>
            <span class="s1">pdb</span><span class="s3">.</span><span class="s1">set_trace</span><span class="s3">()</span>
        <span class="s2">raise </span><span class="s1">AssertionError</span>


<span class="s2">if not </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">__builtins__</span><span class="s3">, </span><span class="s5">&quot;verify&quot;</span><span class="s3">):</span>
    <span class="s1">__builtins__</span><span class="s3">[</span><span class="s5">&quot;verify&quot;</span><span class="s3">] = </span><span class="s1">verify</span>
</pre>
</body>
</html>
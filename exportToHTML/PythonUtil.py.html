<html>
<head>
<title>PythonUtil.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #cf8e6d;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
PythonUtil.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Contains miscellaneous utility functions and classes.&quot;&quot;&quot;</span>

<span class="s1">__all__ </span><span class="s2">= [</span>

    <span class="s3">'indent'</span><span class="s2">, </span><span class="s3">'doc'</span><span class="s2">, </span><span class="s3">'adjust'</span><span class="s2">, </span><span class="s3">'difference'</span><span class="s2">, </span><span class="s3">'intersection'</span><span class="s2">, </span><span class="s3">'union'</span><span class="s2">,</span>
    <span class="s3">'sameElements'</span><span class="s2">, </span><span class="s3">'makeList'</span><span class="s2">, </span><span class="s3">'makeTuple'</span><span class="s2">, </span><span class="s3">'list2dict'</span><span class="s2">, </span><span class="s3">'invertDict'</span><span class="s2">,</span>
    <span class="s3">'invertDictLossless'</span><span class="s2">, </span><span class="s3">'uniqueElements'</span><span class="s2">, </span><span class="s3">'disjoint'</span><span class="s2">, </span><span class="s3">'contains'</span><span class="s2">, </span><span class="s3">'replace'</span><span class="s2">,</span>
    <span class="s3">'reduceAngle'</span><span class="s2">, </span><span class="s3">'fitSrcAngle2Dest'</span><span class="s2">, </span><span class="s3">'fitDestAngle2Src'</span><span class="s2">, </span><span class="s3">'closestDestAngle2'</span><span class="s2">,</span>
    <span class="s3">'closestDestAngle'</span><span class="s2">, </span><span class="s3">'getSetterName'</span><span class="s2">, </span><span class="s3">'getSetter'</span><span class="s2">, </span><span class="s3">'Functor'</span><span class="s2">, </span><span class="s3">'Stack'</span><span class="s2">,</span>
    <span class="s3">'Queue'</span><span class="s2">, </span><span class="s3">'bound'</span><span class="s2">, </span><span class="s3">'clamp'</span><span class="s2">, </span><span class="s3">'lerp'</span><span class="s2">, </span><span class="s3">'average'</span><span class="s2">, </span><span class="s3">'addListsByValue'</span><span class="s2">,</span>
    <span class="s3">'boolEqual'</span><span class="s2">, </span><span class="s3">'lineupPos'</span><span class="s2">, </span><span class="s3">'formatElapsedSeconds'</span><span class="s2">, </span><span class="s3">'solveQuadratic'</span><span class="s2">,</span>
    <span class="s3">'findPythonModule'</span><span class="s2">, </span><span class="s3">'mostDerivedLast'</span><span class="s2">, </span><span class="s3">'clampScalar'</span><span class="s2">, </span><span class="s3">'weightedChoice'</span><span class="s2">,</span>
    <span class="s3">'randFloat'</span><span class="s2">, </span><span class="s3">'normalDistrib'</span><span class="s2">, </span><span class="s3">'weightedRand'</span><span class="s2">, </span><span class="s3">'randUint31'</span><span class="s2">, </span><span class="s3">'randInt32'</span><span class="s2">,</span>
    <span class="s3">'SerialNumGen'</span><span class="s2">, </span><span class="s3">'serialNum'</span><span class="s2">, </span><span class="s3">'uniqueName'</span><span class="s2">, </span><span class="s3">'Enum'</span><span class="s2">, </span><span class="s3">'Singleton'</span><span class="s2">,</span>
    <span class="s3">'SingletonError'</span><span class="s2">, </span><span class="s3">'printListEnum'</span><span class="s2">, </span><span class="s3">'safeRepr'</span><span class="s2">, </span><span class="s3">'fastRepr'</span><span class="s2">,</span>
    <span class="s3">'isDefaultValue'</span><span class="s2">, </span><span class="s3">'ScratchPad'</span><span class="s2">, </span><span class="s3">'Sync'</span><span class="s2">, </span><span class="s3">'itype'</span><span class="s2">, </span><span class="s3">'getNumberedTypedString'</span><span class="s2">,</span>
    <span class="s3">'getNumberedTypedSortedString'</span><span class="s2">, </span><span class="s3">'printNumberedTyped'</span><span class="s2">, </span><span class="s3">'DelayedCall'</span><span class="s2">,</span>
    <span class="s3">'DelayedFunctor'</span><span class="s2">, </span><span class="s3">'FrameDelayedCall'</span><span class="s2">, </span><span class="s3">'SubframeCall'</span><span class="s2">, </span><span class="s3">'getBase'</span><span class="s2">,</span>
    <span class="s3">'GoldenRatio'</span><span class="s2">, </span><span class="s3">'GoldenRectangle'</span><span class="s2">, </span><span class="s3">'rad90'</span><span class="s2">, </span><span class="s3">'rad180'</span><span class="s2">, </span><span class="s3">'rad270'</span><span class="s2">, </span><span class="s3">'rad360'</span><span class="s2">,</span>
    <span class="s3">'nullGen'</span><span class="s2">, </span><span class="s3">'loopGen'</span><span class="s2">, </span><span class="s3">'makeFlywheelGen'</span><span class="s2">, </span><span class="s3">'flywheel'</span><span class="s2">, </span><span class="s3">'listToIndex2item'</span><span class="s2">,</span>
    <span class="s3">'listToItem2index'</span><span class="s2">, </span><span class="s3">'formatTimeCompact'</span><span class="s2">, </span><span class="s3">'deeptype'</span><span class="s2">, </span><span class="s3">'StdoutCapture'</span><span class="s2">,</span>
    <span class="s3">'StdoutPassthrough'</span><span class="s2">, </span><span class="s3">'Averager'</span><span class="s2">, </span><span class="s3">'getRepository'</span><span class="s2">, </span><span class="s3">'formatTimeExact'</span><span class="s2">,</span>
    <span class="s3">'startSuperLog'</span><span class="s2">, </span><span class="s3">'endSuperLog'</span><span class="s2">, </span><span class="s3">'typeName'</span><span class="s2">, </span><span class="s3">'safeTypeName'</span><span class="s2">,</span>
    <span class="s3">'histogramDict'</span><span class="s2">, </span><span class="s3">'unescapeHtmlString'</span><span class="s2">,</span>
<span class="s2">]</span>

<span class="s4">if __debug__</span><span class="s2">:</span>
    <span class="s1">__all__ </span><span class="s2">+= [</span><span class="s3">'StackTrace'</span><span class="s2">, </span><span class="s3">'traceFunctionCall'</span><span class="s2">, </span><span class="s3">'traceParentCall'</span><span class="s2">,</span>
                <span class="s3">'printThisCall'</span><span class="s2">, </span><span class="s3">'stackEntryInfo'</span><span class="s2">, </span><span class="s3">'lineInfo'</span><span class="s2">, </span><span class="s3">'callerInfo'</span><span class="s2">,</span>
                <span class="s3">'lineTag'</span><span class="s2">, </span><span class="s3">'profileFunc'</span><span class="s2">, </span><span class="s3">'profiled'</span><span class="s2">, </span><span class="s3">'startProfile'</span><span class="s2">,</span>
                <span class="s3">'printProfile'</span><span class="s2">, </span><span class="s3">'getProfileResultString'</span><span class="s2">, </span><span class="s3">'printStack'</span><span class="s2">,</span>
                <span class="s3">'printReverseStack'</span><span class="s2">]</span>

<span class="s4">import </span><span class="s1">types</span>
<span class="s4">import </span><span class="s1">math</span>
<span class="s4">import </span><span class="s1">os</span>
<span class="s4">import </span><span class="s1">sys</span>
<span class="s4">import </span><span class="s1">random</span>
<span class="s4">import </span><span class="s1">time</span>

<span class="s1">__report_indent </span><span class="s2">= </span><span class="s5">3</span>

<span class="s4">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s4">import </span><span class="s1">ConfigVariableBool</span>

<span class="s4">if </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">version_info </span><span class="s2">&gt;= (</span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">):</span>
    <span class="s4">import </span><span class="s1">builtins</span>
    <span class="s4">from </span><span class="s1">functools </span><span class="s4">import </span><span class="s1">reduce</span>
    <span class="s1">xrange </span><span class="s2">= </span><span class="s1">range</span>
<span class="s4">else</span><span class="s2">:</span>
    <span class="s4">import </span><span class="s1">__builtin__ </span><span class="s4">as </span><span class="s1">builtins</span>


<span class="s3">&quot;&quot;&quot; 
# with one integer positional arg, this uses about 4/5 of the memory of the Functor class below 
def Functor(function, *args, **kArgs): 
    argsCopy = args[:] 
    def functor(*cArgs, **ckArgs): 
        kArgs.update(ckArgs) 
        return function(*(argsCopy + cArgs), **kArgs) 
    return functor 
&quot;&quot;&quot;</span>

<span class="s4">try</span><span class="s2">:</span>
    <span class="s4">import </span><span class="s1">importlib</span>
<span class="s4">except </span><span class="s1">ImportError</span><span class="s2">:</span>
    <span class="s6"># Backward compatibility for Python 2.6.</span>
    <span class="s4">def </span><span class="s1">_resolve_name</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">package</span><span class="s2">, </span><span class="s1">level</span><span class="s2">):</span>
        <span class="s4">if not </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">package</span><span class="s2">, </span><span class="s3">'rindex'</span><span class="s2">):</span>
            <span class="s4">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s3">&quot;'package' not set to a string&quot;</span><span class="s2">)</span>
        <span class="s1">dot </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">package</span><span class="s2">)</span>
        <span class="s4">for </span><span class="s1">x </span><span class="s4">in </span><span class="s1">xrange</span><span class="s2">(</span><span class="s1">level</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">):</span>
            <span class="s4">try</span><span class="s2">:</span>
                <span class="s1">dot </span><span class="s2">= </span><span class="s1">package</span><span class="s2">.</span><span class="s1">rindex</span><span class="s2">(</span><span class="s3">'.'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">dot</span><span class="s2">)</span>
            <span class="s4">except </span><span class="s1">ValueError</span><span class="s2">:</span>
                <span class="s4">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s3">&quot;attempted relative import beyond top-level &quot;</span>
                                  <span class="s3">&quot;package&quot;</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s3">&quot;%s.%s&quot; </span><span class="s2">% (</span><span class="s1">package</span><span class="s2">[:</span><span class="s1">dot</span><span class="s2">], </span><span class="s1">name</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">import_module</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">package</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">name</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s3">'.'</span><span class="s2">):</span>
            <span class="s4">if not </span><span class="s1">package</span><span class="s2">:</span>
                <span class="s4">raise </span><span class="s1">TypeError</span><span class="s2">(</span><span class="s3">&quot;relative imports require the 'package' argument&quot;</span><span class="s2">)</span>
            <span class="s1">level </span><span class="s2">= </span><span class="s5">0</span>
            <span class="s4">for </span><span class="s1">character </span><span class="s4">in </span><span class="s1">name</span><span class="s2">:</span>
                <span class="s4">if </span><span class="s1">character </span><span class="s2">!= </span><span class="s3">'.'</span><span class="s2">:</span>
                    <span class="s4">break</span>
                <span class="s1">level </span><span class="s2">+= </span><span class="s5">1</span>
            <span class="s1">name </span><span class="s2">= </span><span class="s1">_resolve_name</span><span class="s2">(</span><span class="s1">name</span><span class="s2">[</span><span class="s1">level</span><span class="s2">:], </span><span class="s1">package</span><span class="s2">, </span><span class="s1">level</span><span class="s2">)</span>
        <span class="s1">__import__</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">modules</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]</span>

    <span class="s1">imp </span><span class="s2">= </span><span class="s1">import_module</span><span class="s2">(</span><span class="s3">'imp'</span><span class="s2">)</span>
    <span class="s1">importlib </span><span class="s2">= </span><span class="s1">imp</span><span class="s2">.</span><span class="s1">new_module</span><span class="s2">(</span><span class="s3">&quot;importlib&quot;</span><span class="s2">)</span>
    <span class="s1">importlib</span><span class="s2">.</span><span class="s1">_resolve_name </span><span class="s2">= </span><span class="s1">_resolve_name</span>
    <span class="s1">importlib</span><span class="s2">.</span><span class="s1">import_module </span><span class="s2">= </span><span class="s1">import_module</span>
    <span class="s1">sys</span><span class="s2">.</span><span class="s1">modules</span><span class="s2">[</span><span class="s3">'importlib'</span><span class="s2">] = </span><span class="s1">importlib</span>


<span class="s4">class </span><span class="s1">Functor</span><span class="s2">:</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">function</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kargs</span><span class="s2">):</span>
        <span class="s4">assert </span><span class="s1">callable</span><span class="s2">(</span><span class="s1">function</span><span class="s2">), </span><span class="s3">&quot;function should be a callable obj&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_function </span><span class="s2">= </span><span class="s1">function</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_args </span><span class="s2">= </span><span class="s1">args</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_kargs </span><span class="s2">= </span><span class="s1">kargs</span>
        <span class="s4">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_function</span><span class="s2">, </span><span class="s3">'__name__'</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">__name__ </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_function</span><span class="s2">.</span><span class="s1">__name__</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">__name__ </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">itype</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_function</span><span class="s2">))</span>
        <span class="s4">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_function</span><span class="s2">, </span><span class="s3">'__doc__'</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_function</span><span class="s2">.</span><span class="s1">__doc__</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__name__</span>

    <span class="s4">def </span><span class="s1">destroy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_function</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_args</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_kargs</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__name__</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__doc__</span>

    <span class="s4">def </span><span class="s1">_do__call__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kargs</span><span class="s2">):</span>
        <span class="s1">_kargs </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_kargs</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">_kargs</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">kargs</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_function</span><span class="s2">(*(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_args </span><span class="s2">+ </span><span class="s1">args</span><span class="s2">), **</span><span class="s1">_kargs</span><span class="s2">)</span>

    <span class="s1">__call__ </span><span class="s2">= </span><span class="s1">_do__call__</span>

    <span class="s4">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s3">'Functor(%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_function</span><span class="s2">.</span><span class="s1">__name__</span>
        <span class="s4">for </span><span class="s1">arg </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_args</span><span class="s2">:</span>
            <span class="s4">try</span><span class="s2">:</span>
                <span class="s1">argStr </span><span class="s2">= </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">)</span>
            <span class="s4">except</span><span class="s2">:</span>
                <span class="s1">argStr </span><span class="s2">= </span><span class="s3">'bad repr: %s' </span><span class="s2">% </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">__class__</span>
            <span class="s1">s </span><span class="s2">+= </span><span class="s3">', %s' </span><span class="s2">% </span><span class="s1">argStr</span>
        <span class="s4">for </span><span class="s1">karg</span><span class="s2">, </span><span class="s1">value </span><span class="s4">in </span><span class="s1">list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_kargs</span><span class="s2">.</span><span class="s1">items</span><span class="s2">()):</span>
            <span class="s1">s </span><span class="s2">+= </span><span class="s3">', %s=%s' </span><span class="s2">% (</span><span class="s1">karg</span><span class="s2">, </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">value</span><span class="s2">))</span>
        <span class="s1">s </span><span class="s2">+= </span><span class="s3">')'</span>
        <span class="s4">return </span><span class="s1">s</span>

<span class="s4">class </span><span class="s1">Stack</span><span class="s2">:</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__list </span><span class="s2">= []</span>
    <span class="s4">def </span><span class="s1">push</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">item</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__list</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>
    <span class="s4">def </span><span class="s1">top</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># return the item on the top of the stack without popping it off</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__list</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]</span>
    <span class="s4">def </span><span class="s1">pop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__list</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
    <span class="s4">def </span><span class="s1">clear</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__list </span><span class="s2">= []</span>
    <span class="s4">def </span><span class="s1">isEmpty</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__list</span><span class="s2">) == </span><span class="s5">0</span>
    <span class="s4">def </span><span class="s1">__len__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__list</span><span class="s2">)</span>

<span class="s4">class </span><span class="s1">Queue</span><span class="s2">:</span>
    <span class="s6"># FIFO queue</span>
    <span class="s6"># interface is intentionally identical to Stack (LIFO)</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__list </span><span class="s2">= []</span>
    <span class="s4">def </span><span class="s1">push</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">item</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__list</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>
    <span class="s4">def </span><span class="s1">top</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># return the next item at the front of the queue without popping it off</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__list</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
    <span class="s4">def </span><span class="s1">front</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__list</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
    <span class="s4">def </span><span class="s1">back</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__list</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]</span>
    <span class="s4">def </span><span class="s1">pop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__list</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s4">def </span><span class="s1">clear</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__list </span><span class="s2">= []</span>
    <span class="s4">def </span><span class="s1">isEmpty</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__list</span><span class="s2">) == </span><span class="s5">0</span>
    <span class="s4">def </span><span class="s1">__len__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__list</span><span class="s2">)</span>


<span class="s4">def </span><span class="s1">indent</span><span class="s2">(</span><span class="s1">stream</span><span class="s2">, </span><span class="s1">numIndents</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Write str to stream with numIndents in front of it 
    &quot;&quot;&quot;</span>
    <span class="s6"># To match emacs, instead of a tab character we will use 4 spaces</span>
    <span class="s1">stream</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">'    ' </span><span class="s2">* </span><span class="s1">numIndents </span><span class="s2">+ </span><span class="s1">str</span><span class="s2">)</span>


<span class="s4">if __debug__</span><span class="s2">:</span>
    <span class="s4">import </span><span class="s1">traceback</span>
    <span class="s4">import </span><span class="s1">marshal</span>

    <span class="s4">class </span><span class="s1">StackTrace</span><span class="s2">:</span>
        <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">limit</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
            <span class="s0">&quot;&quot;&quot; 
            label is a string (or anything that be be a string) 
            that is printed as part of the trace back. 
            This is just to make it easier to tell what the 
            stack trace is referring to. 
            start is an integer number of stack frames back 
            from the most recent.  (This is automatically 
            bumped up by one to skip the __init__ call 
            to the StackTrace). 
            limit is an integer number of stack frames 
            to record (or None for unlimited). 
            &quot;&quot;&quot;</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">label </span><span class="s2">= </span><span class="s1">label</span>
            <span class="s4">if </span><span class="s1">limit </span><span class="s4">is not None</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">trace </span><span class="s2">= </span><span class="s1">traceback</span><span class="s2">.</span><span class="s1">extract_stack</span><span class="s2">(</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">_getframe</span><span class="s2">(</span><span class="s5">1</span><span class="s2">+</span><span class="s1">start</span><span class="s2">),</span>
                                                     <span class="s1">limit</span><span class="s2">=</span><span class="s1">limit</span><span class="s2">)</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">trace </span><span class="s2">= </span><span class="s1">traceback</span><span class="s2">.</span><span class="s1">extract_stack</span><span class="s2">(</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">_getframe</span><span class="s2">(</span><span class="s5">1</span><span class="s2">+</span><span class="s1">start</span><span class="s2">))</span>

        <span class="s4">def </span><span class="s1">compact</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
            <span class="s1">r </span><span class="s2">= </span><span class="s3">''</span>
            <span class="s1">comma </span><span class="s2">= </span><span class="s3">','</span>
            <span class="s4">for </span><span class="s1">filename</span><span class="s2">, </span><span class="s1">lineNum</span><span class="s2">, </span><span class="s1">funcName</span><span class="s2">, </span><span class="s1">text </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">:</span>
                <span class="s1">r </span><span class="s2">+= </span><span class="s3">'%s.%s:%s%s' </span><span class="s2">% (</span><span class="s1">filename</span><span class="s2">[:</span><span class="s1">filename</span><span class="s2">.</span><span class="s1">rfind</span><span class="s2">(</span><span class="s3">'.py'</span><span class="s2">)][</span><span class="s1">filename</span><span class="s2">.</span><span class="s1">rfind</span><span class="s2">(</span><span class="s3">'</span><span class="s4">\\</span><span class="s3">'</span><span class="s2">)+</span><span class="s5">1</span><span class="s2">:], </span><span class="s1">funcName</span><span class="s2">, </span><span class="s1">lineNum</span><span class="s2">, </span><span class="s1">comma</span><span class="s2">)</span>
            <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">r</span><span class="s2">):</span>
                <span class="s1">r </span><span class="s2">= </span><span class="s1">r</span><span class="s2">[:-</span><span class="s1">len</span><span class="s2">(</span><span class="s1">comma</span><span class="s2">)]</span>
            <span class="s4">return </span><span class="s1">r</span>

        <span class="s4">def </span><span class="s1">reverseCompact</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
            <span class="s1">r </span><span class="s2">= </span><span class="s3">''</span>
            <span class="s1">comma </span><span class="s2">= </span><span class="s3">','</span>
            <span class="s4">for </span><span class="s1">filename</span><span class="s2">, </span><span class="s1">lineNum</span><span class="s2">, </span><span class="s1">funcName</span><span class="s2">, </span><span class="s1">text </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">:</span>
                <span class="s1">r </span><span class="s2">= </span><span class="s3">'%s.%s:%s%s%s' </span><span class="s2">% (</span><span class="s1">filename</span><span class="s2">[:</span><span class="s1">filename</span><span class="s2">.</span><span class="s1">rfind</span><span class="s2">(</span><span class="s3">'.py'</span><span class="s2">)][</span><span class="s1">filename</span><span class="s2">.</span><span class="s1">rfind</span><span class="s2">(</span><span class="s3">'</span><span class="s4">\\</span><span class="s3">'</span><span class="s2">)+</span><span class="s5">1</span><span class="s2">:], </span><span class="s1">funcName</span><span class="s2">, </span><span class="s1">lineNum</span><span class="s2">, </span><span class="s1">comma</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>
            <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">r</span><span class="s2">):</span>
                <span class="s1">r </span><span class="s2">= </span><span class="s1">r</span><span class="s2">[:-</span><span class="s1">len</span><span class="s2">(</span><span class="s1">comma</span><span class="s2">)]</span>
            <span class="s4">return </span><span class="s1">r</span>

        <span class="s4">def </span><span class="s1">__str__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
            <span class="s1">r </span><span class="s2">= </span><span class="s3">&quot;Debug stack trace of %s (back %s frames):</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s2">%(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">label</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">),)</span>
            <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">traceback</span><span class="s2">.</span><span class="s1">format_list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">):</span>
                <span class="s1">r</span><span class="s2">+=</span><span class="s1">i</span>
            <span class="s1">r</span><span class="s2">+=</span><span class="s3">&quot;***** NOTE: This is not a crash. This is a debug stack trace. *****&quot;</span>
            <span class="s4">return </span><span class="s1">r</span>

    <span class="s4">def </span><span class="s1">printStack</span><span class="s2">():</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">StackTrace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s5">1</span><span class="s2">).</span><span class="s1">compact</span><span class="s2">())</span>
        <span class="s4">return True</span>
    <span class="s4">def </span><span class="s1">printReverseStack</span><span class="s2">():</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">StackTrace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s5">1</span><span class="s2">).</span><span class="s1">reverseCompact</span><span class="s2">())</span>
        <span class="s4">return True</span>
    <span class="s4">def </span><span class="s1">printVerboseStack</span><span class="s2">():</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">StackTrace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s5">1</span><span class="s2">))</span>
        <span class="s4">return True</span>

    <span class="s6">#-----------------------------------------------------------------------------</span>

    <span class="s4">def </span><span class="s1">traceFunctionCall</span><span class="s2">(</span><span class="s1">frame</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        return a string that shows the call frame with calling arguments. 
        e.g. 
        foo(x=234, y=135) 
        &quot;&quot;&quot;</span>
        <span class="s1">f </span><span class="s2">= </span><span class="s1">frame</span>
        <span class="s1">co </span><span class="s2">= </span><span class="s1">f</span><span class="s2">.</span><span class="s1">f_code</span>
        <span class="s1">dict </span><span class="s2">= </span><span class="s1">f</span><span class="s2">.</span><span class="s1">f_locals</span>
        <span class="s1">n </span><span class="s2">= </span><span class="s1">co</span><span class="s2">.</span><span class="s1">co_argcount</span>
        <span class="s4">if </span><span class="s1">co</span><span class="s2">.</span><span class="s1">co_flags </span><span class="s2">&amp; </span><span class="s5">4</span><span class="s2">: </span><span class="s1">n </span><span class="s2">= </span><span class="s1">n</span><span class="s2">+</span><span class="s5">1</span>
        <span class="s4">if </span><span class="s1">co</span><span class="s2">.</span><span class="s1">co_flags </span><span class="s2">&amp; </span><span class="s5">8</span><span class="s2">: </span><span class="s1">n </span><span class="s2">= </span><span class="s1">n</span><span class="s2">+</span><span class="s5">1</span>
        <span class="s1">r</span><span class="s2">=</span><span class="s3">''</span>
        <span class="s4">if </span><span class="s3">'self' </span><span class="s4">in </span><span class="s1">dict</span><span class="s2">:</span>
            <span class="s1">r </span><span class="s2">= </span><span class="s3">'%s.'</span><span class="s2">%(</span><span class="s1">dict</span><span class="s2">[</span><span class="s3">'self'</span><span class="s2">].</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">,)</span>
        <span class="s1">r</span><span class="s2">+=</span><span class="s3">&quot;%s(&quot;</span><span class="s2">%(</span><span class="s1">f</span><span class="s2">.</span><span class="s1">f_code</span><span class="s2">.</span><span class="s1">co_name</span><span class="s2">,)</span>
        <span class="s1">comma</span><span class="s2">=</span><span class="s5">0 </span><span class="s6"># formatting, whether we should type a comma.</span>
        <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
            <span class="s1">name </span><span class="s2">= </span><span class="s1">co</span><span class="s2">.</span><span class="s1">co_varnames</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
            <span class="s4">if </span><span class="s1">name</span><span class="s2">==</span><span class="s3">'self'</span><span class="s2">:</span>
                <span class="s4">continue</span>
            <span class="s4">if </span><span class="s1">comma</span><span class="s2">:</span>
                <span class="s1">r</span><span class="s2">+=</span><span class="s3">', '</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s6"># ok, we skipped the first one, the rest get commas:</span>
                <span class="s1">comma</span><span class="s2">=</span><span class="s5">1</span>
            <span class="s1">r</span><span class="s2">+=</span><span class="s1">name</span>
            <span class="s1">r</span><span class="s2">+=</span><span class="s3">'='</span>
            <span class="s4">if </span><span class="s1">name </span><span class="s4">in </span><span class="s1">dict</span><span class="s2">:</span>
                <span class="s1">v</span><span class="s2">=</span><span class="s1">safeRepr</span><span class="s2">(</span><span class="s1">dict</span><span class="s2">[</span><span class="s1">name</span><span class="s2">])</span>
                <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">v</span><span class="s2">)&gt;</span><span class="s5">2000</span><span class="s2">:</span>
                    <span class="s6"># r+=&quot;&lt;too big for debug&gt;&quot;</span>
                    <span class="s1">r </span><span class="s2">+= (</span><span class="s1">v</span><span class="s2">[:</span><span class="s5">2000</span><span class="s2">] + </span><span class="s3">&quot;...&quot;</span><span class="s2">)</span>
                <span class="s4">else</span><span class="s2">:</span>
                    <span class="s1">r</span><span class="s2">+=</span><span class="s1">v</span>
            <span class="s4">else</span><span class="s2">: </span><span class="s1">r</span><span class="s2">+=</span><span class="s3">&quot;*** undefined ***&quot;</span>
        <span class="s4">return </span><span class="s1">r</span><span class="s2">+</span><span class="s3">')'</span>

    <span class="s4">def </span><span class="s1">traceParentCall</span><span class="s2">():</span>
        <span class="s4">return </span><span class="s1">traceFunctionCall</span><span class="s2">(</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">_getframe</span><span class="s2">(</span><span class="s5">2</span><span class="s2">))</span>

    <span class="s4">def </span><span class="s1">printThisCall</span><span class="s2">():</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">traceFunctionCall</span><span class="s2">(</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">_getframe</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)))</span>
        <span class="s4">return </span><span class="s5">1 </span><span class="s6"># to allow &quot;assert printThisCall()&quot;</span>

<span class="s6"># Magic numbers: These are the bit masks in func_code.co_flags that</span>
<span class="s6"># reveal whether or not the function has a *arg or **kw argument.</span>
<span class="s1">_POS_LIST </span><span class="s2">= </span><span class="s5">4</span>
<span class="s1">_KEY_DICT </span><span class="s2">= </span><span class="s5">8</span>

<span class="s4">def </span><span class="s1">doc</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">):</span>
    <span class="s4">if </span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">MethodType</span><span class="s2">)) </span><span class="s4">or </span><span class="s1">\</span>
       <span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">FunctionType</span><span class="s2">)):</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">__doc__</span><span class="s2">)</span>

<span class="s4">def </span><span class="s1">adjust</span><span class="s2">(</span><span class="s1">command </span><span class="s2">= </span><span class="s4">None</span><span class="s2">, </span><span class="s1">dim </span><span class="s2">= </span><span class="s5">1</span><span class="s2">, </span><span class="s1">parent </span><span class="s2">= </span><span class="s4">None</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    adjust(command = None, parent = None, **kw) 
    Popup and entry scale to adjust a parameter 
 
    Accepts any Slider keyword argument.  Typical arguments include: 
    command: The one argument command to execute 
    min: The min value of the slider 
    max: The max value of the slider 
    resolution: The resolution of the slider 
    text: The label on the slider 
 
    These values can be accessed and/or changed after the fact 
    &gt;&gt;&gt; vg = adjust() 
    &gt;&gt;&gt; vg['min'] 
    0.0 
    &gt;&gt;&gt; vg['min'] = 10.0 
    &gt;&gt;&gt; vg['min'] 
    10.0 
    &quot;&quot;&quot;</span>
    <span class="s6"># Make sure we enable Tk</span>
    <span class="s6"># Don't use a regular import, to prevent ModuleFinder from picking</span>
    <span class="s6"># it up as a dependency when building a .p3d package.</span>
    <span class="s1">Valuator </span><span class="s2">= </span><span class="s1">importlib</span><span class="s2">.</span><span class="s1">import_module</span><span class="s2">(</span><span class="s3">'direct.tkwidgets.Valuator'</span><span class="s2">)</span>
    <span class="s6"># Set command if specified</span>
    <span class="s4">if </span><span class="s1">command</span><span class="s2">:</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'command'</span><span class="s2">] = </span><span class="s4">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">command</span><span class="s2">(*</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">parent </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">kw</span><span class="s2">[</span><span class="s3">'title'</span><span class="s2">] = </span><span class="s1">command</span><span class="s2">.</span><span class="s1">__name__</span>
    <span class="s1">kw</span><span class="s2">[</span><span class="s3">'dim'</span><span class="s2">] = </span><span class="s1">dim</span>
    <span class="s6"># Create toplevel if needed</span>
    <span class="s4">if not </span><span class="s1">parent</span><span class="s2">:</span>
        <span class="s1">vg </span><span class="s2">= </span><span class="s1">Valuator</span><span class="s2">.</span><span class="s1">ValuatorGroupPanel</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s1">vg </span><span class="s2">= </span><span class="s1">Valuator</span><span class="s2">.</span><span class="s1">ValuatorGroup</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>
        <span class="s1">vg</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">expand </span><span class="s2">= </span><span class="s5">1</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s3">'x'</span><span class="s2">)</span>
    <span class="s4">return </span><span class="s1">vg</span>

<span class="s4">def </span><span class="s1">difference</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    difference(list, list): 
    &quot;&quot;&quot;</span>
    <span class="s4">if not </span><span class="s1">a</span><span class="s2">: </span><span class="s4">return </span><span class="s1">b</span>
    <span class="s4">if not </span><span class="s1">b</span><span class="s2">: </span><span class="s4">return </span><span class="s1">a</span>
    <span class="s1">d </span><span class="s2">= []</span>
    <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">a</span><span class="s2">:</span>
        <span class="s4">if </span><span class="s2">(</span><span class="s1">i </span><span class="s4">not in </span><span class="s1">b</span><span class="s2">) </span><span class="s4">and </span><span class="s2">(</span><span class="s1">i </span><span class="s4">not in </span><span class="s1">d</span><span class="s2">):</span>
            <span class="s1">d</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)</span>
    <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">b</span><span class="s2">:</span>
        <span class="s4">if </span><span class="s2">(</span><span class="s1">i </span><span class="s4">not in </span><span class="s1">a</span><span class="s2">) </span><span class="s4">and </span><span class="s2">(</span><span class="s1">i </span><span class="s4">not in </span><span class="s1">d</span><span class="s2">):</span>
            <span class="s1">d</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)</span>
    <span class="s4">return </span><span class="s1">d</span>

<span class="s4">def </span><span class="s1">intersection</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    intersection(list, list): 
    &quot;&quot;&quot;</span>
    <span class="s4">if not </span><span class="s1">a</span><span class="s2">: </span><span class="s4">return </span><span class="s2">[]</span>
    <span class="s4">if not </span><span class="s1">b</span><span class="s2">: </span><span class="s4">return </span><span class="s2">[]</span>
    <span class="s1">d </span><span class="s2">= []</span>
    <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">a</span><span class="s2">:</span>
        <span class="s4">if </span><span class="s2">(</span><span class="s1">i </span><span class="s4">in </span><span class="s1">b</span><span class="s2">) </span><span class="s4">and </span><span class="s2">(</span><span class="s1">i </span><span class="s4">not in </span><span class="s1">d</span><span class="s2">):</span>
            <span class="s1">d</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)</span>
    <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">b</span><span class="s2">:</span>
        <span class="s4">if </span><span class="s2">(</span><span class="s1">i </span><span class="s4">in </span><span class="s1">a</span><span class="s2">) </span><span class="s4">and </span><span class="s2">(</span><span class="s1">i </span><span class="s4">not in </span><span class="s1">d</span><span class="s2">):</span>
            <span class="s1">d</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)</span>
    <span class="s4">return </span><span class="s1">d</span>

<span class="s4">def </span><span class="s1">union</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    union(list, list): 
    &quot;&quot;&quot;</span>
    <span class="s6"># Copy a</span>
    <span class="s1">c </span><span class="s2">= </span><span class="s1">a</span><span class="s2">[:]</span>
    <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">b</span><span class="s2">:</span>
        <span class="s4">if </span><span class="s2">(</span><span class="s1">i </span><span class="s4">not in </span><span class="s1">c</span><span class="s2">):</span>
            <span class="s1">c</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)</span>
    <span class="s4">return </span><span class="s1">c</span>

<span class="s4">def </span><span class="s1">sameElements</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">a</span><span class="s2">) != </span><span class="s1">len</span><span class="s2">(</span><span class="s1">b</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s5">0</span>
    <span class="s4">for </span><span class="s1">elem </span><span class="s4">in </span><span class="s1">a</span><span class="s2">:</span>
        <span class="s4">if </span><span class="s1">elem </span><span class="s4">not in </span><span class="s1">b</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s5">0</span>
    <span class="s4">for </span><span class="s1">elem </span><span class="s4">in </span><span class="s1">b</span><span class="s2">:</span>
        <span class="s4">if </span><span class="s1">elem </span><span class="s4">not in </span><span class="s1">a</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s5">0</span>
    <span class="s4">return </span><span class="s5">1</span>

<span class="s4">def </span><span class="s1">makeList</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;returns x, converted to a list&quot;&quot;&quot;</span>
    <span class="s4">if </span><span class="s1">type</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s4">is </span><span class="s1">list</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">x</span>
    <span class="s4">elif </span><span class="s1">type</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s4">is </span><span class="s1">tuple</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">list</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s2">[</span><span class="s1">x</span><span class="s2">,]</span>

<span class="s4">def </span><span class="s1">makeTuple</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;returns x, converted to a tuple&quot;&quot;&quot;</span>
    <span class="s4">if </span><span class="s1">type</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s4">is </span><span class="s1">list</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s4">elif </span><span class="s1">type</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s4">is </span><span class="s1">tuple</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">x</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s2">(</span><span class="s1">x</span><span class="s2">,)</span>

<span class="s4">def </span><span class="s1">list2dict</span><span class="s2">(</span><span class="s1">L</span><span class="s2">, </span><span class="s1">value</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;creates dict using elements of list, all assigned to same value&quot;&quot;&quot;</span>
    <span class="s4">return </span><span class="s1">dict</span><span class="s2">([(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) </span><span class="s4">for </span><span class="s1">k </span><span class="s4">in </span><span class="s1">L</span><span class="s2">])</span>

<span class="s4">def </span><span class="s1">listToIndex2item</span><span class="s2">(</span><span class="s1">L</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;converts list to dict of list index-&gt;list item&quot;&quot;&quot;</span>
    <span class="s1">d </span><span class="s2">= {}</span>
    <span class="s4">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">item </span><span class="s4">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">L</span><span class="s2">):</span>
        <span class="s1">d</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">item</span>
    <span class="s4">return </span><span class="s1">d</span>

<span class="s4">assert </span><span class="s1">listToIndex2item</span><span class="s2">([</span><span class="s3">'a'</span><span class="s2">,</span><span class="s3">'b'</span><span class="s2">]) == {</span><span class="s5">0</span><span class="s2">: </span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">: </span><span class="s3">'b'</span><span class="s2">,}</span>

<span class="s4">def </span><span class="s1">listToItem2index</span><span class="s2">(</span><span class="s1">L</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;converts list to dict of list item-&gt;list index 
    This is lossy if there are duplicate list items&quot;&quot;&quot;</span>
    <span class="s1">d </span><span class="s2">= {}</span>
    <span class="s4">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">item </span><span class="s4">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">L</span><span class="s2">):</span>
        <span class="s1">d</span><span class="s2">[</span><span class="s1">item</span><span class="s2">] = </span><span class="s1">i</span>
    <span class="s4">return </span><span class="s1">d</span>

<span class="s4">assert </span><span class="s1">listToItem2index</span><span class="s2">([</span><span class="s3">'a'</span><span class="s2">,</span><span class="s3">'b'</span><span class="s2">]) == {</span><span class="s3">'a'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">: </span><span class="s5">1</span><span class="s2">,}</span>

<span class="s4">def </span><span class="s1">invertDict</span><span class="s2">(</span><span class="s1">D</span><span class="s2">, </span><span class="s1">lossy</span><span class="s2">=</span><span class="s4">False</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;creates a dictionary by 'inverting' D; keys are placed in the new 
    dictionary under their corresponding value in the old dictionary. 
    It is an error if D contains any duplicate values. 
 
    &gt;&gt;&gt; old = {'key1':1, 'key2':2} 
    &gt;&gt;&gt; invertDict(old) 
    {1: 'key1', 2: 'key2'} 
    &quot;&quot;&quot;</span>
    <span class="s1">n </span><span class="s2">= {}</span>
    <span class="s4">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s4">in </span><span class="s1">D</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
        <span class="s4">if not </span><span class="s1">lossy </span><span class="s4">and </span><span class="s1">value </span><span class="s4">in </span><span class="s1">n</span><span class="s2">:</span>
            <span class="s4">raise </span><span class="s1">Exception</span><span class="s2">(</span><span class="s3">'duplicate key in invertDict: %s' </span><span class="s2">% </span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">n</span><span class="s2">[</span><span class="s1">value</span><span class="s2">] = </span><span class="s1">key</span>
    <span class="s4">return </span><span class="s1">n</span>

<span class="s4">def </span><span class="s1">invertDictLossless</span><span class="s2">(</span><span class="s1">D</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;similar to invertDict, but values of new dict are lists of keys from 
    old dict. No information is lost. 
 
    &gt;&gt;&gt; old = {'key1':1, 'key2':2, 'keyA':2} 
    &gt;&gt;&gt; invertDictLossless(old) 
    {1: ['key1'], 2: ['key2', 'keyA']} 
    &quot;&quot;&quot;</span>
    <span class="s1">n </span><span class="s2">= {}</span>
    <span class="s4">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s4">in </span><span class="s1">D</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
        <span class="s1">n</span><span class="s2">.</span><span class="s1">setdefault</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, [])</span>
        <span class="s1">n</span><span class="s2">[</span><span class="s1">value</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s1">key</span><span class="s2">)</span>
    <span class="s4">return </span><span class="s1">n</span>

<span class="s4">def </span><span class="s1">uniqueElements</span><span class="s2">(</span><span class="s1">L</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;are all elements of list unique?&quot;&quot;&quot;</span>
    <span class="s4">return </span><span class="s1">len</span><span class="s2">(</span><span class="s1">L</span><span class="s2">) == </span><span class="s1">len</span><span class="s2">(</span><span class="s1">list2dict</span><span class="s2">(</span><span class="s1">L</span><span class="s2">))</span>

<span class="s4">def </span><span class="s1">disjoint</span><span class="s2">(</span><span class="s1">L1</span><span class="s2">, </span><span class="s1">L2</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;returns non-zero if L1 and L2 have no common elements&quot;&quot;&quot;</span>
    <span class="s1">used </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">([(</span><span class="s1">k</span><span class="s2">, </span><span class="s4">None</span><span class="s2">) </span><span class="s4">for </span><span class="s1">k </span><span class="s4">in </span><span class="s1">L1</span><span class="s2">])</span>
    <span class="s4">for </span><span class="s1">k </span><span class="s4">in </span><span class="s1">L2</span><span class="s2">:</span>
        <span class="s4">if </span><span class="s1">k </span><span class="s4">in </span><span class="s1">used</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s5">0</span>
    <span class="s4">return </span><span class="s5">1</span>

<span class="s4">def </span><span class="s1">contains</span><span class="s2">(</span><span class="s1">whole</span><span class="s2">, </span><span class="s1">sub</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Return 1 if whole contains sub, 0 otherwise 
    &quot;&quot;&quot;</span>
    <span class="s4">if </span><span class="s2">(</span><span class="s1">whole </span><span class="s2">== </span><span class="s1">sub</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s5">1</span>
    <span class="s4">for </span><span class="s1">elem </span><span class="s4">in </span><span class="s1">sub</span><span class="s2">:</span>
        <span class="s6"># The first item you find not in whole, return 0</span>
        <span class="s4">if </span><span class="s1">elem </span><span class="s4">not in </span><span class="s1">whole</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s5">0</span>
    <span class="s6"># If you got here, whole must contain sub</span>
    <span class="s4">return </span><span class="s5">1</span>

<span class="s4">def </span><span class="s1">replace</span><span class="s2">(</span><span class="s1">list</span><span class="s2">, </span><span class="s1">old</span><span class="s2">, </span><span class="s1">new</span><span class="s2">, </span><span class="s1">all</span><span class="s2">=</span><span class="s5">0</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    replace 'old' with 'new' in 'list' 
    if all == 0, replace first occurrence 
    otherwise replace all occurrences 
    returns the number of items replaced 
    &quot;&quot;&quot;</span>
    <span class="s4">if </span><span class="s1">old </span><span class="s4">not in </span><span class="s1">list</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s5">0</span>

    <span class="s4">if not </span><span class="s1">all</span><span class="s2">:</span>
        <span class="s1">i </span><span class="s2">= </span><span class="s1">list</span><span class="s2">.</span><span class="s1">index</span><span class="s2">(</span><span class="s1">old</span><span class="s2">)</span>
        <span class="s1">list</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">new</span>
        <span class="s4">return </span><span class="s5">1</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s1">numReplaced </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">xrange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">list</span><span class="s2">)):</span>
            <span class="s4">if </span><span class="s1">list</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] == </span><span class="s1">old</span><span class="s2">:</span>
                <span class="s1">numReplaced </span><span class="s2">+= </span><span class="s5">1</span>
                <span class="s1">list</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">new</span>
        <span class="s4">return </span><span class="s1">numReplaced</span>

<span class="s1">rad90 </span><span class="s2">= </span><span class="s1">math</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">/ </span><span class="s5">2.</span>
<span class="s1">rad180 </span><span class="s2">= </span><span class="s1">math</span><span class="s2">.</span><span class="s1">pi</span>
<span class="s1">rad270 </span><span class="s2">= </span><span class="s5">1.5 </span><span class="s2">* </span><span class="s1">math</span><span class="s2">.</span><span class="s1">pi</span>
<span class="s1">rad360 </span><span class="s2">= </span><span class="s5">2. </span><span class="s2">* </span><span class="s1">math</span><span class="s2">.</span><span class="s1">pi</span>

<span class="s4">def </span><span class="s1">reduceAngle</span><span class="s2">(</span><span class="s1">deg</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Reduces an angle (in degrees) to a value in [-180..180) 
    &quot;&quot;&quot;</span>
    <span class="s4">return </span><span class="s2">(((</span><span class="s1">deg </span><span class="s2">+ </span><span class="s5">180.</span><span class="s2">) % </span><span class="s5">360.</span><span class="s2">) - </span><span class="s5">180.</span><span class="s2">)</span>

<span class="s4">def </span><span class="s1">fitSrcAngle2Dest</span><span class="s2">(</span><span class="s1">src</span><span class="s2">, </span><span class="s1">dest</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    given a src and destination angle, returns an equivalent src angle 
    that is within [-180..180) of dest 
    examples: 
    fitSrcAngle2Dest(30, 60) == 30 
    fitSrcAngle2Dest(60, 30) == 60 
    fitSrcAngle2Dest(0, 180) == 0 
    fitSrcAngle2Dest(-1, 180) == 359 
    fitSrcAngle2Dest(-180, 180) == 180 
    &quot;&quot;&quot;</span>
    <span class="s4">return </span><span class="s1">dest </span><span class="s2">+ </span><span class="s1">reduceAngle</span><span class="s2">(</span><span class="s1">src </span><span class="s2">- </span><span class="s1">dest</span><span class="s2">)</span>

<span class="s4">def </span><span class="s1">fitDestAngle2Src</span><span class="s2">(</span><span class="s1">src</span><span class="s2">, </span><span class="s1">dest</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    given a src and destination angle, returns an equivalent dest angle 
    that is within [-180..180) of src 
    examples: 
    fitDestAngle2Src(30, 60) == 60 
    fitDestAngle2Src(60, 30) == 30 
    fitDestAngle2Src(0, 180) == -180 
    fitDestAngle2Src(1, 180) == 180 
    &quot;&quot;&quot;</span>
    <span class="s4">return </span><span class="s1">src </span><span class="s2">+ (</span><span class="s1">reduceAngle</span><span class="s2">(</span><span class="s1">dest </span><span class="s2">- </span><span class="s1">src</span><span class="s2">))</span>

<span class="s4">def </span><span class="s1">closestDestAngle2</span><span class="s2">(</span><span class="s1">src</span><span class="s2">, </span><span class="s1">dest</span><span class="s2">):</span>
    <span class="s6"># The function above didn't seem to do what I wanted. So I hacked</span>
    <span class="s6"># this one together. I can't really say I understand it. It's more</span>
    <span class="s6"># from impirical observation... GRW</span>
    <span class="s1">diff </span><span class="s2">= </span><span class="s1">src </span><span class="s2">- </span><span class="s1">dest</span>
    <span class="s4">if </span><span class="s1">diff </span><span class="s2">&gt; </span><span class="s5">180</span><span class="s2">:</span>
        <span class="s6"># if the difference is greater that 180 it's shorter to go the other way</span>
        <span class="s4">return </span><span class="s1">dest </span><span class="s2">- </span><span class="s5">360</span>
    <span class="s4">elif </span><span class="s1">diff </span><span class="s2">&lt; -</span><span class="s5">180</span><span class="s2">:</span>
        <span class="s6"># or perhaps the OTHER other way...</span>
        <span class="s4">return </span><span class="s1">dest </span><span class="s2">+ </span><span class="s5">360</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s6"># otherwise just go to the original destination</span>
        <span class="s4">return </span><span class="s1">dest</span>

<span class="s4">def </span><span class="s1">closestDestAngle</span><span class="s2">(</span><span class="s1">src</span><span class="s2">, </span><span class="s1">dest</span><span class="s2">):</span>
    <span class="s6"># The function above didn't seem to do what I wanted. So I hacked</span>
    <span class="s6"># this one together. I can't really say I understand it. It's more</span>
    <span class="s6"># from impirical observation... GRW</span>
    <span class="s1">diff </span><span class="s2">= </span><span class="s1">src </span><span class="s2">- </span><span class="s1">dest</span>
    <span class="s4">if </span><span class="s1">diff </span><span class="s2">&gt; </span><span class="s5">180</span><span class="s2">:</span>
        <span class="s6"># if the difference is greater that 180 it's shorter to go the other way</span>
        <span class="s4">return </span><span class="s1">src </span><span class="s2">- (</span><span class="s1">diff </span><span class="s2">- </span><span class="s5">360</span><span class="s2">)</span>
    <span class="s4">elif </span><span class="s1">diff </span><span class="s2">&lt; -</span><span class="s5">180</span><span class="s2">:</span>
        <span class="s6"># or perhaps the OTHER other way...</span>
        <span class="s4">return </span><span class="s1">src </span><span class="s2">- (</span><span class="s5">360 </span><span class="s2">+ </span><span class="s1">diff</span><span class="s2">)</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s6"># otherwise just go to the original destination</span>
        <span class="s4">return </span><span class="s1">dest</span>

<span class="s4">class </span><span class="s1">StdoutCapture</span><span class="s2">:</span>
    <span class="s6"># redirects stdout to a string</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_oldStdout </span><span class="s2">= </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">stdout</span>
        <span class="s1">sys</span><span class="s2">.</span><span class="s1">stdout </span><span class="s2">= </span><span class="s1">self</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_string </span><span class="s2">= </span><span class="s3">''</span>
    <span class="s4">def </span><span class="s1">destroy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">sys</span><span class="s2">.</span><span class="s1">stdout </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_oldStdout</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_oldStdout</span>

    <span class="s4">def </span><span class="s1">getString</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_string</span>

    <span class="s6"># internal</span>
    <span class="s4">def </span><span class="s1">write</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">string</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_string </span><span class="s2">= </span><span class="s3">''</span><span class="s2">.</span><span class="s1">join</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_string</span><span class="s2">, </span><span class="s1">string</span><span class="s2">])</span>

<span class="s4">class </span><span class="s1">StdoutPassthrough</span><span class="s2">(</span><span class="s1">StdoutCapture</span><span class="s2">):</span>
    <span class="s6"># like StdoutCapture but also allows output to go through to the OS as normal</span>

    <span class="s6"># internal</span>
    <span class="s4">def </span><span class="s1">write</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">string</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_string </span><span class="s2">= </span><span class="s3">''</span><span class="s2">.</span><span class="s1">join</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_string</span><span class="s2">, </span><span class="s1">string</span><span class="s2">])</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_oldStdout</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s1">string</span><span class="s2">)</span>

<span class="s6"># constant profile defaults</span>
<span class="s4">if __debug__</span><span class="s2">:</span>
    <span class="s4">from </span><span class="s1">io </span><span class="s4">import </span><span class="s1">StringIO</span>

    <span class="s1">PyUtilProfileDefaultFilename </span><span class="s2">= </span><span class="s3">'profiledata'</span>
    <span class="s1">PyUtilProfileDefaultLines </span><span class="s2">= </span><span class="s5">80</span>
    <span class="s1">PyUtilProfileDefaultSorts </span><span class="s2">= [</span><span class="s3">'cumulative'</span><span class="s2">, </span><span class="s3">'time'</span><span class="s2">, </span><span class="s3">'calls'</span><span class="s2">]</span>

    <span class="s1">_ProfileResultStr </span><span class="s2">= </span><span class="s3">''</span>

    <span class="s4">def </span><span class="s1">getProfileResultString</span><span class="s2">():</span>
        <span class="s6"># if you called profile with 'log' not set to True,</span>
        <span class="s6"># you can call this function to get the results as</span>
        <span class="s6"># a string</span>
        <span class="s4">global </span><span class="s1">_ProfileResultStr</span>
        <span class="s4">return </span><span class="s1">_ProfileResultStr</span>

    <span class="s4">def </span><span class="s1">profileFunc</span><span class="s2">(</span><span class="s1">callback</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">terse</span><span class="s2">, </span><span class="s1">log</span><span class="s2">=</span><span class="s4">True</span><span class="s2">):</span>
        <span class="s4">global </span><span class="s1">_ProfileResultStr</span>
        <span class="s4">if </span><span class="s3">'globalProfileFunc' </span><span class="s4">in </span><span class="s1">builtins</span><span class="s2">.</span><span class="s1">__dict__</span><span class="s2">:</span>
            <span class="s6"># rats. Python profiler is not re-entrant...</span>
            <span class="s1">base</span><span class="s2">.</span><span class="s1">notify</span><span class="s2">.</span><span class="s1">warning</span><span class="s2">(</span>
                <span class="s3">'PythonUtil.profileStart(%s): aborted, already profiling %s'</span>
                <span class="s6">#'\nStack Trace:\n%s'</span>
                <span class="s2">% (</span><span class="s1">name</span><span class="s2">, </span><span class="s1">builtins</span><span class="s2">.</span><span class="s1">globalProfileFunc</span><span class="s2">,</span>
                <span class="s6">#StackTrace()</span>
                <span class="s2">))</span>
            <span class="s4">return</span>
        <span class="s1">builtins</span><span class="s2">.</span><span class="s1">globalProfileFunc </span><span class="s2">= </span><span class="s1">callback</span>
        <span class="s1">builtins</span><span class="s2">.</span><span class="s1">globalProfileResult </span><span class="s2">= [</span><span class="s4">None</span><span class="s2">]</span>
        <span class="s1">prefix </span><span class="s2">= </span><span class="s3">'***** START PROFILE: %s *****' </span><span class="s2">% </span><span class="s1">name</span>
        <span class="s4">if </span><span class="s1">log</span><span class="s2">:</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">)</span>
        <span class="s1">startProfile</span><span class="s2">(</span><span class="s1">cmd</span><span class="s2">=</span><span class="s3">'globalProfileResult[0]=globalProfileFunc()'</span><span class="s2">, </span><span class="s1">callInfo</span><span class="s2">=(</span><span class="s4">not </span><span class="s1">terse</span><span class="s2">), </span><span class="s1">silent</span><span class="s2">=</span><span class="s4">not </span><span class="s1">log</span><span class="s2">)</span>
        <span class="s1">suffix </span><span class="s2">= </span><span class="s3">'***** END PROFILE: %s *****' </span><span class="s2">% </span><span class="s1">name</span>
        <span class="s4">if </span><span class="s1">log</span><span class="s2">:</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s1">suffix</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">_ProfileResultStr </span><span class="s2">= </span><span class="s3">'%s</span><span class="s4">\n</span><span class="s3">%s</span><span class="s4">\n</span><span class="s3">%s' </span><span class="s2">% (</span><span class="s1">prefix</span><span class="s2">, </span><span class="s1">_ProfileResultStr</span><span class="s2">, </span><span class="s1">suffix</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">globalProfileResult</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s4">del </span><span class="s1">builtins</span><span class="s2">.</span><span class="s1">__dict__</span><span class="s2">[</span><span class="s3">'globalProfileFunc'</span><span class="s2">]</span>
        <span class="s4">del </span><span class="s1">builtins</span><span class="s2">.</span><span class="s1">__dict__</span><span class="s2">[</span><span class="s3">'globalProfileResult'</span><span class="s2">]</span>
        <span class="s4">return </span><span class="s1">result</span>

    <span class="s4">def </span><span class="s1">profiled</span><span class="s2">(</span><span class="s1">category</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, </span><span class="s1">terse</span><span class="s2">=</span><span class="s4">False</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; decorator for profiling functions 
        turn categories on and off via &quot;want-profile-categoryName 1&quot; 
 
        e.g.:: 
 
            @profiled('particles') 
            def loadParticles(): 
                ... 
 
        :: 
 
            want-profile-particles 1 
        &quot;&quot;&quot;</span>
        <span class="s4">assert </span><span class="s1">type</span><span class="s2">(</span><span class="s1">category</span><span class="s2">) </span><span class="s4">in </span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">type</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)), </span><span class="s3">&quot;must provide a category name for @profiled&quot;</span>

        <span class="s6"># allow profiling in published versions</span>
        <span class="s3">&quot;&quot;&quot; 
        try: 
            null = not __dev__ 
        except: 
            null = not __debug__ 
        if null: 
            # if we're not in __dev__, just return the function itself. This 
            # results in zero runtime overhead, since decorators are evaluated 
            # at module-load. 
            def nullDecorator(f): 
                return f 
            return nullDecorator 
        &quot;&quot;&quot;</span>

        <span class="s4">def </span><span class="s1">profileDecorator</span><span class="s2">(</span><span class="s1">f</span><span class="s2">):</span>
            <span class="s4">def </span><span class="s1">_profiled</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kArgs</span><span class="s2">):</span>
                <span class="s1">name </span><span class="s2">= </span><span class="s3">'(%s) %s from %s' </span><span class="s2">% (</span><span class="s1">category</span><span class="s2">, </span><span class="s1">f</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">, </span><span class="s1">f</span><span class="s2">.</span><span class="s1">__module__</span><span class="s2">)</span>

                <span class="s6"># showbase might not be loaded yet, so don't use</span>
                <span class="s6"># base.config.  Instead, query the ConfigVariableBool.</span>
                <span class="s4">if </span><span class="s2">(</span><span class="s1">category </span><span class="s4">is None</span><span class="s2">) </span><span class="s4">or </span><span class="s1">ConfigVariableBool</span><span class="s2">(</span><span class="s3">'want-profile-%s' </span><span class="s2">% </span><span class="s1">category</span><span class="s2">, </span><span class="s5">0</span><span class="s2">).</span><span class="s1">getValue</span><span class="s2">():</span>
                    <span class="s4">return </span><span class="s1">profileFunc</span><span class="s2">(</span><span class="s1">Functor</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kArgs</span><span class="s2">), </span><span class="s1">name</span><span class="s2">, </span><span class="s1">terse</span><span class="s2">)</span>
                <span class="s4">else</span><span class="s2">:</span>
                    <span class="s4">return </span><span class="s1">f</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kArgs</span><span class="s2">)</span>
            <span class="s1">_profiled</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">f</span><span class="s2">.</span><span class="s1">__doc__</span>
            <span class="s4">return </span><span class="s1">_profiled</span>
        <span class="s4">return </span><span class="s1">profileDecorator</span>

    <span class="s6"># intercept profile-related file operations to avoid disk access</span>
    <span class="s1">movedOpenFuncs </span><span class="s2">= []</span>
    <span class="s1">movedDumpFuncs </span><span class="s2">= []</span>
    <span class="s1">movedLoadFuncs </span><span class="s2">= []</span>
    <span class="s1">profileFilenames </span><span class="s2">= </span><span class="s1">set</span><span class="s2">()</span>
    <span class="s1">profileFilenameList </span><span class="s2">= </span><span class="s1">Stack</span><span class="s2">()</span>
    <span class="s1">profileFilename2file </span><span class="s2">= {}</span>
    <span class="s1">profileFilename2marshalData </span><span class="s2">= {}</span>

    <span class="s4">def </span><span class="s1">_profileOpen</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kArgs</span><span class="s2">):</span>
        <span class="s6"># this is a replacement for the file open() builtin function</span>
        <span class="s6"># for use during profiling, to intercept the file open</span>
        <span class="s6"># operation used by the Python profiler and profile stats</span>
        <span class="s6"># systems</span>
        <span class="s4">if </span><span class="s1">filename </span><span class="s4">in </span><span class="s1">profileFilenames</span><span class="s2">:</span>
            <span class="s6"># if this is a file related to profiling, create an</span>
            <span class="s6"># in-RAM file object</span>
            <span class="s4">if </span><span class="s1">filename </span><span class="s4">not in </span><span class="s1">profileFilename2file</span><span class="s2">:</span>
                <span class="s1">file </span><span class="s2">= </span><span class="s1">StringIO</span><span class="s2">()</span>
                <span class="s1">file</span><span class="s2">.</span><span class="s1">_profFilename </span><span class="s2">= </span><span class="s1">filename</span>
                <span class="s1">profileFilename2file</span><span class="s2">[</span><span class="s1">filename</span><span class="s2">] = </span><span class="s1">file</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">file </span><span class="s2">= </span><span class="s1">profileFilename2file</span><span class="s2">[</span><span class="s1">filename</span><span class="s2">]</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">file </span><span class="s2">= </span><span class="s1">movedOpenFuncs</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">](</span><span class="s1">filename</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kArgs</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s1">file</span>

    <span class="s4">def </span><span class="s1">_profileMarshalDump</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">file</span><span class="s2">):</span>
        <span class="s6"># marshal.dump doesn't work with StringIO objects</span>
        <span class="s6"># simulate it</span>
        <span class="s4">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">file</span><span class="s2">, </span><span class="s1">StringIO</span><span class="s2">) </span><span class="s4">and </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">file</span><span class="s2">, </span><span class="s3">'_profFilename'</span><span class="s2">):</span>
            <span class="s4">if </span><span class="s1">file</span><span class="s2">.</span><span class="s1">_profFilename </span><span class="s4">in </span><span class="s1">profileFilenames</span><span class="s2">:</span>
                <span class="s1">profileFilename2marshalData</span><span class="s2">[</span><span class="s1">file</span><span class="s2">.</span><span class="s1">_profFilename</span><span class="s2">] = </span><span class="s1">data</span>
                <span class="s4">return None</span>
        <span class="s4">return </span><span class="s1">movedDumpFuncs</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">](</span><span class="s1">data</span><span class="s2">, </span><span class="s1">file</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_profileMarshalLoad</span><span class="s2">(</span><span class="s1">file</span><span class="s2">):</span>
        <span class="s6"># marshal.load doesn't work with StringIO objects</span>
        <span class="s6"># simulate it</span>
        <span class="s4">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">file</span><span class="s2">, </span><span class="s1">StringIO</span><span class="s2">) </span><span class="s4">and </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">file</span><span class="s2">, </span><span class="s3">'_profFilename'</span><span class="s2">):</span>
            <span class="s4">if </span><span class="s1">file</span><span class="s2">.</span><span class="s1">_profFilename </span><span class="s4">in </span><span class="s1">profileFilenames</span><span class="s2">:</span>
                <span class="s4">return </span><span class="s1">profileFilename2marshalData</span><span class="s2">[</span><span class="s1">file</span><span class="s2">.</span><span class="s1">_profFilename</span><span class="s2">]</span>
        <span class="s4">return </span><span class="s1">movedLoadFuncs</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">](</span><span class="s1">file</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_installProfileCustomFuncs</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">):</span>
        <span class="s4">assert </span><span class="s1">filename </span><span class="s4">not in </span><span class="s1">profileFilenames</span>
        <span class="s1">profileFilenames</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">)</span>
        <span class="s1">profileFilenameList</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">)</span>
        <span class="s1">movedOpenFuncs</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">builtins</span><span class="s2">.</span><span class="s1">open</span><span class="s2">)</span>
        <span class="s1">builtins</span><span class="s2">.</span><span class="s1">open </span><span class="s2">= </span><span class="s1">_profileOpen</span>
        <span class="s1">movedDumpFuncs</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">marshal</span><span class="s2">.</span><span class="s1">dump</span><span class="s2">)</span>
        <span class="s1">marshal</span><span class="s2">.</span><span class="s1">dump </span><span class="s2">= </span><span class="s1">_profileMarshalDump</span>
        <span class="s1">movedLoadFuncs</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">marshal</span><span class="s2">.</span><span class="s1">load</span><span class="s2">)</span>
        <span class="s1">marshal</span><span class="s2">.</span><span class="s1">load </span><span class="s2">= </span><span class="s1">_profileMarshalLoad</span>

    <span class="s4">def </span><span class="s1">_getProfileResultFileInfo</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s2">(</span><span class="s1">profileFilename2file</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, </span><span class="s4">None</span><span class="s2">),</span>
                <span class="s1">profileFilename2marshalData</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, </span><span class="s4">None</span><span class="s2">))</span>

    <span class="s4">def </span><span class="s1">_setProfileResultsFileInfo</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, </span><span class="s1">info</span><span class="s2">):</span>
        <span class="s1">f</span><span class="s2">, </span><span class="s1">m </span><span class="s2">= </span><span class="s1">info</span>
        <span class="s4">if </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s1">profileFilename2file</span><span class="s2">[</span><span class="s1">filename</span><span class="s2">] = </span><span class="s1">f</span>
        <span class="s4">if </span><span class="s1">m</span><span class="s2">:</span>
            <span class="s1">profileFilename2marshalData</span><span class="s2">[</span><span class="s1">filename</span><span class="s2">] = </span><span class="s1">m</span>

    <span class="s4">def </span><span class="s1">_clearProfileResultFileInfo</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">):</span>
        <span class="s1">profileFilename2file</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, </span><span class="s4">None</span><span class="s2">)</span>
        <span class="s1">profileFilename2marshalData</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, </span><span class="s4">None</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_removeProfileCustomFuncs</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">):</span>
        <span class="s4">assert </span><span class="s1">profileFilenameList</span><span class="s2">.</span><span class="s1">top</span><span class="s2">() == </span><span class="s1">filename</span>
        <span class="s1">marshal</span><span class="s2">.</span><span class="s1">load </span><span class="s2">= </span><span class="s1">movedLoadFuncs</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
        <span class="s1">marshal</span><span class="s2">.</span><span class="s1">dump </span><span class="s2">= </span><span class="s1">movedDumpFuncs</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
        <span class="s1">builtins</span><span class="s2">.</span><span class="s1">open </span><span class="s2">= </span><span class="s1">movedOpenFuncs</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
        <span class="s1">profileFilenames</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">)</span>
        <span class="s1">profileFilenameList</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
        <span class="s1">profileFilename2file</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, </span><span class="s4">None</span><span class="s2">)</span>
        <span class="s6"># don't let marshalled data pile up</span>
        <span class="s1">profileFilename2marshalData</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, </span><span class="s4">None</span><span class="s2">)</span>


    <span class="s6"># call this from the prompt, and break back out to the prompt</span>
    <span class="s6"># to stop profiling</span>
    <span class="s6">#</span>
    <span class="s6"># OR to do inline profiling, you must make a globally-visible</span>
    <span class="s6"># function to be profiled, i.e. to profile 'self.load()', do</span>
    <span class="s6"># something like this:</span>
    <span class="s6">#</span>
    <span class="s6">#        def func(self=self):</span>
    <span class="s6">#            self.load()</span>
    <span class="s6">#        import builtins</span>
    <span class="s6">#        builtins.func = func</span>
    <span class="s6">#        PythonUtil.startProfile(cmd='func()', filename='profileData')</span>
    <span class="s6">#        del builtins.func</span>
    <span class="s6">#</span>
    <span class="s4">def </span><span class="s1">_profileWithoutGarbageLeak</span><span class="s2">(</span><span class="s1">cmd</span><span class="s2">, </span><span class="s1">filename</span><span class="s2">):</span>
        <span class="s6"># The profile module isn't necessarily installed on every Python</span>
        <span class="s6"># installation, so we import it here, instead of in the module</span>
        <span class="s6"># scope.</span>
        <span class="s4">import </span><span class="s1">profile</span>
        <span class="s6"># this is necessary because the profile module creates a memory leak</span>
        <span class="s1">Profile </span><span class="s2">= </span><span class="s1">profile</span><span class="s2">.</span><span class="s1">Profile</span>
        <span class="s1">statement </span><span class="s2">= </span><span class="s1">cmd</span>
        <span class="s1">sort </span><span class="s2">= -</span><span class="s5">1</span>
        <span class="s1">retVal </span><span class="s2">= </span><span class="s4">None</span>
        <span class="s6">#### COPIED FROM profile.run ####</span>
        <span class="s1">prof </span><span class="s2">= </span><span class="s1">Profile</span><span class="s2">()</span>
        <span class="s4">try</span><span class="s2">:</span>
            <span class="s1">prof </span><span class="s2">= </span><span class="s1">prof</span><span class="s2">.</span><span class="s1">run</span><span class="s2">(</span><span class="s1">statement</span><span class="s2">)</span>
        <span class="s4">except </span><span class="s1">SystemExit</span><span class="s2">:</span>
            <span class="s4">pass</span>
        <span class="s4">if </span><span class="s1">filename </span><span class="s4">is not None</span><span class="s2">:</span>
            <span class="s1">prof</span><span class="s2">.</span><span class="s1">dump_stats</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s6">#return prof.print_stats(sort)  #DCR</span>
            <span class="s1">retVal </span><span class="s2">= </span><span class="s1">prof</span><span class="s2">.</span><span class="s1">print_stats</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">) </span><span class="s6">#DCR</span>
        <span class="s6">#################################</span>
        <span class="s6"># eliminate the garbage leak</span>
        <span class="s4">del </span><span class="s1">prof</span><span class="s2">.</span><span class="s1">dispatcher</span>
        <span class="s4">return </span><span class="s1">retVal</span>

    <span class="s4">def </span><span class="s1">startProfile</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">=</span><span class="s1">PyUtilProfileDefaultFilename</span><span class="s2">,</span>
                     <span class="s1">lines</span><span class="s2">=</span><span class="s1">PyUtilProfileDefaultLines</span><span class="s2">,</span>
                     <span class="s1">sorts</span><span class="s2">=</span><span class="s1">PyUtilProfileDefaultSorts</span><span class="s2">,</span>
                     <span class="s1">silent</span><span class="s2">=</span><span class="s5">0</span><span class="s2">,</span>
                     <span class="s1">callInfo</span><span class="s2">=</span><span class="s5">1</span><span class="s2">,</span>
                     <span class="s1">useDisk</span><span class="s2">=</span><span class="s4">False</span><span class="s2">,</span>
                     <span class="s1">cmd</span><span class="s2">=</span><span class="s3">'run()'</span><span class="s2">):</span>
        <span class="s6"># uniquify the filename to allow multiple processes to profile simultaneously</span>
        <span class="s1">filename </span><span class="s2">= </span><span class="s3">'%s.%s%s' </span><span class="s2">% (</span><span class="s1">filename</span><span class="s2">, </span><span class="s1">randUint31</span><span class="s2">(), </span><span class="s1">randUint31</span><span class="s2">())</span>
        <span class="s4">if not </span><span class="s1">useDisk</span><span class="s2">:</span>
            <span class="s6"># use a RAM file</span>
            <span class="s1">_installProfileCustomFuncs</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">)</span>
        <span class="s1">_profileWithoutGarbageLeak</span><span class="s2">(</span><span class="s1">cmd</span><span class="s2">, </span><span class="s1">filename</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">silent</span><span class="s2">:</span>
            <span class="s1">extractProfile</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, </span><span class="s1">lines</span><span class="s2">, </span><span class="s1">sorts</span><span class="s2">, </span><span class="s1">callInfo</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">printProfile</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, </span><span class="s1">lines</span><span class="s2">, </span><span class="s1">sorts</span><span class="s2">, </span><span class="s1">callInfo</span><span class="s2">)</span>
        <span class="s4">if not </span><span class="s1">useDisk</span><span class="s2">:</span>
            <span class="s6"># discard the RAM file</span>
            <span class="s1">_removeProfileCustomFuncs</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">os</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">)</span>

    <span class="s6"># call these to see the results again, as a string or in the log</span>
    <span class="s4">def </span><span class="s1">printProfile</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">=</span><span class="s1">PyUtilProfileDefaultFilename</span><span class="s2">,</span>
                     <span class="s1">lines</span><span class="s2">=</span><span class="s1">PyUtilProfileDefaultLines</span><span class="s2">,</span>
                     <span class="s1">sorts</span><span class="s2">=</span><span class="s1">PyUtilProfileDefaultSorts</span><span class="s2">,</span>
                     <span class="s1">callInfo</span><span class="s2">=</span><span class="s5">1</span><span class="s2">):</span>
        <span class="s4">import </span><span class="s1">pstats</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">pstats</span><span class="s2">.</span><span class="s1">Stats</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">)</span>
        <span class="s1">s</span><span class="s2">.</span><span class="s1">strip_dirs</span><span class="s2">()</span>
        <span class="s4">for </span><span class="s1">sort </span><span class="s4">in </span><span class="s1">sorts</span><span class="s2">:</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">sort_stats</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">)</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">print_stats</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">)</span>
            <span class="s4">if </span><span class="s1">callInfo</span><span class="s2">:</span>
                <span class="s1">s</span><span class="s2">.</span><span class="s1">print_callees</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">)</span>
                <span class="s1">s</span><span class="s2">.</span><span class="s1">print_callers</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">)</span>

    <span class="s6"># same args as printProfile</span>
    <span class="s4">def </span><span class="s1">extractProfile</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kArgs</span><span class="s2">):</span>
        <span class="s4">global </span><span class="s1">_ProfileResultStr</span>
        <span class="s6"># capture print output</span>
        <span class="s1">sc </span><span class="s2">= </span><span class="s1">StdoutCapture</span><span class="s2">()</span>
        <span class="s6"># print the profile output, redirected to the result string</span>
        <span class="s1">printProfile</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kArgs</span><span class="s2">)</span>
        <span class="s6"># make a copy of the print output</span>
        <span class="s1">_ProfileResultStr </span><span class="s2">= </span><span class="s1">sc</span><span class="s2">.</span><span class="s1">getString</span><span class="s2">()</span>
        <span class="s6"># restore stdout to what it was before</span>
        <span class="s1">sc</span><span class="s2">.</span><span class="s1">destroy</span><span class="s2">()</span>

<span class="s4">def </span><span class="s1">getSetterName</span><span class="s2">(</span><span class="s1">valueName</span><span class="s2">, </span><span class="s1">prefix</span><span class="s2">=</span><span class="s3">'set'</span><span class="s2">):</span>
    <span class="s6"># getSetterName('color') -&gt; 'setColor'</span>
    <span class="s6"># getSetterName('color', 'get') -&gt; 'getColor'</span>
    <span class="s4">return </span><span class="s3">'%s%s%s' </span><span class="s2">% (</span><span class="s1">prefix</span><span class="s2">, </span><span class="s1">valueName</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">upper</span><span class="s2">(), </span><span class="s1">valueName</span><span class="s2">[</span><span class="s5">1</span><span class="s2">:])</span>
<span class="s4">def </span><span class="s1">getSetter</span><span class="s2">(</span><span class="s1">targetObj</span><span class="s2">, </span><span class="s1">valueName</span><span class="s2">, </span><span class="s1">prefix</span><span class="s2">=</span><span class="s3">'set'</span><span class="s2">):</span>
    <span class="s6"># getSetter(smiley, 'pos') -&gt; smiley.setPos</span>
    <span class="s4">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">targetObj</span><span class="s2">, </span><span class="s1">getSetterName</span><span class="s2">(</span><span class="s1">valueName</span><span class="s2">, </span><span class="s1">prefix</span><span class="s2">))</span>

<span class="s4">def </span><span class="s1">mostDerivedLast</span><span class="s2">(</span><span class="s1">classList</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;pass in list of classes. sorts list in-place, with derived classes 
    appearing after their bases&quot;&quot;&quot;</span>

    <span class="s4">class </span><span class="s1">ClassSortKey</span><span class="s2">(</span><span class="s1">object</span><span class="s2">):</span>
        <span class="s1">__slots__ </span><span class="s2">= </span><span class="s3">'classobj'</span><span class="s2">,</span>
        <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">classobj</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">classobj </span><span class="s2">= </span><span class="s1">classobj</span>
        <span class="s4">def </span><span class="s1">__lt__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
            <span class="s4">return </span><span class="s1">issubclass</span><span class="s2">(</span><span class="s1">other</span><span class="s2">.</span><span class="s1">classobj</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">classobj</span><span class="s2">)</span>

    <span class="s1">classList</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">key</span><span class="s2">=</span><span class="s1">ClassSortKey</span><span class="s2">)</span>

<span class="s4">def </span><span class="s1">bound</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">bound1</span><span class="s2">, </span><span class="s1">bound2</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    returns value if value is between bound1 and bound2 
    otherwise returns bound that is closer to value 
    &quot;&quot;&quot;</span>
    <span class="s4">if </span><span class="s1">bound1 </span><span class="s2">&gt; </span><span class="s1">bound2</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">min</span><span class="s2">(</span><span class="s1">max</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">bound2</span><span class="s2">), </span><span class="s1">bound1</span><span class="s2">)</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">min</span><span class="s2">(</span><span class="s1">max</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">bound1</span><span class="s2">), </span><span class="s1">bound2</span><span class="s2">)</span>
<span class="s1">clamp </span><span class="s2">= </span><span class="s1">bound</span>

<span class="s4">def </span><span class="s1">lerp</span><span class="s2">(</span><span class="s1">v0</span><span class="s2">, </span><span class="s1">v1</span><span class="s2">, </span><span class="s1">t</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    returns a value lerped between v0 and v1, according to t 
    t == 0 maps to v0, t == 1 maps to v1 
    &quot;&quot;&quot;</span>
    <span class="s4">return </span><span class="s1">v0 </span><span class="s2">+ ((</span><span class="s1">v1 </span><span class="s2">- </span><span class="s1">v0</span><span class="s2">) * </span><span class="s1">t</span><span class="s2">)</span>

<span class="s4">def </span><span class="s1">getShortestRotation</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Given two heading values, return a tuple describing 
    the shortest interval from 'start' to 'end'.  This tuple 
    can be used to lerp a camera between two rotations 
    while avoiding the 'spin' problem. 
    &quot;&quot;&quot;</span>
    <span class="s1">start</span><span class="s2">, </span><span class="s1">end </span><span class="s2">= </span><span class="s1">start </span><span class="s2">% </span><span class="s5">360</span><span class="s2">, </span><span class="s1">end </span><span class="s2">% </span><span class="s5">360</span>
    <span class="s4">if </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">end </span><span class="s2">- </span><span class="s1">start</span><span class="s2">) &gt; </span><span class="s5">180</span><span class="s2">:</span>
        <span class="s4">if </span><span class="s1">end </span><span class="s2">&lt; </span><span class="s1">start</span><span class="s2">:</span>
            <span class="s1">end </span><span class="s2">+= </span><span class="s5">360</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">start </span><span class="s2">+= </span><span class="s5">360</span>
    <span class="s4">return </span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">)</span>

<span class="s4">def </span><span class="s1">average</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; returns simple average of list of values &quot;&quot;&quot;</span>
    <span class="s1">val </span><span class="s2">= </span><span class="s5">0.</span>
    <span class="s4">for </span><span class="s1">arg </span><span class="s4">in </span><span class="s1">args</span><span class="s2">:</span>
        <span class="s1">val </span><span class="s2">+= </span><span class="s1">arg</span>
    <span class="s4">return </span><span class="s1">val </span><span class="s2">/ </span><span class="s1">len</span><span class="s2">(</span><span class="s1">args</span><span class="s2">)</span>

<span class="s4">class </span><span class="s1">Averager</span><span class="s2">:</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_name </span><span class="s2">= </span><span class="s1">name</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">reset</span><span class="s2">()</span>
    <span class="s4">def </span><span class="s1">reset</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_total </span><span class="s2">= </span><span class="s5">0.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_count </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s4">def </span><span class="s1">addValue</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_total </span><span class="s2">+= </span><span class="s1">value</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_count </span><span class="s2">+= </span><span class="s5">1</span>
    <span class="s4">def </span><span class="s1">getAverage</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_total </span><span class="s2">/ </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_count</span>
    <span class="s4">def </span><span class="s1">getCount</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_count</span>

<span class="s4">def </span><span class="s1">addListsByValue</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    returns a new array containing the sums of the two array arguments 
    (c[0] = a[0 + b[0], etc.) 
    &quot;&quot;&quot;</span>
    <span class="s1">c </span><span class="s2">= []</span>
    <span class="s4">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s4">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
        <span class="s1">c</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">x </span><span class="s2">+ </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s4">return </span><span class="s1">c</span>

<span class="s4">def </span><span class="s1">boolEqual</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    returns true if a and b are both true or both false. 
    returns false otherwise 
    (a.k.a. xnor -- eXclusive Not OR). 
    &quot;&quot;&quot;</span>
    <span class="s4">return </span><span class="s2">(</span><span class="s1">a </span><span class="s4">and </span><span class="s1">b</span><span class="s2">) </span><span class="s4">or not </span><span class="s2">(</span><span class="s1">a </span><span class="s4">or </span><span class="s1">b</span><span class="s2">)</span>

<span class="s4">def </span><span class="s1">lineupPos</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s1">num</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    use to line up a series of 'num' objects, in one dimension, 
    centered around zero 
    'i' is the index of the object in the lineup 
    'spacing' is the amount of space between objects in the lineup 
    &quot;&quot;&quot;</span>
    <span class="s4">assert </span><span class="s1">num </span><span class="s2">&gt;= </span><span class="s5">1</span>
    <span class="s4">assert </span><span class="s1">i </span><span class="s2">&gt;= </span><span class="s5">0 </span><span class="s4">and </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">num</span>
    <span class="s1">pos </span><span class="s2">= </span><span class="s1">float</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) * </span><span class="s1">spacing</span>
    <span class="s4">return </span><span class="s1">pos </span><span class="s2">- ((</span><span class="s1">float</span><span class="s2">(</span><span class="s1">spacing</span><span class="s2">) * (</span><span class="s1">num</span><span class="s2">-</span><span class="s5">1</span><span class="s2">))/</span><span class="s5">2.</span><span class="s2">)</span>

<span class="s4">def </span><span class="s1">formatElapsedSeconds</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Returns a string of the form &quot;mm:ss&quot; or &quot;hh:mm:ss&quot; or &quot;n days&quot;, 
    representing the indicated elapsed time in seconds. 
    &quot;&quot;&quot;</span>
    <span class="s1">sign </span><span class="s2">= </span><span class="s3">''</span>
    <span class="s4">if </span><span class="s1">seconds </span><span class="s2">&lt; </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s1">seconds </span><span class="s2">= -</span><span class="s1">seconds</span>
        <span class="s1">sign </span><span class="s2">= </span><span class="s3">'-'</span>

    <span class="s6"># We use math.floor() instead of casting to an int, so we avoid</span>
    <span class="s6"># problems with numbers that are too large to represent as</span>
    <span class="s6"># type int.</span>
    <span class="s1">seconds </span><span class="s2">= </span><span class="s1">math</span><span class="s2">.</span><span class="s1">floor</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">)</span>
    <span class="s1">hours </span><span class="s2">= </span><span class="s1">math</span><span class="s2">.</span><span class="s1">floor</span><span class="s2">(</span><span class="s1">seconds </span><span class="s2">/ (</span><span class="s5">60 </span><span class="s2">* </span><span class="s5">60</span><span class="s2">))</span>
    <span class="s4">if </span><span class="s1">hours </span><span class="s2">&gt; </span><span class="s5">36</span><span class="s2">:</span>
        <span class="s1">days </span><span class="s2">= </span><span class="s1">math</span><span class="s2">.</span><span class="s1">floor</span><span class="s2">((</span><span class="s1">hours </span><span class="s2">+ </span><span class="s5">12</span><span class="s2">) / </span><span class="s5">24</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s3">&quot;%s%d days&quot; </span><span class="s2">% (</span><span class="s1">sign</span><span class="s2">, </span><span class="s1">days</span><span class="s2">)</span>

    <span class="s1">seconds </span><span class="s2">-= </span><span class="s1">hours </span><span class="s2">* (</span><span class="s5">60 </span><span class="s2">* </span><span class="s5">60</span><span class="s2">)</span>
    <span class="s1">minutes </span><span class="s2">= (</span><span class="s1">int</span><span class="s2">)(</span><span class="s1">seconds </span><span class="s2">/ </span><span class="s5">60</span><span class="s2">)</span>
    <span class="s1">seconds </span><span class="s2">-= </span><span class="s1">minutes </span><span class="s2">* </span><span class="s5">60</span>
    <span class="s4">if </span><span class="s1">hours </span><span class="s2">!= </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s3">&quot;%s%d:%02d:%02d&quot; </span><span class="s2">% (</span><span class="s1">sign</span><span class="s2">, </span><span class="s1">hours</span><span class="s2">, </span><span class="s1">minutes</span><span class="s2">, </span><span class="s1">seconds</span><span class="s2">)</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s3">&quot;%s%d:%02d&quot; </span><span class="s2">% (</span><span class="s1">sign</span><span class="s2">, </span><span class="s1">minutes</span><span class="s2">, </span><span class="s1">seconds</span><span class="s2">)</span>

<span class="s4">def </span><span class="s1">solveQuadratic</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">c</span><span class="s2">):</span>
    <span class="s6"># quadratic equation: ax^2 + bx + c = 0</span>
    <span class="s6"># quadratic formula:  x = [-b +/- sqrt(b^2 - 4ac)] / 2a</span>
    <span class="s6"># returns None, root, or [root1, root2]</span>

    <span class="s6"># a cannot be zero.</span>
    <span class="s4">if </span><span class="s1">a </span><span class="s2">== </span><span class="s5">0.</span><span class="s2">:</span>
        <span class="s4">return None</span>

    <span class="s6"># calculate the determinant (b^2 - 4ac)</span>
    <span class="s1">D </span><span class="s2">= (</span><span class="s1">b </span><span class="s2">* </span><span class="s1">b</span><span class="s2">) - (</span><span class="s5">4. </span><span class="s2">* </span><span class="s1">a </span><span class="s2">* </span><span class="s1">c</span><span class="s2">)</span>

    <span class="s4">if </span><span class="s1">D </span><span class="s2">&lt; </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s6"># there are no solutions (sqrt(negative number) is undefined)</span>
        <span class="s4">return None</span>
    <span class="s4">elif </span><span class="s1">D </span><span class="s2">== </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s6"># only one root</span>
        <span class="s4">return </span><span class="s2">(-</span><span class="s1">b</span><span class="s2">) / (</span><span class="s5">2. </span><span class="s2">* </span><span class="s1">a</span><span class="s2">)</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s6"># OK, there are two roots</span>
        <span class="s1">sqrtD </span><span class="s2">= </span><span class="s1">math</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s1">D</span><span class="s2">)</span>
        <span class="s1">twoA </span><span class="s2">= </span><span class="s5">2. </span><span class="s2">* </span><span class="s1">a</span>
        <span class="s1">root1 </span><span class="s2">= ((-</span><span class="s1">b</span><span class="s2">) - </span><span class="s1">sqrtD</span><span class="s2">) / </span><span class="s1">twoA</span>
        <span class="s1">root2 </span><span class="s2">= ((-</span><span class="s1">b</span><span class="s2">) + </span><span class="s1">sqrtD</span><span class="s2">) / </span><span class="s1">twoA</span>
        <span class="s4">return </span><span class="s2">[</span><span class="s1">root1</span><span class="s2">, </span><span class="s1">root2</span><span class="s2">]</span>

<span class="s4">if __debug__</span><span class="s2">:</span>
    <span class="s4">def </span><span class="s1">stackEntryInfo</span><span class="s2">(</span><span class="s1">depth</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">baseFileName</span><span class="s2">=</span><span class="s5">1</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        returns the sourcefilename, line number, and function name of 
        an entry in the stack. 
        'depth' is how far back to go in the stack; 0 is the caller of this 
        function, 1 is the function that called the caller of this function, etc. 
        by default, strips off the path of the filename; override with baseFileName 
        returns (fileName, lineNum, funcName) --&gt; (string, int, string) 
        returns (None, None, None) on error 
        &quot;&quot;&quot;</span>
        <span class="s4">import </span><span class="s1">inspect</span>

        <span class="s4">try</span><span class="s2">:</span>
            <span class="s1">stack </span><span class="s2">= </span><span class="s4">None</span>
            <span class="s1">frame </span><span class="s2">= </span><span class="s4">None</span>
            <span class="s4">try</span><span class="s2">:</span>
                <span class="s1">stack </span><span class="s2">= </span><span class="s1">inspect</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">()</span>
                <span class="s6"># add one to skip the frame associated with this function</span>
                <span class="s1">frame </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">[</span><span class="s1">depth</span><span class="s2">+</span><span class="s5">1</span><span class="s2">]</span>
                <span class="s1">filename </span><span class="s2">= </span><span class="s1">frame</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>
                <span class="s4">if </span><span class="s1">baseFileName</span><span class="s2">:</span>
                    <span class="s1">filename </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">basename</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">)</span>
                <span class="s1">lineNum </span><span class="s2">= </span><span class="s1">frame</span><span class="s2">[</span><span class="s5">2</span><span class="s2">]</span>
                <span class="s1">funcName </span><span class="s2">= </span><span class="s1">frame</span><span class="s2">[</span><span class="s5">3</span><span class="s2">]</span>
                <span class="s1">result </span><span class="s2">= (</span><span class="s1">filename</span><span class="s2">, </span><span class="s1">lineNum</span><span class="s2">, </span><span class="s1">funcName</span><span class="s2">)</span>
            <span class="s4">finally</span><span class="s2">:</span>
                <span class="s4">del </span><span class="s1">stack</span>
                <span class="s4">del </span><span class="s1">frame</span>
        <span class="s4">except</span><span class="s2">:</span>
            <span class="s1">result </span><span class="s2">= (</span><span class="s4">None</span><span class="s2">, </span><span class="s4">None</span><span class="s2">, </span><span class="s4">None</span><span class="s2">)</span>

        <span class="s4">return </span><span class="s1">result</span>

    <span class="s4">def </span><span class="s1">lineInfo</span><span class="s2">(</span><span class="s1">baseFileName</span><span class="s2">=</span><span class="s5">1</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        returns the sourcefilename, line number, and function name of the 
        code that called this function 
        (answers the question: 'hey lineInfo, where am I in the codebase?') 
        see stackEntryInfo, above, for info on 'baseFileName' and return types 
        &quot;&quot;&quot;</span>
        <span class="s4">return </span><span class="s1">stackEntryInfo</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">baseFileName</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">callerInfo</span><span class="s2">(</span><span class="s1">baseFileName</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">howFarBack</span><span class="s2">=</span><span class="s5">0</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        returns the sourcefilename, line number, and function name of the 
        caller of the function that called this function 
        (answers the question: 'hey callerInfo, who called me?') 
        see stackEntryInfo, above, for info on 'baseFileName' and return types 
        &quot;&quot;&quot;</span>
        <span class="s4">return </span><span class="s1">stackEntryInfo</span><span class="s2">(</span><span class="s5">2</span><span class="s2">+</span><span class="s1">howFarBack</span><span class="s2">, </span><span class="s1">baseFileName</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">lineTag</span><span class="s2">(</span><span class="s1">baseFileName</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">verbose</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">separator</span><span class="s2">=</span><span class="s3">':'</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        returns a string containing the sourcefilename and line number 
        of the code that called this function 
        (equivalent to lineInfo, above, with different return type) 
        see stackEntryInfo, above, for info on 'baseFileName' 
 
        if 'verbose' is false, returns a compact string of the form 
        'fileName:lineNum:funcName' 
        if 'verbose' is true, returns a longer string that matches the 
        format of Python stack trace dumps 
 
        returns empty string on error 
        &quot;&quot;&quot;</span>
        <span class="s1">fileName</span><span class="s2">, </span><span class="s1">lineNum</span><span class="s2">, </span><span class="s1">funcName </span><span class="s2">= </span><span class="s1">callerInfo</span><span class="s2">(</span><span class="s1">baseFileName</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">fileName </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s3">''</span>
        <span class="s4">if </span><span class="s1">verbose</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s3">'File &quot;%s&quot;, line %s, in %s' </span><span class="s2">% (</span><span class="s1">fileName</span><span class="s2">, </span><span class="s1">lineNum</span><span class="s2">, </span><span class="s1">funcName</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s3">'%s%s%s%s%s' </span><span class="s2">% (</span><span class="s1">fileName</span><span class="s2">, </span><span class="s1">separator</span><span class="s2">, </span><span class="s1">lineNum</span><span class="s2">, </span><span class="s1">separator</span><span class="s2">,</span>
                                   <span class="s1">funcName</span><span class="s2">)</span>

<span class="s4">def </span><span class="s1">findPythonModule</span><span class="s2">(</span><span class="s1">module</span><span class="s2">):</span>
    <span class="s6"># Look along the python load path for the indicated filename.</span>
    <span class="s6"># Returns the located pathname, or None if the filename is not</span>
    <span class="s6"># found.</span>
    <span class="s1">filename </span><span class="s2">= </span><span class="s1">module </span><span class="s2">+ </span><span class="s3">'.py'</span>
    <span class="s4">for </span><span class="s1">dir </span><span class="s4">in </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">path</span><span class="s2">:</span>
        <span class="s1">pathname </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">dir</span><span class="s2">, </span><span class="s1">filename</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">exists</span><span class="s2">(</span><span class="s1">pathname</span><span class="s2">):</span>
            <span class="s4">return </span><span class="s1">pathname</span>

    <span class="s4">return None</span>

<span class="s4">def </span><span class="s1">clampScalar</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s6"># calling this ought to be faster than calling both min and max</span>
    <span class="s4">if </span><span class="s1">a </span><span class="s2">&lt; </span><span class="s1">b</span><span class="s2">:</span>
        <span class="s4">if </span><span class="s1">value </span><span class="s2">&lt; </span><span class="s1">a</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">a</span>
        <span class="s4">elif </span><span class="s1">value </span><span class="s2">&gt; </span><span class="s1">b</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">b</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">value</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s4">if </span><span class="s1">value </span><span class="s2">&lt; </span><span class="s1">b</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">b</span>
        <span class="s4">elif </span><span class="s1">value </span><span class="s2">&gt; </span><span class="s1">a</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">a</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">value</span>

<span class="s4">def </span><span class="s1">weightedChoice</span><span class="s2">(</span><span class="s1">choiceList</span><span class="s2">, </span><span class="s1">rng</span><span class="s2">=</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">, </span><span class="s1">sum</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;given a list of (weight, item) pairs, chooses an item based on the 
    weights. rng must return 0..1. if you happen to have the sum of the 
    weights, pass it in 'sum'.&quot;&quot;&quot;</span>
    <span class="s6"># Throw an IndexError if we got an empty list.</span>
    <span class="s4">if not </span><span class="s1">choiceList</span><span class="s2">:</span>
        <span class="s4">raise </span><span class="s1">IndexError</span><span class="s2">(</span><span class="s3">'Cannot choose from an empty sequence'</span><span class="s2">)</span>

    <span class="s6"># TODO: add support for dicts</span>
    <span class="s4">if </span><span class="s1">sum </span><span class="s4">is None</span><span class="s2">:</span>
        <span class="s1">sum </span><span class="s2">= </span><span class="s5">0.</span>
        <span class="s4">for </span><span class="s1">weight</span><span class="s2">, </span><span class="s1">item </span><span class="s4">in </span><span class="s1">choiceList</span><span class="s2">:</span>
            <span class="s1">sum </span><span class="s2">+= </span><span class="s1">weight</span>

    <span class="s1">rand </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">()</span>
    <span class="s1">accum </span><span class="s2">= </span><span class="s1">rand </span><span class="s2">* </span><span class="s1">sum</span>
    <span class="s1">item </span><span class="s2">= </span><span class="s4">None</span>
    <span class="s4">for </span><span class="s1">weight</span><span class="s2">, </span><span class="s1">item </span><span class="s4">in </span><span class="s1">choiceList</span><span class="s2">:</span>
        <span class="s1">accum </span><span class="s2">-= </span><span class="s1">weight</span>
        <span class="s4">if </span><span class="s1">accum </span><span class="s2">&lt;= </span><span class="s5">0.</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">item</span>
    <span class="s6"># rand is ~1., and floating-point error prevented accum from hitting 0.</span>
    <span class="s6"># Or you passed in a 'sum' that was was too large.</span>
    <span class="s6"># Return the last item.</span>
    <span class="s4">return </span><span class="s1">item</span>

<span class="s4">def </span><span class="s1">randFloat</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">=</span><span class="s5">0.</span><span class="s2">, </span><span class="s1">rng</span><span class="s2">=</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;returns a random float in [a, b] 
    call with single argument to generate random float between arg and zero 
    &quot;&quot;&quot;</span>
    <span class="s4">return </span><span class="s1">lerp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">rng</span><span class="s2">())</span>

<span class="s4">def </span><span class="s1">normalDistrib</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">gauss</span><span class="s2">=</span><span class="s1">random</span><span class="s2">.</span><span class="s1">gauss</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    NOTE: assumes a &lt; b 
 
    Returns random number between a and b, using gaussian distribution, with 
    mean=avg(a, b), and a standard deviation that fits ~99.7% of the curve 
    between a and b. 
 
    For ease of use, outlying results are re-computed until result is in [a, b] 
    This should fit the remaining .3% of the curve that lies outside [a, b] 
    uniformly onto the curve inside [a, b] 
 
    ------------------------------------------------------------------------ 
    The 68-95-99.7% Rule 
    ==================== 
    All normal density curves satisfy the following property which is often 
      referred to as the Empirical Rule: 
    68% of the observations fall within 1 standard deviation of the mean. 
    95% of the observations fall within 2 standard deviations of the mean. 
    99.7% of the observations fall within 3 standard deviations of the mean. 
 
    Thus, for a normal distribution, almost all values lie within 3 standard 
      deviations of the mean. 
    ------------------------------------------------------------------------ 
 
    In calculating our standard deviation, we divide (b-a) by 6, since the 
    99.7% figure includes 3 standard deviations _on_either_side_ of the mean. 
    &quot;&quot;&quot;</span>
    <span class="s4">while True</span><span class="s2">:</span>
        <span class="s1">r </span><span class="s2">= </span><span class="s1">gauss</span><span class="s2">((</span><span class="s1">a</span><span class="s2">+</span><span class="s1">b</span><span class="s2">)*</span><span class="s5">.5</span><span class="s2">, (</span><span class="s1">b</span><span class="s2">-</span><span class="s1">a</span><span class="s2">)/</span><span class="s5">6.</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s2">(</span><span class="s1">r </span><span class="s2">&gt;= </span><span class="s1">a</span><span class="s2">) </span><span class="s4">and </span><span class="s2">(</span><span class="s1">r </span><span class="s2">&lt;= </span><span class="s1">b</span><span class="s2">):</span>
            <span class="s4">return </span><span class="s1">r</span>

<span class="s4">def </span><span class="s1">weightedRand</span><span class="s2">(</span><span class="s1">valDict</span><span class="s2">, </span><span class="s1">rng</span><span class="s2">=</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    pass in a dictionary with a selection -&gt; weight mapping.  E.g.:: 
 
        {&quot;Choice 1&quot;: 10, 
         &quot;Choice 2&quot;: 30, 
         &quot;bear&quot;:     100} 
 
    - Weights need not add up to any particular value. 
    - The actual selection will be returned. 
    &quot;&quot;&quot;</span>
    <span class="s1">selections </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">valDict</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">())</span>
    <span class="s1">weights </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">valDict</span><span class="s2">.</span><span class="s1">values</span><span class="s2">())</span>

    <span class="s1">totalWeight </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s4">for </span><span class="s1">weight </span><span class="s4">in </span><span class="s1">weights</span><span class="s2">:</span>
        <span class="s1">totalWeight </span><span class="s2">+= </span><span class="s1">weight</span>

    <span class="s6"># get a random value between 0 and the total of the weights</span>
    <span class="s1">randomWeight </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">() * </span><span class="s1">totalWeight</span>

    <span class="s6"># find the index that corresponds with this weight</span>
    <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">weights</span><span class="s2">)):</span>
        <span class="s1">totalWeight </span><span class="s2">-= </span><span class="s1">weights</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
        <span class="s4">if </span><span class="s1">totalWeight </span><span class="s2">&lt;= </span><span class="s1">randomWeight</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">selections</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>

    <span class="s4">assert True</span><span class="s2">, </span><span class="s3">&quot;Should never get here&quot;</span>
    <span class="s4">return </span><span class="s1">selections</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]</span>

<span class="s4">def </span><span class="s1">randUint31</span><span class="s2">(</span><span class="s1">rng</span><span class="s2">=</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;returns a random integer in [0..2^31). 
    rng must return float in [0..1]&quot;&quot;&quot;</span>
    <span class="s4">return </span><span class="s1">int</span><span class="s2">(</span><span class="s1">rng</span><span class="s2">() * </span><span class="s5">0x7FFFFFFF</span><span class="s2">)</span>

<span class="s4">def </span><span class="s1">randInt32</span><span class="s2">(</span><span class="s1">rng</span><span class="s2">=</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;returns a random integer in [-2147483648..2147483647]. 
    rng must return float in [0..1] 
    &quot;&quot;&quot;</span>
    <span class="s1">i </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s1">rng</span><span class="s2">() * </span><span class="s5">0x7FFFFFFF</span><span class="s2">)</span>
    <span class="s4">if </span><span class="s1">rng</span><span class="s2">() &lt; </span><span class="s5">.5</span><span class="s2">:</span>
        <span class="s1">i </span><span class="s2">*= -</span><span class="s5">1</span>
    <span class="s4">return </span><span class="s1">i</span>

<span class="s4">class </span><span class="s1">SerialNumGen</span><span class="s2">:</span>
    <span class="s0">&quot;&quot;&quot;generates serial numbers&quot;&quot;&quot;</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">start </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">start </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__counter </span><span class="s2">= </span><span class="s1">start</span><span class="s2">-</span><span class="s5">1</span>

    <span class="s4">def </span><span class="s1">next</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__counter </span><span class="s2">+= </span><span class="s5">1</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__counter</span>

    <span class="s1">__next__ </span><span class="s2">= </span><span class="s1">next</span>

<span class="s4">class </span><span class="s1">SerialMaskedGen</span><span class="s2">(</span><span class="s1">SerialNumGen</span><span class="s2">):</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_mask </span><span class="s2">= </span><span class="s1">mask</span>
        <span class="s1">SerialNumGen</span><span class="s2">.</span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">start</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">next</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">v </span><span class="s2">= </span><span class="s1">SerialNumGen</span><span class="s2">.</span><span class="s1">next</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s1">v </span><span class="s2">&amp; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_mask</span>

    <span class="s1">__next__ </span><span class="s2">= </span><span class="s1">next</span>

<span class="s1">_serialGen </span><span class="s2">= </span><span class="s1">SerialNumGen</span><span class="s2">()</span>
<span class="s4">def </span><span class="s1">serialNum</span><span class="s2">():</span>
    <span class="s4">global </span><span class="s1">_serialGen</span>
    <span class="s4">return </span><span class="s1">_serialGen</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()</span>
<span class="s4">def </span><span class="s1">uniqueName</span><span class="s2">(</span><span class="s1">name</span><span class="s2">):</span>
    <span class="s4">global </span><span class="s1">_serialGen</span>
    <span class="s4">return </span><span class="s3">'%s-%s' </span><span class="s2">% (</span><span class="s1">name</span><span class="s2">, </span><span class="s1">_serialGen</span><span class="s2">.</span><span class="s1">next</span><span class="s2">())</span>

<span class="s4">class </span><span class="s1">EnumIter</span><span class="s2">:</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">enum</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_values </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">enum</span><span class="s2">.</span><span class="s1">_stringTable</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">())</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_index </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s4">def </span><span class="s1">__iter__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span>
    <span class="s4">def </span><span class="s1">__next__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_index </span><span class="s2">&gt;= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">):</span>
            <span class="s4">raise </span><span class="s1">StopIteration</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_index </span><span class="s2">+= </span><span class="s5">1</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">[</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_index</span><span class="s2">-</span><span class="s5">1</span><span class="s2">]</span>
    <span class="s1">next </span><span class="s2">= </span><span class="s1">__next__</span>

<span class="s4">class </span><span class="s1">Enum</span><span class="s2">:</span>
    <span class="s0">&quot;&quot;&quot;Pass in list of strings or string of comma-separated strings. 
    Items are accessible as instance.item, and are assigned unique, 
    increasing integer values. Pass in integer for 'start' to override 
    starting value. 
 
    Example: 
 
    &gt;&gt;&gt; colors = Enum('red, green, blue') 
    &gt;&gt;&gt; colors.red 
    0 
    &gt;&gt;&gt; colors.green 
    1 
    &gt;&gt;&gt; colors.blue 
    2 
    &gt;&gt;&gt; colors.getString(colors.red) 
    'red' 
    &quot;&quot;&quot;</span>

    <span class="s4">if __debug__</span><span class="s2">:</span>
        <span class="s6"># chars that cannot appear within an item string.</span>
        <span class="s4">def </span><span class="s1">_checkValidIdentifier</span><span class="s2">(</span><span class="s1">item</span><span class="s2">):</span>
            <span class="s4">import </span><span class="s1">string</span>
            <span class="s1">invalidChars </span><span class="s2">= </span><span class="s1">string</span><span class="s2">.</span><span class="s1">whitespace </span><span class="s2">+ </span><span class="s1">string</span><span class="s2">.</span><span class="s1">punctuation</span>
            <span class="s1">invalidChars </span><span class="s2">= </span><span class="s1">invalidChars</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s3">'_'</span><span class="s2">, </span><span class="s3">''</span><span class="s2">)</span>
            <span class="s1">invalidFirstChars </span><span class="s2">= </span><span class="s1">invalidChars</span><span class="s2">+</span><span class="s1">string</span><span class="s2">.</span><span class="s1">digits</span>
            <span class="s4">if </span><span class="s1">item</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] </span><span class="s4">in </span><span class="s1">invalidFirstChars</span><span class="s2">:</span>
                <span class="s4">raise </span><span class="s1">SyntaxError</span><span class="s2">(</span><span class="s3">&quot;Enum '%s' contains invalid first char&quot; </span><span class="s2">%</span>
                                    <span class="s1">item</span><span class="s2">)</span>
            <span class="s4">if not </span><span class="s1">disjoint</span><span class="s2">(</span><span class="s1">item</span><span class="s2">, </span><span class="s1">invalidChars</span><span class="s2">):</span>
                <span class="s4">for </span><span class="s1">char </span><span class="s4">in </span><span class="s1">item</span><span class="s2">:</span>
                    <span class="s4">if </span><span class="s1">char </span><span class="s4">in </span><span class="s1">invalidChars</span><span class="s2">:</span>
                        <span class="s4">raise </span><span class="s1">SyntaxError</span><span class="s2">(</span>
                            <span class="s3">&quot;Enum</span><span class="s4">\n</span><span class="s3">'%s'</span><span class="s4">\n</span><span class="s3">contains illegal char '%s'&quot; </span><span class="s2">%</span>
                            <span class="s2">(</span><span class="s1">item</span><span class="s2">, </span><span class="s1">char</span><span class="s2">))</span>
            <span class="s4">return </span><span class="s5">1</span>
        <span class="s1">_checkValidIdentifier </span><span class="s2">= </span><span class="s1">staticmethod</span><span class="s2">(</span><span class="s1">_checkValidIdentifier</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">items</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s5">0</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">items</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
            <span class="s1">items </span><span class="s2">= </span><span class="s1">items</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s3">','</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_stringTable </span><span class="s2">= {}</span>

        <span class="s6"># make sure we don't overwrite an existing element of the class</span>
        <span class="s4">assert </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_checkExistingMembers</span><span class="s2">(</span><span class="s1">items</span><span class="s2">)</span>
        <span class="s4">assert </span><span class="s1">uniqueElements</span><span class="s2">(</span><span class="s1">items</span><span class="s2">)</span>

        <span class="s1">i </span><span class="s2">= </span><span class="s1">start</span>
        <span class="s4">for </span><span class="s1">item </span><span class="s4">in </span><span class="s1">items</span><span class="s2">:</span>
            <span class="s6"># remove leading/trailing whitespace</span>
            <span class="s1">item </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>
            <span class="s6"># is there anything left?</span>
            <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">item</span><span class="s2">) == </span><span class="s5">0</span><span class="s2">:</span>
                <span class="s4">continue</span>
            <span class="s6"># make sure there are no invalid characters</span>
            <span class="s4">assert </span><span class="s1">Enum</span><span class="s2">.</span><span class="s1">_checkValidIdentifier</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">__dict__</span><span class="s2">[</span><span class="s1">item</span><span class="s2">] = </span><span class="s1">i</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_stringTable</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">item</span>
            <span class="s1">i </span><span class="s2">+= </span><span class="s5">1</span>

    <span class="s4">def </span><span class="s1">__iter__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">EnumIter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">hasString</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">string</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">string </span><span class="s4">in </span><span class="s1">set</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_stringTable</span><span class="s2">.</span><span class="s1">values</span><span class="s2">())</span>

    <span class="s4">def </span><span class="s1">fromString</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">string</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">hasString</span><span class="s2">(</span><span class="s1">string</span><span class="s2">):</span>
            <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__dict__</span><span class="s2">[</span><span class="s1">string</span><span class="s2">]</span>
        <span class="s6"># throw an error</span>
        <span class="s2">{}[</span><span class="s1">string</span><span class="s2">]</span>

    <span class="s4">def </span><span class="s1">getString</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_stringTable</span><span class="s2">[</span><span class="s1">value</span><span class="s2">]</span>

    <span class="s4">def </span><span class="s1">__contains__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">value </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_stringTable</span>

    <span class="s4">def </span><span class="s1">__len__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_stringTable</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">copyTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">obj</span><span class="s2">):</span>
        <span class="s6"># copies all members onto obj</span>
        <span class="s4">for </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_stringTable</span><span class="s2">:</span>
            <span class="s1">setattr</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

    <span class="s4">if __debug__</span><span class="s2">:</span>
        <span class="s4">def </span><span class="s1">_checkExistingMembers</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">items</span><span class="s2">):</span>
            <span class="s4">for </span><span class="s1">item </span><span class="s4">in </span><span class="s1">items</span><span class="s2">:</span>
                <span class="s4">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">item</span><span class="s2">):</span>
                    <span class="s4">return </span><span class="s5">0</span>
            <span class="s4">return </span><span class="s5">1</span>

<span class="s6">############################################################</span>
<span class="s6"># class: Singleton</span>
<span class="s6"># Purpose: This provides a base metaclass for all classes</span>
<span class="s6">#          that require one and only one instance.</span>
<span class="s6">#</span>
<span class="s6"># Example: class mySingleton:</span>
<span class="s6">#              __metaclass__ = PythonUtil.Singleton</span>
<span class="s6">#              def __init__(self, ...):</span>
<span class="s6">#                  ...</span>
<span class="s6">#</span>
<span class="s6"># Note: This class is based on Python's New-Style Class</span>
<span class="s6">#       design. An error will occur if a defined class</span>
<span class="s6">#       attemps to inherit from a Classic-Style Class only,</span>
<span class="s6">#       ie: class myClassX:</span>
<span class="s6">#               def __init__(self, ...):</span>
<span class="s6">#                   ...</span>
<span class="s6">#</span>
<span class="s6">#           class myNewClassX(myClassX):</span>
<span class="s6">#               __metaclass__ = PythonUtil.Singleton</span>
<span class="s6">#               def __init__(self, ...):</span>
<span class="s6">#                   myClassX.__init__(self, ...)</span>
<span class="s6">#                   ...</span>
<span class="s6">#</span>
<span class="s6">#           This causes problems because myNewClassX is a</span>
<span class="s6">#           New-Style class that inherits from only a</span>
<span class="s6">#           Classic-Style base class. There are two ways</span>
<span class="s6">#           simple ways to resolve this issue.</span>
<span class="s6">#</span>
<span class="s6">#           First, if possible, make myClassX a</span>
<span class="s6">#           New-Style class by inheriting from object</span>
<span class="s6">#           object. IE:  class myClassX(object):</span>
<span class="s6">#</span>
<span class="s6">#           If for some reason that is not an option, make</span>
<span class="s6">#           myNewClassX inherit from object and myClassX.</span>
<span class="s6">#           IE: class myNewClassX(object, myClassX):</span>
<span class="s6">############################################################</span>
<span class="s4">class </span><span class="s1">Singleton</span><span class="s2">(</span><span class="s1">type</span><span class="s2">):</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">bases</span><span class="s2">, </span><span class="s1">dic</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">Singleton</span><span class="s2">, </span><span class="s1">cls</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">bases</span><span class="s2">, </span><span class="s1">dic</span><span class="s2">)</span>
        <span class="s1">cls</span><span class="s2">.</span><span class="s1">instance</span><span class="s2">=</span><span class="s4">None</span>
    <span class="s4">def </span><span class="s1">__call__</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">instance </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">cls</span><span class="s2">.</span><span class="s1">instance</span><span class="s2">=</span><span class="s1">super</span><span class="s2">(</span><span class="s1">Singleton</span><span class="s2">, </span><span class="s1">cls</span><span class="s2">).</span><span class="s1">__call__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">instance</span>

<span class="s4">class </span><span class="s1">SingletonError</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; Used to indicate an inappropriate value for a Singleton.&quot;&quot;&quot;</span>

<span class="s4">def </span><span class="s1">printListEnumGen</span><span class="s2">(</span><span class="s1">l</span><span class="s2">):</span>
    <span class="s6"># log each individual item with a number in front of it</span>
    <span class="s1">digits </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s1">n </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)</span>
    <span class="s4">while </span><span class="s1">n </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s1">digits </span><span class="s2">+= </span><span class="s5">1</span>
        <span class="s1">n </span><span class="s2">//= </span><span class="s5">10</span>
    <span class="s1">format </span><span class="s2">= </span><span class="s3">'%0' </span><span class="s2">+ </span><span class="s3">'%s' </span><span class="s2">% </span><span class="s1">digits </span><span class="s2">+ </span><span class="s3">'i:%s'</span>
    <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)):</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">format </span><span class="s2">% (</span><span class="s1">i</span><span class="s2">, </span><span class="s1">l</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]))</span>
        <span class="s4">yield None</span>

<span class="s4">def </span><span class="s1">printListEnum</span><span class="s2">(</span><span class="s1">l</span><span class="s2">):</span>
    <span class="s4">for </span><span class="s1">result </span><span class="s4">in </span><span class="s1">printListEnumGen</span><span class="s2">(</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s4">pass</span>

<span class="s6"># base class for all Panda C++ objects</span>
<span class="s6"># libdtoolconfig doesn't seem to have this, grab it off of TypedObject</span>
<span class="s1">dtoolSuperBase </span><span class="s2">= </span><span class="s4">None</span>

<span class="s4">def </span><span class="s1">_getDtoolSuperBase</span><span class="s2">():</span>
    <span class="s4">global </span><span class="s1">dtoolSuperBase</span>
    <span class="s4">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s4">import </span><span class="s1">TypedObject</span>
    <span class="s1">dtoolSuperBase </span><span class="s2">= </span><span class="s1">TypedObject</span><span class="s2">.</span><span class="s1">__bases__</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
    <span class="s4">assert </span><span class="s1">dtoolSuperBase</span><span class="s2">.</span><span class="s1">__name__ </span><span class="s2">== </span><span class="s3">'DTOOL_SUPER_BASE'</span>

<span class="s1">safeReprNotify </span><span class="s2">= </span><span class="s4">None</span>

<span class="s4">def </span><span class="s1">_getSafeReprNotify</span><span class="s2">():</span>
    <span class="s4">global </span><span class="s1">safeReprNotify</span>
    <span class="s4">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">directnotify</span><span class="s2">.</span><span class="s1">DirectNotifyGlobal </span><span class="s4">import </span><span class="s1">directNotify</span>
    <span class="s1">safeReprNotify </span><span class="s2">= </span><span class="s1">directNotify</span><span class="s2">.</span><span class="s1">newCategory</span><span class="s2">(</span><span class="s3">&quot;safeRepr&quot;</span><span class="s2">)</span>
    <span class="s4">return </span><span class="s1">safeReprNotify</span>

<span class="s4">def </span><span class="s1">safeRepr</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">):</span>
    <span class="s4">global </span><span class="s1">dtoolSuperBase</span>
    <span class="s4">if </span><span class="s1">dtoolSuperBase </span><span class="s4">is None</span><span class="s2">:</span>
        <span class="s1">_getDtoolSuperBase</span><span class="s2">()</span>

    <span class="s4">global </span><span class="s1">safeReprNotify</span>
    <span class="s4">if </span><span class="s1">safeReprNotify </span><span class="s4">is None</span><span class="s2">:</span>
        <span class="s1">_getSafeReprNotify</span><span class="s2">()</span>

    <span class="s4">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">dtoolSuperBase</span><span class="s2">):</span>
        <span class="s6"># repr of C++ object could crash, particularly if the object has been deleted</span>
        <span class="s6"># log that we're calling repr</span>
        <span class="s1">safeReprNotify</span><span class="s2">.</span><span class="s1">info</span><span class="s2">(</span><span class="s3">'calling repr on instance of %s.%s' </span><span class="s2">% (</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__module__</span><span class="s2">, </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">))</span>
        <span class="s1">sys</span><span class="s2">.</span><span class="s1">stdout</span><span class="s2">.</span><span class="s1">flush</span><span class="s2">()</span>

    <span class="s4">try</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)</span>
    <span class="s4">except</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s3">'&lt;** FAILED REPR OF %s instance at %s **&gt;' </span><span class="s2">% (</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">, </span><span class="s1">hex</span><span class="s2">(</span><span class="s1">id</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)))</span>

<span class="s4">def </span><span class="s1">safeReprTypeOnFail</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">):</span>
    <span class="s4">global </span><span class="s1">dtoolSuperBase</span>
    <span class="s4">if </span><span class="s1">dtoolSuperBase </span><span class="s4">is None</span><span class="s2">:</span>
        <span class="s1">_getDtoolSuperBase</span><span class="s2">()</span>

    <span class="s4">global </span><span class="s1">safeReprNotify</span>
    <span class="s4">if </span><span class="s1">safeReprNotify </span><span class="s4">is None</span><span class="s2">:</span>
        <span class="s1">_getSafeReprNotify</span><span class="s2">()</span>

    <span class="s4">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">dtoolSuperBase</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">type</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)</span>

    <span class="s4">try</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)</span>
    <span class="s4">except</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s3">'&lt;** FAILED REPR OF %s instance at %s **&gt;' </span><span class="s2">% (</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">, </span><span class="s1">hex</span><span class="s2">(</span><span class="s1">id</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)))</span>



<span class="s4">def </span><span class="s1">fastRepr</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">maxLen</span><span class="s2">=</span><span class="s5">200</span><span class="s2">, </span><span class="s1">strFactor</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">_visitedIds</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; caps the length of iterable types, so very large objects will print faster. 
    also prevents infinite recursion &quot;&quot;&quot;</span>
    <span class="s4">try</span><span class="s2">:</span>
        <span class="s4">if </span><span class="s1">_visitedIds </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">_visitedIds </span><span class="s2">= </span><span class="s1">set</span><span class="s2">()</span>
        <span class="s4">if </span><span class="s1">id</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) </span><span class="s4">in </span><span class="s1">_visitedIds</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s3">'&lt;ALREADY-VISITED %s&gt;' </span><span class="s2">% </span><span class="s1">itype</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">type</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) </span><span class="s4">in </span><span class="s2">(</span><span class="s1">tuple</span><span class="s2">, </span><span class="s1">list</span><span class="s2">):</span>
            <span class="s1">s </span><span class="s2">= </span><span class="s3">''</span>
            <span class="s1">s </span><span class="s2">+= {</span><span class="s1">tuple</span><span class="s2">: </span><span class="s3">'('</span><span class="s2">,</span>
                  <span class="s1">list</span><span class="s2">:  </span><span class="s3">'['</span><span class="s2">,}[</span><span class="s1">type</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)]</span>
            <span class="s4">if </span><span class="s1">maxLen </span><span class="s4">is not None and </span><span class="s1">len</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) &gt; </span><span class="s1">maxLen</span><span class="s2">:</span>
                <span class="s1">o </span><span class="s2">= </span><span class="s1">obj</span><span class="s2">[:</span><span class="s1">maxLen</span><span class="s2">]</span>
                <span class="s1">ellips </span><span class="s2">= </span><span class="s3">'...'</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">o </span><span class="s2">= </span><span class="s1">obj</span>
                <span class="s1">ellips </span><span class="s2">= </span><span class="s3">''</span>
            <span class="s1">_visitedIds</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">id</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">))</span>
            <span class="s4">for </span><span class="s1">item </span><span class="s4">in </span><span class="s1">o</span><span class="s2">:</span>
                <span class="s1">s </span><span class="s2">+= </span><span class="s1">fastRepr</span><span class="s2">(</span><span class="s1">item</span><span class="s2">, </span><span class="s1">maxLen</span><span class="s2">, </span><span class="s1">_visitedIds</span><span class="s2">=</span><span class="s1">_visitedIds</span><span class="s2">)</span>
                <span class="s1">s </span><span class="s2">+= </span><span class="s3">', '</span>
            <span class="s1">_visitedIds</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">id</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">))</span>
            <span class="s1">s </span><span class="s2">+= </span><span class="s1">ellips</span>
            <span class="s1">s </span><span class="s2">+= {</span><span class="s1">tuple</span><span class="s2">: </span><span class="s3">')'</span><span class="s2">,</span>
                  <span class="s1">list</span><span class="s2">:  </span><span class="s3">']'</span><span class="s2">,}[</span><span class="s1">type</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)]</span>
            <span class="s4">return </span><span class="s1">s</span>
        <span class="s4">elif </span><span class="s1">type</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) </span><span class="s4">is </span><span class="s1">dict</span><span class="s2">:</span>
            <span class="s1">s </span><span class="s2">= </span><span class="s3">'{'</span>
            <span class="s4">if </span><span class="s1">maxLen </span><span class="s4">is not None and </span><span class="s1">len</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) &gt; </span><span class="s1">maxLen</span><span class="s2">:</span>
                <span class="s1">o </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">())[:</span><span class="s1">maxLen</span><span class="s2">]</span>
                <span class="s1">ellips </span><span class="s2">= </span><span class="s3">'...'</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">o </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">())</span>
                <span class="s1">ellips </span><span class="s2">= </span><span class="s3">''</span>
            <span class="s1">_visitedIds</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">id</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">))</span>
            <span class="s4">for </span><span class="s1">key </span><span class="s4">in </span><span class="s1">o</span><span class="s2">:</span>
                <span class="s1">value </span><span class="s2">= </span><span class="s1">obj</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
                <span class="s1">s </span><span class="s2">+= </span><span class="s3">'%s: %s, ' </span><span class="s2">% (</span><span class="s1">fastRepr</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">maxLen</span><span class="s2">, </span><span class="s1">_visitedIds</span><span class="s2">=</span><span class="s1">_visitedIds</span><span class="s2">),</span>
                                   <span class="s1">fastRepr</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">maxLen</span><span class="s2">, </span><span class="s1">_visitedIds</span><span class="s2">=</span><span class="s1">_visitedIds</span><span class="s2">))</span>
            <span class="s1">_visitedIds</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">id</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">))</span>
            <span class="s1">s </span><span class="s2">+= </span><span class="s1">ellips</span>
            <span class="s1">s </span><span class="s2">+= </span><span class="s3">'}'</span>
            <span class="s4">return </span><span class="s1">s</span>
        <span class="s4">elif </span><span class="s1">type</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) </span><span class="s4">is </span><span class="s1">str</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">maxLen </span><span class="s4">is not None</span><span class="s2">:</span>
                <span class="s1">maxLen </span><span class="s2">*= </span><span class="s1">strFactor</span>
            <span class="s4">if </span><span class="s1">maxLen </span><span class="s4">is not None and </span><span class="s1">len</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) &gt; </span><span class="s1">maxLen</span><span class="s2">:</span>
                <span class="s4">return </span><span class="s1">safeRepr</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">[:</span><span class="s1">maxLen</span><span class="s2">])</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s4">return </span><span class="s1">safeRepr</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">r </span><span class="s2">= </span><span class="s1">safeRepr</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)</span>
            <span class="s1">maxLen </span><span class="s2">*= </span><span class="s1">strFactor</span>
            <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">r</span><span class="s2">) &gt; </span><span class="s1">maxLen</span><span class="s2">:</span>
                <span class="s1">r </span><span class="s2">= </span><span class="s1">r</span><span class="s2">[:</span><span class="s1">maxLen</span><span class="s2">]</span>
            <span class="s4">return </span><span class="s1">r</span>
    <span class="s4">except</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s3">'&lt;** FAILED REPR OF %s **&gt;' </span><span class="s2">% </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span>

<span class="s4">def </span><span class="s1">convertTree</span><span class="s2">(</span><span class="s1">objTree</span><span class="s2">, </span><span class="s1">idList</span><span class="s2">):</span>
    <span class="s1">newTree </span><span class="s2">= {}</span>
    <span class="s4">for </span><span class="s1">key </span><span class="s4">in </span><span class="s1">list</span><span class="s2">(</span><span class="s1">objTree</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">()):</span>
        <span class="s1">obj </span><span class="s2">= (</span><span class="s1">idList</span><span class="s2">[</span><span class="s1">key</span><span class="s2">],)</span>
        <span class="s1">newTree</span><span class="s2">[</span><span class="s1">obj</span><span class="s2">] = {}</span>
        <span class="s1">r_convertTree</span><span class="s2">(</span><span class="s1">objTree</span><span class="s2">[</span><span class="s1">key</span><span class="s2">], </span><span class="s1">newTree</span><span class="s2">[</span><span class="s1">obj</span><span class="s2">], </span><span class="s1">idList</span><span class="s2">)</span>
    <span class="s4">return </span><span class="s1">newTree</span>

<span class="s4">def </span><span class="s1">r_convertTree</span><span class="s2">(</span><span class="s1">oldTree</span><span class="s2">, </span><span class="s1">newTree</span><span class="s2">, </span><span class="s1">idList</span><span class="s2">):</span>
    <span class="s4">for </span><span class="s1">key </span><span class="s4">in </span><span class="s1">list</span><span class="s2">(</span><span class="s1">oldTree</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">()):</span>

        <span class="s1">obj </span><span class="s2">= </span><span class="s1">idList</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">key</span><span class="s2">)</span>
        <span class="s4">if</span><span class="s2">(</span><span class="s4">not </span><span class="s1">obj</span><span class="s2">):</span>
            <span class="s4">continue</span>
        <span class="s1">obj </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)[:</span><span class="s5">100</span><span class="s2">]</span>

        <span class="s1">newTree</span><span class="s2">[</span><span class="s1">obj</span><span class="s2">] = {}</span>
        <span class="s1">r_convertTree</span><span class="s2">(</span><span class="s1">oldTree</span><span class="s2">[</span><span class="s1">key</span><span class="s2">], </span><span class="s1">newTree</span><span class="s2">[</span><span class="s1">obj</span><span class="s2">], </span><span class="s1">idList</span><span class="s2">)</span>


<span class="s4">def </span><span class="s1">pretty_print</span><span class="s2">(</span><span class="s1">tree</span><span class="s2">):</span>
    <span class="s4">for </span><span class="s1">name </span><span class="s4">in </span><span class="s1">tree</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">():</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)</span>
        <span class="s1">r_pretty_print</span><span class="s2">(</span><span class="s1">tree</span><span class="s2">[</span><span class="s1">name</span><span class="s2">], </span><span class="s5">0</span><span class="s2">)</span>


<span class="s4">def </span><span class="s1">r_pretty_print</span><span class="s2">(</span><span class="s1">tree</span><span class="s2">, </span><span class="s1">num</span><span class="s2">):</span>
    <span class="s1">num</span><span class="s2">+=</span><span class="s5">1</span>
    <span class="s4">for </span><span class="s1">name </span><span class="s4">in </span><span class="s1">tree</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">():</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;  &quot;</span><span class="s2">*</span><span class="s1">num</span><span class="s2">,</span><span class="s1">name</span><span class="s2">)</span>
        <span class="s1">r_pretty_print</span><span class="s2">(</span><span class="s1">tree</span><span class="s2">[</span><span class="s1">name</span><span class="s2">],</span><span class="s1">num</span><span class="s2">)</span>


<span class="s4">def </span><span class="s1">isDefaultValue</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s4">return </span><span class="s1">x </span><span class="s2">== </span><span class="s1">type</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)()</span>


<span class="s4">def </span><span class="s1">appendStr</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">st</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;adds a string onto the __str__ output of an instance&quot;&quot;&quot;</span>
    <span class="s4">def </span><span class="s1">appendedStr</span><span class="s2">(</span><span class="s1">oldStr</span><span class="s2">, </span><span class="s1">st</span><span class="s2">, </span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">oldStr</span><span class="s2">() + </span><span class="s1">st</span>
    <span class="s1">oldStr </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s3">'__str__'</span><span class="s2">, </span><span class="s4">None</span><span class="s2">)</span>
    <span class="s4">if </span><span class="s1">oldStr </span><span class="s4">is None</span><span class="s2">:</span>
        <span class="s4">def </span><span class="s1">stringer</span><span class="s2">(</span><span class="s1">s</span><span class="s2">):</span>
            <span class="s4">return </span><span class="s1">s</span>
        <span class="s1">oldStr </span><span class="s2">= </span><span class="s1">Functor</span><span class="s2">(</span><span class="s1">stringer</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">))</span>
        <span class="s1">stringer </span><span class="s2">= </span><span class="s4">None</span>
    <span class="s4">if </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">version_info </span><span class="s2">&gt;= (</span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">):</span>
        <span class="s1">obj</span><span class="s2">.</span><span class="s1">__str__ </span><span class="s2">= </span><span class="s1">types</span><span class="s2">.</span><span class="s1">MethodType</span><span class="s2">(</span><span class="s1">Functor</span><span class="s2">(</span><span class="s1">appendedStr</span><span class="s2">, </span><span class="s1">oldStr</span><span class="s2">, </span><span class="s1">st</span><span class="s2">), </span><span class="s1">obj</span><span class="s2">)</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s1">obj</span><span class="s2">.</span><span class="s1">__str__ </span><span class="s2">= </span><span class="s1">types</span><span class="s2">.</span><span class="s1">MethodType</span><span class="s2">(</span><span class="s1">Functor</span><span class="s2">(</span><span class="s1">appendedStr</span><span class="s2">, </span><span class="s1">oldStr</span><span class="s2">, </span><span class="s1">st</span><span class="s2">), </span><span class="s1">obj</span><span class="s2">, </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">)</span>
    <span class="s1">appendedStr </span><span class="s2">= </span><span class="s4">None</span>
    <span class="s4">return </span><span class="s1">obj</span>


<span class="s4">class </span><span class="s1">ScratchPad</span><span class="s2">:</span>
    <span class="s0">&quot;&quot;&quot;empty class to stick values onto&quot;&quot;&quot;</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kArgs</span><span class="s2">):</span>
        <span class="s4">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s4">in </span><span class="s1">kArgs</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
            <span class="s1">setattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_keys </span><span class="s2">= </span><span class="s1">set</span><span class="s2">(</span><span class="s1">kArgs</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">())</span>
    <span class="s4">def </span><span class="s1">add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kArgs</span><span class="s2">):</span>
        <span class="s4">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s4">in </span><span class="s1">kArgs</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
            <span class="s1">setattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_keys</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s1">kArgs</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">()))</span>
    <span class="s4">def </span><span class="s1">destroy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">for </span><span class="s1">key </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_keys</span><span class="s2">:</span>
            <span class="s1">delattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)</span>

    <span class="s6"># allow dict [] syntax</span>
    <span class="s4">def </span><span class="s1">__getitem__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">itemName</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">itemName</span><span class="s2">)</span>
    <span class="s4">def </span><span class="s1">get</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">itemName</span><span class="s2">, </span><span class="s1">default</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">itemName</span><span class="s2">, </span><span class="s1">default</span><span class="s2">)</span>
    <span class="s6"># allow 'in'</span>
    <span class="s4">def </span><span class="s1">__contains__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">itemName</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">itemName </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_keys</span>

<span class="s4">class </span><span class="s1">Sync</span><span class="s2">:</span>
    <span class="s1">_SeriesGen </span><span class="s2">= </span><span class="s1">SerialNumGen</span><span class="s2">()</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">other</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_name </span><span class="s2">= </span><span class="s1">name</span>
        <span class="s4">if </span><span class="s1">other </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_series </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_SeriesGen</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_series </span><span class="s2">= </span><span class="s1">other</span><span class="s2">.</span><span class="s1">_series</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">= </span><span class="s1">other</span><span class="s2">.</span><span class="s1">_value</span>
    <span class="s4">def </span><span class="s1">invalidate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">= </span><span class="s4">None</span>
    <span class="s4">def </span><span class="s1">change</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">+= </span><span class="s5">1</span>
    <span class="s4">def </span><span class="s1">sync</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_series </span><span class="s2">!= </span><span class="s1">other</span><span class="s2">.</span><span class="s1">_series</span><span class="s2">) </span><span class="s4">or </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">!= </span><span class="s1">other</span><span class="s2">.</span><span class="s1">_value</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_series </span><span class="s2">= </span><span class="s1">other</span><span class="s2">.</span><span class="s1">_series</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">= </span><span class="s1">other</span><span class="s2">.</span><span class="s1">_value</span>
            <span class="s4">return True</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s4">return False</span>
    <span class="s4">def </span><span class="s1">isSynced</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s2">((</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_series </span><span class="s2">== </span><span class="s1">other</span><span class="s2">.</span><span class="s1">_series</span><span class="s2">) </span><span class="s4">and</span>
                <span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_value </span><span class="s2">== </span><span class="s1">other</span><span class="s2">.</span><span class="s1">_value</span><span class="s2">))</span>
    <span class="s4">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s3">'%s(%s)&lt;family=%s,value=%s&gt;' </span><span class="s2">% (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">,</span>
                              <span class="s1">self</span><span class="s2">.</span><span class="s1">_name</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_series</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_value</span><span class="s2">)</span>

<span class="s4">def </span><span class="s1">itype</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">):</span>
    <span class="s6"># version of type that gives more complete information about instance types</span>
    <span class="s4">global </span><span class="s1">dtoolSuperBase</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)</span>
    <span class="s4">if </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">version_info </span><span class="s2">&lt; (</span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">) </span><span class="s4">and </span><span class="s1">t </span><span class="s4">is </span><span class="s1">types</span><span class="s2">.</span><span class="s1">InstanceType</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s3">&quot;&lt;type 'instance' of &lt;class %s&gt;&gt;&quot; </span><span class="s2">% (</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">)</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s6"># C++ object instances appear to be types via type()</span>
        <span class="s6"># check if this is a C++ object</span>
        <span class="s4">if </span><span class="s1">dtoolSuperBase </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">_getDtoolSuperBase</span><span class="s2">()</span>
        <span class="s4">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">dtoolSuperBase</span><span class="s2">):</span>
            <span class="s4">return </span><span class="s3">&quot;&lt;type 'instance' of %s&gt;&quot; </span><span class="s2">% (</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s1">t</span>

<span class="s4">def </span><span class="s1">deeptype</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">maxLen</span><span class="s2">=</span><span class="s5">100</span><span class="s2">, </span><span class="s1">_visitedIds</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
    <span class="s4">if </span><span class="s1">_visitedIds </span><span class="s4">is None</span><span class="s2">:</span>
        <span class="s1">_visitedIds </span><span class="s2">= </span><span class="s1">set</span><span class="s2">()</span>
    <span class="s4">if </span><span class="s1">id</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) </span><span class="s4">in </span><span class="s1">_visitedIds</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s3">'&lt;ALREADY-VISITED %s&gt;' </span><span class="s2">% </span><span class="s1">itype</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)</span>
    <span class="s4">if </span><span class="s1">t </span><span class="s4">in </span><span class="s2">(</span><span class="s1">tuple</span><span class="s2">, </span><span class="s1">list</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s3">''</span>
        <span class="s1">s </span><span class="s2">+= {</span><span class="s1">tuple</span><span class="s2">: </span><span class="s3">'('</span><span class="s2">,</span>
              <span class="s1">list</span><span class="s2">:  </span><span class="s3">'['</span><span class="s2">,}[</span><span class="s1">type</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)]</span>
        <span class="s4">if </span><span class="s1">maxLen </span><span class="s4">is not None and </span><span class="s1">len</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) &gt; </span><span class="s1">maxLen</span><span class="s2">:</span>
            <span class="s1">o </span><span class="s2">= </span><span class="s1">obj</span><span class="s2">[:</span><span class="s1">maxLen</span><span class="s2">]</span>
            <span class="s1">ellips </span><span class="s2">= </span><span class="s3">'...'</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">o </span><span class="s2">= </span><span class="s1">obj</span>
            <span class="s1">ellips </span><span class="s2">= </span><span class="s3">''</span>
        <span class="s1">_visitedIds</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">id</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">))</span>
        <span class="s4">for </span><span class="s1">item </span><span class="s4">in </span><span class="s1">o</span><span class="s2">:</span>
            <span class="s1">s </span><span class="s2">+= </span><span class="s1">deeptype</span><span class="s2">(</span><span class="s1">item</span><span class="s2">, </span><span class="s1">maxLen</span><span class="s2">, </span><span class="s1">_visitedIds</span><span class="s2">=</span><span class="s1">_visitedIds</span><span class="s2">)</span>
            <span class="s1">s </span><span class="s2">+= </span><span class="s3">', '</span>
        <span class="s1">_visitedIds</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">id</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">))</span>
        <span class="s1">s </span><span class="s2">+= </span><span class="s1">ellips</span>
        <span class="s1">s </span><span class="s2">+= {</span><span class="s1">tuple</span><span class="s2">: </span><span class="s3">')'</span><span class="s2">,</span>
              <span class="s1">list</span><span class="s2">:  </span><span class="s3">']'</span><span class="s2">,}[</span><span class="s1">type</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">)]</span>
        <span class="s4">return </span><span class="s1">s</span>
    <span class="s4">elif </span><span class="s1">type</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) </span><span class="s4">is </span><span class="s1">dict</span><span class="s2">:</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s3">'{'</span>
        <span class="s4">if </span><span class="s1">maxLen </span><span class="s4">is not None and </span><span class="s1">len</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) &gt; </span><span class="s1">maxLen</span><span class="s2">:</span>
            <span class="s1">o </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">())[:</span><span class="s1">maxLen</span><span class="s2">]</span>
            <span class="s1">ellips </span><span class="s2">= </span><span class="s3">'...'</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">o </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">())</span>
            <span class="s1">ellips </span><span class="s2">= </span><span class="s3">''</span>
        <span class="s1">_visitedIds</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">id</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">))</span>
        <span class="s4">for </span><span class="s1">key </span><span class="s4">in </span><span class="s1">o</span><span class="s2">:</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">obj</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
            <span class="s1">s </span><span class="s2">+= </span><span class="s3">'%s: %s, ' </span><span class="s2">% (</span><span class="s1">deeptype</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">maxLen</span><span class="s2">, </span><span class="s1">_visitedIds</span><span class="s2">=</span><span class="s1">_visitedIds</span><span class="s2">),</span>
                               <span class="s1">deeptype</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">maxLen</span><span class="s2">, </span><span class="s1">_visitedIds</span><span class="s2">=</span><span class="s1">_visitedIds</span><span class="s2">))</span>
        <span class="s1">_visitedIds</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">id</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">))</span>
        <span class="s1">s </span><span class="s2">+= </span><span class="s1">ellips</span>
        <span class="s1">s </span><span class="s2">+= </span><span class="s3">'}'</span>
        <span class="s4">return </span><span class="s1">s</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">str</span><span class="s2">(</span><span class="s1">itype</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">))</span>

<span class="s4">def </span><span class="s1">getNumberedTypedString</span><span class="s2">(</span><span class="s1">items</span><span class="s2">, </span><span class="s1">maxLen</span><span class="s2">=</span><span class="s5">5000</span><span class="s2">, </span><span class="s1">numPrefix</span><span class="s2">=</span><span class="s3">''</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;get a string that has each item of the list on its own line, 
    and each item is numbered on the left from zero&quot;&quot;&quot;</span>
    <span class="s1">digits </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s1">n </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">items</span><span class="s2">)</span>
    <span class="s4">while </span><span class="s1">n </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s1">digits </span><span class="s2">+= </span><span class="s5">1</span>
        <span class="s1">n </span><span class="s2">//= </span><span class="s5">10</span>
    <span class="s1">digits </span><span class="s2">= </span><span class="s1">digits</span>
    <span class="s1">format </span><span class="s2">= </span><span class="s1">numPrefix </span><span class="s2">+ </span><span class="s3">'%0' </span><span class="s2">+ </span><span class="s3">'%s' </span><span class="s2">% </span><span class="s1">digits </span><span class="s2">+ </span><span class="s3">'i:%s </span><span class="s4">\t</span><span class="s3">%s'</span>
    <span class="s1">first </span><span class="s2">= </span><span class="s4">True</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s3">''</span>
    <span class="s1">snip </span><span class="s2">= </span><span class="s3">'&lt;SNIP&gt;'</span>
    <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">xrange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">items</span><span class="s2">)):</span>
        <span class="s4">if not </span><span class="s1">first</span><span class="s2">:</span>
            <span class="s1">s </span><span class="s2">+= </span><span class="s3">'</span><span class="s4">\n</span><span class="s3">'</span>
        <span class="s1">first </span><span class="s2">= </span><span class="s4">False</span>
        <span class="s1">objStr </span><span class="s2">= </span><span class="s1">fastRepr</span><span class="s2">(</span><span class="s1">items</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])</span>
        <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">objStr</span><span class="s2">) &gt; </span><span class="s1">maxLen</span><span class="s2">:</span>
            <span class="s1">objStr </span><span class="s2">= </span><span class="s3">'%s%s' </span><span class="s2">% (</span><span class="s1">objStr</span><span class="s2">[:(</span><span class="s1">maxLen</span><span class="s2">-</span><span class="s1">len</span><span class="s2">(</span><span class="s1">snip</span><span class="s2">))], </span><span class="s1">snip</span><span class="s2">)</span>
        <span class="s1">s </span><span class="s2">+= </span><span class="s1">format </span><span class="s2">% (</span><span class="s1">i</span><span class="s2">, </span><span class="s1">itype</span><span class="s2">(</span><span class="s1">items</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]), </span><span class="s1">objStr</span><span class="s2">)</span>
    <span class="s4">return </span><span class="s1">s</span>

<span class="s4">def </span><span class="s1">getNumberedTypedSortedString</span><span class="s2">(</span><span class="s1">items</span><span class="s2">, </span><span class="s1">maxLen</span><span class="s2">=</span><span class="s5">5000</span><span class="s2">, </span><span class="s1">numPrefix</span><span class="s2">=</span><span class="s3">''</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;get a string that has each item of the list on its own line, 
    the items are stringwise-sorted, and each item is numbered on 
    the left from zero&quot;&quot;&quot;</span>
    <span class="s1">digits </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s1">n </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">items</span><span class="s2">)</span>
    <span class="s4">while </span><span class="s1">n </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s1">digits </span><span class="s2">+= </span><span class="s5">1</span>
        <span class="s1">n </span><span class="s2">//= </span><span class="s5">10</span>
    <span class="s1">digits </span><span class="s2">= </span><span class="s1">digits</span>
    <span class="s1">format </span><span class="s2">= </span><span class="s1">numPrefix </span><span class="s2">+ </span><span class="s3">'%0' </span><span class="s2">+ </span><span class="s3">'%s' </span><span class="s2">% </span><span class="s1">digits </span><span class="s2">+ </span><span class="s3">'i:%s </span><span class="s4">\t</span><span class="s3">%s'</span>
    <span class="s1">snip </span><span class="s2">= </span><span class="s3">'&lt;SNIP&gt;'</span>
    <span class="s1">strs </span><span class="s2">= []</span>
    <span class="s4">for </span><span class="s1">item </span><span class="s4">in </span><span class="s1">items</span><span class="s2">:</span>
        <span class="s1">objStr </span><span class="s2">= </span><span class="s1">fastRepr</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">objStr</span><span class="s2">) &gt; </span><span class="s1">maxLen</span><span class="s2">:</span>
            <span class="s1">objStr </span><span class="s2">= </span><span class="s3">'%s%s' </span><span class="s2">% (</span><span class="s1">objStr</span><span class="s2">[:(</span><span class="s1">maxLen</span><span class="s2">-</span><span class="s1">len</span><span class="s2">(</span><span class="s1">snip</span><span class="s2">))], </span><span class="s1">snip</span><span class="s2">)</span>
        <span class="s1">strs</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">objStr</span><span class="s2">)</span>
    <span class="s1">first </span><span class="s2">= </span><span class="s4">True</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s3">''</span>
    <span class="s1">strs</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">()</span>
    <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">xrange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">strs</span><span class="s2">)):</span>
        <span class="s4">if not </span><span class="s1">first</span><span class="s2">:</span>
            <span class="s1">s </span><span class="s2">+= </span><span class="s3">'</span><span class="s4">\n</span><span class="s3">'</span>
        <span class="s1">first </span><span class="s2">= </span><span class="s4">False</span>
        <span class="s1">objStr </span><span class="s2">= </span><span class="s1">strs</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
        <span class="s1">s </span><span class="s2">+= </span><span class="s1">format </span><span class="s2">% (</span><span class="s1">i</span><span class="s2">, </span><span class="s1">itype</span><span class="s2">(</span><span class="s1">items</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]), </span><span class="s1">strs</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])</span>
    <span class="s4">return </span><span class="s1">s</span>

<span class="s4">def </span><span class="s1">printNumberedTyped</span><span class="s2">(</span><span class="s1">items</span><span class="s2">, </span><span class="s1">maxLen</span><span class="s2">=</span><span class="s5">5000</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;print out each item of the list on its own line, 
    with each item numbered on the left from zero&quot;&quot;&quot;</span>
    <span class="s1">digits </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s1">n </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">items</span><span class="s2">)</span>
    <span class="s4">while </span><span class="s1">n </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s1">digits </span><span class="s2">+= </span><span class="s5">1</span>
        <span class="s1">n </span><span class="s2">//= </span><span class="s5">10</span>
    <span class="s1">digits </span><span class="s2">= </span><span class="s1">digits</span>
    <span class="s1">format </span><span class="s2">= </span><span class="s3">'%0' </span><span class="s2">+ </span><span class="s3">'%s' </span><span class="s2">% </span><span class="s1">digits </span><span class="s2">+ </span><span class="s3">'i:%s </span><span class="s4">\t</span><span class="s3">%s'</span>
    <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">xrange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">items</span><span class="s2">)):</span>
        <span class="s1">objStr </span><span class="s2">= </span><span class="s1">fastRepr</span><span class="s2">(</span><span class="s1">items</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])</span>
        <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">objStr</span><span class="s2">) &gt; </span><span class="s1">maxLen</span><span class="s2">:</span>
            <span class="s1">snip </span><span class="s2">= </span><span class="s3">'&lt;SNIP&gt;'</span>
            <span class="s1">objStr </span><span class="s2">= </span><span class="s3">'%s%s' </span><span class="s2">% (</span><span class="s1">objStr</span><span class="s2">[:(</span><span class="s1">maxLen</span><span class="s2">-</span><span class="s1">len</span><span class="s2">(</span><span class="s1">snip</span><span class="s2">))], </span><span class="s1">snip</span><span class="s2">)</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">format </span><span class="s2">% (</span><span class="s1">i</span><span class="s2">, </span><span class="s1">itype</span><span class="s2">(</span><span class="s1">items</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]), </span><span class="s1">objStr</span><span class="s2">))</span>

<span class="s4">def </span><span class="s1">printNumberedTypesGen</span><span class="s2">(</span><span class="s1">items</span><span class="s2">, </span><span class="s1">maxLen</span><span class="s2">=</span><span class="s5">5000</span><span class="s2">):</span>
    <span class="s1">digits </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s1">n </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">items</span><span class="s2">)</span>
    <span class="s4">while </span><span class="s1">n </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s1">digits </span><span class="s2">+= </span><span class="s5">1</span>
        <span class="s1">n </span><span class="s2">//= </span><span class="s5">10</span>
    <span class="s1">digits </span><span class="s2">= </span><span class="s1">digits</span>
    <span class="s1">format </span><span class="s2">= </span><span class="s3">'%0' </span><span class="s2">+ </span><span class="s3">'%s' </span><span class="s2">% </span><span class="s1">digits </span><span class="s2">+ </span><span class="s3">'i:%s'</span>
    <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">xrange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">items</span><span class="s2">)):</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">format </span><span class="s2">% (</span><span class="s1">i</span><span class="s2">, </span><span class="s1">itype</span><span class="s2">(</span><span class="s1">items</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])))</span>
        <span class="s4">yield None</span>

<span class="s4">def </span><span class="s1">printNumberedTypes</span><span class="s2">(</span><span class="s1">items</span><span class="s2">, </span><span class="s1">maxLen</span><span class="s2">=</span><span class="s5">5000</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;print out the type of each item of the list on its own line, 
    with each item numbered on the left from zero&quot;&quot;&quot;</span>
    <span class="s4">for </span><span class="s1">result </span><span class="s4">in </span><span class="s1">printNumberedTypesGen</span><span class="s2">(</span><span class="s1">items</span><span class="s2">, </span><span class="s1">maxLen</span><span class="s2">):</span>
        <span class="s4">yield </span><span class="s1">result</span>

<span class="s4">class </span><span class="s1">DelayedCall</span><span class="s2">:</span>
    <span class="s0">&quot;&quot;&quot; calls a func after a specified delay &quot;&quot;&quot;</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">func</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, </span><span class="s1">delay</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">name </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">name </span><span class="s2">= </span><span class="s3">'anonymous'</span>
        <span class="s4">if </span><span class="s1">delay </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">delay </span><span class="s2">= </span><span class="s5">.01</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_func </span><span class="s2">= </span><span class="s1">func</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_taskName </span><span class="s2">= </span><span class="s3">'DelayedCallback-%s' </span><span class="s2">% </span><span class="s1">name</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_delay </span><span class="s2">= </span><span class="s1">delay</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_finished </span><span class="s2">= </span><span class="s4">False</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_addDoLater</span><span class="s2">()</span>
    <span class="s4">def </span><span class="s1">destroy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_finished </span><span class="s2">= </span><span class="s4">True</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_removeDoLater</span><span class="s2">()</span>
    <span class="s4">def </span><span class="s1">finish</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_finished</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_doCallback</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">destroy</span><span class="s2">()</span>
    <span class="s4">def </span><span class="s1">_addDoLater</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">doMethodLater</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_delay</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_doCallback</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_taskName</span><span class="s2">)</span>
    <span class="s4">def </span><span class="s1">_removeDoLater</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_taskName</span><span class="s2">)</span>
    <span class="s4">def </span><span class="s1">_doCallback</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">task</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_finished </span><span class="s2">= </span><span class="s4">True</span>
        <span class="s1">func </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_func</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_func</span>
        <span class="s1">func</span><span class="s2">()</span>

<span class="s4">class </span><span class="s1">FrameDelayedCall</span><span class="s2">:</span>
    <span class="s0">&quot;&quot;&quot; calls a func after N frames &quot;&quot;&quot;</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">, </span><span class="s1">frames</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, </span><span class="s1">cancelFunc</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s6"># checkFunc is optional; called every frame, if returns True, FrameDelay is cancelled</span>
        <span class="s6"># and callback is not called</span>
        <span class="s4">if </span><span class="s1">frames </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">frames </span><span class="s2">= </span><span class="s5">1</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_name </span><span class="s2">= </span><span class="s1">name</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_frames </span><span class="s2">= </span><span class="s1">frames</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_callback </span><span class="s2">= </span><span class="s1">callback</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_cancelFunc </span><span class="s2">= </span><span class="s1">cancelFunc</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_taskName </span><span class="s2">= </span><span class="s1">uniqueName</span><span class="s2">(</span><span class="s3">'%s-%s' </span><span class="s2">% (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_name</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_finished </span><span class="s2">= </span><span class="s4">False</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_startTask</span><span class="s2">()</span>
    <span class="s4">def </span><span class="s1">destroy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_finished </span><span class="s2">= </span><span class="s4">True</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_stopTask</span><span class="s2">()</span>
    <span class="s4">def </span><span class="s1">finish</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_finished</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_finished </span><span class="s2">= </span><span class="s4">True</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_callback</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">destroy</span><span class="s2">()</span>
    <span class="s4">def </span><span class="s1">_startTask</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_frameTask</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_taskName</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_counter </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s4">def </span><span class="s1">_stopTask</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_taskName</span><span class="s2">)</span>
    <span class="s4">def </span><span class="s1">_frameTask</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">task</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_cancelFunc </span><span class="s4">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_cancelFunc</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">destroy</span><span class="s2">()</span>
            <span class="s4">return </span><span class="s1">task</span><span class="s2">.</span><span class="s1">done</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_counter </span><span class="s2">+= </span><span class="s5">1</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_counter </span><span class="s2">&gt;= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_frames</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">finish</span><span class="s2">()</span>
            <span class="s4">return </span><span class="s1">task</span><span class="s2">.</span><span class="s1">done</span>
        <span class="s4">return </span><span class="s1">task</span><span class="s2">.</span><span class="s1">cont</span>

<span class="s4">class </span><span class="s1">DelayedFunctor</span><span class="s2">:</span>
    <span class="s0">&quot;&quot;&quot; Waits for this object to be called, then calls supplied functor after a delay. 
    Effectively inserts a time delay between the caller and the functor. &quot;&quot;&quot;</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">functor</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, </span><span class="s1">delay</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_functor </span><span class="s2">= </span><span class="s1">functor</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_name </span><span class="s2">= </span><span class="s1">name</span>
        <span class="s6"># FunctionInterval requires __name__</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__name__ </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_name</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_delay </span><span class="s2">= </span><span class="s1">delay</span>
    <span class="s4">def </span><span class="s1">_callFunctor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">cb </span><span class="s2">= </span><span class="s1">Functor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_functor</span><span class="s2">, *</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_args</span><span class="s2">, **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_kwArgs</span><span class="s2">)</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_functor</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_name</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_delay</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_args</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_kwArgs</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_delayedCall</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__name__</span>
        <span class="s1">cb</span><span class="s2">()</span>
    <span class="s4">def </span><span class="s1">__call__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwArgs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_args </span><span class="s2">= </span><span class="s1">args</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_kwArgs </span><span class="s2">= </span><span class="s1">kwArgs</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_delayedCall </span><span class="s2">= </span><span class="s1">DelayedCall</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_callFunctor</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_name</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_delay</span><span class="s2">)</span>

<span class="s4">class </span><span class="s1">SubframeCall</span><span class="s2">:</span>
    <span class="s0">&quot;&quot;&quot;Calls a callback at a specific time during the frame using the 
    task system&quot;&quot;&quot;</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">functor</span><span class="s2">, </span><span class="s1">taskPriority</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_functor </span><span class="s2">= </span><span class="s1">functor</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_name </span><span class="s2">= </span><span class="s1">name</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_taskName </span><span class="s2">= </span><span class="s1">uniqueName</span><span class="s2">(</span><span class="s3">'SubframeCall-%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_name</span><span class="s2">)</span>
        <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_doCallback</span><span class="s2">,</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">_taskName</span><span class="s2">,</span>
                    <span class="s1">priority</span><span class="s2">=</span><span class="s1">taskPriority</span><span class="s2">)</span>
    <span class="s4">def </span><span class="s1">_doCallback</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">task</span><span class="s2">):</span>
        <span class="s1">functor </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_functor</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_functor</span>
        <span class="s1">functor</span><span class="s2">()</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_name</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_taskName </span><span class="s2">= </span><span class="s4">None</span>
        <span class="s4">return </span><span class="s1">task</span><span class="s2">.</span><span class="s1">done</span>
    <span class="s4">def </span><span class="s1">cleanup</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_taskName</span><span class="s2">):</span>
            <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_taskName</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_taskName </span><span class="s2">= </span><span class="s4">None</span>

<span class="s4">class </span><span class="s1">PStatScope</span><span class="s2">:</span>
    <span class="s1">collectors </span><span class="s2">= {}</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">level </span><span class="s2">= </span><span class="s4">None</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">levels </span><span class="s2">= []</span>
        <span class="s4">if </span><span class="s1">level</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">level</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">copy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">push </span><span class="s2">= </span><span class="s4">None</span><span class="s2">):</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">PStatScope</span><span class="s2">()</span>
        <span class="s1">c</span><span class="s2">.</span><span class="s1">levels </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">[:]</span>
        <span class="s4">if </span><span class="s1">push</span><span class="s2">:</span>
            <span class="s1">c</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">push</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s1">c</span>

    <span class="s4">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s3">'PStatScope - </span><span class="s4">\'</span><span class="s3">%s</span><span class="s4">\'</span><span class="s3">' </span><span class="s2">% (</span><span class="s1">self</span><span class="s2">,)</span>

    <span class="s4">def </span><span class="s1">__str__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s3">':'</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">push</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">level</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">level</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s3">'_'</span><span class="s2">,</span><span class="s3">''</span><span class="s2">))</span>

    <span class="s4">def </span><span class="s1">pop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">start</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">push </span><span class="s2">= </span><span class="s4">None</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">push</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">push</span><span class="s2">)</span>
            <span class="s4">pass</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getCollector</span><span class="s2">().</span><span class="s1">start</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">stop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pop </span><span class="s2">= </span><span class="s4">False</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getCollector</span><span class="s2">().</span><span class="s1">stop</span><span class="s2">()</span>
        <span class="s4">if </span><span class="s1">pop</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">getCollector</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">label </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">label </span><span class="s4">not in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collectors</span><span class="s2">:</span>
            <span class="s4">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s4">import </span><span class="s1">PStatCollector</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">collectors</span><span class="s2">[</span><span class="s1">label</span><span class="s2">] = </span><span class="s1">PStatCollector</span><span class="s2">(</span><span class="s1">label</span><span class="s2">)</span>
            <span class="s4">pass</span>
        <span class="s6"># print '  ',self.collectors[label]</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collectors</span><span class="s2">[</span><span class="s1">label</span><span class="s2">]</span>

<span class="s4">def </span><span class="s1">pstatcollect</span><span class="s2">(</span><span class="s1">scope</span><span class="s2">, </span><span class="s1">level </span><span class="s2">= </span><span class="s4">None</span><span class="s2">):</span>
    <span class="s4">def </span><span class="s1">decorator</span><span class="s2">(</span><span class="s1">f</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">f</span>

    <span class="s4">try</span><span class="s2">:</span>

        <span class="s4">if not </span><span class="s2">(</span><span class="s1">__dev__ </span><span class="s4">or </span><span class="s1">ConfigVariableBool</span><span class="s2">(</span><span class="s3">'force-pstatcollect'</span><span class="s2">, </span><span class="s4">False</span><span class="s2">)) </span><span class="s4">or </span><span class="s1">\</span>
           <span class="s4">not </span><span class="s1">scope</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">decorator</span>

        <span class="s4">def </span><span class="s1">decorator</span><span class="s2">(</span><span class="s1">f</span><span class="s2">):</span>
            <span class="s4">def </span><span class="s1">wrap</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
                <span class="s1">scope</span><span class="s2">.</span><span class="s1">start</span><span class="s2">(</span><span class="s1">push </span><span class="s2">= (</span><span class="s1">level </span><span class="s4">or </span><span class="s1">f</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">))</span>
                <span class="s1">val </span><span class="s2">= </span><span class="s1">f</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>
                <span class="s1">scope</span><span class="s2">.</span><span class="s1">stop</span><span class="s2">(</span><span class="s1">pop </span><span class="s2">= </span><span class="s4">True</span><span class="s2">)</span>
                <span class="s4">return </span><span class="s1">val</span>
            <span class="s4">return </span><span class="s1">wrap</span>

        <span class="s4">pass</span>
    <span class="s4">except</span><span class="s2">:</span>
        <span class="s4">pass</span>

    <span class="s4">return </span><span class="s1">decorator</span>

<span class="s1">__report_indent </span><span class="s2">= </span><span class="s5">0</span>
<span class="s4">def </span><span class="s1">report</span><span class="s2">(</span><span class="s1">types </span><span class="s2">= [], </span><span class="s1">prefix </span><span class="s2">= </span><span class="s3">''</span><span class="s2">, </span><span class="s1">xform </span><span class="s2">= </span><span class="s4">None</span><span class="s2">, </span><span class="s1">notifyFunc </span><span class="s2">= </span><span class="s4">None</span><span class="s2">, </span><span class="s1">dConfigParam </span><span class="s2">= []):</span>
    <span class="s0">&quot;&quot;&quot; 
    This is a decorator generating function.  Use is similar to 
    a @decorator, except you must be sure to call it as a function. 
    It actually returns the decorator which is then used to transform 
    your decorated function. Confusing at first, I know. 
 
    Decoration occurs at function definition time. 
 
    If __dev__ is not defined, or resolves to False, this function 
    has no effect and no wrapping/transform occurs.  So in production, 
    it's as if the report has been asserted out. 
 
    Parameters: 
        types: A subset list of ['timeStamp', 'frameCount', 'avLocation'] 
            This allows you to specify certain useful bits of info: 
 
              - *module*: Prints the module that this report statement 
                can be found in. 
              - *args*: Prints the arguments as they were passed to this 
                function. 
              - *timeStamp*: Adds the current frame time to the output. 
              - *deltaStamp*: Adds the current AI synched frame time to 
                the output 
              - *frameCount*: Adds the current frame count to the output. 
                Usually cleaner than the timeStamp output. 
              - *avLocation*: Adds the localAvatar's network location to 
                the output.  Useful for interest debugging. 
              - *interests*: Prints the current interest state after the 
                report. 
              - *stackTrace*: Prints a stack trace after the report. 
 
        prefix: Optional string to prepend to output, just before the 
            function.  Allows for easy grepping and is useful when 
            merging AI/Client reports into a single file. 
 
        xform:  Optional callback that accepts a single parameter: 
            argument 0 to the decorated function. (assumed to be 'self') 
            It should return a value to be inserted into the report 
            output string. 
 
        notifyFunc: A notify function such as info, debug, warning, etc. 
            By default the report will be printed to stdout. This will 
            allow you send the report to a designated 'notify' output. 
 
        dConfigParam: A list of Config.prc string variables. 
            By default the report will always print.  If you specify 
            this param, it will only print if one of the specified 
            config strings resolve to True. 
    &quot;&quot;&quot;</span>


    <span class="s4">def </span><span class="s1">indent</span><span class="s2">(</span><span class="s1">str</span><span class="s2">):</span>
        <span class="s4">global </span><span class="s1">__report_indent</span>
        <span class="s4">return </span><span class="s3">' '</span><span class="s2">*</span><span class="s1">__report_indent</span><span class="s2">+</span><span class="s1">str</span>

    <span class="s4">def </span><span class="s1">decorator</span><span class="s2">(</span><span class="s1">f</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">f</span>

    <span class="s4">try</span><span class="s2">:</span>
        <span class="s4">if not </span><span class="s2">(</span><span class="s1">__dev__ </span><span class="s4">or </span><span class="s1">config</span><span class="s2">.</span><span class="s1">GetBool</span><span class="s2">(</span><span class="s3">'force-reports'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)):</span>
            <span class="s4">return </span><span class="s1">decorator</span>

        <span class="s6"># determine whether we should use the decorator</span>
        <span class="s6"># based on the value of dConfigParam.</span>
        <span class="s1">dConfigParamList </span><span class="s2">= []</span>
        <span class="s1">doPrint </span><span class="s2">= </span><span class="s4">False</span>
        <span class="s4">if not </span><span class="s1">dConfigParam</span><span class="s2">:</span>
            <span class="s1">doPrint </span><span class="s2">= </span><span class="s4">True</span>
        <span class="s4">else</span><span class="s2">:</span>

            <span class="s4">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">dConfigParam</span><span class="s2">, (</span><span class="s1">list</span><span class="s2">,</span><span class="s1">tuple</span><span class="s2">)):</span>
                <span class="s1">dConfigParams </span><span class="s2">= (</span><span class="s1">dConfigParam</span><span class="s2">,)</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">dConfigParams </span><span class="s2">= </span><span class="s1">dConfigParam</span>

            <span class="s1">dConfigParamList </span><span class="s2">= [</span><span class="s1">param </span><span class="s4">for </span><span class="s1">param </span><span class="s4">in </span><span class="s1">dConfigParams \</span>
                                <span class="s4">if </span><span class="s1">config</span><span class="s2">.</span><span class="s1">GetBool</span><span class="s2">(</span><span class="s3">'want-%s-report' </span><span class="s2">% (</span><span class="s1">param</span><span class="s2">,), </span><span class="s5">0</span><span class="s2">)]</span>

            <span class="s1">doPrint </span><span class="s2">= </span><span class="s1">bool</span><span class="s2">(</span><span class="s1">dConfigParamList</span><span class="s2">)</span>
            <span class="s4">pass</span>

        <span class="s4">if not </span><span class="s1">doPrint</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">decorator</span>

        <span class="s6"># Determine any prefixes defined in our Config.prc.</span>
        <span class="s4">if </span><span class="s1">prefix</span><span class="s2">:</span>
            <span class="s1">prefixes </span><span class="s2">= </span><span class="s1">set</span><span class="s2">([</span><span class="s1">prefix</span><span class="s2">])</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">prefixes </span><span class="s2">= </span><span class="s1">set</span><span class="s2">()</span>
            <span class="s4">pass</span>

        <span class="s4">for </span><span class="s1">param </span><span class="s4">in </span><span class="s1">dConfigParamList</span><span class="s2">:</span>
            <span class="s1">prefix </span><span class="s2">= </span><span class="s1">config</span><span class="s2">.</span><span class="s1">GetString</span><span class="s2">(</span><span class="s3">'prefix-%s-report' </span><span class="s2">% (</span><span class="s1">param</span><span class="s2">,), </span><span class="s3">''</span><span class="s2">)</span>
            <span class="s4">if </span><span class="s1">prefix</span><span class="s2">:</span>
                <span class="s1">prefixes</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">)</span>
                <span class="s4">pass</span>
            <span class="s4">pass</span>

    <span class="s4">except </span><span class="s1">NameError </span><span class="s4">as </span><span class="s1">e</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">decorator</span>

    <span class="s1">globalClockDelta </span><span class="s2">= </span><span class="s1">importlib</span><span class="s2">.</span><span class="s1">import_module</span><span class="s2">(</span><span class="s3">&quot;direct.distributed.ClockDelta&quot;</span><span class="s2">).</span><span class="s1">globalClockDelta</span>

    <span class="s4">def </span><span class="s1">decorator</span><span class="s2">(</span><span class="s1">f</span><span class="s2">):</span>
        <span class="s4">def </span><span class="s1">wrap</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">,**</span><span class="s1">kwargs</span><span class="s2">):</span>
            <span class="s4">if </span><span class="s1">args</span><span class="s2">:</span>
                <span class="s1">rArgs </span><span class="s2">= [</span><span class="s1">args</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__ </span><span class="s2">+ </span><span class="s3">', '</span><span class="s2">]</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">rArgs </span><span class="s2">= []</span>

            <span class="s4">if </span><span class="s3">'args' </span><span class="s4">in </span><span class="s1">types</span><span class="s2">:</span>
                <span class="s1">rArgs </span><span class="s2">+= [</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)+</span><span class="s3">', ' </span><span class="s4">for </span><span class="s1">x </span><span class="s4">in </span><span class="s1">args</span><span class="s2">[</span><span class="s5">1</span><span class="s2">:]] + </span><span class="s1">\</span>
                         <span class="s2">[ </span><span class="s1">x </span><span class="s2">+ </span><span class="s3">' = ' </span><span class="s2">+ </span><span class="s3">'%s, ' </span><span class="s2">% </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">y</span><span class="s2">) </span><span class="s4">for </span><span class="s1">x</span><span class="s2">,</span><span class="s1">y </span><span class="s4">in </span><span class="s1">kwargs</span><span class="s2">.</span><span class="s1">items</span><span class="s2">()]</span>

            <span class="s4">if not </span><span class="s1">rArgs</span><span class="s2">:</span>
                <span class="s1">rArgs </span><span class="s2">= </span><span class="s3">'()'</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">rArgs </span><span class="s2">= </span><span class="s3">'(' </span><span class="s2">+ </span><span class="s1">reduce</span><span class="s2">(</span><span class="s1">str</span><span class="s2">.</span><span class="s1">__add__</span><span class="s2">,</span><span class="s1">rArgs</span><span class="s2">)[:-</span><span class="s5">2</span><span class="s2">] + </span><span class="s3">')'</span>


            <span class="s1">outStr </span><span class="s2">= </span><span class="s3">'%s%s' </span><span class="s2">% (</span><span class="s1">f</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">, </span><span class="s1">rArgs</span><span class="s2">)</span>

            <span class="s6"># Insert prefix place holder, if needed</span>
            <span class="s4">if </span><span class="s1">prefixes</span><span class="s2">:</span>
                <span class="s1">outStr </span><span class="s2">= </span><span class="s3">'%%s %s' </span><span class="s2">% (</span><span class="s1">outStr</span><span class="s2">,)</span>


            <span class="s4">if </span><span class="s3">'module' </span><span class="s4">in </span><span class="s1">types</span><span class="s2">:</span>
                <span class="s1">outStr </span><span class="s2">= </span><span class="s3">'%s {M:%s}' </span><span class="s2">% (</span><span class="s1">outStr</span><span class="s2">, </span><span class="s1">f</span><span class="s2">.</span><span class="s1">__module__</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s3">'.'</span><span class="s2">)[-</span><span class="s5">1</span><span class="s2">])</span>

            <span class="s4">if </span><span class="s3">'frameCount' </span><span class="s4">in </span><span class="s1">types</span><span class="s2">:</span>
                <span class="s1">outStr </span><span class="s2">= </span><span class="s3">'%-8d : %s' </span><span class="s2">% (</span><span class="s1">globalClock</span><span class="s2">.</span><span class="s1">getFrameCount</span><span class="s2">(), </span><span class="s1">outStr</span><span class="s2">)</span>

            <span class="s4">if </span><span class="s3">'timeStamp' </span><span class="s4">in </span><span class="s1">types</span><span class="s2">:</span>
                <span class="s1">outStr </span><span class="s2">= </span><span class="s3">'%-8.3f : %s' </span><span class="s2">% (</span><span class="s1">globalClock</span><span class="s2">.</span><span class="s1">getFrameTime</span><span class="s2">(), </span><span class="s1">outStr</span><span class="s2">)</span>

            <span class="s4">if </span><span class="s3">'deltaStamp' </span><span class="s4">in </span><span class="s1">types</span><span class="s2">:</span>
                <span class="s1">outStr </span><span class="s2">= </span><span class="s3">'%-8.2f : %s' </span><span class="s2">% (</span><span class="s1">globalClock</span><span class="s2">.</span><span class="s1">getRealTime</span><span class="s2">() - </span><span class="s1">\</span>
                                         <span class="s1">globalClockDelta</span><span class="s2">.</span><span class="s1">delta</span><span class="s2">, </span><span class="s1">outStr</span><span class="s2">)</span>
            <span class="s4">if </span><span class="s3">'avLocation' </span><span class="s4">in </span><span class="s1">types</span><span class="s2">:</span>
                <span class="s1">outStr </span><span class="s2">= </span><span class="s3">'%s : %s' </span><span class="s2">% (</span><span class="s1">outStr</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">localAvatar</span><span class="s2">.</span><span class="s1">getLocation</span><span class="s2">()))</span>

            <span class="s4">if </span><span class="s1">xform</span><span class="s2">:</span>
                <span class="s1">outStr </span><span class="s2">= </span><span class="s3">'%s : %s' </span><span class="s2">% (</span><span class="s1">outStr</span><span class="s2">, </span><span class="s1">xform</span><span class="s2">(</span><span class="s1">args</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]))</span>

            <span class="s4">if </span><span class="s1">prefixes</span><span class="s2">:</span>
                <span class="s6"># This will print the same report once for each prefix</span>
                <span class="s4">for </span><span class="s1">prefix </span><span class="s4">in </span><span class="s1">prefixes</span><span class="s2">:</span>
                    <span class="s4">if </span><span class="s1">notifyFunc</span><span class="s2">:</span>
                        <span class="s1">notifyFunc</span><span class="s2">(</span><span class="s1">outStr </span><span class="s2">% (</span><span class="s1">prefix</span><span class="s2">,))</span>
                    <span class="s4">else</span><span class="s2">:</span>
                        <span class="s1">print</span><span class="s2">(</span><span class="s1">indent</span><span class="s2">(</span><span class="s1">outStr </span><span class="s2">% (</span><span class="s1">prefix</span><span class="s2">,)))</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s4">if </span><span class="s1">notifyFunc</span><span class="s2">:</span>
                    <span class="s1">notifyFunc</span><span class="s2">(</span><span class="s1">outStr</span><span class="s2">)</span>
                <span class="s4">else</span><span class="s2">:</span>
                    <span class="s1">print</span><span class="s2">(</span><span class="s1">indent</span><span class="s2">(</span><span class="s1">outStr</span><span class="s2">))</span>

            <span class="s4">if </span><span class="s3">'interests' </span><span class="s4">in </span><span class="s1">types</span><span class="s2">:</span>
                <span class="s1">base</span><span class="s2">.</span><span class="s1">cr</span><span class="s2">.</span><span class="s1">printInterestSets</span><span class="s2">()</span>

            <span class="s4">if </span><span class="s3">'stackTrace' </span><span class="s4">in </span><span class="s1">types</span><span class="s2">:</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s1">StackTrace</span><span class="s2">())</span>

            <span class="s4">global </span><span class="s1">__report_indent</span>
            <span class="s1">rVal </span><span class="s2">= </span><span class="s4">None</span>
            <span class="s4">try</span><span class="s2">:</span>
                <span class="s1">__report_indent </span><span class="s2">+= </span><span class="s5">1</span>
                <span class="s1">rVal </span><span class="s2">= </span><span class="s1">f</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">,**</span><span class="s1">kwargs</span><span class="s2">)</span>
            <span class="s4">finally</span><span class="s2">:</span>
                <span class="s1">__report_indent </span><span class="s2">-= </span><span class="s5">1</span>
                <span class="s4">if </span><span class="s1">rVal </span><span class="s4">is not None</span><span class="s2">:</span>
                    <span class="s1">print</span><span class="s2">(</span><span class="s1">indent</span><span class="s2">(</span><span class="s3">' -&gt; '</span><span class="s2">+</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">rVal</span><span class="s2">)))</span>
                    <span class="s4">pass</span>
                <span class="s4">pass</span>
            <span class="s4">return </span><span class="s1">rVal</span>

        <span class="s1">wrap</span><span class="s2">.</span><span class="s1">__name__ </span><span class="s2">= </span><span class="s1">f</span><span class="s2">.</span><span class="s1">__name__</span>
        <span class="s1">wrap</span><span class="s2">.</span><span class="s1">__dict__ </span><span class="s2">= </span><span class="s1">f</span><span class="s2">.</span><span class="s1">__dict__</span>
        <span class="s1">wrap</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">f</span><span class="s2">.</span><span class="s1">__doc__</span>
        <span class="s1">wrap</span><span class="s2">.</span><span class="s1">__module__ </span><span class="s2">= </span><span class="s1">f</span><span class="s2">.</span><span class="s1">__module__</span>
        <span class="s4">return </span><span class="s1">wrap</span>
    <span class="s4">return </span><span class="s1">decorator</span>

<span class="s4">def </span><span class="s1">getBase</span><span class="s2">():</span>
    <span class="s4">try</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">base</span>
    <span class="s4">except</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">simbase</span>

<span class="s4">def </span><span class="s1">getRepository</span><span class="s2">():</span>
    <span class="s4">try</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">base</span><span class="s2">.</span><span class="s1">cr</span>
    <span class="s4">except</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">simbase</span><span class="s2">.</span><span class="s1">air</span>

<span class="s1">exceptionLoggedNotify </span><span class="s2">= </span><span class="s4">None</span>
<span class="s4">if __debug__</span><span class="s2">:</span>
    <span class="s4">def </span><span class="s1">exceptionLogged</span><span class="s2">(</span><span class="s1">append</span><span class="s2">=</span><span class="s4">True</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot;decorator that outputs the function name and all arguments 
        if an exception passes back through the stack frame 
        if append is true, string is appended to the __str__ output of 
        the exception. if append is false, string is printed to the log 
        directly. If the output will take up many lines, it's recommended 
        to set append to False so that the exception stack is not hidden 
        by the output of this decorator. 
        &quot;&quot;&quot;</span>
        <span class="s4">try</span><span class="s2">:</span>
            <span class="s1">null </span><span class="s2">= </span><span class="s4">not </span><span class="s1">__dev__</span>
        <span class="s4">except</span><span class="s2">:</span>
            <span class="s1">null </span><span class="s2">= </span><span class="s4">not __debug__</span>
        <span class="s4">if </span><span class="s1">null</span><span class="s2">:</span>
            <span class="s6"># if we're not in __dev__, just return the function itself. This</span>
            <span class="s6"># results in zero runtime overhead, since decorators are evaluated</span>
            <span class="s6"># at module-load.</span>
            <span class="s4">def </span><span class="s1">nullDecorator</span><span class="s2">(</span><span class="s1">f</span><span class="s2">):</span>
                <span class="s4">return </span><span class="s1">f</span>
            <span class="s4">return </span><span class="s1">nullDecorator</span>

        <span class="s4">def </span><span class="s1">_decoratorFunc</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">append</span><span class="s2">=</span><span class="s1">append</span><span class="s2">):</span>
            <span class="s4">global </span><span class="s1">exceptionLoggedNotify</span>
            <span class="s4">if </span><span class="s1">exceptionLoggedNotify </span><span class="s4">is None</span><span class="s2">:</span>
                <span class="s4">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">directnotify</span><span class="s2">.</span><span class="s1">DirectNotifyGlobal </span><span class="s4">import </span><span class="s1">directNotify</span>
                <span class="s1">exceptionLoggedNotify </span><span class="s2">= </span><span class="s1">directNotify</span><span class="s2">.</span><span class="s1">newCategory</span><span class="s2">(</span><span class="s3">&quot;ExceptionLogged&quot;</span><span class="s2">)</span>
            <span class="s4">def </span><span class="s1">_exceptionLogged</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kArgs</span><span class="s2">):</span>
                <span class="s4">try</span><span class="s2">:</span>
                    <span class="s4">return </span><span class="s1">f</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kArgs</span><span class="s2">)</span>
                <span class="s4">except </span><span class="s1">Exception </span><span class="s4">as </span><span class="s1">e</span><span class="s2">:</span>
                    <span class="s4">try</span><span class="s2">:</span>
                        <span class="s1">s </span><span class="s2">= </span><span class="s3">'%s(' </span><span class="s2">% </span><span class="s1">f</span><span class="s2">.</span><span class="s1">__name__</span>
                        <span class="s4">for </span><span class="s1">arg </span><span class="s4">in </span><span class="s1">args</span><span class="s2">:</span>
                            <span class="s1">s </span><span class="s2">+= </span><span class="s3">'%s, ' </span><span class="s2">% </span><span class="s1">arg</span>
                        <span class="s4">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s4">in </span><span class="s1">list</span><span class="s2">(</span><span class="s1">kArgs</span><span class="s2">.</span><span class="s1">items</span><span class="s2">()):</span>
                            <span class="s1">s </span><span class="s2">+= </span><span class="s3">'%s=%s, ' </span><span class="s2">% (</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>
                        <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">args</span><span class="s2">) </span><span class="s4">or </span><span class="s1">len</span><span class="s2">(</span><span class="s1">kArgs</span><span class="s2">):</span>
                            <span class="s1">s </span><span class="s2">= </span><span class="s1">s</span><span class="s2">[:-</span><span class="s5">2</span><span class="s2">]</span>
                        <span class="s1">s </span><span class="s2">+= </span><span class="s3">')'</span>
                        <span class="s4">if </span><span class="s1">append</span><span class="s2">:</span>
                            <span class="s1">appendStr</span><span class="s2">(</span><span class="s1">e</span><span class="s2">, </span><span class="s3">'</span><span class="s4">\n</span><span class="s3">%s' </span><span class="s2">% </span><span class="s1">s</span><span class="s2">)</span>
                        <span class="s4">else</span><span class="s2">:</span>
                            <span class="s1">exceptionLoggedNotify</span><span class="s2">.</span><span class="s1">info</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>
                    <span class="s4">except</span><span class="s2">:</span>
                        <span class="s1">exceptionLoggedNotify</span><span class="s2">.</span><span class="s1">info</span><span class="s2">(</span>
                            <span class="s3">'%s: ERROR IN PRINTING' </span><span class="s2">% </span><span class="s1">f</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">)</span>
                    <span class="s4">raise</span>
            <span class="s1">_exceptionLogged</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">f</span><span class="s2">.</span><span class="s1">__doc__</span>
            <span class="s4">return </span><span class="s1">_exceptionLogged</span>
        <span class="s4">return </span><span class="s1">_decoratorFunc</span>

<span class="s6"># http://en.wikipedia.org/wiki/Golden_ratio</span>
<span class="s1">GoldenRatio </span><span class="s2">= (</span><span class="s5">1. </span><span class="s2">+ </span><span class="s1">math</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s5">5.</span><span class="s2">)) / </span><span class="s5">2.</span>
<span class="s4">class </span><span class="s1">GoldenRectangle</span><span class="s2">:</span>
    <span class="s2">@</span><span class="s1">staticmethod</span>
    <span class="s4">def </span><span class="s1">getLongerEdge</span><span class="s2">(</span><span class="s1">shorter</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">shorter </span><span class="s2">* </span><span class="s1">GoldenRatio</span>
    <span class="s2">@</span><span class="s1">staticmethod</span>
    <span class="s4">def </span><span class="s1">getShorterEdge</span><span class="s2">(</span><span class="s1">longer</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">longer </span><span class="s2">/ </span><span class="s1">GoldenRatio</span>

<span class="s4">def </span><span class="s1">nullGen</span><span class="s2">():</span>
    <span class="s6"># generator that ends immediately</span>
    <span class="s4">if False</span><span class="s2">:</span>
        <span class="s6"># yield that never runs but still exists, making this func a generator</span>
        <span class="s4">yield None</span>

<span class="s4">def </span><span class="s1">loopGen</span><span class="s2">(</span><span class="s1">l</span><span class="s2">):</span>
    <span class="s6"># generator that yields the items of an iterable object forever</span>
    <span class="s4">def </span><span class="s1">_gen</span><span class="s2">(</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s4">while True</span><span class="s2">:</span>
            <span class="s4">for </span><span class="s1">item </span><span class="s4">in </span><span class="s1">l</span><span class="s2">:</span>
                <span class="s4">yield </span><span class="s1">item</span>
    <span class="s1">gen </span><span class="s2">= </span><span class="s1">_gen</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)</span>
    <span class="s6"># don't leak</span>
    <span class="s1">_gen </span><span class="s2">= </span><span class="s4">None</span>
    <span class="s4">return </span><span class="s1">gen</span>

<span class="s4">def </span><span class="s1">makeFlywheelGen</span><span class="s2">(</span><span class="s1">objects</span><span class="s2">, </span><span class="s1">countList</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, </span><span class="s1">countFunc</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
    <span class="s6"># iterates and finally yields a flywheel generator object</span>
    <span class="s6"># the number of appearances for each object is controlled by passing in</span>
    <span class="s6"># a list of counts, or a functor that returns a count when called with</span>
    <span class="s6"># an object from the 'objects' list.</span>
    <span class="s6"># if scale is provided, all counts are scaled by the scale value and then int()'ed.</span>
    <span class="s4">def </span><span class="s1">flywheel</span><span class="s2">(</span><span class="s1">index2objectAndCount</span><span class="s2">):</span>
        <span class="s6"># generator to produce a sequence whose elements appear a specific number of times</span>
        <span class="s4">while </span><span class="s1">len</span><span class="s2">(</span><span class="s1">index2objectAndCount</span><span class="s2">):</span>
            <span class="s1">keyList </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">index2objectAndCount</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">())</span>
            <span class="s4">for </span><span class="s1">key </span><span class="s4">in </span><span class="s1">keyList</span><span class="s2">:</span>
                <span class="s4">if </span><span class="s1">index2objectAndCount</span><span class="s2">[</span><span class="s1">key</span><span class="s2">][</span><span class="s5">1</span><span class="s2">] &gt; </span><span class="s5">0</span><span class="s2">:</span>
                    <span class="s4">yield </span><span class="s1">index2objectAndCount</span><span class="s2">[</span><span class="s1">key</span><span class="s2">][</span><span class="s5">0</span><span class="s2">]</span>
                    <span class="s1">index2objectAndCount</span><span class="s2">[</span><span class="s1">key</span><span class="s2">][</span><span class="s5">1</span><span class="s2">] -= </span><span class="s5">1</span>
                <span class="s4">if </span><span class="s1">index2objectAndCount</span><span class="s2">[</span><span class="s1">key</span><span class="s2">][</span><span class="s5">1</span><span class="s2">] &lt;= </span><span class="s5">0</span><span class="s2">:</span>
                    <span class="s4">del </span><span class="s1">index2objectAndCount</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
    <span class="s6"># if we were not given a list of counts, create it by calling countFunc</span>
    <span class="s4">if </span><span class="s1">countList </span><span class="s4">is None</span><span class="s2">:</span>
        <span class="s1">countList </span><span class="s2">= []</span>
        <span class="s4">for </span><span class="s1">object </span><span class="s4">in </span><span class="s1">objects</span><span class="s2">:</span>
            <span class="s4">yield None</span>
            <span class="s1">countList</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">countFunc</span><span class="s2">(</span><span class="s1">object</span><span class="s2">))</span>
    <span class="s4">if </span><span class="s1">scale </span><span class="s4">is not None</span><span class="s2">:</span>
        <span class="s6"># scale the counts if we've got a scale factor</span>
        <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">xrange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">countList</span><span class="s2">)):</span>
            <span class="s4">yield None</span>
            <span class="s4">if </span><span class="s1">countList</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] &gt; </span><span class="s5">0</span><span class="s2">:</span>
                <span class="s1">countList</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">max</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">int</span><span class="s2">(</span><span class="s1">countList</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] * </span><span class="s1">scale</span><span class="s2">))</span>
    <span class="s6"># create a dict for the flywheel to use during its iteration to efficiently select</span>
    <span class="s6"># the objects for the sequence</span>
    <span class="s1">index2objectAndCount </span><span class="s2">= {}</span>
    <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">xrange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">countList</span><span class="s2">)):</span>
        <span class="s4">yield None</span>
        <span class="s1">index2objectAndCount</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = [</span><span class="s1">objects</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">countList</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]]</span>
    <span class="s6"># create the flywheel generator</span>
    <span class="s4">yield </span><span class="s1">flywheel</span><span class="s2">(</span><span class="s1">index2objectAndCount</span><span class="s2">)</span>

<span class="s4">def </span><span class="s1">flywheel</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kArgs</span><span class="s2">):</span>
    <span class="s6"># create a flywheel generator</span>
    <span class="s6"># see arguments and comments in flywheelGen above</span>
    <span class="s6"># example usage:</span>
    <span class="s0">&quot;&quot;&quot; 
    &gt;&gt;&gt; for i in flywheel([1,2,3], countList=[10, 5, 1]): 
    ...   print i, 
    ... 
    1 2 3 1 2 1 2 1 2 1 2 1 1 1 1 1 
    &quot;&quot;&quot;</span>
    <span class="s4">for </span><span class="s1">flywheel </span><span class="s4">in </span><span class="s1">makeFlywheelGen</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kArgs</span><span class="s2">):</span>
        <span class="s4">pass</span>
    <span class="s4">return </span><span class="s1">flywheel</span>


<span class="s4">if __debug__</span><span class="s2">:</span>
    <span class="s4">def </span><span class="s1">quickProfile</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;unnamed&quot;</span><span class="s2">):</span>
        <span class="s4">import </span><span class="s1">pstats</span>
        <span class="s4">def </span><span class="s1">profileDecorator</span><span class="s2">(</span><span class="s1">f</span><span class="s2">):</span>
            <span class="s4">if</span><span class="s2">(</span><span class="s4">not </span><span class="s1">config</span><span class="s2">.</span><span class="s1">GetBool</span><span class="s2">(</span><span class="s3">&quot;use-profiler&quot;</span><span class="s2">,</span><span class="s5">0</span><span class="s2">)):</span>
                <span class="s4">return </span><span class="s1">f</span>
            <span class="s4">def </span><span class="s1">_profiled</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kArgs</span><span class="s2">):</span>
                <span class="s6"># must do this in here because we don't have base/simbase</span>
                <span class="s6"># at the time that PythonUtil is loaded</span>
                <span class="s4">if</span><span class="s2">(</span><span class="s4">not </span><span class="s1">config</span><span class="s2">.</span><span class="s1">GetBool</span><span class="s2">(</span><span class="s3">&quot;profile-debug&quot;</span><span class="s2">,</span><span class="s5">0</span><span class="s2">)):</span>
                    <span class="s6">#dumb timings</span>
                    <span class="s1">st</span><span class="s2">=</span><span class="s1">globalClock</span><span class="s2">.</span><span class="s1">getRealTime</span><span class="s2">()</span>
                    <span class="s1">f</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">,**</span><span class="s1">kArgs</span><span class="s2">)</span>
                    <span class="s1">s</span><span class="s2">=</span><span class="s1">globalClock</span><span class="s2">.</span><span class="s1">getRealTime</span><span class="s2">()-</span><span class="s1">st</span>
                    <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Function %s.%s took %s seconds&quot;</span><span class="s2">%(</span><span class="s1">f</span><span class="s2">.</span><span class="s1">__module__</span><span class="s2">, </span><span class="s1">f</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">,</span><span class="s1">s</span><span class="s2">))</span>
                <span class="s4">else</span><span class="s2">:</span>
                    <span class="s4">import </span><span class="s1">profile </span><span class="s4">as </span><span class="s1">prof</span><span class="s2">, </span><span class="s1">pstats</span>

                    <span class="s6">#detailed profile, stored in base.stats under (</span>
                    <span class="s4">if</span><span class="s2">(</span><span class="s4">not </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">base</span><span class="s2">,</span><span class="s3">&quot;stats&quot;</span><span class="s2">)):</span>
                        <span class="s1">base</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">={}</span>
                    <span class="s4">if</span><span class="s2">(</span><span class="s4">not </span><span class="s1">base</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)):</span>
                        <span class="s1">base</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]=[]</span>

                    <span class="s1">prof</span><span class="s2">.</span><span class="s1">runctx</span><span class="s2">(</span><span class="s3">'f(*args, **kArgs)'</span><span class="s2">, {</span><span class="s3">'f'</span><span class="s2">:</span><span class="s1">f</span><span class="s2">,</span><span class="s3">'args'</span><span class="s2">:</span><span class="s1">args</span><span class="s2">,</span><span class="s3">'kArgs'</span><span class="s2">:</span><span class="s1">kArgs</span><span class="s2">},</span><span class="s4">None</span><span class="s2">,</span><span class="s3">&quot;t.prof&quot;</span><span class="s2">)</span>
                    <span class="s1">s</span><span class="s2">=</span><span class="s1">pstats</span><span class="s2">.</span><span class="s1">Stats</span><span class="s2">(</span><span class="s3">&quot;t.prof&quot;</span><span class="s2">)</span>
                    <span class="s6">#p=hotshot.Profile(&quot;t.prof&quot;)</span>
                    <span class="s6">#p.runctx('f(*args, **kArgs)', {'f':f,'args':args,'kArgs':kArgs},None)</span>
                    <span class="s6">#s = hotshot.stats.load(&quot;t.prof&quot;)</span>
                    <span class="s1">s</span><span class="s2">.</span><span class="s1">strip_dirs</span><span class="s2">()</span>
                    <span class="s1">s</span><span class="s2">.</span><span class="s1">sort_stats</span><span class="s2">(</span><span class="s3">&quot;cumulative&quot;</span><span class="s2">)</span>
                    <span class="s1">base</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">[</span><span class="s1">name</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>

            <span class="s1">_profiled</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">f</span><span class="s2">.</span><span class="s1">__doc__</span>
            <span class="s4">return </span><span class="s1">_profiled</span>
        <span class="s4">return </span><span class="s1">profileDecorator</span>

<span class="s4">def </span><span class="s1">getTotalAnnounceTime</span><span class="s2">():</span>
    <span class="s1">td</span><span class="s2">=</span><span class="s5">0</span>
    <span class="s4">for </span><span class="s1">objs </span><span class="s4">in </span><span class="s1">base</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">values</span><span class="s2">():</span>
        <span class="s4">for </span><span class="s1">stat </span><span class="s4">in </span><span class="s1">objs</span><span class="s2">:</span>
            <span class="s1">td</span><span class="s2">+=</span><span class="s1">getAnnounceGenerateTime</span><span class="s2">(</span><span class="s1">stat</span><span class="s2">)</span>
    <span class="s4">return </span><span class="s1">td</span>

<span class="s4">def </span><span class="s1">getAnnounceGenerateTime</span><span class="s2">(</span><span class="s1">stat</span><span class="s2">):</span>
    <span class="s1">val</span><span class="s2">=</span><span class="s5">0</span>
    <span class="s1">stats</span><span class="s2">=</span><span class="s1">stat</span><span class="s2">.</span><span class="s1">stats</span>
    <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">list</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">()):</span>
        <span class="s4">if</span><span class="s2">(</span><span class="s1">i</span><span class="s2">[</span><span class="s5">2</span><span class="s2">]==</span><span class="s3">&quot;announceGenerate&quot;</span><span class="s2">):</span>
            <span class="s1">newVal</span><span class="s2">=</span><span class="s1">stats</span><span class="s2">[</span><span class="s1">i</span><span class="s2">][</span><span class="s5">3</span><span class="s2">]</span>
            <span class="s4">if</span><span class="s2">(</span><span class="s1">newVal</span><span class="s2">&gt;</span><span class="s1">val</span><span class="s2">):</span>
                <span class="s1">val</span><span class="s2">=</span><span class="s1">newVal</span>
    <span class="s4">return </span><span class="s1">val</span>


<span class="s4">class </span><span class="s1">MiniLog</span><span class="s2">:</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">indent </span><span class="s2">= </span><span class="s5">1</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">name</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">lines </span><span class="s2">= []</span>

    <span class="s4">def </span><span class="s1">__str__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s3">'%s</span><span class="s4">\n</span><span class="s3">MiniLog: %s</span><span class="s4">\n</span><span class="s3">%s</span><span class="s4">\n</span><span class="s3">%s</span><span class="s4">\n</span><span class="s3">%s' </span><span class="s2">% </span><span class="s1">\</span>
               <span class="s2">(</span><span class="s3">'*'</span><span class="s2">*</span><span class="s5">50</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">, </span><span class="s3">'-'</span><span class="s2">*</span><span class="s5">50</span><span class="s2">, </span><span class="s3">'</span><span class="s4">\n</span><span class="s3">'</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">), </span><span class="s3">'*'</span><span class="s2">*</span><span class="s5">50</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">enterFunction</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">funcName</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
        <span class="s1">rArgs </span><span class="s2">= [</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)+</span><span class="s3">', ' </span><span class="s4">for </span><span class="s1">x </span><span class="s4">in </span><span class="s1">args</span><span class="s2">] + </span><span class="s1">\</span>
                <span class="s2">[ </span><span class="s1">x </span><span class="s2">+ </span><span class="s3">' = ' </span><span class="s2">+ </span><span class="s3">'%s, ' </span><span class="s2">% </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">y</span><span class="s2">) </span><span class="s4">for </span><span class="s1">x</span><span class="s2">,</span><span class="s1">y </span><span class="s4">in </span><span class="s1">kw</span><span class="s2">.</span><span class="s1">items</span><span class="s2">()]</span>

        <span class="s4">if not </span><span class="s1">rArgs</span><span class="s2">:</span>
            <span class="s1">rArgs </span><span class="s2">= </span><span class="s3">'()'</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">rArgs </span><span class="s2">= </span><span class="s3">'(' </span><span class="s2">+ </span><span class="s1">reduce</span><span class="s2">(</span><span class="s1">str</span><span class="s2">.</span><span class="s1">__add__</span><span class="s2">,</span><span class="s1">rArgs</span><span class="s2">)[:-</span><span class="s5">2</span><span class="s2">] + </span><span class="s3">')'</span>

        <span class="s1">line </span><span class="s2">= </span><span class="s3">'%s%s' </span><span class="s2">% (</span><span class="s1">funcName</span><span class="s2">, </span><span class="s1">rArgs</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">appendFunctionCall</span><span class="s2">(</span><span class="s1">line</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">indent </span><span class="s2">+= </span><span class="s5">1</span>

        <span class="s4">return </span><span class="s1">line</span>

    <span class="s4">def </span><span class="s1">exitFunction</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">indent </span><span class="s2">-= </span><span class="s5">1</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">indent</span>

    <span class="s4">def </span><span class="s1">appendFunctionCall</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">line</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">' '</span><span class="s2">*(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">indent</span><span class="s2">*</span><span class="s5">2</span><span class="s2">) + </span><span class="s1">line</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s1">line</span>

    <span class="s4">def </span><span class="s1">appendLine</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">line</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">' '</span><span class="s2">*(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">indent</span><span class="s2">*</span><span class="s5">2</span><span class="s2">) + </span><span class="s3">'&lt;&lt; ' </span><span class="s2">+ </span><span class="s1">line </span><span class="s2">+ </span><span class="s3">' &gt;&gt;'</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s1">line</span>

    <span class="s4">def </span><span class="s1">flush</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">outStr </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">indent </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">lines </span><span class="s2">= []</span>
        <span class="s4">return </span><span class="s1">outStr</span>

<span class="s4">class </span><span class="s1">MiniLogSentry</span><span class="s2">:</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">log</span><span class="s2">, </span><span class="s1">funcName</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">log </span><span class="s2">= </span><span class="s1">log</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">log</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">log</span><span class="s2">.</span><span class="s1">enterFunction</span><span class="s2">(</span><span class="s1">funcName</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">__del__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">log</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">log</span><span class="s2">.</span><span class="s1">exitFunction</span><span class="s2">()</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">log</span>

<span class="s4">def </span><span class="s1">logBlock</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s3">'&lt;&lt; LOGBLOCK(%03d)' </span><span class="s2">% </span><span class="s1">id</span><span class="s2">)</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">))</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s3">'/LOGBLOCK(%03d) &gt;&gt;' </span><span class="s2">% </span><span class="s1">id</span><span class="s2">)</span>

<span class="s4">class </span><span class="s1">HierarchyException</span><span class="s2">(</span><span class="s1">Exception</span><span class="s2">):</span>
    <span class="s1">JOSWILSO </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">owner</span><span class="s2">, </span><span class="s1">description</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">owner </span><span class="s2">= </span><span class="s1">owner</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">desc </span><span class="s2">= </span><span class="s1">description</span>

    <span class="s4">def </span><span class="s1">__str__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s3">'(%s): %s' </span><span class="s2">% (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">owner</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">desc</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s3">'HierarchyException(%s)' </span><span class="s2">% (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">owner</span><span class="s2">, )</span>

<span class="s4">def </span><span class="s1">formatTimeCompact</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">):</span>
    <span class="s6"># returns string in format '1d3h22m43s'</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s3">''</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">)</span>
    <span class="s1">seconds </span><span class="s2">= </span><span class="s1">a </span><span class="s2">% </span><span class="s5">60</span>
    <span class="s1">a </span><span class="s2">//= </span><span class="s5">60</span>
    <span class="s4">if </span><span class="s1">a </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s1">minutes </span><span class="s2">= </span><span class="s1">a </span><span class="s2">% </span><span class="s5">60</span>
        <span class="s1">a </span><span class="s2">//= </span><span class="s5">60</span>
        <span class="s4">if </span><span class="s1">a </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">:</span>
            <span class="s1">hours </span><span class="s2">= </span><span class="s1">a </span><span class="s2">% </span><span class="s5">24</span>
            <span class="s1">a </span><span class="s2">//= </span><span class="s5">24</span>
            <span class="s4">if </span><span class="s1">a </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">:</span>
                <span class="s1">days </span><span class="s2">= </span><span class="s1">a</span>
                <span class="s1">result </span><span class="s2">+= </span><span class="s3">'%sd' </span><span class="s2">% </span><span class="s1">days</span>
            <span class="s1">result </span><span class="s2">+= </span><span class="s3">'%sh' </span><span class="s2">% </span><span class="s1">hours</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s3">'%sm' </span><span class="s2">% </span><span class="s1">minutes</span>
    <span class="s1">result </span><span class="s2">+= </span><span class="s3">'%ss' </span><span class="s2">% </span><span class="s1">seconds</span>
    <span class="s4">return </span><span class="s1">result</span>

<span class="s4">if __debug__ and </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s3">'__main__'</span><span class="s2">:</span>
    <span class="s1">ftc </span><span class="s2">= </span><span class="s1">formatTimeCompact</span>
    <span class="s4">assert </span><span class="s1">ftc</span><span class="s2">(</span><span class="s5">0</span><span class="s2">) == </span><span class="s3">'0s'</span>
    <span class="s4">assert </span><span class="s1">ftc</span><span class="s2">(</span><span class="s5">1</span><span class="s2">) == </span><span class="s3">'1s'</span>
    <span class="s4">assert </span><span class="s1">ftc</span><span class="s2">(</span><span class="s5">60</span><span class="s2">) == </span><span class="s3">'1m0s'</span>
    <span class="s4">assert </span><span class="s1">ftc</span><span class="s2">(</span><span class="s5">64</span><span class="s2">) == </span><span class="s3">'1m4s'</span>
    <span class="s4">assert </span><span class="s1">ftc</span><span class="s2">(</span><span class="s5">60</span><span class="s2">*</span><span class="s5">60</span><span class="s2">) == </span><span class="s3">'1h0m0s'</span>
    <span class="s4">assert </span><span class="s1">ftc</span><span class="s2">(</span><span class="s5">24</span><span class="s2">*</span><span class="s5">60</span><span class="s2">*</span><span class="s5">60</span><span class="s2">) == </span><span class="s3">'1d0h0m0s'</span>
    <span class="s4">assert </span><span class="s1">ftc</span><span class="s2">(</span><span class="s5">24</span><span class="s2">*</span><span class="s5">60</span><span class="s2">*</span><span class="s5">60 </span><span class="s2">+ </span><span class="s5">2</span><span class="s2">*</span><span class="s5">60</span><span class="s2">*</span><span class="s5">60 </span><span class="s2">+ </span><span class="s5">34</span><span class="s2">*</span><span class="s5">60 </span><span class="s2">+ </span><span class="s5">12</span><span class="s2">) == </span><span class="s3">'1d2h34m12s'</span>
    <span class="s4">del </span><span class="s1">ftc</span>

<span class="s4">def </span><span class="s1">formatTimeExact</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">):</span>
    <span class="s6"># like formatTimeCompact but leaves off '0 seconds', '0 minutes' etc. for</span>
    <span class="s6"># times that are e.g. 1 hour, 3 days etc.</span>
    <span class="s6"># returns string in format '1d3h22m43s'</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s3">''</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">)</span>
    <span class="s1">seconds </span><span class="s2">= </span><span class="s1">a </span><span class="s2">% </span><span class="s5">60</span>
    <span class="s1">a </span><span class="s2">//= </span><span class="s5">60</span>
    <span class="s4">if </span><span class="s1">a </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s1">minutes </span><span class="s2">= </span><span class="s1">a </span><span class="s2">% </span><span class="s5">60</span>
        <span class="s1">a </span><span class="s2">//= </span><span class="s5">60</span>
        <span class="s4">if </span><span class="s1">a </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">:</span>
            <span class="s1">hours </span><span class="s2">= </span><span class="s1">a </span><span class="s2">% </span><span class="s5">24</span>
            <span class="s1">a </span><span class="s2">//= </span><span class="s5">24</span>
            <span class="s4">if </span><span class="s1">a </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">:</span>
                <span class="s1">days </span><span class="s2">= </span><span class="s1">a</span>
                <span class="s1">result </span><span class="s2">+= </span><span class="s3">'%sd' </span><span class="s2">% </span><span class="s1">days</span>
            <span class="s4">if </span><span class="s1">hours </span><span class="s4">or </span><span class="s1">minutes </span><span class="s4">or </span><span class="s1">seconds</span><span class="s2">:</span>
                <span class="s1">result </span><span class="s2">+= </span><span class="s3">'%sh' </span><span class="s2">% </span><span class="s1">hours</span>
        <span class="s4">if </span><span class="s1">minutes </span><span class="s4">or </span><span class="s1">seconds</span><span class="s2">:</span>
            <span class="s1">result </span><span class="s2">+= </span><span class="s3">'%sm' </span><span class="s2">% </span><span class="s1">minutes</span>
    <span class="s4">if </span><span class="s1">seconds </span><span class="s4">or </span><span class="s1">result </span><span class="s2">== </span><span class="s3">''</span><span class="s2">:</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s3">'%ss' </span><span class="s2">% </span><span class="s1">seconds</span>
    <span class="s4">return </span><span class="s1">result</span>

<span class="s4">if __debug__ and </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s3">'__main__'</span><span class="s2">:</span>
    <span class="s1">fte </span><span class="s2">= </span><span class="s1">formatTimeExact</span>
    <span class="s4">assert </span><span class="s1">fte</span><span class="s2">(</span><span class="s5">0</span><span class="s2">) == </span><span class="s3">'0s'</span>
    <span class="s4">assert </span><span class="s1">fte</span><span class="s2">(</span><span class="s5">1</span><span class="s2">) == </span><span class="s3">'1s'</span>
    <span class="s4">assert </span><span class="s1">fte</span><span class="s2">(</span><span class="s5">2</span><span class="s2">) == </span><span class="s3">'2s'</span>
    <span class="s4">assert </span><span class="s1">fte</span><span class="s2">(</span><span class="s5">61</span><span class="s2">) == </span><span class="s3">'1m1s'</span>
    <span class="s4">assert </span><span class="s1">fte</span><span class="s2">(</span><span class="s5">60</span><span class="s2">) == </span><span class="s3">'1m'</span>
    <span class="s4">assert </span><span class="s1">fte</span><span class="s2">(</span><span class="s5">60</span><span class="s2">*</span><span class="s5">60</span><span class="s2">) == </span><span class="s3">'1h'</span>
    <span class="s4">assert </span><span class="s1">fte</span><span class="s2">(</span><span class="s5">24</span><span class="s2">*</span><span class="s5">60</span><span class="s2">*</span><span class="s5">60</span><span class="s2">) == </span><span class="s3">'1d'</span>
    <span class="s4">assert </span><span class="s1">fte</span><span class="s2">((</span><span class="s5">24</span><span class="s2">*</span><span class="s5">60</span><span class="s2">*</span><span class="s5">60</span><span class="s2">) + (</span><span class="s5">2 </span><span class="s2">* </span><span class="s5">60</span><span class="s2">)) == </span><span class="s3">'1d0h2m'</span>
    <span class="s4">del </span><span class="s1">fte</span>

<span class="s4">class </span><span class="s1">AlphabetCounter</span><span class="s2">:</span>
    <span class="s6"># object that produces 'A', 'B', 'C', ... 'AA', 'AB', etc.</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_curCounter </span><span class="s2">= [</span><span class="s3">'A'</span><span class="s2">]</span>

    <span class="s4">def </span><span class="s1">next</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s3">''</span><span class="s2">.</span><span class="s1">join</span><span class="s2">([</span><span class="s1">c </span><span class="s4">for </span><span class="s1">c </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_curCounter</span><span class="s2">])</span>
        <span class="s1">index </span><span class="s2">= -</span><span class="s5">1</span>
        <span class="s4">while True</span><span class="s2">:</span>
            <span class="s1">curChar </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_curCounter</span><span class="s2">[</span><span class="s1">index</span><span class="s2">]</span>
            <span class="s4">if </span><span class="s1">curChar </span><span class="s2">== </span><span class="s3">'Z'</span><span class="s2">:</span>
                <span class="s1">nextChar </span><span class="s2">= </span><span class="s3">'A'</span>
                <span class="s1">carry </span><span class="s2">= </span><span class="s4">True</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">nextChar </span><span class="s2">= </span><span class="s1">chr</span><span class="s2">(</span><span class="s1">ord</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_curCounter</span><span class="s2">[</span><span class="s1">index</span><span class="s2">])+</span><span class="s5">1</span><span class="s2">)</span>
                <span class="s1">carry </span><span class="s2">= </span><span class="s4">False</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_curCounter</span><span class="s2">[</span><span class="s1">index</span><span class="s2">] = </span><span class="s1">nextChar</span>
            <span class="s4">if </span><span class="s1">carry</span><span class="s2">:</span>
                <span class="s4">if </span><span class="s2">(-</span><span class="s1">index</span><span class="s2">) == </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_curCounter</span><span class="s2">):</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">_curCounter </span><span class="s2">= [</span><span class="s3">'A'</span><span class="s2">,] + </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_curCounter</span>
                    <span class="s4">break</span>
                <span class="s4">else</span><span class="s2">:</span>
                    <span class="s1">index </span><span class="s2">-= </span><span class="s5">1</span>
                <span class="s1">carry </span><span class="s2">= </span><span class="s4">False</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s4">break</span>
        <span class="s4">return </span><span class="s1">result</span>

    <span class="s1">__next__ </span><span class="s2">= </span><span class="s1">next</span>

<span class="s4">if __debug__ and </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s3">'__main__'</span><span class="s2">:</span>
    <span class="s4">def </span><span class="s1">testAlphabetCounter</span><span class="s2">():</span>
        <span class="s1">tempList </span><span class="s2">= []</span>
        <span class="s1">ac </span><span class="s2">= </span><span class="s1">AlphabetCounter</span><span class="s2">()</span>
        <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">xrange</span><span class="s2">(</span><span class="s5">26</span><span class="s2">*</span><span class="s5">3</span><span class="s2">):</span>
            <span class="s1">tempList</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">ac</span><span class="s2">.</span><span class="s1">next</span><span class="s2">())</span>
        <span class="s4">assert </span><span class="s1">tempList </span><span class="s2">== [ </span><span class="s3">'A'</span><span class="s2">, </span><span class="s3">'B'</span><span class="s2">, </span><span class="s3">'C'</span><span class="s2">, </span><span class="s3">'D'</span><span class="s2">, </span><span class="s3">'E'</span><span class="s2">, </span><span class="s3">'F'</span><span class="s2">, </span><span class="s3">'G'</span><span class="s2">, </span><span class="s3">'H'</span><span class="s2">, </span><span class="s3">'I'</span><span class="s2">, </span><span class="s3">'J'</span><span class="s2">, </span><span class="s3">'K'</span><span class="s2">, </span><span class="s3">'L'</span><span class="s2">, </span><span class="s3">'M'</span><span class="s2">, </span><span class="s3">'N'</span><span class="s2">, </span><span class="s3">'O'</span><span class="s2">, </span><span class="s3">'P'</span><span class="s2">, </span><span class="s3">'Q'</span><span class="s2">, </span><span class="s3">'R'</span><span class="s2">, </span><span class="s3">'S'</span><span class="s2">, </span><span class="s3">'T'</span><span class="s2">, </span><span class="s3">'U'</span><span class="s2">, </span><span class="s3">'V'</span><span class="s2">, </span><span class="s3">'W'</span><span class="s2">, </span><span class="s3">'X'</span><span class="s2">, </span><span class="s3">'Y'</span><span class="s2">, </span><span class="s3">'Z'</span><span class="s2">,</span>
                            <span class="s3">'AA'</span><span class="s2">,</span><span class="s3">'AB'</span><span class="s2">,</span><span class="s3">'AC'</span><span class="s2">,</span><span class="s3">'AD'</span><span class="s2">,</span><span class="s3">'AE'</span><span class="s2">,</span><span class="s3">'AF'</span><span class="s2">,</span><span class="s3">'AG'</span><span class="s2">,</span><span class="s3">'AH'</span><span class="s2">,</span><span class="s3">'AI'</span><span class="s2">,</span><span class="s3">'AJ'</span><span class="s2">,</span><span class="s3">'AK'</span><span class="s2">,</span><span class="s3">'AL'</span><span class="s2">,</span><span class="s3">'AM'</span><span class="s2">,</span><span class="s3">'AN'</span><span class="s2">,</span><span class="s3">'AO'</span><span class="s2">,</span><span class="s3">'AP'</span><span class="s2">,</span><span class="s3">'AQ'</span><span class="s2">,</span><span class="s3">'AR'</span><span class="s2">,</span><span class="s3">'AS'</span><span class="s2">,</span><span class="s3">'AT'</span><span class="s2">,</span><span class="s3">'AU'</span><span class="s2">,</span><span class="s3">'AV'</span><span class="s2">,</span><span class="s3">'AW'</span><span class="s2">,</span><span class="s3">'AX'</span><span class="s2">,</span><span class="s3">'AY'</span><span class="s2">,</span><span class="s3">'AZ'</span><span class="s2">,</span>
                            <span class="s3">'BA'</span><span class="s2">,</span><span class="s3">'BB'</span><span class="s2">,</span><span class="s3">'BC'</span><span class="s2">,</span><span class="s3">'BD'</span><span class="s2">,</span><span class="s3">'BE'</span><span class="s2">,</span><span class="s3">'BF'</span><span class="s2">,</span><span class="s3">'BG'</span><span class="s2">,</span><span class="s3">'BH'</span><span class="s2">,</span><span class="s3">'BI'</span><span class="s2">,</span><span class="s3">'BJ'</span><span class="s2">,</span><span class="s3">'BK'</span><span class="s2">,</span><span class="s3">'BL'</span><span class="s2">,</span><span class="s3">'BM'</span><span class="s2">,</span><span class="s3">'BN'</span><span class="s2">,</span><span class="s3">'BO'</span><span class="s2">,</span><span class="s3">'BP'</span><span class="s2">,</span><span class="s3">'BQ'</span><span class="s2">,</span><span class="s3">'BR'</span><span class="s2">,</span><span class="s3">'BS'</span><span class="s2">,</span><span class="s3">'BT'</span><span class="s2">,</span><span class="s3">'BU'</span><span class="s2">,</span><span class="s3">'BV'</span><span class="s2">,</span><span class="s3">'BW'</span><span class="s2">,</span><span class="s3">'BX'</span><span class="s2">,</span><span class="s3">'BY'</span><span class="s2">,</span><span class="s3">'BZ'</span><span class="s2">,]</span>
        <span class="s1">ac </span><span class="s2">= </span><span class="s1">AlphabetCounter</span><span class="s2">()</span>
        <span class="s1">num  </span><span class="s2">= </span><span class="s5">26 </span><span class="s6"># A-Z</span>
        <span class="s1">num </span><span class="s2">+= (</span><span class="s5">26</span><span class="s2">*</span><span class="s5">26</span><span class="s2">) </span><span class="s6"># AA-ZZ</span>
        <span class="s1">num </span><span class="s2">+= </span><span class="s5">26 </span><span class="s6"># AAZ</span>
        <span class="s1">num </span><span class="s2">+= </span><span class="s5">1 </span><span class="s6"># ABA</span>
        <span class="s1">num </span><span class="s2">+= </span><span class="s5">2 </span><span class="s6"># ABC</span>
        <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">xrange</span><span class="s2">(</span><span class="s1">num</span><span class="s2">):</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">ac</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()</span>
        <span class="s4">assert </span><span class="s1">x </span><span class="s2">== </span><span class="s3">'ABC'</span>
    <span class="s1">testAlphabetCounter</span><span class="s2">()</span>
    <span class="s4">del </span><span class="s1">testAlphabetCounter</span>


<span class="s4">class </span><span class="s1">Default</span><span class="s2">:</span>
    <span class="s6"># represents 'use the default value'</span>
    <span class="s6"># useful for keyword arguments to virtual methods</span>
    <span class="s4">pass</span>

<span class="s1">superLogFile </span><span class="s2">= </span><span class="s4">None</span>
<span class="s4">def </span><span class="s1">startSuperLog</span><span class="s2">(</span><span class="s1">customFunction </span><span class="s2">= </span><span class="s4">None</span><span class="s2">):</span>
    <span class="s4">global </span><span class="s1">superLogFile</span>

    <span class="s4">if</span><span class="s2">(</span><span class="s4">not </span><span class="s1">superLogFile</span><span class="s2">):</span>
        <span class="s1">superLogFile </span><span class="s2">= </span><span class="s1">open</span><span class="s2">(</span><span class="s3">&quot;c:</span><span class="s4">\\</span><span class="s3">temp</span><span class="s4">\\</span><span class="s3">superLog.txt&quot;</span><span class="s2">, </span><span class="s3">&quot;w&quot;</span><span class="s2">)</span>
        <span class="s4">def </span><span class="s1">trace_dispatch</span><span class="s2">(</span><span class="s1">a</span><span class="s2">,</span><span class="s1">b</span><span class="s2">,</span><span class="s1">c</span><span class="s2">):</span>
            <span class="s4">if</span><span class="s2">(</span><span class="s1">b</span><span class="s2">==</span><span class="s3">'call' </span><span class="s4">and </span><span class="s1">a</span><span class="s2">.</span><span class="s1">f_code</span><span class="s2">.</span><span class="s1">co_name </span><span class="s2">!= </span><span class="s3">'?' </span><span class="s4">and </span><span class="s1">a</span><span class="s2">.</span><span class="s1">f_code</span><span class="s2">.</span><span class="s1">co_name</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s3">&quot;safeRepr&quot;</span><span class="s2">)&lt;</span><span class="s5">0</span><span class="s2">):</span>
                <span class="s1">vars </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">f_locals</span><span class="s2">)</span>
                <span class="s4">if </span><span class="s3">'self' </span><span class="s4">in </span><span class="s1">vars</span><span class="s2">:</span>
                    <span class="s4">del </span><span class="s1">vars</span><span class="s2">[</span><span class="s3">'self'</span><span class="s2">]</span>
                <span class="s4">if </span><span class="s3">'__builtins__' </span><span class="s4">in </span><span class="s1">vars</span><span class="s2">:</span>
                    <span class="s4">del </span><span class="s1">vars</span><span class="s2">[</span><span class="s3">'__builtins__'</span><span class="s2">]</span>
                <span class="s4">for </span><span class="s1">i </span><span class="s4">in </span><span class="s1">vars</span><span class="s2">:</span>
                    <span class="s1">vars</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">safeReprTypeOnFail</span><span class="s2">(</span><span class="s1">vars</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])</span>

                <span class="s4">if </span><span class="s1">customFunction</span><span class="s2">:</span>
                    <span class="s1">superLogFile</span><span class="s2">.</span><span class="s1">write</span><span class="s2">( </span><span class="s3">&quot;before = %s</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s2">%</span><span class="s1">customFunction</span><span class="s2">())</span>

                <span class="s1">superLogFile</span><span class="s2">.</span><span class="s1">write</span><span class="s2">( </span><span class="s3">&quot;%s(%s):%s:%s</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s2">%(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">f_code</span><span class="s2">.</span><span class="s1">co_filename</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s4">\\</span><span class="s3">&quot;</span><span class="s2">)[-</span><span class="s5">1</span><span class="s2">],</span><span class="s1">a</span><span class="s2">.</span><span class="s1">f_code</span><span class="s2">.</span><span class="s1">co_firstlineno</span><span class="s2">, </span><span class="s1">a</span><span class="s2">.</span><span class="s1">f_code</span><span class="s2">.</span><span class="s1">co_name</span><span class="s2">, </span><span class="s1">vars</span><span class="s2">))</span>

                <span class="s4">if </span><span class="s1">customFunction</span><span class="s2">:</span>
                    <span class="s1">superLogFile</span><span class="s2">.</span><span class="s1">write</span><span class="s2">( </span><span class="s3">&quot;after = %s</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s2">%</span><span class="s1">customFunction</span><span class="s2">())</span>



                <span class="s4">return </span><span class="s1">trace_dispatch</span>
        <span class="s1">sys</span><span class="s2">.</span><span class="s1">settrace</span><span class="s2">(</span><span class="s1">trace_dispatch</span><span class="s2">)</span>

<span class="s4">def </span><span class="s1">endSuperLog</span><span class="s2">():</span>
    <span class="s4">global </span><span class="s1">superLogFile</span>
    <span class="s4">if</span><span class="s2">(</span><span class="s1">superLogFile</span><span class="s2">):</span>
        <span class="s1">sys</span><span class="s2">.</span><span class="s1">settrace</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
        <span class="s1">superLogFile</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>
        <span class="s1">superLogFile </span><span class="s2">= </span><span class="s4">None</span>

<span class="s4">def </span><span class="s1">configIsToday</span><span class="s2">(</span><span class="s1">configName</span><span class="s2">):</span>
    <span class="s6"># TODO: replace usage of strptime with something else</span>
    <span class="s6"># returns true if config string is a valid representation of today's date</span>
    <span class="s1">today </span><span class="s2">= </span><span class="s1">time</span><span class="s2">.</span><span class="s1">localtime</span><span class="s2">()</span>
    <span class="s1">confStr </span><span class="s2">= </span><span class="s1">config</span><span class="s2">.</span><span class="s1">GetString</span><span class="s2">(</span><span class="s1">configName</span><span class="s2">, </span><span class="s3">''</span><span class="s2">)</span>
    <span class="s4">for </span><span class="s1">format </span><span class="s4">in </span><span class="s2">(</span><span class="s3">'%m/%d/%Y'</span><span class="s2">, </span><span class="s3">'%m-%d-%Y'</span><span class="s2">, </span><span class="s3">'%m.%d.%Y'</span><span class="s2">):</span>
        <span class="s4">try</span><span class="s2">:</span>
            <span class="s1">confDate </span><span class="s2">= </span><span class="s1">time</span><span class="s2">.</span><span class="s1">strptime</span><span class="s2">(</span><span class="s1">confStr</span><span class="s2">, </span><span class="s1">format</span><span class="s2">)</span>
        <span class="s4">except </span><span class="s1">ValueError</span><span class="s2">:</span>
            <span class="s4">pass</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s2">(</span><span class="s1">confDate</span><span class="s2">.</span><span class="s1">tm_year </span><span class="s2">== </span><span class="s1">today</span><span class="s2">.</span><span class="s1">tm_year </span><span class="s4">and</span>
                <span class="s1">confDate</span><span class="s2">.</span><span class="s1">tm_mon </span><span class="s2">== </span><span class="s1">today</span><span class="s2">.</span><span class="s1">tm_mon </span><span class="s4">and</span>
                <span class="s1">confDate</span><span class="s2">.</span><span class="s1">tm_mday </span><span class="s2">== </span><span class="s1">today</span><span class="s2">.</span><span class="s1">tm_mday</span><span class="s2">):</span>
                <span class="s4">return True</span>
    <span class="s4">return False</span>

<span class="s4">def </span><span class="s1">typeName</span><span class="s2">(</span><span class="s1">o</span><span class="s2">):</span>
    <span class="s4">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">o</span><span class="s2">, </span><span class="s3">'__class__'</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">o</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">o</span><span class="s2">.</span><span class="s1">__name__</span>

<span class="s4">def </span><span class="s1">safeTypeName</span><span class="s2">(</span><span class="s1">o</span><span class="s2">):</span>
    <span class="s4">try</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">typeName</span><span class="s2">(</span><span class="s1">o</span><span class="s2">)</span>
    <span class="s4">except</span><span class="s2">:</span>
        <span class="s4">pass</span>
    <span class="s4">try</span><span class="s2">:</span>
        <span class="s4">return </span><span class="s1">type</span><span class="s2">(</span><span class="s1">o</span><span class="s2">)</span>
    <span class="s4">except</span><span class="s2">:</span>
        <span class="s4">pass</span>
    <span class="s4">return </span><span class="s3">'&lt;failed safeTypeName()&gt;'</span>

<span class="s4">def </span><span class="s1">histogramDict</span><span class="s2">(</span><span class="s1">l</span><span class="s2">):</span>
    <span class="s1">d </span><span class="s2">= {}</span>
    <span class="s4">for </span><span class="s1">e </span><span class="s4">in </span><span class="s1">l</span><span class="s2">:</span>
        <span class="s1">d</span><span class="s2">.</span><span class="s1">setdefault</span><span class="s2">(</span><span class="s1">e</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">d</span><span class="s2">[</span><span class="s1">e</span><span class="s2">] += </span><span class="s5">1</span>
    <span class="s4">return </span><span class="s1">d</span>

<span class="s4">def </span><span class="s1">unescapeHtmlString</span><span class="s2">(</span><span class="s1">s</span><span class="s2">):</span>
    <span class="s6"># converts %## to corresponding character</span>
    <span class="s6"># replaces '+' with ' '</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s3">''</span>
    <span class="s1">i </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s4">while </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">(</span><span class="s1">s</span><span class="s2">):</span>
        <span class="s1">char </span><span class="s2">= </span><span class="s1">s</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
        <span class="s4">if </span><span class="s1">char </span><span class="s2">== </span><span class="s3">'+'</span><span class="s2">:</span>
            <span class="s1">char </span><span class="s2">= </span><span class="s3">' '</span>
        <span class="s4">elif </span><span class="s1">char </span><span class="s2">== </span><span class="s3">'%'</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">i </span><span class="s2">&lt; (</span><span class="s1">len</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)-</span><span class="s5">2</span><span class="s2">):</span>
                <span class="s1">num </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s1">s</span><span class="s2">[</span><span class="s1">i</span><span class="s2">+</span><span class="s5">1</span><span class="s2">:</span><span class="s1">i</span><span class="s2">+</span><span class="s5">3</span><span class="s2">], </span><span class="s5">16</span><span class="s2">)</span>
                <span class="s1">char </span><span class="s2">= </span><span class="s1">chr</span><span class="s2">(</span><span class="s1">num</span><span class="s2">)</span>
                <span class="s1">i </span><span class="s2">+= </span><span class="s5">2</span>
        <span class="s1">i </span><span class="s2">+= </span><span class="s5">1</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s1">char</span>
    <span class="s4">return </span><span class="s1">result</span>

<span class="s4">class </span><span class="s1">PriorityCallbacks</span><span class="s2">:</span>
    <span class="s0">&quot;&quot;&quot; manage a set of prioritized callbacks, and allow them to be invoked in order of priority &quot;&quot;&quot;</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_callbacks </span><span class="s2">= []</span>

    <span class="s4">def </span><span class="s1">clear</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_callbacks</span><span class="s2">[:]</span>

    <span class="s4">def </span><span class="s1">add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">, </span><span class="s1">priority</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">priority </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">priority </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s1">callbacks </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_callbacks</span>
        <span class="s1">lo </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s1">hi </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">callbacks</span><span class="s2">)</span>
        <span class="s4">while </span><span class="s1">lo </span><span class="s2">&lt; </span><span class="s1">hi</span><span class="s2">:</span>
            <span class="s1">mid </span><span class="s2">= (</span><span class="s1">lo </span><span class="s2">+ </span><span class="s1">hi</span><span class="s2">) // </span><span class="s5">2</span>
            <span class="s4">if </span><span class="s1">priority </span><span class="s2">&lt; </span><span class="s1">callbacks</span><span class="s2">[</span><span class="s1">mid</span><span class="s2">][</span><span class="s5">0</span><span class="s2">]:</span>
                <span class="s1">hi </span><span class="s2">= </span><span class="s1">mid</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">lo </span><span class="s2">= </span><span class="s1">mid </span><span class="s2">+ </span><span class="s5">1</span>
        <span class="s1">item </span><span class="s2">= (</span><span class="s1">priority</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">)</span>
        <span class="s1">callbacks</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s1">lo</span><span class="s2">, </span><span class="s1">item</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s1">item</span>

    <span class="s4">def </span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">item</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_callbacks</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">__call__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">for </span><span class="s1">priority</span><span class="s2">, </span><span class="s1">callback </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_callbacks</span><span class="s2">:</span>
            <span class="s1">callback</span><span class="s2">()</span>

<span class="s1">builtins</span><span class="s2">.</span><span class="s1">Functor </span><span class="s2">= </span><span class="s1">Functor</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">Stack </span><span class="s2">= </span><span class="s1">Stack</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">Queue </span><span class="s2">= </span><span class="s1">Queue</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">Enum </span><span class="s2">= </span><span class="s1">Enum</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">SerialNumGen </span><span class="s2">= </span><span class="s1">SerialNumGen</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">SerialMaskedGen </span><span class="s2">= </span><span class="s1">SerialMaskedGen</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">ScratchPad </span><span class="s2">= </span><span class="s1">ScratchPad</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">uniqueName </span><span class="s2">= </span><span class="s1">uniqueName</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">serialNum </span><span class="s2">= </span><span class="s1">serialNum</span>
<span class="s4">if __debug__</span><span class="s2">:</span>
    <span class="s1">builtins</span><span class="s2">.</span><span class="s1">profiled </span><span class="s2">= </span><span class="s1">profiled</span>
    <span class="s1">builtins</span><span class="s2">.</span><span class="s1">exceptionLogged </span><span class="s2">= </span><span class="s1">exceptionLogged</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">itype </span><span class="s2">= </span><span class="s1">itype</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">appendStr </span><span class="s2">= </span><span class="s1">appendStr</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">bound </span><span class="s2">= </span><span class="s1">bound</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">clamp </span><span class="s2">= </span><span class="s1">clamp</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">lerp </span><span class="s2">= </span><span class="s1">lerp</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">makeList </span><span class="s2">= </span><span class="s1">makeList</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">makeTuple </span><span class="s2">= </span><span class="s1">makeTuple</span>
<span class="s4">if __debug__</span><span class="s2">:</span>
    <span class="s1">builtins</span><span class="s2">.</span><span class="s1">printStack </span><span class="s2">= </span><span class="s1">printStack</span>
    <span class="s1">builtins</span><span class="s2">.</span><span class="s1">printReverseStack </span><span class="s2">= </span><span class="s1">printReverseStack</span>
    <span class="s1">builtins</span><span class="s2">.</span><span class="s1">printVerboseStack </span><span class="s2">= </span><span class="s1">printVerboseStack</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">DelayedCall </span><span class="s2">= </span><span class="s1">DelayedCall</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">DelayedFunctor </span><span class="s2">= </span><span class="s1">DelayedFunctor</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">FrameDelayedCall </span><span class="s2">= </span><span class="s1">FrameDelayedCall</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">SubframeCall </span><span class="s2">= </span><span class="s1">SubframeCall</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">invertDict </span><span class="s2">= </span><span class="s1">invertDict</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">invertDictLossless </span><span class="s2">= </span><span class="s1">invertDictLossless</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">getBase </span><span class="s2">= </span><span class="s1">getBase</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">getRepository </span><span class="s2">= </span><span class="s1">getRepository</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">safeRepr </span><span class="s2">= </span><span class="s1">safeRepr</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">fastRepr </span><span class="s2">= </span><span class="s1">fastRepr</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">nullGen </span><span class="s2">= </span><span class="s1">nullGen</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">flywheel </span><span class="s2">= </span><span class="s1">flywheel</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">loopGen </span><span class="s2">= </span><span class="s1">loopGen</span>
<span class="s4">if __debug__</span><span class="s2">:</span>
    <span class="s1">builtins</span><span class="s2">.</span><span class="s1">StackTrace </span><span class="s2">= </span><span class="s1">StackTrace</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">report </span><span class="s2">= </span><span class="s1">report</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">pstatcollect </span><span class="s2">= </span><span class="s1">pstatcollect</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">MiniLog </span><span class="s2">= </span><span class="s1">MiniLog</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">MiniLogSentry </span><span class="s2">= </span><span class="s1">MiniLogSentry</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">logBlock </span><span class="s2">= </span><span class="s1">logBlock</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">HierarchyException </span><span class="s2">= </span><span class="s1">HierarchyException</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">deeptype </span><span class="s2">= </span><span class="s1">deeptype</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">Default </span><span class="s2">= </span><span class="s1">Default</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">configIsToday </span><span class="s2">= </span><span class="s1">configIsToday</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">typeName </span><span class="s2">= </span><span class="s1">typeName</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">safeTypeName </span><span class="s2">= </span><span class="s1">safeTypeName</span>
<span class="s1">builtins</span><span class="s2">.</span><span class="s1">histogramDict </span><span class="s2">= </span><span class="s1">histogramDict</span>
</pre>
</body>
</html>
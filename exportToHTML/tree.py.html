<html>
<head>
<title>Tree.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #7a7e85;}
.s5 { color: #cf8e6d;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Tree.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Defines tree widgets for the tkinter GUI system.&quot;&quot;&quot;</span>

<span class="s1">__all__ </span><span class="s2">= [</span><span class="s3">'TreeNode'</span><span class="s2">, </span><span class="s3">'TreeItem'</span><span class="s2">]</span>

<span class="s4"># ADAPTED FROM IDLE TreeWidget.py</span>
<span class="s4"># XXX TO DO:</span>
<span class="s4"># - popup menu</span>
<span class="s4"># - support partial or total redisplay</span>
<span class="s4"># - key bindings (instead of quick-n-dirty bindings on Canvas):</span>
<span class="s4">#   - up/down arrow keys to move focus around</span>
<span class="s4">#   - ditto for page up/down, home/end</span>
<span class="s4">#   - left/right arrows to expand/collapse and move out/in</span>
<span class="s4"># - more doc strings</span>
<span class="s4"># - add icons for &quot;file&quot;, &quot;module&quot;, &quot;class&quot;, &quot;method&quot;; better &quot;python&quot; icon</span>
<span class="s4"># - callback for selection???</span>
<span class="s4"># - multiple-item selection</span>
<span class="s4"># - tooltips</span>
<span class="s4"># - redo geometry without magic numbers</span>
<span class="s4"># - keep track of object ids to allow more careful cleaning</span>
<span class="s4"># - optimize tree redraw after expand of subnode</span>

<span class="s5">import </span><span class="s1">os</span>
<span class="s5">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">showbase</span><span class="s2">.</span><span class="s1">TkGlobal </span><span class="s5">import </span><span class="s2">*</span>
<span class="s5">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s5">import </span><span class="s2">*</span>

<span class="s4"># Initialize icon directory</span>
<span class="s1">ICONDIR </span><span class="s2">= </span><span class="s1">ConfigVariableSearchPath</span><span class="s2">(</span><span class="s3">'model-path'</span><span class="s2">).</span><span class="s1">findFile</span><span class="s2">(</span><span class="s1">Filename</span><span class="s2">(</span><span class="s3">'icons'</span><span class="s2">)).</span><span class="s1">toOsSpecific</span><span class="s2">()</span>
<span class="s5">if not </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">isdir</span><span class="s2">(</span><span class="s1">ICONDIR</span><span class="s2">):</span>
    <span class="s5">raise </span><span class="s1">RuntimeError</span><span class="s2">(</span><span class="s3">&quot;can't find DIRECT icon directory (%s)&quot; </span><span class="s2">% </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">ICONDIR</span><span class="s2">))</span>

<span class="s5">class </span><span class="s1">TreeNode</span><span class="s2">:</span>

    <span class="s5">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">canvas</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">, </span><span class="s1">item</span><span class="s2">, </span><span class="s1">menuList </span><span class="s2">= []):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas </span><span class="s2">= </span><span class="s1">canvas</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">parent </span><span class="s2">= </span><span class="s1">parent</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">item </span><span class="s2">= </span><span class="s1">item</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'collapsed'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">= </span><span class="s6">0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">children </span><span class="s2">= {}</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">kidKeys </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">x </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y </span><span class="s2">= </span><span class="s5">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">iconimages </span><span class="s2">= {} </span><span class="s4"># cache of PhotoImage instances for icons</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">menuList </span><span class="s2">= </span><span class="s1">menuList</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuList</span><span class="s2">:</span>
            <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuList</span><span class="s2">[-</span><span class="s6">1</span><span class="s2">] == </span><span class="s3">'Separator'</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">menuList </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuList</span><span class="s2">[:-</span><span class="s6">1</span><span class="s2">]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">menuVar </span><span class="s2">= </span><span class="s1">IntVar</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">menuVar</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_popupMenu </span><span class="s2">= </span><span class="s5">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fSortChildren </span><span class="s2">= </span><span class="s5">False </span><span class="s4"># [gjeon] flag for sorting children or not</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fModeChildrenTag </span><span class="s2">= </span><span class="s6">0 </span><span class="s4"># [gjeon] flag for using filter or not</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">childrenTag </span><span class="s2">= </span><span class="s5">None </span><span class="s4"># [gjeon] filter dictionary for</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setAsTarget </span><span class="s2">= </span><span class="s6">0 </span><span class="s4"># [gjeon] to visualize reparent target</span>

    <span class="s4"># [gjeon] to set fSortChildren</span>
    <span class="s5">def </span><span class="s1">setFSortChildren</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fSortChildren</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fSortChildren </span><span class="s2">= </span><span class="s1">fSortChildren</span>

    <span class="s5">def </span><span class="s1">setChildrenTag</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">tag</span><span class="s2">, </span><span class="s1">fModeChildrenTag</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">childrenTag </span><span class="s2">= </span><span class="s1">tag</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fModeChildrenTag </span><span class="s2">= </span><span class="s1">fModeChildrenTag</span>

    <span class="s5">def </span><span class="s1">destroy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_popupMenu</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_popupMenu</span><span class="s2">.</span><span class="s1">destroy</span><span class="s2">()</span>
        <span class="s5">for </span><span class="s1">key </span><span class="s5">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">kidKeys</span><span class="s2">:</span>
            <span class="s1">c </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
            <span class="s5">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
            <span class="s1">c</span><span class="s2">.</span><span class="s1">destroy</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">parent </span><span class="s2">= </span><span class="s5">None</span>

    <span class="s5">def </span><span class="s1">geticonimage</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s5">try</span><span class="s2">:</span>
            <span class="s5">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">iconimages</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]</span>
        <span class="s5">except </span><span class="s1">KeyError</span><span class="s2">:</span>
            <span class="s5">pass</span>
        <span class="s1">file</span><span class="s2">, </span><span class="s1">ext </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">splitext</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)</span>
        <span class="s1">ext </span><span class="s2">= </span><span class="s1">ext </span><span class="s5">or </span><span class="s3">&quot;.gif&quot;</span>
        <span class="s1">fullname </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">ICONDIR</span><span class="s2">, </span><span class="s1">file </span><span class="s2">+ </span><span class="s1">ext</span><span class="s2">)</span>
        <span class="s1">image </span><span class="s2">= </span><span class="s1">PhotoImage</span><span class="s2">(</span><span class="s1">master</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">, </span><span class="s1">file</span><span class="s2">=</span><span class="s1">fullname</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">iconimages</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">image</span>
        <span class="s5">return </span><span class="s1">image</span>

    <span class="s5">def </span><span class="s1">select</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">=</span><span class="s5">None</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">:</span>
            <span class="s5">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">deselectall</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">= </span><span class="s6">1</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">delete</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">image_id</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">drawicon</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">drawtext</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">OnSelect</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">deselect</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">=</span><span class="s5">None</span><span class="s2">):</span>
        <span class="s5">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">:</span>
            <span class="s5">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">= </span><span class="s6">0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">delete</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">image_id</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">drawicon</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">drawtext</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">deselectall</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">.</span><span class="s1">deselectall</span><span class="s2">()</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">deselecttree</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">deselecttree</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">deselect</span><span class="s2">()</span>
        <span class="s5">for </span><span class="s1">key </span><span class="s5">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">kidKeys</span><span class="s2">:</span>
            <span class="s1">child </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
            <span class="s1">child</span><span class="s2">.</span><span class="s1">deselecttree</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">flip</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">=</span><span class="s5">None</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">== </span><span class="s3">'expanded'</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">collapse</span><span class="s2">()</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">expand</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">OnDoubleClick</span><span class="s2">()</span>
        <span class="s5">return </span><span class="s3">&quot;break&quot;</span>

    <span class="s5">def </span><span class="s1">createPopupMenu</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuList</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_popupMenu </span><span class="s2">= </span><span class="s1">Menu</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">, </span><span class="s1">tearoff </span><span class="s2">= </span><span class="s6">0</span><span class="s2">)</span>
            <span class="s5">for </span><span class="s1">i </span><span class="s5">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuList</span><span class="s2">)):</span>
                <span class="s1">item </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuList</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
                <span class="s5">if </span><span class="s1">item </span><span class="s2">== </span><span class="s3">'Separator'</span><span class="s2">:</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">_popupMenu</span><span class="s2">.</span><span class="s1">add_separator</span><span class="s2">()</span>
                <span class="s5">else</span><span class="s2">:</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">_popupMenu</span><span class="s2">.</span><span class="s1">add_radiobutton</span><span class="s2">(</span>
                        <span class="s1">label </span><span class="s2">= </span><span class="s1">item</span><span class="s2">,</span>
                        <span class="s1">variable </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuVar</span><span class="s2">,</span>
                        <span class="s1">value </span><span class="s2">= </span><span class="s1">i</span><span class="s2">,</span>
                        <span class="s1">indicatoron </span><span class="s2">= </span><span class="s6">0</span><span class="s2">,</span>
                        <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">popupMenuCommand</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">popupMenu</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">=</span><span class="s5">None</span><span class="s2">):</span>
        <span class="s5">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_popupMenu</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">createPopupMenu</span><span class="s2">()</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_popupMenu</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_popupMenu</span><span class="s2">.</span><span class="s1">post</span><span class="s2">(</span><span class="s1">event</span><span class="s2">.</span><span class="s1">widget</span><span class="s2">.</span><span class="s1">winfo_pointerx</span><span class="s2">(),</span>
                                 <span class="s1">event</span><span class="s2">.</span><span class="s1">widget</span><span class="s2">.</span><span class="s1">winfo_pointery</span><span class="s2">())</span>
            <span class="s5">return </span><span class="s3">&quot;break&quot;</span>

    <span class="s5">def </span><span class="s1">popupMenuCommand</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuList</span><span class="s2">[</span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuVar</span><span class="s2">.</span><span class="s1">get</span><span class="s2">()]</span>

        <span class="s5">if </span><span class="s2">(</span><span class="s1">command </span><span class="s2">== </span><span class="s3">'Expand All'</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">updateAll</span><span class="s2">(</span><span class="s6">1</span><span class="s2">)</span>
        <span class="s5">elif </span><span class="s2">(</span><span class="s1">command </span><span class="s2">== </span><span class="s3">'Collapse All'</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">updateAll</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">skipUpdate </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">MenuCommand</span><span class="s2">(</span><span class="s1">command</span><span class="s2">)</span>
            <span class="s5">if not </span><span class="s1">skipUpdate </span><span class="s5">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parent </span><span class="s5">and </span><span class="s2">(</span><span class="s1">command </span><span class="s2">!= </span><span class="s3">'Update Explorer'</span><span class="s2">):</span>
                <span class="s4"># Update parent to try to keep explorer up to date</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">.</span><span class="s1">update</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">expand</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">=</span><span class="s5">None</span><span class="s2">):</span>
        <span class="s5">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">IsExpandable</span><span class="s2">():</span>
            <span class="s5">return</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">!= </span><span class="s3">'expanded'</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'expanded'</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">update</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">view</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">collapse</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">=</span><span class="s5">None</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">!= </span><span class="s3">'collapsed'</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'collapsed'</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">update</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">view</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">top </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y </span><span class="s2">- </span><span class="s6">2</span>
        <span class="s1">bottom </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">lastvisiblechild</span><span class="s2">().</span><span class="s1">y </span><span class="s2">+ </span><span class="s6">17</span>
        <span class="s1">height </span><span class="s2">= </span><span class="s1">bottom </span><span class="s2">- </span><span class="s1">top</span>
        <span class="s1">visible_top </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">canvasy</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">visible_height </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">winfo_height</span><span class="s2">()</span>
        <span class="s1">visible_bottom </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">canvasy</span><span class="s2">(</span><span class="s1">visible_height</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">visible_top </span><span class="s2">&lt;= </span><span class="s1">top </span><span class="s5">and </span><span class="s1">bottom </span><span class="s2">&lt;= </span><span class="s1">visible_bottom</span><span class="s2">:</span>
            <span class="s5">return</span>
        <span class="s1">x0</span><span class="s2">, </span><span class="s1">y0</span><span class="s2">, </span><span class="s1">x1</span><span class="s2">, </span><span class="s1">y1 </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">_getints</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">[</span><span class="s3">'scrollregion'</span><span class="s2">])</span>
        <span class="s5">if </span><span class="s1">top </span><span class="s2">&gt;= </span><span class="s1">visible_top </span><span class="s5">and </span><span class="s1">height </span><span class="s2">&lt;= </span><span class="s1">visible_height</span><span class="s2">:</span>
            <span class="s1">fraction </span><span class="s2">= </span><span class="s1">top </span><span class="s2">+ </span><span class="s1">height </span><span class="s2">- </span><span class="s1">visible_height</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">fraction </span><span class="s2">= </span><span class="s1">top</span>
        <span class="s1">fraction </span><span class="s2">= </span><span class="s1">float</span><span class="s2">(</span><span class="s1">fraction</span><span class="s2">) / </span><span class="s1">y1</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">yview_moveto</span><span class="s2">(</span><span class="s1">fraction</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">reveal</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Make sure all parent nodes are marked as expanded</span>
        <span class="s1">parent </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parent</span>
        <span class="s5">while </span><span class="s1">parent</span><span class="s2">:</span>
            <span class="s5">if </span><span class="s1">parent</span><span class="s2">.</span><span class="s1">state </span><span class="s2">== </span><span class="s3">'collapsed'</span><span class="s2">:</span>
                <span class="s1">parent</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'expanded'</span>
                <span class="s1">parent </span><span class="s2">= </span><span class="s1">parent</span><span class="s2">.</span><span class="s1">parent</span>
            <span class="s5">else</span><span class="s2">:</span>
                <span class="s5">break</span>
        <span class="s4"># Redraw tree accordingly</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">update</span><span class="s2">()</span>
        <span class="s4"># Bring this item into view</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">view</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">lastvisiblechild</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">kidKeys </span><span class="s5">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">== </span><span class="s3">'expanded'</span><span class="s2">:</span>
            <span class="s5">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">self</span><span class="s2">.</span><span class="s1">kidKeys</span><span class="s2">[-</span><span class="s6">1</span><span class="s2">]].</span><span class="s1">lastvisiblechild</span><span class="s2">()</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s5">return </span><span class="s1">self</span>

    <span class="s4"># [gjeon] function to expand or collapse all the tree nodes</span>
    <span class="s5">def </span><span class="s1">updateAll</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fMode</span><span class="s2">, </span><span class="s1">depth </span><span class="s2">= </span><span class="s6">0</span><span class="s2">, </span><span class="s1">fUseCachedChildren </span><span class="s2">= </span><span class="s6">1</span><span class="s2">):</span>
        <span class="s1">depth </span><span class="s2">= </span><span class="s1">depth </span><span class="s2">+ </span><span class="s6">1</span>
        <span class="s5">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">IsExpandable</span><span class="s2">():</span>
            <span class="s5">return</span>
        <span class="s5">if </span><span class="s1">fMode</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'expanded'</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s5">if </span><span class="s1">depth </span><span class="s2">&gt; </span><span class="s6">1</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'collapsed'</span>

        <span class="s1">sublist </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">_GetSubList</span><span class="s2">()</span>
        <span class="s5">if not </span><span class="s1">sublist</span><span class="s2">:</span>
            <span class="s5">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">kidKeys </span><span class="s2">= []</span>
        <span class="s5">for </span><span class="s1">item </span><span class="s5">in </span><span class="s1">sublist</span><span class="s2">:</span>
            <span class="s1">key </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">GetKey</span><span class="s2">()</span>
            <span class="s5">if </span><span class="s1">fUseCachedChildren </span><span class="s5">and </span><span class="s1">key </span><span class="s5">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">:</span>
                <span class="s1">child </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
            <span class="s5">else</span><span class="s2">:</span>
                <span class="s1">child </span><span class="s2">= </span><span class="s1">TreeNode</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">, </span><span class="s1">self</span><span class="s2">, </span><span class="s1">item</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuList</span><span class="s2">)</span>

            <span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">child</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">kidKeys</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">key</span><span class="s2">)</span>

        <span class="s4"># Remove unused children</span>
        <span class="s5">for </span><span class="s1">key </span><span class="s5">in </span><span class="s1">list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">()):</span>
            <span class="s5">if </span><span class="s1">key </span><span class="s5">not in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">kidKeys</span><span class="s2">:</span>
                <span class="s5">del</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">key</span><span class="s2">])</span>

        <span class="s5">for </span><span class="s1">key </span><span class="s5">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">kidKeys</span><span class="s2">:</span>
            <span class="s1">child </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
            <span class="s1">child</span><span class="s2">.</span><span class="s1">updateAll</span><span class="s2">(</span><span class="s1">fMode</span><span class="s2">, </span><span class="s1">depth</span><span class="s2">=</span><span class="s1">depth</span><span class="s2">)</span>

        <span class="s4"># [gjeon] to update the tree one time only</span>
        <span class="s5">if </span><span class="s1">depth </span><span class="s2">== </span><span class="s6">1</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">update</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">view</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">update</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fUseCachedChildren </span><span class="s2">= </span><span class="s6">1</span><span class="s2">, </span><span class="s1">fExpandMode </span><span class="s2">= </span><span class="s6">0</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">fUseCachedChildren</span><span class="s2">, </span><span class="s1">fExpandMode </span><span class="s2">= </span><span class="s1">fExpandMode</span><span class="s2">)</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">oldcursor </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">[</span><span class="s3">'cursor'</span><span class="s2">]</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">[</span><span class="s3">'cursor'</span><span class="s2">] = </span><span class="s3">&quot;watch&quot;</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">update</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">delete</span><span class="s2">(</span><span class="s1">ALL</span><span class="s2">)     </span><span class="s4"># XXX could be more subtle</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">(</span><span class="s6">7</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s1">fUseCachedChildren</span><span class="s2">)</span>
            <span class="s1">x0</span><span class="s2">, </span><span class="s1">y0</span><span class="s2">, </span><span class="s1">x1</span><span class="s2">, </span><span class="s1">y1 </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">bbox</span><span class="s2">(</span><span class="s1">ALL</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">scrollregion</span><span class="s2">=(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s1">x1</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">[</span><span class="s3">'cursor'</span><span class="s2">] = </span><span class="s1">oldcursor</span>

    <span class="s5">def </span><span class="s1">draw</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">fUseCachedChildren </span><span class="s2">= </span><span class="s6">1</span><span class="s2">):</span>
        <span class="s4"># XXX This hard-codes too many geometry constants!</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">x</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y </span><span class="s2">= </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">drawicon</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">drawtext</span><span class="s2">()</span>

        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">!= </span><span class="s3">'expanded'</span><span class="s2">:</span>
            <span class="s5">return </span><span class="s1">y</span><span class="s2">+</span><span class="s6">17</span>
        <span class="s4"># draw children</span>
        <span class="s1">sublist </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">_GetSubList</span><span class="s2">()</span>
        <span class="s5">if not </span><span class="s1">sublist</span><span class="s2">:</span>
            <span class="s4"># IsExpandable() was mistaken; that's allowed</span>
            <span class="s5">return </span><span class="s1">y</span><span class="s2">+</span><span class="s6">17</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">kidKeys </span><span class="s2">= []</span>

        <span class="s4"># [gjeon] to sort children</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fSortChildren</span><span class="s2">:</span>
            <span class="s5">def </span><span class="s1">compareText</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
                <span class="s1">textX </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">GetText</span><span class="s2">()</span>
                <span class="s1">textY </span><span class="s2">= </span><span class="s1">y</span><span class="s2">.</span><span class="s1">GetText</span><span class="s2">()</span>
                <span class="s5">if </span><span class="s2">(</span><span class="s1">textX </span><span class="s2">&gt; </span><span class="s1">textY</span><span class="s2">):</span>
                    <span class="s5">return </span><span class="s6">1</span>
                <span class="s5">elif </span><span class="s2">(</span><span class="s1">textX </span><span class="s2">== </span><span class="s1">textY</span><span class="s2">):</span>
                    <span class="s5">return </span><span class="s6">0</span>
                <span class="s5">else</span><span class="s2">: </span><span class="s4"># textX &lt; textY</span>
                    <span class="s5">return </span><span class="s2">-</span><span class="s6">1</span>
            <span class="s1">sublist</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">compareText</span><span class="s2">)</span>
        <span class="s5">for </span><span class="s1">item </span><span class="s5">in </span><span class="s1">sublist</span><span class="s2">:</span>
            <span class="s1">key </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">GetKey</span><span class="s2">()</span>
            <span class="s5">if </span><span class="s1">fUseCachedChildren </span><span class="s5">and </span><span class="s1">key </span><span class="s5">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">:</span>
                <span class="s1">child </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
            <span class="s5">else</span><span class="s2">:</span>
                <span class="s1">child </span><span class="s2">= </span><span class="s1">TreeNode</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">, </span><span class="s1">self</span><span class="s2">, </span><span class="s1">item</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuList</span><span class="s2">)</span>

            <span class="s4"># [gjeon] to set flag recursively</span>
            <span class="s1">child</span><span class="s2">.</span><span class="s1">setFSortChildren</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">fSortChildren</span><span class="s2">)</span>
            <span class="s1">child</span><span class="s2">.</span><span class="s1">setChildrenTag</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">childrenTag</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fModeChildrenTag</span><span class="s2">)</span>

            <span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">child</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">kidKeys</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">key</span><span class="s2">)</span>

            <span class="s4"># [gjeon] to filter by given tag</span>
            <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fModeChildrenTag</span><span class="s2">:</span>
                <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">childrenTag</span><span class="s2">:</span>
                    <span class="s1">showThisItem </span><span class="s2">= </span><span class="s5">False</span>
                    <span class="s5">for </span><span class="s1">tagKey </span><span class="s5">in </span><span class="s1">list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">childrenTag</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">()):</span>
                        <span class="s5">if </span><span class="s1">item</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">hasTag</span><span class="s2">(</span><span class="s1">tagKey</span><span class="s2">):</span>
                            <span class="s1">showThisItem </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">childrenTag</span><span class="s2">[</span><span class="s1">tagKey</span><span class="s2">]</span>
                    <span class="s5">if not </span><span class="s1">showThisItem</span><span class="s2">:</span>
                        <span class="s1">self</span><span class="s2">.</span><span class="s1">kidKeys</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">key</span><span class="s2">)</span>

        <span class="s4"># Remove unused children</span>
        <span class="s5">for </span><span class="s1">key </span><span class="s5">in </span><span class="s1">list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">()):</span>
            <span class="s5">if </span><span class="s1">key </span><span class="s5">not in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">kidKeys</span><span class="s2">:</span>
                <span class="s5">del</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">key</span><span class="s2">])</span>
        <span class="s1">cx </span><span class="s2">= </span><span class="s1">x</span><span class="s2">+</span><span class="s6">20</span>
        <span class="s1">cy </span><span class="s2">= </span><span class="s1">y</span><span class="s2">+</span><span class="s6">17</span>
        <span class="s1">cylast </span><span class="s2">= </span><span class="s6">0</span>
        <span class="s5">for </span><span class="s1">key </span><span class="s5">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">kidKeys</span><span class="s2">:</span>
            <span class="s1">child </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
            <span class="s1">cylast </span><span class="s2">= </span><span class="s1">cy</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">create_line</span><span class="s2">(</span><span class="s1">x</span><span class="s2">+</span><span class="s6">9</span><span class="s2">, </span><span class="s1">cy</span><span class="s2">+</span><span class="s6">7</span><span class="s2">, </span><span class="s1">cx</span><span class="s2">, </span><span class="s1">cy</span><span class="s2">+</span><span class="s6">7</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s3">&quot;gray50&quot;</span><span class="s2">)</span>
            <span class="s1">cy </span><span class="s2">= </span><span class="s1">child</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">(</span><span class="s1">cx</span><span class="s2">, </span><span class="s1">cy</span><span class="s2">, </span><span class="s1">fUseCachedChildren</span><span class="s2">)</span>
            <span class="s5">if </span><span class="s1">child</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">IsExpandable</span><span class="s2">():</span>
                <span class="s5">if </span><span class="s1">child</span><span class="s2">.</span><span class="s1">state </span><span class="s2">== </span><span class="s3">'expanded'</span><span class="s2">:</span>
                    <span class="s1">iconname </span><span class="s2">= </span><span class="s3">&quot;minusnode&quot;</span>
                    <span class="s1">callback </span><span class="s2">= </span><span class="s1">child</span><span class="s2">.</span><span class="s1">collapse</span>
                <span class="s5">else</span><span class="s2">:</span>
                    <span class="s1">iconname </span><span class="s2">= </span><span class="s3">&quot;plusnode&quot;</span>
                    <span class="s1">callback </span><span class="s2">= </span><span class="s1">child</span><span class="s2">.</span><span class="s1">expand</span>
                <span class="s1">image </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">geticonimage</span><span class="s2">(</span><span class="s1">iconname</span><span class="s2">)</span>
                <span class="s1">id </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">create_image</span><span class="s2">(</span><span class="s1">x</span><span class="s2">+</span><span class="s6">9</span><span class="s2">, </span><span class="s1">cylast</span><span class="s2">+</span><span class="s6">7</span><span class="s2">, </span><span class="s1">image</span><span class="s2">=</span><span class="s1">image</span><span class="s2">)</span>
                <span class="s4"># XXX This leaks bindings until canvas is deleted:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">tag_bind</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s3">&quot;&lt;1&gt;&quot;</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">tag_bind</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s3">&quot;&lt;Double-1&gt;&quot;</span><span class="s2">, </span><span class="s5">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s5">None</span><span class="s2">)</span>
        <span class="s1">id </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">create_line</span><span class="s2">(</span><span class="s1">x</span><span class="s2">+</span><span class="s6">9</span><span class="s2">, </span><span class="s1">y</span><span class="s2">+</span><span class="s6">10</span><span class="s2">, </span><span class="s1">x</span><span class="s2">+</span><span class="s6">9</span><span class="s2">, </span><span class="s1">cylast</span><span class="s2">+</span><span class="s6">7</span><span class="s2">,</span>
            <span class="s4">##stipple=&quot;gray50&quot;,     # XXX Seems broken in Tk 8.0.x</span>
            <span class="s1">fill</span><span class="s2">=</span><span class="s3">&quot;gray50&quot;</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">tag_lower</span><span class="s2">(</span><span class="s1">id</span><span class="s2">) </span><span class="s4"># XXX .lower(id) before Python 1.5.2</span>
        <span class="s5">return </span><span class="s1">cy</span>

    <span class="s5">def </span><span class="s1">drawicon</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">:</span>
            <span class="s1">imagename </span><span class="s2">= (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">GetSelectedIconName</span><span class="s2">() </span><span class="s5">or</span>
                         <span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">GetIconName</span><span class="s2">() </span><span class="s5">or</span>
                         <span class="s3">&quot;openfolder&quot;</span><span class="s2">)</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">imagename </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">GetIconName</span><span class="s2">() </span><span class="s5">or </span><span class="s3">&quot;folder&quot;</span>
        <span class="s1">image </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">geticonimage</span><span class="s2">(</span><span class="s1">imagename</span><span class="s2">)</span>
        <span class="s1">id </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">create_image</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">x</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y</span><span class="s2">, </span><span class="s1">anchor</span><span class="s2">=</span><span class="s3">&quot;nw&quot;</span><span class="s2">, </span><span class="s1">image</span><span class="s2">=</span><span class="s1">image</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">image_id </span><span class="s2">= </span><span class="s1">id</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">tag_bind</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s3">&quot;&lt;1&gt;&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">select</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">tag_bind</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s3">&quot;&lt;Double-1&gt;&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">flip</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">tag_bind</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s3">&quot;&lt;3&gt;&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">popupMenu</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">drawtext</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">textx </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">x</span><span class="s2">+</span><span class="s6">20</span><span class="s2">-</span><span class="s6">1</span>
        <span class="s1">texty </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y</span><span class="s2">-</span><span class="s6">1</span>
        <span class="s1">labeltext </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">GetLabelText</span><span class="s2">()</span>
        <span class="s5">if </span><span class="s1">labeltext</span><span class="s2">:</span>
            <span class="s1">id </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">create_text</span><span class="s2">(</span><span class="s1">textx</span><span class="s2">, </span><span class="s1">texty</span><span class="s2">, </span><span class="s1">anchor</span><span class="s2">=</span><span class="s3">&quot;nw&quot;</span><span class="s2">,</span>
                                         <span class="s1">text</span><span class="s2">=</span><span class="s1">labeltext</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">tag_bind</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s3">&quot;&lt;1&gt;&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">select</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">tag_bind</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s3">&quot;&lt;Double-1&gt;&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">flip</span><span class="s2">)</span>
            <span class="s1">x0</span><span class="s2">, </span><span class="s1">y0</span><span class="s2">, </span><span class="s1">x1</span><span class="s2">, </span><span class="s1">y1 </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">bbox</span><span class="s2">(</span><span class="s1">id</span><span class="s2">)</span>
            <span class="s1">textx </span><span class="s2">= </span><span class="s1">max</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s6">200</span><span class="s2">) + </span><span class="s6">10</span>
        <span class="s1">text </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">GetText</span><span class="s2">() </span><span class="s5">or </span><span class="s3">&quot;&lt;no text&gt;&quot;</span>
        <span class="s5">try</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">entry</span>
        <span class="s5">except </span><span class="s1">AttributeError</span><span class="s2">:</span>
            <span class="s5">pass</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">edit_finish</span><span class="s2">()</span>
        <span class="s5">try</span><span class="s2">:</span>
            <span class="s1">label </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">label</span>
        <span class="s5">except </span><span class="s1">AttributeError</span><span class="s2">:</span>
            <span class="s4"># padding carefully selected (on Windows) to match Entry widget:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">label </span><span class="s2">= </span><span class="s1">Label</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">, </span><span class="s1">text</span><span class="s2">=</span><span class="s1">text</span><span class="s2">, </span><span class="s1">bd</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">padx</span><span class="s2">=</span><span class="s6">2</span><span class="s2">, </span><span class="s1">pady</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">label</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">fg</span><span class="s2">=</span><span class="s3">&quot;white&quot;</span><span class="s2">, </span><span class="s1">bg</span><span class="s2">=</span><span class="s3">&quot;darkblue&quot;</span><span class="s2">)</span>
        <span class="s5">elif </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setAsTarget</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">label</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">fg</span><span class="s2">=</span><span class="s3">&quot;white&quot;</span><span class="s2">, </span><span class="s1">bg</span><span class="s2">=</span><span class="s3">&quot;red&quot;</span><span class="s2">)</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">fg </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">GetTextFg</span><span class="s2">()</span>
            <span class="s1">bg </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">GetTextBg</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">label</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">fg</span><span class="s2">=</span><span class="s1">fg</span><span class="s2">, </span><span class="s1">bg</span><span class="s2">=</span><span class="s1">bg</span><span class="s2">)</span>
        <span class="s1">id </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">create_window</span><span class="s2">(</span><span class="s1">textx</span><span class="s2">, </span><span class="s1">texty</span><span class="s2">,</span>
                                       <span class="s1">anchor</span><span class="s2">=</span><span class="s3">&quot;nw&quot;</span><span class="s2">, </span><span class="s1">window</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">label</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">label</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">&quot;&lt;1&gt;&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">select_or_edit</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">label</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">&quot;&lt;Double-1&gt;&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">flip</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">label</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">&quot;&lt;3&gt;&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">popupMenu</span><span class="s2">)</span>
        <span class="s4"># Update text if necessary</span>
        <span class="s5">if </span><span class="s1">text </span><span class="s2">!= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">label</span><span class="s2">[</span><span class="s3">'text'</span><span class="s2">]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">label</span><span class="s2">[</span><span class="s3">'text'</span><span class="s2">] = </span><span class="s1">text</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">text_id </span><span class="s2">= </span><span class="s1">id</span>

    <span class="s5">def </span><span class="s1">select_or_edit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">=</span><span class="s5">None</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">selected </span><span class="s5">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">IsEditable</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">edit</span><span class="s2">(</span><span class="s1">event</span><span class="s2">)</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">select</span><span class="s2">(</span><span class="s1">event</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">edit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">=</span><span class="s5">None</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">entry </span><span class="s2">= </span><span class="s1">Entry</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">label</span><span class="s2">, </span><span class="s1">bd</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">highlightthickness</span><span class="s2">=</span><span class="s6">1</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">entry</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">label</span><span class="s2">[</span><span class="s3">'text'</span><span class="s2">])</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">entry</span><span class="s2">.</span><span class="s1">selection_range</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s1">END</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">entry</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">ipadx</span><span class="s2">=</span><span class="s6">5</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">entry</span><span class="s2">.</span><span class="s1">focus_set</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">entry</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">&quot;&lt;Return&gt;&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">edit_finish</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">entry</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">&quot;&lt;Escape&gt;&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">edit_cancel</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">edit_finish</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">=</span><span class="s5">None</span><span class="s2">):</span>
        <span class="s5">try</span><span class="s2">:</span>
            <span class="s1">entry </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">entry</span>
            <span class="s5">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">entry</span>
        <span class="s5">except </span><span class="s1">AttributeError</span><span class="s2">:</span>
            <span class="s5">return</span>
        <span class="s1">text </span><span class="s2">= </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">get</span><span class="s2">()</span>
        <span class="s1">entry</span><span class="s2">.</span><span class="s1">destroy</span><span class="s2">()</span>
        <span class="s5">if </span><span class="s1">text </span><span class="s5">and </span><span class="s1">text </span><span class="s2">!= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">GetText</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">SetText</span><span class="s2">(</span><span class="s1">text</span><span class="s2">)</span>
        <span class="s1">text </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">GetText</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">label</span><span class="s2">[</span><span class="s3">'text'</span><span class="s2">] = </span><span class="s1">text</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">drawtext</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">focus_set</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">edit_cancel</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">=</span><span class="s5">None</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">drawtext</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">focus_set</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">find</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">searchKey</span><span class="s2">):</span>
        <span class="s4"># Search for a node who's key matches the given key</span>
        <span class="s4"># Is it this node</span>
        <span class="s5">if </span><span class="s1">searchKey </span><span class="s2">== </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">GetKey</span><span class="s2">():</span>
            <span class="s4"># [gjeon] to filter by given tag</span>
            <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fModeChildrenTag</span><span class="s2">:</span>
                <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">childrenTag</span><span class="s2">:</span>
                    <span class="s1">showThisItem </span><span class="s2">= </span><span class="s5">False</span>
                    <span class="s5">for </span><span class="s1">tagKey </span><span class="s5">in </span><span class="s1">list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">childrenTag</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">()):</span>
                        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">hasTag</span><span class="s2">(</span><span class="s1">tagKey</span><span class="s2">):</span>
                            <span class="s1">showThisItem </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">childrenTag</span><span class="s2">[</span><span class="s1">tagKey</span><span class="s2">]</span>
                    <span class="s5">if not </span><span class="s1">showThisItem</span><span class="s2">:</span>
                        <span class="s5">return None</span>
            <span class="s5">return </span><span class="s1">self</span>
        <span class="s4"># Nope, check the children</span>
        <span class="s1">sublist </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">.</span><span class="s1">_GetSubList</span><span class="s2">()</span>
        <span class="s5">for </span><span class="s1">item </span><span class="s5">in </span><span class="s1">sublist</span><span class="s2">:</span>
            <span class="s1">key </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">GetKey</span><span class="s2">()</span>

            <span class="s4"># Use existing child or create new TreeNode if none exists</span>
            <span class="s5">if </span><span class="s1">key </span><span class="s5">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">:</span>
                <span class="s1">child </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
            <span class="s5">else</span><span class="s2">:</span>
                <span class="s1">child </span><span class="s2">= </span><span class="s1">TreeNode</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">, </span><span class="s1">self</span><span class="s2">, </span><span class="s1">item</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuList</span><span class="s2">)</span>
                <span class="s4"># Update local list of children and keys</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">child</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">kidKeys</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">key</span><span class="s2">)</span>
            <span class="s4"># [gjeon] to set flag recursively</span>
            <span class="s1">child</span><span class="s2">.</span><span class="s1">setChildrenTag</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">childrenTag</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fModeChildrenTag</span><span class="s2">)</span>

            <span class="s4"># See if node is child (or one of child's descendants)</span>
            <span class="s1">retVal </span><span class="s2">= </span><span class="s1">child</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s1">searchKey</span><span class="s2">)</span>
            <span class="s5">if </span><span class="s1">retVal</span><span class="s2">:</span>
                <span class="s5">return </span><span class="s1">retVal</span>
        <span class="s4"># Not here</span>
        <span class="s5">return None</span>

<span class="s5">class </span><span class="s1">TreeItem</span><span class="s2">:</span>

    <span class="s0">&quot;&quot;&quot;Abstract class representing tree items. 
 
    Methods should typically be overridden, otherwise a default action 
    is used. 
 
    &quot;&quot;&quot;</span>

    <span class="s5">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot;Constructor.  Do whatever you need to do.&quot;&quot;&quot;</span>

    <span class="s5">def </span><span class="s1">GetText</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot;Return text string to display.&quot;&quot;&quot;</span>

    <span class="s5">def </span><span class="s1">GetTextFg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">return </span><span class="s3">&quot;black&quot;</span>

    <span class="s5">def </span><span class="s1">GetTextBg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">return </span><span class="s3">&quot;white&quot;</span>

    <span class="s5">def </span><span class="s1">GetLabelText</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot;Return label text string to display in front of text (if any).&quot;&quot;&quot;</span>

    <span class="s5">def </span><span class="s1">IsExpandable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot;Return whether there are subitems.&quot;&quot;&quot;</span>
        <span class="s5">return </span><span class="s6">1</span>

    <span class="s5">def </span><span class="s1">_GetSubList</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot;Do not override!  Called by TreeNode.&quot;&quot;&quot;</span>
        <span class="s5">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">IsExpandable</span><span class="s2">():</span>
            <span class="s5">return </span><span class="s2">[]</span>
        <span class="s1">sublist </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">GetSubList</span><span class="s2">()</span>
        <span class="s5">return </span><span class="s1">sublist</span>

    <span class="s5">def </span><span class="s1">IsEditable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot;Return whether the item's text may be edited.&quot;&quot;&quot;</span>

    <span class="s5">def </span><span class="s1">SetText</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">text</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot;Change the item's text (if it is editable).&quot;&quot;&quot;</span>

    <span class="s5">def </span><span class="s1">GetIconName</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot;Return name of icon to be displayed normally.&quot;&quot;&quot;</span>

    <span class="s5">def </span><span class="s1">GetSelectedIconName</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot;Return name of icon to be displayed when selected.&quot;&quot;&quot;</span>

    <span class="s5">def </span><span class="s1">GetSubList</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot;Return list of items forming sublist.&quot;&quot;&quot;</span>

    <span class="s5">def </span><span class="s1">OnDoubleClick</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot;Called on a double-click on the item.&quot;&quot;&quot;</span>

    <span class="s5">def </span><span class="s1">OnSelect</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot;Called when item selected.&quot;&quot;&quot;</span>



</pre>
</body>
</html>
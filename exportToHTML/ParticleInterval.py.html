<html>
<head>
<title>ParticleInterval.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #cf8e6d;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
ParticleInterval.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Contains the ParticleInterval class 
&quot;&quot;&quot;</span>

<span class="s1">__all__ </span><span class="s2">= [</span><span class="s3">'ParticleInterval'</span><span class="s2">]</span>

<span class="s4">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s4">import </span><span class="s2">*</span>
<span class="s4">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">direct </span><span class="s4">import </span><span class="s2">*</span>
<span class="s4">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">directnotify</span><span class="s2">.</span><span class="s1">DirectNotifyGlobal </span><span class="s4">import </span><span class="s1">directNotify</span>
<span class="s4">from </span><span class="s2">.</span><span class="s1">Interval </span><span class="s4">import </span><span class="s1">Interval</span>


<span class="s4">class </span><span class="s1">ParticleInterval</span><span class="s2">(</span><span class="s1">Interval</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Use this interval when you want to have greater control over a 
    ParticleEffect.  The interval does not register the effect with 
    the global particle and physics managers, but it does call upon 
    them to perform its stepping.  You should NOT call 
    particleEffect.start() with an effect that is being controlled 
    by a ParticleInterval. 
    &quot;&quot;&quot;</span>
    <span class="s5"># Name counter</span>
    <span class="s1">particleNum </span><span class="s2">= </span><span class="s6">1</span>
    <span class="s5"># create ParticleInterval DirectNotify category</span>
    <span class="s1">notify </span><span class="s2">= </span><span class="s1">directNotify</span><span class="s2">.</span><span class="s1">newCategory</span><span class="s2">(</span><span class="s3">'ParticleInterval'</span><span class="s2">)</span>
    <span class="s5"># Class methods</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">,</span>
                 <span class="s1">particleEffect</span><span class="s2">,</span>
                 <span class="s1">parent</span><span class="s2">,</span>
                 <span class="s1">worldRelative </span><span class="s2">= </span><span class="s6">1</span><span class="s2">,</span>
                 <span class="s1">renderParent </span><span class="s2">= </span><span class="s4">None</span><span class="s2">,</span>
                 <span class="s1">duration </span><span class="s2">= </span><span class="s6">0.0</span><span class="s2">,</span>
                 <span class="s1">softStopT </span><span class="s2">= </span><span class="s6">0.0</span><span class="s2">,</span>
                 <span class="s1">cleanup </span><span class="s2">= </span><span class="s4">False</span><span class="s2">,</span>
                 <span class="s1">name </span><span class="s2">= </span><span class="s4">None</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Args: 
            particleEffect (ParticleEffect): a particle effect 
            parent (NodePath): this is where the effect will be parented in the 
                scene graph 
            worldRelative (bool): this will override 'renderParent' with render 
            renderParent (NodePath): this is where the particles will be 
                rendered in the scenegraph 
            duration (float): for the time 
            softStopT (float): no effect if 0.0, a positive value will count 
                from the start of the interval, a negative value will count 
                from the end of the interval 
            cleanup (boolean): if True the effect will be destroyed and removed 
                from the scenegraph upon interval completion.  Set to False if 
                planning on reusing the interval. 
            name (string): use this for unique intervals so that they can be 
                easily found in the taskMgr. 
        &quot;&quot;&quot;</span>

        <span class="s5"># Generate unique name</span>
        <span class="s1">id </span><span class="s2">= </span><span class="s3">'Particle-%d' </span><span class="s2">% </span><span class="s1">ParticleInterval</span><span class="s2">.</span><span class="s1">particleNum</span>
        <span class="s1">ParticleInterval</span><span class="s2">.</span><span class="s1">particleNum </span><span class="s2">+= </span><span class="s6">1</span>
        <span class="s4">if </span><span class="s1">name </span><span class="s2">== </span><span class="s4">None</span><span class="s2">:</span>
            <span class="s1">name </span><span class="s2">= </span><span class="s1">id</span>
        <span class="s5"># Record instance variables</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect </span><span class="s2">= </span><span class="s1">particleEffect</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cleanup </span><span class="s2">= </span><span class="s1">cleanup</span>

        <span class="s4">if </span><span class="s1">parent </span><span class="s2">!= </span><span class="s4">None</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">worldRelative</span><span class="s2">:</span>
            <span class="s1">renderParent </span><span class="s2">= </span><span class="s1">render</span>
        <span class="s4">if </span><span class="s1">renderParent</span><span class="s2">:</span>
            <span class="s4">for </span><span class="s1">particles </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect</span><span class="s2">.</span><span class="s1">getParticlesList</span><span class="s2">():</span>
                <span class="s1">particles</span><span class="s2">.</span><span class="s1">setRenderParent</span><span class="s2">(</span><span class="s1">renderParent</span><span class="s2">.</span><span class="s1">node</span><span class="s2">())</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">__softStopped </span><span class="s2">= </span><span class="s4">False</span>

        <span class="s4">if </span><span class="s1">softStopT </span><span class="s2">== </span><span class="s6">0.0</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">softStopT </span><span class="s2">= </span><span class="s1">duration</span>
        <span class="s4">elif </span><span class="s1">softStopT </span><span class="s2">&lt; </span><span class="s6">0.0</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">softStopT </span><span class="s2">= </span><span class="s1">duration</span><span class="s2">+</span><span class="s1">softStopT</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">softStopT </span><span class="s2">= </span><span class="s1">softStopT</span>

        <span class="s5"># Initialize superclass</span>
        <span class="s1">Interval</span><span class="s2">.</span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">__step</span><span class="s2">(</span><span class="s1">self</span><span class="s2">,</span><span class="s1">dt</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect</span><span class="s2">.</span><span class="s1">accelerate</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">,</span><span class="s6">1</span><span class="s2">,</span><span class="s6">0.05</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">__softStart</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect</span><span class="s2">.</span><span class="s1">softStart</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__softStopped </span><span class="s2">= </span><span class="s4">False</span>

    <span class="s4">def </span><span class="s1">__softStop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect</span><span class="s2">.</span><span class="s1">softStop</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__softStopped </span><span class="s2">= </span><span class="s4">True</span>

    <span class="s4">def </span><span class="s1">privInitialize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">t</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">!= </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SPaused</span><span class="s2">:</span>
            <span class="s5"># Restarting from a hard stop or just interrupting the</span>
            <span class="s5"># current play</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">__softStart</span><span class="s2">()</span>
            <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect</span><span class="s2">.</span><span class="s1">clearToInitial</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">currT </span><span class="s2">= </span><span class="s6">0</span>

        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect</span><span class="s2">:</span>
            <span class="s4">for </span><span class="s1">forceGroup </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect</span><span class="s2">.</span><span class="s1">getForceGroupList</span><span class="s2">():</span>
                <span class="s1">forceGroup</span><span class="s2">.</span><span class="s1">enable</span><span class="s2">()</span>

        <span class="s1">Interval</span><span class="s2">.</span><span class="s1">privInitialize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">,</span><span class="s1">t</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">privInstant</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">privInitialize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">getDuration</span><span class="s2">())</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">privFinalize</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">privStep</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">t</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">== </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SPaused </span><span class="s4">or </span><span class="s1">t </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">currT</span><span class="s2">:</span>
            <span class="s5"># Restarting from a pause.</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">privInitialize</span><span class="s2">(</span><span class="s1">t</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__softStopped </span><span class="s4">and </span><span class="s1">t </span><span class="s2">&gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">softStopT</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">__step</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">softStopT</span><span class="s2">-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">currT</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">__softStop</span><span class="s2">()</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">__step</span><span class="s2">(</span><span class="s1">t</span><span class="s2">-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">softStopT</span><span class="s2">)</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">__step</span><span class="s2">(</span><span class="s1">t</span><span class="s2">-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">currT</span><span class="s2">)</span>
            <span class="s1">Interval</span><span class="s2">.</span><span class="s1">privStep</span><span class="s2">(</span><span class="s1">self</span><span class="s2">,</span><span class="s1">t</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">privFinalize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">Interval</span><span class="s2">.</span><span class="s1">privFinalize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cleanup </span><span class="s4">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect</span><span class="s2">.</span><span class="s1">cleanup</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">particleEffect </span><span class="s2">= </span><span class="s4">None</span>

</pre>
</body>
</html>
<html>
<head>
<title>gendocs.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
gendocs.py</font>
</center></td></tr></table>
<pre><span class="s0">########################################################################</span>
<span class="s0">#</span>
<span class="s0"># Documentation generator for panda.</span>
<span class="s0">#</span>
<span class="s0"># How to use this module:</span>
<span class="s0">#</span>
<span class="s0">#   from direct.directscripts import gendocs</span>
<span class="s0">#   gendocs.generate(version, indirlist, directdirlist, docdir, header, footer, urlprefix, urlsuffix)</span>
<span class="s0">#</span>
<span class="s0">#   - version is the panda version number</span>
<span class="s0">#</span>
<span class="s0">#   - indirlist is the name of a directory, or a list of directories,</span>
<span class="s0">#     containing the &quot;xxx.in&quot; files that interrogate generates.  No</span>
<span class="s0">#     slash at end.</span>
<span class="s0">#</span>
<span class="s0">#   - directdirlist is the name of a directory, or a list of</span>
<span class="s0">#     directories, containing the source code for &quot;direct,&quot; as well as</span>
<span class="s0">#     for other Python-based trees that should be included in the</span>
<span class="s0">#     documentation pages.  No slash at end.</span>
<span class="s0">#</span>
<span class="s0">#   - docdir is the name of a directory into which HTML files</span>
<span class="s0">#     will be emitted.  No slash at end.</span>
<span class="s0">#</span>
<span class="s0">#   - header is a string that will be placed at the front of</span>
<span class="s0">#     every HTML page.</span>
<span class="s0">#</span>
<span class="s0">#   - footer is a string that will be placed at the end of</span>
<span class="s0">#     every HTML page.</span>
<span class="s0">#</span>
<span class="s0">#   - urlprefix is a string that will be appended to the front of</span>
<span class="s0">#     every URL.</span>
<span class="s0">#</span>
<span class="s0">#   - urlsuffix is a string that will be appended to the end of</span>
<span class="s0">#     every URL.</span>
<span class="s0">#</span>
<span class="s0">########################################################################</span>
<span class="s0">#</span>
<span class="s0"># The major subsystems are:</span>
<span class="s0">#</span>
<span class="s0"># * The module that loads interrogate databases.</span>
<span class="s0">#</span>
<span class="s0"># * The module that loads python parse-trees.</span>
<span class="s0">#</span>
<span class="s0"># * The &quot;code database&quot;, which provides a single access point</span>
<span class="s0">#   for both interrogate databases and python parse trees.</span>
<span class="s0">#</span>
<span class="s0"># * The HTML generator.</span>
<span class="s0">#</span>
<span class="s0">########################################################################</span>

<span class="s2">import </span><span class="s1">os</span><span class="s3">, </span><span class="s1">sys</span><span class="s3">, </span><span class="s1">parser</span><span class="s3">, </span><span class="s1">symbol</span><span class="s3">, </span><span class="s1">token</span><span class="s3">, </span><span class="s1">re</span>

<span class="s0">########################################################################</span>
<span class="s0">#</span>
<span class="s0"># assorted utility functions</span>
<span class="s0">#</span>
<span class="s0">########################################################################</span>

<span class="s1">SECHEADER </span><span class="s3">= </span><span class="s1">re</span><span class="s3">.</span><span class="s1">compile</span><span class="s3">(</span><span class="s4">&quot;^[A-Z][a-z]+</span><span class="s2">\\</span><span class="s4">s*:&quot;</span><span class="s3">)</span>
<span class="s1">JUNKHEADER </span><span class="s3">= </span><span class="s1">re</span><span class="s3">.</span><span class="s1">compile</span><span class="s3">(</span><span class="s4">&quot;^((Function)|(Access))</span><span class="s2">\\</span><span class="s4">s*:&quot;</span><span class="s3">)</span>
<span class="s1">IMPORTSTAR </span><span class="s3">= </span><span class="s1">re</span><span class="s3">.</span><span class="s1">compile</span><span class="s3">(</span><span class="s4">&quot;^from</span><span class="s2">\\</span><span class="s4">s+([a-zA-Z0-9_.]+)</span><span class="s2">\\</span><span class="s4">s+import</span><span class="s2">\\</span><span class="s4">s+[*]</span><span class="s2">\\</span><span class="s4">s*$&quot;</span><span class="s3">)</span>
<span class="s1">IDENTIFIER </span><span class="s3">= </span><span class="s1">re</span><span class="s3">.</span><span class="s1">compile</span><span class="s3">(</span><span class="s4">&quot;[a-zA-Z0-9_]+&quot;</span><span class="s3">)</span>
<span class="s1">FILEHEADER </span><span class="s3">= </span><span class="s1">re</span><span class="s3">.</span><span class="s1">compile</span><span class="s3">(</span>
<span class="s4">r&quot;&quot;&quot;^// Filename: [a-zA-Z.]+ 
// Created by:  [a-zA-Z. ()0-9]+( 
//)? 
//////////////////////////////////////////////////////////////////// 
// 
// PANDA 3D SOFTWARE 
// Copyright \(c\) Carnegie Mellon University.  All rights reserved. 
// 
// All use of this software is subject to the terms of the revised BSD 
// license.  You should have received a copy of this license along 
// with this source code in a file named &quot;LICENSE.&quot; 
// 
////////////////////////////////////////////////////////////////////&quot;&quot;&quot;</span><span class="s3">)</span>

<span class="s2">def </span><span class="s1">readFile</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">):</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s1">srchandle </span><span class="s3">= </span><span class="s1">open</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">, </span><span class="s4">&quot;r&quot;</span><span class="s3">)</span>
        <span class="s1">data </span><span class="s3">= </span><span class="s1">srchandle</span><span class="s3">.</span><span class="s1">read</span><span class="s3">()</span>
        <span class="s1">srchandle</span><span class="s3">.</span><span class="s1">close</span><span class="s3">()</span>
        <span class="s2">return </span><span class="s1">data</span>
    <span class="s2">except</span><span class="s3">:</span>
        <span class="s1">sys</span><span class="s3">.</span><span class="s1">exit</span><span class="s3">(</span><span class="s4">&quot;Cannot read &quot;</span><span class="s3">+</span><span class="s1">fn</span><span class="s3">)</span>

<span class="s2">def </span><span class="s1">writeFile</span><span class="s3">(</span><span class="s1">wfile</span><span class="s3">, </span><span class="s1">data</span><span class="s3">):</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s1">dsthandle </span><span class="s3">= </span><span class="s1">open</span><span class="s3">(</span><span class="s1">wfile</span><span class="s3">, </span><span class="s4">&quot;wb&quot;</span><span class="s3">)</span>
        <span class="s1">dsthandle</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s1">data</span><span class="s3">)</span>
        <span class="s1">dsthandle</span><span class="s3">.</span><span class="s1">close</span><span class="s3">()</span>
    <span class="s2">except</span><span class="s3">:</span>
        <span class="s1">sys</span><span class="s3">.</span><span class="s1">exit</span><span class="s3">(</span><span class="s4">&quot;Cannot write &quot;</span><span class="s3">+</span><span class="s1">wfile</span><span class="s3">)</span>

<span class="s2">def </span><span class="s1">writeFileLines</span><span class="s3">(</span><span class="s1">wfile</span><span class="s3">, </span><span class="s1">lines</span><span class="s3">):</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s1">dsthandle </span><span class="s3">= </span><span class="s1">open</span><span class="s3">(</span><span class="s1">wfile</span><span class="s3">, </span><span class="s4">&quot;wb&quot;</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">lines</span><span class="s3">:</span>
            <span class="s1">dsthandle</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>
            <span class="s1">dsthandle</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">)</span>
        <span class="s1">dsthandle</span><span class="s3">.</span><span class="s1">close</span><span class="s3">()</span>
    <span class="s2">except</span><span class="s3">:</span>
        <span class="s1">sys</span><span class="s3">.</span><span class="s1">exit</span><span class="s3">(</span><span class="s4">&quot;Cannot write &quot;</span><span class="s3">+</span><span class="s1">wfile</span><span class="s3">)</span>

<span class="s2">def </span><span class="s1">findFiles</span><span class="s3">(</span><span class="s1">dirlist</span><span class="s3">, </span><span class="s1">ext</span><span class="s3">, </span><span class="s1">ign</span><span class="s3">, </span><span class="s1">list</span><span class="s3">):</span>
    <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">dirlist</span><span class="s3">, </span><span class="s1">str</span><span class="s3">):</span>
        <span class="s1">dirlist </span><span class="s3">= [</span><span class="s1">dirlist</span><span class="s3">]</span>
    <span class="s2">for </span><span class="s1">dir </span><span class="s2">in </span><span class="s1">dirlist</span><span class="s3">:</span>
        <span class="s2">for </span><span class="s1">file </span><span class="s2">in </span><span class="s1">os</span><span class="s3">.</span><span class="s1">listdir</span><span class="s3">(</span><span class="s1">dir</span><span class="s3">):</span>
            <span class="s1">full </span><span class="s3">= </span><span class="s1">dir </span><span class="s3">+ </span><span class="s4">&quot;/&quot; </span><span class="s3">+ </span><span class="s1">file</span>
            <span class="s2">if </span><span class="s1">full </span><span class="s2">not in </span><span class="s1">ign </span><span class="s2">and </span><span class="s1">file </span><span class="s2">not in </span><span class="s1">ign</span><span class="s3">:</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">isfile</span><span class="s3">(</span><span class="s1">full</span><span class="s3">)):</span>
                    <span class="s2">if </span><span class="s3">(</span><span class="s1">file</span><span class="s3">.</span><span class="s1">endswith</span><span class="s3">(</span><span class="s1">ext</span><span class="s3">)):</span>
                        <span class="s1">list</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">full</span><span class="s3">)</span>
                <span class="s2">elif </span><span class="s3">(</span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">isdir</span><span class="s3">(</span><span class="s1">full</span><span class="s3">)):</span>
                    <span class="s1">findFiles</span><span class="s3">(</span><span class="s1">full</span><span class="s3">, </span><span class="s1">ext</span><span class="s3">, </span><span class="s1">ign</span><span class="s3">, </span><span class="s1">list</span><span class="s3">)</span>

<span class="s2">def </span><span class="s1">pathToModule</span><span class="s3">(</span><span class="s1">result</span><span class="s3">):</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">result</span><span class="s3">[-</span><span class="s5">3</span><span class="s3">:]==</span><span class="s4">&quot;.py&quot;</span><span class="s3">): </span><span class="s1">result</span><span class="s3">=</span><span class="s1">result</span><span class="s3">[:-</span><span class="s5">3</span><span class="s3">]</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">result</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;/src/&quot;</span><span class="s3">,</span><span class="s4">&quot;/&quot;</span><span class="s3">)</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">result</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;/&quot;</span><span class="s3">,</span><span class="s4">&quot;.&quot;</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">result</span>

<span class="s2">def </span><span class="s1">textToHTML</span><span class="s3">(</span><span class="s1">comment</span><span class="s3">, </span><span class="s1">sep</span><span class="s3">, </span><span class="s1">delsection</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
    <span class="s1">sections </span><span class="s3">= [</span><span class="s4">&quot;&quot;</span><span class="s3">]</span>
    <span class="s1">included </span><span class="s3">= {}</span>
    <span class="s2">for </span><span class="s1">line </span><span class="s2">in </span><span class="s1">comment</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">):</span>
        <span class="s1">line </span><span class="s3">= </span><span class="s1">line</span><span class="s3">.</span><span class="s1">lstrip</span><span class="s3">(</span><span class="s4">&quot; &quot;</span><span class="s3">).</span><span class="s1">lstrip</span><span class="s3">(</span><span class="s1">sep</span><span class="s3">).</span><span class="s1">lstrip</span><span class="s3">(</span><span class="s4">&quot; &quot;</span><span class="s3">).</span><span class="s1">rstrip</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\r</span><span class="s4">&quot;</span><span class="s3">).</span><span class="s1">rstrip</span><span class="s3">(</span><span class="s4">&quot; &quot;</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">line </span><span class="s3">== </span><span class="s4">&quot;&quot;</span><span class="s3">):</span>
            <span class="s1">sections</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">&quot;&quot;</span><span class="s3">)</span>
        <span class="s2">elif </span><span class="s3">(</span><span class="s1">line</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]==</span><span class="s4">&quot;*&quot;</span><span class="s3">) </span><span class="s2">or </span><span class="s3">(</span><span class="s1">line</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]==</span><span class="s4">&quot;-&quot;</span><span class="s3">):</span>
            <span class="s1">sections</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">line</span><span class="s3">)</span>
            <span class="s1">sections</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">&quot;&quot;</span><span class="s3">)</span>
        <span class="s2">elif </span><span class="s3">(</span><span class="s1">SECHEADER</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">line</span><span class="s3">)):</span>
            <span class="s1">sections</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">line</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">sections</span><span class="s3">[-</span><span class="s5">1</span><span class="s3">] = </span><span class="s1">sections</span><span class="s3">[-</span><span class="s5">1</span><span class="s3">] + </span><span class="s4">&quot; &quot; </span><span class="s3">+ </span><span class="s1">line</span>
    <span class="s1">total </span><span class="s3">= </span><span class="s4">&quot;&quot;</span>
    <span class="s2">for </span><span class="s1">sec </span><span class="s2">in </span><span class="s1">sections</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">sec </span><span class="s3">!= </span><span class="s4">&quot;&quot;</span><span class="s3">):</span>
            <span class="s1">sec </span><span class="s3">= </span><span class="s1">sec</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;&amp;&quot;</span><span class="s3">,</span><span class="s4">&quot;&amp;amp;&quot;</span><span class="s3">)</span>
            <span class="s1">sec </span><span class="s3">= </span><span class="s1">sec</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;&lt;&quot;</span><span class="s3">,</span><span class="s4">&quot;&amp;lt;&quot;</span><span class="s3">)</span>
            <span class="s1">sec </span><span class="s3">= </span><span class="s1">sec</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;&gt;&quot;</span><span class="s3">,</span><span class="s4">&quot;&amp;gt;&quot;</span><span class="s3">)</span>
            <span class="s1">sec </span><span class="s3">= </span><span class="s1">sec</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;  &quot;</span><span class="s3">,</span><span class="s4">&quot; &quot;</span><span class="s3">)</span>
            <span class="s1">sec </span><span class="s3">= </span><span class="s1">sec</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;  &quot;</span><span class="s3">,</span><span class="s4">&quot; &quot;</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">delsection </span><span class="s3">!= </span><span class="s2">None</span><span class="s3">) </span><span class="s2">and </span><span class="s3">(</span><span class="s1">delsection</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">sec</span><span class="s3">)):</span>
                <span class="s1">included</span><span class="s3">[</span><span class="s1">sec</span><span class="s3">] = </span><span class="s5">1</span>
            <span class="s2">if </span><span class="s1">sec </span><span class="s2">not in </span><span class="s1">included</span><span class="s3">:</span>
                <span class="s1">included</span><span class="s3">[</span><span class="s1">sec</span><span class="s3">] = </span><span class="s5">1</span>
                <span class="s1">total </span><span class="s3">= </span><span class="s1">total </span><span class="s3">+ </span><span class="s1">sec </span><span class="s3">+ </span><span class="s4">&quot;&lt;br&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s2">return </span><span class="s1">total</span>

<span class="s2">def </span><span class="s1">linkTo</span><span class="s3">(</span><span class="s1">link</span><span class="s3">, </span><span class="s1">text</span><span class="s3">):</span>
    <span class="s2">return </span><span class="s4">'&lt;a href=&quot;' </span><span class="s3">+ </span><span class="s1">link </span><span class="s3">+ </span><span class="s4">'&quot;&gt;' </span><span class="s3">+ </span><span class="s1">text </span><span class="s3">+ </span><span class="s4">'&lt;/a&gt;'</span>

<span class="s2">def </span><span class="s1">convertToPythonFn</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">):</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s4">&quot;&quot;</span>
    <span class="s1">lastc </span><span class="s3">= </span><span class="s5">0</span>
    <span class="s2">for </span><span class="s1">c </span><span class="s2">in </span><span class="s1">fn</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">c</span><span class="s3">!=</span><span class="s4">&quot;_&quot;</span><span class="s3">):</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">lastc</span><span class="s3">==</span><span class="s4">&quot;_&quot;</span><span class="s3">):</span>
                <span class="s1">result </span><span class="s3">= </span><span class="s1">result </span><span class="s3">+ </span><span class="s1">c</span><span class="s3">.</span><span class="s1">upper</span><span class="s3">()</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">result </span><span class="s3">= </span><span class="s1">result </span><span class="s3">+ </span><span class="s1">c</span>
        <span class="s1">lastc </span><span class="s3">= </span><span class="s1">c</span>
    <span class="s2">return </span><span class="s1">result</span>

<span class="s2">def </span><span class="s1">removeFileLicense</span><span class="s3">(</span><span class="s1">content</span><span class="s3">):</span>
    <span class="s0"># Removes the license part at the top of a file.</span>
    <span class="s2">return </span><span class="s1">re</span><span class="s3">.</span><span class="s1">sub</span><span class="s3">(</span><span class="s1">FILEHEADER</span><span class="s3">, </span><span class="s4">&quot;&quot;</span><span class="s3">, </span><span class="s1">content</span><span class="s3">).</span><span class="s1">strip</span><span class="s3">()</span>

<span class="s0">########################################################################</span>
<span class="s0">#</span>
<span class="s0"># Interrogate Database Tokenizer</span>
<span class="s0">#</span>
<span class="s0">########################################################################</span>

<span class="s2">class </span><span class="s1">InterrogateTokenizer</span><span class="s3">:</span>
    <span class="s6">&quot;&quot;&quot; 
    A big string, with a &quot;parse pointer&quot;, and routines to 
    extract integers and strings.  The token syntax is that 
    used by interrogate databases. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">fn</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">fn </span><span class="s3">= </span><span class="s1">fn</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">= </span><span class="s5">0</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">data </span><span class="s3">= </span><span class="s1">readFile</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">readint</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">neg </span><span class="s3">= </span><span class="s5">0</span>
        <span class="s2">while </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">data</span><span class="s3">[</span><span class="s1">self</span><span class="s3">.</span><span class="s1">pos</span><span class="s3">].</span><span class="s1">isspace</span><span class="s3">()):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">+= </span><span class="s5">1</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">data</span><span class="s3">[</span><span class="s1">self</span><span class="s3">.</span><span class="s1">pos</span><span class="s3">] == </span><span class="s4">&quot;-&quot;</span><span class="s3">):</span>
            <span class="s1">neg </span><span class="s3">= </span><span class="s5">1</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">+= </span><span class="s5">1</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">data</span><span class="s3">[</span><span class="s1">self</span><span class="s3">.</span><span class="s1">pos</span><span class="s3">].</span><span class="s1">isdigit</span><span class="s3">()==</span><span class="s5">0</span><span class="s3">):</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;File position &quot; </span><span class="s3">+ </span><span class="s1">str</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">pos</span><span class="s3">))</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;Text: &quot; </span><span class="s3">+ </span><span class="s1">self</span><span class="s3">.</span><span class="s1">data</span><span class="s3">[</span><span class="s1">self</span><span class="s3">.</span><span class="s1">pos</span><span class="s3">:</span><span class="s1">self</span><span class="s3">.</span><span class="s1">pos</span><span class="s3">+</span><span class="s5">50</span><span class="s3">])</span>
            <span class="s1">sys</span><span class="s3">.</span><span class="s1">exit</span><span class="s3">(</span><span class="s4">&quot;Syntax error in interrogate file format 0&quot;</span><span class="s3">)</span>
        <span class="s1">value </span><span class="s3">= </span><span class="s5">0</span>
        <span class="s2">while </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">data</span><span class="s3">[</span><span class="s1">self</span><span class="s3">.</span><span class="s1">pos</span><span class="s3">].</span><span class="s1">isdigit</span><span class="s3">()):</span>
            <span class="s1">value </span><span class="s3">= </span><span class="s1">value</span><span class="s3">*</span><span class="s5">10 </span><span class="s3">+ </span><span class="s1">int</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">data</span><span class="s3">[</span><span class="s1">self</span><span class="s3">.</span><span class="s1">pos</span><span class="s3">])</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">+= </span><span class="s5">1</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">neg</span><span class="s3">): </span><span class="s1">value </span><span class="s3">= -</span><span class="s1">value</span>
        <span class="s2">return </span><span class="s1">value</span>

    <span class="s2">def </span><span class="s1">readstring</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">length </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">data</span><span class="s3">[</span><span class="s1">self</span><span class="s3">.</span><span class="s1">pos</span><span class="s3">].</span><span class="s1">isspace</span><span class="s3">()==</span><span class="s5">0</span><span class="s3">):</span>
            <span class="s1">sys</span><span class="s3">.</span><span class="s1">exit</span><span class="s3">(</span><span class="s4">&quot;Syntax error in interrogate file format 1&quot;</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">+= </span><span class="s5">1</span>
        <span class="s1">body </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">data</span><span class="s3">[</span><span class="s1">self</span><span class="s3">.</span><span class="s1">pos</span><span class="s3">:</span><span class="s1">self</span><span class="s3">.</span><span class="s1">pos</span><span class="s3">+</span><span class="s1">length</span><span class="s3">]</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">body</span><span class="s3">) != </span><span class="s1">length</span><span class="s3">):</span>
            <span class="s1">sys</span><span class="s3">.</span><span class="s1">exit</span><span class="s3">(</span><span class="s4">&quot;Syntax error in interrogate file format 2&quot;</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">+= </span><span class="s1">length</span>
        <span class="s2">return </span><span class="s1">body</span>

<span class="s0">########################################################################</span>
<span class="s0">#</span>
<span class="s0"># Interrogate Database Storage/Parsing</span>
<span class="s0">#</span>
<span class="s0">########################################################################</span>

<span class="s2">def </span><span class="s1">parseInterrogateIntVec</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">):</span>
    <span class="s1">length </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
    <span class="s1">result </span><span class="s3">= []</span>
    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">length</span><span class="s3">):</span>
        <span class="s1">result</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">())</span>
    <span class="s2">return </span><span class="s1">result</span>

<span class="s2">class </span><span class="s1">InterrogateFunction</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tokzr</span><span class="s3">, </span><span class="s1">db</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">db </span><span class="s3">= </span><span class="s1">db</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">index </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">componentname </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">flags </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">classindex </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">scopedname </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">cwrappers </span><span class="s3">= </span><span class="s1">parseInterrogateIntVec</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">pythonwrappers </span><span class="s3">= </span><span class="s1">parseInterrogateIntVec</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">comment </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">prototype </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>

<span class="s2">class </span><span class="s1">InterrogateEnumValue</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tokzr</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">name </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">scopedname </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">value </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>

<span class="s2">class </span><span class="s1">InterrogateDerivation</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tokzr</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">flags </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">base </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">upcast </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">downcast </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>

<span class="s2">class </span><span class="s1">InterrogateType</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tokzr</span><span class="s3">, </span><span class="s1">db</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">db </span><span class="s3">= </span><span class="s1">db</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">index </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">componentname </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">flags </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">scopedname </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">truename </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">outerclass </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">atomictype </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">wrappedtype </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">constructors </span><span class="s3">= </span><span class="s1">parseInterrogateIntVec</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">destructor </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">elements </span><span class="s3">= </span><span class="s1">parseInterrogateIntVec</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">methods </span><span class="s3">= </span><span class="s1">parseInterrogateIntVec</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">casts </span><span class="s3">= </span><span class="s1">parseInterrogateIntVec</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">derivations </span><span class="s3">= []</span>
        <span class="s1">nderivations </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">nderivations</span><span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">derivations</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">InterrogateDerivation</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">))</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">enumvalues </span><span class="s3">= []</span>
        <span class="s1">nenumvalues </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">nenumvalues</span><span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">enumvalues</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">InterrogateEnumValue</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">))</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">nested </span><span class="s3">= </span><span class="s1">parseInterrogateIntVec</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">comment </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>

<span class="s2">class </span><span class="s1">InterrogateParameter</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tokzr</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">name </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">parameterflags </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">type </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>

<span class="s2">class </span><span class="s1">InterrogateWrapper</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tokzr</span><span class="s3">, </span><span class="s1">db</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">db </span><span class="s3">= </span><span class="s1">db</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">index </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">componentname </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">flags </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">function </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">returntype </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">returnvaluedestructor </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">uniquename </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">parameters </span><span class="s3">= []</span>
        <span class="s1">nparameters </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">nparameters</span><span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">parameters</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">InterrogateParameter</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">))</span>

<span class="s2">class </span><span class="s1">InterrogateDatabase</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tokzr</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">fn </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">fn</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">magic </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">version1 </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s1">version2 </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">version1 </span><span class="s3">!= </span><span class="s5">2</span><span class="s3">) </span><span class="s2">or </span><span class="s3">(</span><span class="s1">version2 </span><span class="s3">!= </span><span class="s5">2</span><span class="s3">):</span>
            <span class="s1">sys</span><span class="s3">.</span><span class="s1">exit</span><span class="s3">(</span><span class="s4">&quot;This program only understands interrogate file format 2.2&quot;</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">library </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">libhash </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">module </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readstring</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">functions </span><span class="s3">= {}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">wrappers </span><span class="s3">= {}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">types </span><span class="s3">= {}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">namedtypes </span><span class="s3">= {}</span>
        <span class="s1">count_functions </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">count_functions</span><span class="s3">):</span>
            <span class="s1">fn </span><span class="s3">= </span><span class="s1">InterrogateFunction</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">, </span><span class="s1">self</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">functions</span><span class="s3">[</span><span class="s1">fn</span><span class="s3">.</span><span class="s1">index</span><span class="s3">] = </span><span class="s1">fn</span>
        <span class="s1">count_wrappers </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">count_wrappers</span><span class="s3">):</span>
            <span class="s1">wr </span><span class="s3">= </span><span class="s1">InterrogateWrapper</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">, </span><span class="s1">self</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">wrappers</span><span class="s3">[</span><span class="s1">wr</span><span class="s3">.</span><span class="s1">index</span><span class="s3">] = </span><span class="s1">wr</span>
        <span class="s1">count_types </span><span class="s3">= </span><span class="s1">tokzr</span><span class="s3">.</span><span class="s1">readint</span><span class="s3">()</span>
        <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">count_types</span><span class="s3">):</span>
            <span class="s1">tp </span><span class="s3">= </span><span class="s1">InterrogateType</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">, </span><span class="s1">self</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">types</span><span class="s3">[</span><span class="s1">tp</span><span class="s3">.</span><span class="s1">index</span><span class="s3">] = </span><span class="s1">tp</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">namedtypes</span><span class="s3">[</span><span class="s1">tp</span><span class="s3">.</span><span class="s1">scopedname</span><span class="s3">] = </span><span class="s1">tp</span>

<span class="s0">########################################################################</span>
<span class="s0">#</span>
<span class="s0"># Pattern Matching for Python Parse Trees</span>
<span class="s0">#</span>
<span class="s0">########################################################################</span>

<span class="s2">def </span><span class="s1">printTree</span><span class="s3">(</span><span class="s1">tree</span><span class="s3">, </span><span class="s1">indent</span><span class="s3">):</span>
    <span class="s1">spacing </span><span class="s3">= </span><span class="s4">&quot;                                                        &quot;</span><span class="s3">[:</span><span class="s1">indent</span><span class="s3">]</span>
    <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">tree</span><span class="s3">, </span><span class="s1">tuple</span><span class="s3">) </span><span class="s2">and </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">tree</span><span class="s3">[</span><span class="s5">0</span><span class="s3">], </span><span class="s1">int</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">tree</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] </span><span class="s2">in </span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">sym_name</span><span class="s3">:</span>
            <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">tree</span><span class="s3">)):</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">i</span><span class="s3">==</span><span class="s5">0</span><span class="s3">):</span>
                    <span class="s1">print</span><span class="s3">(</span><span class="s1">spacing </span><span class="s3">+ </span><span class="s4">&quot;(symbol.&quot; </span><span class="s3">+ </span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">sym_name</span><span class="s3">[</span><span class="s1">tree</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]] + </span><span class="s4">&quot;,&quot;</span><span class="s3">)</span>
                <span class="s2">else</span><span class="s3">:</span>
                    <span class="s1">printTree</span><span class="s3">(</span><span class="s1">tree</span><span class="s3">[</span><span class="s1">i</span><span class="s3">], </span><span class="s1">indent</span><span class="s3">+</span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s1">spacing </span><span class="s3">+ </span><span class="s4">&quot;),&quot;</span><span class="s3">)</span>
        <span class="s2">elif </span><span class="s1">tree</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] </span><span class="s2">in </span><span class="s1">token</span><span class="s3">.</span><span class="s1">tok_name</span><span class="s3">:</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s1">spacing </span><span class="s3">+ </span><span class="s4">&quot;(token.&quot; </span><span class="s3">+ </span><span class="s1">token</span><span class="s3">.</span><span class="s1">tok_name</span><span class="s3">[</span><span class="s1">tree</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]] + </span><span class="s4">&quot;, '&quot; </span><span class="s3">+ </span><span class="s1">tree</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] + </span><span class="s4">&quot;'),&quot;</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s1">spacing </span><span class="s3">+ </span><span class="s1">str</span><span class="s3">(</span><span class="s1">tree</span><span class="s3">))</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s1">spacing </span><span class="s3">+ </span><span class="s1">str</span><span class="s3">(</span><span class="s1">tree</span><span class="s3">))</span>


<span class="s1">COMPOUND_STMT_PATTERN </span><span class="s3">= (</span>
    <span class="s1">symbol</span><span class="s3">.</span><span class="s1">stmt</span><span class="s3">,</span>
    <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">compound_stmt</span><span class="s3">, [</span><span class="s4">'compound'</span><span class="s3">])</span>
    <span class="s3">)</span>


<span class="s1">DOCSTRING_STMT_PATTERN </span><span class="s3">= (</span>
    <span class="s1">symbol</span><span class="s3">.</span><span class="s1">stmt</span><span class="s3">,</span>
    <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">simple_stmt</span><span class="s3">,</span>
     <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">small_stmt</span><span class="s3">,</span>
      <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">expr_stmt</span><span class="s3">,</span>
       <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">testlist</span><span class="s3">,</span>
        <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">test</span><span class="s3">,</span>
         <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">or_test</span><span class="s3">,</span>
           <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">and_test</span><span class="s3">,</span>
            <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">not_test</span><span class="s3">,</span>
             <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">comparison</span><span class="s3">,</span>
              <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">expr</span><span class="s3">,</span>
               <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">xor_expr</span><span class="s3">,</span>
                <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">and_expr</span><span class="s3">,</span>
                 <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">shift_expr</span><span class="s3">,</span>
                  <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">arith_expr</span><span class="s3">,</span>
                   <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">term</span><span class="s3">,</span>
                    <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">factor</span><span class="s3">,</span>
                     <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">power</span><span class="s3">,</span>
                      <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">atom</span><span class="s3">,</span>
                       <span class="s3">(</span><span class="s1">token</span><span class="s3">.</span><span class="s1">STRING</span><span class="s3">, [</span><span class="s4">'docstring'</span><span class="s3">])</span>
                       <span class="s3">))))))))))))))))),</span>
     <span class="s3">(</span><span class="s1">token</span><span class="s3">.</span><span class="s1">NEWLINE</span><span class="s3">, </span><span class="s4">''</span><span class="s3">)</span>
     <span class="s3">))</span>

<span class="s1">DERIVATION_PATTERN </span><span class="s3">= (</span>
    <span class="s1">symbol</span><span class="s3">.</span><span class="s1">test</span><span class="s3">,</span>
    <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">or_test</span><span class="s3">,</span>
     <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">and_test</span><span class="s3">,</span>
      <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">not_test</span><span class="s3">,</span>
       <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">comparison</span><span class="s3">,</span>
        <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">expr</span><span class="s3">,</span>
         <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">xor_expr</span><span class="s3">,</span>
          <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">and_expr</span><span class="s3">,</span>
           <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">shift_expr</span><span class="s3">,</span>
            <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">arith_expr</span><span class="s3">,</span>
             <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">term</span><span class="s3">,</span>
              <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">factor</span><span class="s3">,</span>
               <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">power</span><span class="s3">,</span>
                <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">atom</span><span class="s3">,</span>
                 <span class="s3">(</span><span class="s1">token</span><span class="s3">.</span><span class="s1">NAME</span><span class="s3">, [</span><span class="s4">'classname'</span><span class="s3">])</span>
   <span class="s3">))))))))))))))</span>

<span class="s1">ASSIGNMENT_STMT_PATTERN </span><span class="s3">= (</span>
    <span class="s1">symbol</span><span class="s3">.</span><span class="s1">stmt</span><span class="s3">,</span>
    <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">simple_stmt</span><span class="s3">,</span>
     <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">small_stmt</span><span class="s3">,</span>
      <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">expr_stmt</span><span class="s3">,</span>
       <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">testlist</span><span class="s3">,</span>
        <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">test</span><span class="s3">,</span>
         <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">or_test</span><span class="s3">,</span>
           <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">and_test</span><span class="s3">,</span>
            <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">not_test</span><span class="s3">,</span>
             <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">comparison</span><span class="s3">,</span>
              <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">expr</span><span class="s3">,</span>
               <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">xor_expr</span><span class="s3">,</span>
                <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">and_expr</span><span class="s3">,</span>
                 <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">shift_expr</span><span class="s3">,</span>
                  <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">arith_expr</span><span class="s3">,</span>
                   <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">term</span><span class="s3">,</span>
                    <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">factor</span><span class="s3">,</span>
                     <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">power</span><span class="s3">,</span>
                      <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">atom</span><span class="s3">,</span>
                       <span class="s3">(</span><span class="s1">token</span><span class="s3">.</span><span class="s1">NAME</span><span class="s3">, [</span><span class="s4">'varname'</span><span class="s3">]),</span>
       <span class="s3">))))))))))))))),</span>
       <span class="s3">(</span><span class="s1">token</span><span class="s3">.</span><span class="s1">EQUAL</span><span class="s3">, </span><span class="s4">'='</span><span class="s3">),</span>
       <span class="s3">(</span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">testlist</span><span class="s3">, [</span><span class="s4">'rhs'</span><span class="s3">]))),</span>
     <span class="s3">(</span><span class="s1">token</span><span class="s3">.</span><span class="s1">NEWLINE</span><span class="s3">, </span><span class="s4">''</span><span class="s3">),</span>
   <span class="s3">))</span>

<span class="s2">class </span><span class="s1">ParseTreeInfo</span><span class="s3">:</span>
    <span class="s1">docstring </span><span class="s3">= </span><span class="s4">''</span>
    <span class="s1">name </span><span class="s3">= </span><span class="s4">''</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tree</span><span class="s3">, </span><span class="s1">name</span><span class="s3">, </span><span class="s1">file</span><span class="s3">):</span>
        <span class="s6">&quot;&quot;&quot; 
        The code can be a string (in which case it is parsed), or it 
        can be in parse tree form already. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">name </span><span class="s3">= </span><span class="s1">name</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">file </span><span class="s3">= </span><span class="s1">file</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">class_info </span><span class="s3">= {}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">function_info </span><span class="s3">= {}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assign_info </span><span class="s3">= {}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">derivs </span><span class="s3">= {}</span>
        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">tree</span><span class="s3">, </span><span class="s1">str</span><span class="s3">):</span>
            <span class="s2">try</span><span class="s3">:</span>
                <span class="s1">tree </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">suite</span><span class="s3">(</span><span class="s1">tree</span><span class="s3">+</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">).</span><span class="s1">totuple</span><span class="s3">()</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">tree</span><span class="s3">):</span>
                    <span class="s1">found</span><span class="s3">, </span><span class="s1">vars </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">DOCSTRING_STMT_PATTERN</span><span class="s3">, </span><span class="s1">tree</span><span class="s3">[</span><span class="s5">1</span><span class="s3">])</span>
                    <span class="s2">if </span><span class="s1">found</span><span class="s3">:</span>
                        <span class="s1">self</span><span class="s3">.</span><span class="s1">docstring </span><span class="s3">= </span><span class="s1">vars</span><span class="s3">[</span><span class="s4">&quot;docstring&quot;</span><span class="s3">]</span>
            <span class="s2">except</span><span class="s3">:</span>
                <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;CAUTION --- Parse failed: &quot; </span><span class="s3">+ </span><span class="s1">name</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">tree</span><span class="s3">, </span><span class="s1">tuple</span><span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">extract_info</span><span class="s3">(</span><span class="s1">tree</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">match</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">pattern</span><span class="s3">, </span><span class="s1">data</span><span class="s3">, </span><span class="s1">vars</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
        <span class="s6">&quot;&quot;&quot; 
        pattern 
            Pattern to match against, possibly containing variables. 
        data 
            Data to be checked and against which variables are extracted. 
        vars 
            Dictionary of variables which have already been found.  If not 
            provided, an empty dictionary is created. 
 
        The `pattern' value may contain variables of the form ['varname'] 
        which are allowed to parseTreeMatch anything.  The value that is 
        parseTreeMatched is returned as part of a dictionary which maps 
        'varname' to the parseTreeMatched value.  'varname' is not required 
        to be a string object, but using strings makes patterns and the code 
        which uses them more readable.  This function returns two values: a 
        boolean indicating whether a parseTreeMatch was found and a 
        dictionary mapping variable names to their associated values. 
        &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">vars </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">vars </span><span class="s3">= {}</span>
        <span class="s2">if </span><span class="s1">type</span><span class="s3">(</span><span class="s1">pattern</span><span class="s3">) </span><span class="s2">is </span><span class="s1">list</span><span class="s3">:       </span><span class="s0"># 'variables' are ['varname']</span>
            <span class="s1">vars</span><span class="s3">[</span><span class="s1">pattern</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]] = </span><span class="s1">data</span>
            <span class="s2">return </span><span class="s5">1</span><span class="s3">, </span><span class="s1">vars</span>
        <span class="s2">if </span><span class="s1">type</span><span class="s3">(</span><span class="s1">pattern</span><span class="s3">) </span><span class="s2">is not </span><span class="s1">tuple</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s3">(</span><span class="s1">pattern </span><span class="s3">== </span><span class="s1">data</span><span class="s3">), </span><span class="s1">vars</span>
        <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">data</span><span class="s3">) != </span><span class="s1">len</span><span class="s3">(</span><span class="s1">pattern</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s5">0</span><span class="s3">, </span><span class="s1">vars</span>
        <span class="s2">for </span><span class="s1">pattern</span><span class="s3">, </span><span class="s1">data </span><span class="s2">in </span><span class="s1">map</span><span class="s3">(</span><span class="s2">None</span><span class="s3">, </span><span class="s1">pattern</span><span class="s3">, </span><span class="s1">data</span><span class="s3">):</span>
            <span class="s1">same</span><span class="s3">, </span><span class="s1">vars </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">pattern</span><span class="s3">, </span><span class="s1">data</span><span class="s3">, </span><span class="s1">vars</span><span class="s3">)</span>
            <span class="s2">if not </span><span class="s1">same</span><span class="s3">:</span>
                <span class="s2">break</span>
        <span class="s2">return </span><span class="s1">same</span><span class="s3">, </span><span class="s1">vars</span>

    <span class="s2">def </span><span class="s1">extract_info</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tree</span><span class="s3">):</span>
        <span class="s0"># extract docstring</span>
        <span class="s1">found </span><span class="s3">= </span><span class="s5">0</span>
        <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">tree</span><span class="s3">) == </span><span class="s5">2</span><span class="s3">:</span>
            <span class="s1">found</span><span class="s3">, </span><span class="s1">vars </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">DOCSTRING_STMT_PATTERN</span><span class="s3">[</span><span class="s5">1</span><span class="s3">], </span><span class="s1">tree</span><span class="s3">[</span><span class="s5">1</span><span class="s3">])</span>
        <span class="s2">elif </span><span class="s1">len</span><span class="s3">(</span><span class="s1">tree</span><span class="s3">) &gt;= </span><span class="s5">4</span><span class="s3">:</span>
            <span class="s1">found</span><span class="s3">, </span><span class="s1">vars </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">DOCSTRING_STMT_PATTERN</span><span class="s3">, </span><span class="s1">tree</span><span class="s3">[</span><span class="s5">3</span><span class="s3">])</span>
        <span class="s2">if </span><span class="s1">found</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">docstring </span><span class="s3">= </span><span class="s1">eval</span><span class="s3">(</span><span class="s1">vars</span><span class="s3">[</span><span class="s4">'docstring'</span><span class="s3">])</span>
        <span class="s0"># discover inner definitions</span>
        <span class="s2">for </span><span class="s1">node </span><span class="s2">in </span><span class="s1">tree</span><span class="s3">[</span><span class="s5">1</span><span class="s3">:]:</span>
            <span class="s1">found</span><span class="s3">, </span><span class="s1">vars </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">ASSIGNMENT_STMT_PATTERN</span><span class="s3">, </span><span class="s1">node</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">found</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">assign_info</span><span class="s3">[</span><span class="s1">vars</span><span class="s3">[</span><span class="s4">'varname'</span><span class="s3">]] = </span><span class="s5">1</span>
            <span class="s1">found</span><span class="s3">, </span><span class="s1">vars </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">COMPOUND_STMT_PATTERN</span><span class="s3">, </span><span class="s1">node</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">found</span><span class="s3">:</span>
                <span class="s1">cstmt </span><span class="s3">= </span><span class="s1">vars</span><span class="s3">[</span><span class="s4">'compound'</span><span class="s3">]</span>
                <span class="s2">if </span><span class="s1">cstmt</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] == </span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">funcdef</span><span class="s3">:</span>
                    <span class="s1">name </span><span class="s3">= </span><span class="s1">cstmt</span><span class="s3">[</span><span class="s5">2</span><span class="s3">][</span><span class="s5">1</span><span class="s3">]</span>
                    <span class="s0"># Workaround for a weird issue with static and classmethods</span>
                    <span class="s2">if </span><span class="s1">name </span><span class="s3">== </span><span class="s4">&quot;def&quot;</span><span class="s3">:</span>
                        <span class="s1">name </span><span class="s3">= </span><span class="s1">cstmt</span><span class="s3">[</span><span class="s5">3</span><span class="s3">][</span><span class="s5">1</span><span class="s3">]</span>
                        <span class="s1">self</span><span class="s3">.</span><span class="s1">function_info</span><span class="s3">[</span><span class="s1">name</span><span class="s3">] = </span><span class="s1">ParseTreeInfo</span><span class="s3">(</span><span class="s1">cstmt </span><span class="s2">and </span><span class="s1">cstmt</span><span class="s3">[-</span><span class="s5">1</span><span class="s3">] </span><span class="s2">or None</span><span class="s3">, </span><span class="s1">name</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">file</span><span class="s3">)</span>
                        <span class="s1">self</span><span class="s3">.</span><span class="s1">function_info</span><span class="s3">[</span><span class="s1">name</span><span class="s3">].</span><span class="s1">prototype </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">extract_tokens</span><span class="s3">(</span><span class="s4">&quot;&quot;</span><span class="s3">, </span><span class="s1">cstmt</span><span class="s3">[</span><span class="s5">4</span><span class="s3">])</span>
                    <span class="s2">else</span><span class="s3">:</span>
                        <span class="s1">self</span><span class="s3">.</span><span class="s1">function_info</span><span class="s3">[</span><span class="s1">name</span><span class="s3">] = </span><span class="s1">ParseTreeInfo</span><span class="s3">(</span><span class="s1">cstmt </span><span class="s2">and </span><span class="s1">cstmt</span><span class="s3">[-</span><span class="s5">1</span><span class="s3">] </span><span class="s2">or None</span><span class="s3">, </span><span class="s1">name</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">file</span><span class="s3">)</span>
                        <span class="s1">self</span><span class="s3">.</span><span class="s1">function_info</span><span class="s3">[</span><span class="s1">name</span><span class="s3">].</span><span class="s1">prototype </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">extract_tokens</span><span class="s3">(</span><span class="s4">&quot;&quot;</span><span class="s3">, </span><span class="s1">cstmt</span><span class="s3">[</span><span class="s5">3</span><span class="s3">])</span>
                <span class="s2">elif </span><span class="s1">cstmt</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] == </span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">classdef</span><span class="s3">:</span>
                    <span class="s1">name </span><span class="s3">= </span><span class="s1">cstmt</span><span class="s3">[</span><span class="s5">2</span><span class="s3">][</span><span class="s5">1</span><span class="s3">]</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">class_info</span><span class="s3">[</span><span class="s1">name</span><span class="s3">] = </span><span class="s1">ParseTreeInfo</span><span class="s3">(</span><span class="s1">cstmt </span><span class="s2">and </span><span class="s1">cstmt</span><span class="s3">[-</span><span class="s5">1</span><span class="s3">] </span><span class="s2">or None</span><span class="s3">, </span><span class="s1">name</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">file</span><span class="s3">)</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">extract_derivs</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">class_info</span><span class="s3">[</span><span class="s1">name</span><span class="s3">], </span><span class="s1">cstmt</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">extract_derivs</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">classinfo</span><span class="s3">, </span><span class="s1">tree</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">tree</span><span class="s3">)==</span><span class="s5">8</span><span class="s3">):</span>
            <span class="s1">derivs </span><span class="s3">= </span><span class="s1">tree</span><span class="s3">[</span><span class="s5">4</span><span class="s3">]</span>
            <span class="s2">for </span><span class="s1">deriv </span><span class="s2">in </span><span class="s1">derivs</span><span class="s3">[</span><span class="s5">1</span><span class="s3">:]:</span>
                <span class="s1">found</span><span class="s3">, </span><span class="s1">vars </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">DERIVATION_PATTERN</span><span class="s3">, </span><span class="s1">deriv</span><span class="s3">)</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">found</span><span class="s3">):</span>
                    <span class="s1">classinfo</span><span class="s3">.</span><span class="s1">derivs</span><span class="s3">[</span><span class="s1">vars</span><span class="s3">[</span><span class="s4">&quot;classname&quot;</span><span class="s3">]] = </span><span class="s5">1</span>

    <span class="s2">def </span><span class="s1">extract_tokens</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">str</span><span class="s3">, </span><span class="s1">tree</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">tree</span><span class="s3">, </span><span class="s1">tuple</span><span class="s3">)):</span>
            <span class="s2">if </span><span class="s1">tree</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] </span><span class="s2">in </span><span class="s1">token</span><span class="s3">.</span><span class="s1">tok_name</span><span class="s3">:</span>
                <span class="s1">str </span><span class="s3">= </span><span class="s1">str </span><span class="s3">+ </span><span class="s1">tree</span><span class="s3">[</span><span class="s5">1</span><span class="s3">]</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">tree</span><span class="s3">[</span><span class="s5">1</span><span class="s3">]==</span><span class="s4">&quot;,&quot;</span><span class="s3">): </span><span class="s1">str</span><span class="s3">=</span><span class="s1">str</span><span class="s3">+</span><span class="s4">&quot; &quot;</span>
            <span class="s2">elif </span><span class="s1">tree</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] </span><span class="s2">in </span><span class="s1">symbol</span><span class="s3">.</span><span class="s1">sym_name</span><span class="s3">:</span>
                <span class="s2">for </span><span class="s1">sub </span><span class="s2">in </span><span class="s1">tree</span><span class="s3">[</span><span class="s5">1</span><span class="s3">:]:</span>
                    <span class="s1">str </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">extract_tokens</span><span class="s3">(</span><span class="s1">str</span><span class="s3">, </span><span class="s1">sub</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">str</span>

<span class="s0">########################################################################</span>
<span class="s0">#</span>
<span class="s0"># The code database contains:</span>
<span class="s0">#</span>
<span class="s0">#  - a list of InterrogateDatabase objects representing C++ modules.</span>
<span class="s0">#  - a list of ParseTreeInfo objects representing python modules.</span>
<span class="s0">#</span>
<span class="s0"># Collectively, these make up all the data about all the code.</span>
<span class="s0">#</span>
<span class="s0">########################################################################</span>

<span class="s2">class </span><span class="s1">CodeDatabase</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">cxxlist</span><span class="s3">, </span><span class="s1">pylist</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">types </span><span class="s3">= {}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">funcs </span><span class="s3">= {}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">goodtypes </span><span class="s3">= {}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">funcExports </span><span class="s3">= {}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">typeExports </span><span class="s3">= {}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">varExports </span><span class="s3">= {}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">globalfn </span><span class="s3">= []</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">formattedprotos </span><span class="s3">= {}</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;Reading C++ source files&quot;</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">cxx </span><span class="s2">in </span><span class="s1">cxxlist</span><span class="s3">:</span>
            <span class="s1">tokzr </span><span class="s3">= </span><span class="s1">InterrogateTokenizer</span><span class="s3">(</span><span class="s1">cxx</span><span class="s3">)</span>
            <span class="s1">idb </span><span class="s3">= </span><span class="s1">InterrogateDatabase</span><span class="s3">(</span><span class="s1">tokzr</span><span class="s3">)</span>
            <span class="s2">for </span><span class="s1">type </span><span class="s2">in </span><span class="s1">idb</span><span class="s3">.</span><span class="s1">types</span><span class="s3">.</span><span class="s1">values</span><span class="s3">():</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">type</span><span class="s3">.</span><span class="s1">flags </span><span class="s3">&amp; </span><span class="s5">8192</span><span class="s3">) </span><span class="s2">or </span><span class="s1">type</span><span class="s3">.</span><span class="s1">scopedname </span><span class="s2">not in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">types</span><span class="s3">:</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">types</span><span class="s3">[</span><span class="s1">type</span><span class="s3">.</span><span class="s1">scopedname</span><span class="s3">] = </span><span class="s1">type</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">type</span><span class="s3">.</span><span class="s1">flags </span><span class="s3">&amp; </span><span class="s5">8192</span><span class="s3">) </span><span class="s2">and </span><span class="s3">(</span><span class="s1">type</span><span class="s3">.</span><span class="s1">atomictype </span><span class="s3">== </span><span class="s5">0</span><span class="s3">) </span><span class="s2">and </span><span class="s3">(</span><span class="s1">type</span><span class="s3">.</span><span class="s1">scopedname</span><span class="s3">.</span><span class="s1">count</span><span class="s3">(</span><span class="s4">&quot; &quot;</span><span class="s3">)==</span><span class="s5">0</span><span class="s3">) </span><span class="s2">and </span><span class="s3">(</span><span class="s1">type</span><span class="s3">.</span><span class="s1">scopedname</span><span class="s3">.</span><span class="s1">count</span><span class="s3">(</span><span class="s4">&quot;:&quot;</span><span class="s3">)==</span><span class="s5">0</span><span class="s3">):</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">goodtypes</span><span class="s3">[</span><span class="s1">type</span><span class="s3">.</span><span class="s1">scopedname</span><span class="s3">] = </span><span class="s1">type</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">typeExports</span><span class="s3">.</span><span class="s1">setdefault</span><span class="s3">(</span><span class="s4">&quot;pandac.PandaModules&quot;</span><span class="s3">, []).</span><span class="s1">append</span><span class="s3">(</span><span class="s1">type</span><span class="s3">.</span><span class="s1">scopedname</span><span class="s3">)</span>
            <span class="s2">for </span><span class="s1">func </span><span class="s2">in </span><span class="s1">idb</span><span class="s3">.</span><span class="s1">functions</span><span class="s3">.</span><span class="s1">values</span><span class="s3">():</span>
                <span class="s1">type </span><span class="s3">= </span><span class="s1">idb</span><span class="s3">.</span><span class="s1">types</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">func</span><span class="s3">.</span><span class="s1">classindex</span><span class="s3">)</span>
                <span class="s1">func</span><span class="s3">.</span><span class="s1">pyname </span><span class="s3">= </span><span class="s1">convertToPythonFn</span><span class="s3">(</span><span class="s1">func</span><span class="s3">.</span><span class="s1">componentname</span><span class="s3">)</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">type </span><span class="s3">== </span><span class="s2">None</span><span class="s3">):</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">funcs</span><span class="s3">[</span><span class="s4">&quot;GLOBAL.&quot;</span><span class="s3">+</span><span class="s1">func</span><span class="s3">.</span><span class="s1">pyname</span><span class="s3">] = </span><span class="s1">func</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">globalfn</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">&quot;GLOBAL.&quot;</span><span class="s3">+</span><span class="s1">func</span><span class="s3">.</span><span class="s1">pyname</span><span class="s3">)</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">funcExports</span><span class="s3">.</span><span class="s1">setdefault</span><span class="s3">(</span><span class="s4">&quot;pandac.PandaModules&quot;</span><span class="s3">, []).</span><span class="s1">append</span><span class="s3">(</span><span class="s1">func</span><span class="s3">.</span><span class="s1">pyname</span><span class="s3">)</span>
                <span class="s2">else</span><span class="s3">:</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">funcs</span><span class="s3">[</span><span class="s1">type</span><span class="s3">.</span><span class="s1">scopedname</span><span class="s3">+</span><span class="s4">&quot;.&quot;</span><span class="s3">+</span><span class="s1">func</span><span class="s3">.</span><span class="s1">pyname</span><span class="s3">] = </span><span class="s1">func</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;Reading Python sources files&quot;</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">py </span><span class="s2">in </span><span class="s1">pylist</span><span class="s3">:</span>
            <span class="s1">pyinf </span><span class="s3">= </span><span class="s1">ParseTreeInfo</span><span class="s3">(</span><span class="s1">readFile</span><span class="s3">(</span><span class="s1">py</span><span class="s3">), </span><span class="s1">py</span><span class="s3">, </span><span class="s1">py</span><span class="s3">)</span>
            <span class="s1">mod </span><span class="s3">= </span><span class="s1">pathToModule</span><span class="s3">(</span><span class="s1">py</span><span class="s3">)</span>
            <span class="s2">for </span><span class="s1">type </span><span class="s2">in </span><span class="s1">pyinf</span><span class="s3">.</span><span class="s1">class_info</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">():</span>
                <span class="s1">typinf </span><span class="s3">= </span><span class="s1">pyinf</span><span class="s3">.</span><span class="s1">class_info</span><span class="s3">[</span><span class="s1">type</span><span class="s3">]</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">types</span><span class="s3">[</span><span class="s1">type</span><span class="s3">] = </span><span class="s1">typinf</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">goodtypes</span><span class="s3">[</span><span class="s1">type</span><span class="s3">] = </span><span class="s1">typinf</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">typeExports</span><span class="s3">.</span><span class="s1">setdefault</span><span class="s3">(</span><span class="s1">mod</span><span class="s3">, []).</span><span class="s1">append</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)</span>
                <span class="s2">for </span><span class="s1">func </span><span class="s2">in </span><span class="s1">typinf</span><span class="s3">.</span><span class="s1">function_info</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">():</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">funcs</span><span class="s3">[</span><span class="s1">type</span><span class="s3">+</span><span class="s4">&quot;.&quot;</span><span class="s3">+</span><span class="s1">func</span><span class="s3">] = </span><span class="s1">typinf</span><span class="s3">.</span><span class="s1">function_info</span><span class="s3">[</span><span class="s1">func</span><span class="s3">]</span>
            <span class="s2">for </span><span class="s1">func </span><span class="s2">in </span><span class="s1">pyinf</span><span class="s3">.</span><span class="s1">function_info</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">():</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">funcs</span><span class="s3">[</span><span class="s4">&quot;GLOBAL.&quot;</span><span class="s3">+</span><span class="s1">func</span><span class="s3">] = </span><span class="s1">pyinf</span><span class="s3">.</span><span class="s1">function_info</span><span class="s3">[</span><span class="s1">func</span><span class="s3">]</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">globalfn</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">&quot;GLOBAL.&quot;</span><span class="s3">+</span><span class="s1">func</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">funcExports</span><span class="s3">.</span><span class="s1">setdefault</span><span class="s3">(</span><span class="s1">mod</span><span class="s3">, []).</span><span class="s1">append</span><span class="s3">(</span><span class="s1">func</span><span class="s3">)</span>
            <span class="s2">for </span><span class="s1">var </span><span class="s2">in </span><span class="s1">pyinf</span><span class="s3">.</span><span class="s1">assign_info</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">():</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">varExports</span><span class="s3">.</span><span class="s1">setdefault</span><span class="s3">(</span><span class="s1">mod</span><span class="s3">, []).</span><span class="s1">append</span><span class="s3">(</span><span class="s1">var</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">getClassList</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">list</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">goodtypes</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">())</span>

    <span class="s2">def </span><span class="s1">getGlobalFunctionList</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">globalfn</span>

    <span class="s2">def </span><span class="s1">getClassComment</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">cn</span><span class="s3">):</span>
        <span class="s1">type </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">types</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">cn</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">InterrogateType</span><span class="s3">)):</span>
            <span class="s2">return </span><span class="s1">textToHTML</span><span class="s3">(</span><span class="s1">type</span><span class="s3">.</span><span class="s1">comment</span><span class="s3">,</span><span class="s4">&quot;/&quot;</span><span class="s3">)</span>
        <span class="s2">elif </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">ParseTreeInfo</span><span class="s3">)):</span>
            <span class="s2">return </span><span class="s1">textToHTML</span><span class="s3">(</span><span class="s1">type</span><span class="s3">.</span><span class="s1">docstring</span><span class="s3">,</span><span class="s4">&quot;#&quot;</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s4">&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">getClassParents</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">cn</span><span class="s3">):</span>
        <span class="s1">type </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">types</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">cn</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">InterrogateType</span><span class="s3">)):</span>
            <span class="s1">parents </span><span class="s3">= []</span>
            <span class="s2">for </span><span class="s1">deriv </span><span class="s2">in </span><span class="s1">type</span><span class="s3">.</span><span class="s1">derivations</span><span class="s3">:</span>
                <span class="s1">basetype </span><span class="s3">= </span><span class="s1">type</span><span class="s3">.</span><span class="s1">db</span><span class="s3">.</span><span class="s1">types</span><span class="s3">[</span><span class="s1">deriv</span><span class="s3">.</span><span class="s1">base</span><span class="s3">]</span>
                <span class="s1">parents</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">basetype</span><span class="s3">.</span><span class="s1">scopedname</span><span class="s3">)</span>
            <span class="s2">return </span><span class="s1">parents</span>
        <span class="s2">elif </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">ParseTreeInfo</span><span class="s3">)):</span>
            <span class="s2">return </span><span class="s1">list</span><span class="s3">(</span><span class="s1">type</span><span class="s3">.</span><span class="s1">derivs</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">())</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s3">[]</span>

    <span class="s2">def </span><span class="s1">getClassConstants</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">cn</span><span class="s3">):</span>
        <span class="s1">type </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">types</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">cn</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">InterrogateType</span><span class="s3">)):</span>
            <span class="s1">result </span><span class="s3">= []</span>
            <span class="s2">for </span><span class="s1">subtype </span><span class="s2">in </span><span class="s1">type</span><span class="s3">.</span><span class="s1">nested</span><span class="s3">:</span>
                <span class="s1">enumtype </span><span class="s3">= </span><span class="s1">type</span><span class="s3">.</span><span class="s1">db</span><span class="s3">.</span><span class="s1">types</span><span class="s3">[</span><span class="s1">subtype</span><span class="s3">]</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">enumtype</span><span class="s3">.</span><span class="s1">enumvalues</span><span class="s3">)):</span>
                    <span class="s2">for </span><span class="s1">enumvalue </span><span class="s2">in </span><span class="s1">enumtype</span><span class="s3">.</span><span class="s1">enumvalues</span><span class="s3">:</span>
                        <span class="s1">name </span><span class="s3">= </span><span class="s1">convertToPythonFn</span><span class="s3">(</span><span class="s1">enumvalue</span><span class="s3">.</span><span class="s1">name</span><span class="s3">)</span>
                        <span class="s1">result</span><span class="s3">.</span><span class="s1">append</span><span class="s3">((</span><span class="s1">name</span><span class="s3">, </span><span class="s4">&quot;(&quot;</span><span class="s3">+</span><span class="s1">enumtype</span><span class="s3">.</span><span class="s1">componentname</span><span class="s3">+</span><span class="s4">&quot;)&quot;</span><span class="s3">))</span>
                    <span class="s1">result</span><span class="s3">.</span><span class="s1">append</span><span class="s3">((</span><span class="s4">&quot;&quot;</span><span class="s3">,</span><span class="s4">&quot;&quot;</span><span class="s3">))</span>
            <span class="s2">return </span><span class="s1">result</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s3">[]</span>

    <span class="s2">def </span><span class="s1">buildInheritance</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">inheritance</span><span class="s3">, </span><span class="s1">cn</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">inheritance</span><span class="s3">.</span><span class="s1">count</span><span class="s3">(</span><span class="s1">cn</span><span class="s3">) == </span><span class="s5">0</span><span class="s3">):</span>
            <span class="s1">inheritance</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">cn</span><span class="s3">)</span>
            <span class="s2">for </span><span class="s1">parent </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">getClassParents</span><span class="s3">(</span><span class="s1">cn</span><span class="s3">):</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">buildInheritance</span><span class="s3">(</span><span class="s1">inheritance</span><span class="s3">, </span><span class="s1">parent</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">getInheritance</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">cn</span><span class="s3">):</span>
        <span class="s1">inheritance </span><span class="s3">= []</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">buildInheritance</span><span class="s3">(</span><span class="s1">inheritance</span><span class="s3">, </span><span class="s1">cn</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">inheritance</span>

    <span class="s2">def </span><span class="s1">getClassImport</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">cn</span><span class="s3">):</span>
        <span class="s1">type </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">types</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">cn</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">InterrogateType</span><span class="s3">)):</span>
            <span class="s2">return </span><span class="s4">&quot;pandac.PandaModules&quot;</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">pathToModule</span><span class="s3">(</span><span class="s1">type</span><span class="s3">.</span><span class="s1">file</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">getClassConstructors</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">cn</span><span class="s3">):</span>
        <span class="s0"># Only detects C++ constructors, not Python constructors, since</span>
        <span class="s0"># those are treated as ordinary methods.</span>
        <span class="s1">type </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">types</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">cn</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= []</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">InterrogateType</span><span class="s3">)):</span>
            <span class="s2">for </span><span class="s1">constructor </span><span class="s2">in </span><span class="s1">type</span><span class="s3">.</span><span class="s1">constructors</span><span class="s3">:</span>
                <span class="s1">func </span><span class="s3">= </span><span class="s1">type</span><span class="s3">.</span><span class="s1">db</span><span class="s3">.</span><span class="s1">functions</span><span class="s3">[</span><span class="s1">constructor</span><span class="s3">]</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">func</span><span class="s3">.</span><span class="s1">classindex </span><span class="s3">== </span><span class="s1">type</span><span class="s3">.</span><span class="s1">index</span><span class="s3">):</span>
                    <span class="s1">result</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">type</span><span class="s3">.</span><span class="s1">scopedname</span><span class="s3">+</span><span class="s4">&quot;.&quot;</span><span class="s3">+</span><span class="s1">func</span><span class="s3">.</span><span class="s1">pyname</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">result</span>

    <span class="s2">def </span><span class="s1">getClassMethods</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">cn</span><span class="s3">):</span>
        <span class="s1">type </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">types</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">cn</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= []</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">InterrogateType</span><span class="s3">)):</span>
            <span class="s2">for </span><span class="s1">method </span><span class="s2">in </span><span class="s1">type</span><span class="s3">.</span><span class="s1">methods</span><span class="s3">:</span>
                <span class="s1">func </span><span class="s3">= </span><span class="s1">type</span><span class="s3">.</span><span class="s1">db</span><span class="s3">.</span><span class="s1">functions</span><span class="s3">[</span><span class="s1">method</span><span class="s3">]</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">func</span><span class="s3">.</span><span class="s1">classindex </span><span class="s3">== </span><span class="s1">type</span><span class="s3">.</span><span class="s1">index</span><span class="s3">):</span>
                    <span class="s1">result</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">type</span><span class="s3">.</span><span class="s1">scopedname</span><span class="s3">+</span><span class="s4">&quot;.&quot;</span><span class="s3">+</span><span class="s1">func</span><span class="s3">.</span><span class="s1">pyname</span><span class="s3">)</span>
        <span class="s2">elif </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">ParseTreeInfo</span><span class="s3">)):</span>
            <span class="s2">for </span><span class="s1">method </span><span class="s2">in </span><span class="s1">type</span><span class="s3">.</span><span class="s1">function_info</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">():</span>
                <span class="s1">result</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">type</span><span class="s3">.</span><span class="s1">name </span><span class="s3">+ </span><span class="s4">&quot;.&quot; </span><span class="s3">+ </span><span class="s1">method</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">result</span>

    <span class="s2">def </span><span class="s1">getFunctionName</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">fn</span><span class="s3">):</span>
        <span class="s1">func </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">funcs</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">func</span><span class="s3">, </span><span class="s1">InterrogateFunction</span><span class="s3">)):</span>
            <span class="s2">return </span><span class="s1">func</span><span class="s3">.</span><span class="s1">pyname</span>
        <span class="s2">elif </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">func</span><span class="s3">, </span><span class="s1">ParseTreeInfo</span><span class="s3">)):</span>
            <span class="s2">return </span><span class="s1">func</span><span class="s3">.</span><span class="s1">name</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">fn</span>

    <span class="s2">def </span><span class="s1">getFunctionImport</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">fn</span><span class="s3">):</span>
        <span class="s1">func </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">funcs</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">func</span><span class="s3">, </span><span class="s1">InterrogateFunction</span><span class="s3">)):</span>
            <span class="s2">return </span><span class="s4">&quot;pandac.PandaModules&quot;</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">pathToModule</span><span class="s3">(</span><span class="s1">func</span><span class="s3">.</span><span class="s1">file</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">getFunctionPrototype</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">fn</span><span class="s3">, </span><span class="s1">urlprefix</span><span class="s3">, </span><span class="s1">urlsuffix</span><span class="s3">):</span>
        <span class="s1">func </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">funcs</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">func</span><span class="s3">, </span><span class="s1">InterrogateFunction</span><span class="s3">)):</span>
            <span class="s2">if </span><span class="s1">fn </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formattedprotos</span><span class="s3">:</span>
                <span class="s1">proto </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formattedprotos</span><span class="s3">[</span><span class="s1">fn</span><span class="s3">]</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">proto </span><span class="s3">= </span><span class="s1">func</span><span class="s3">.</span><span class="s1">prototype</span>
                <span class="s1">proto </span><span class="s3">= </span><span class="s1">proto</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot; inline &quot;</span><span class="s3">,</span><span class="s4">&quot; &quot;</span><span class="s3">)</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">proto</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s4">&quot;inline &quot;</span><span class="s3">)): </span><span class="s1">proto </span><span class="s3">= </span><span class="s1">proto</span><span class="s3">[</span><span class="s5">7</span><span class="s3">:]</span>
                <span class="s1">proto </span><span class="s3">= </span><span class="s1">proto</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;basic_string&lt; char &gt;&quot;</span><span class="s3">, </span><span class="s4">&quot;string&quot;</span><span class="s3">)</span>
                <span class="s1">proto </span><span class="s3">= </span><span class="s1">textToHTML</span><span class="s3">(</span><span class="s1">proto</span><span class="s3">,</span><span class="s4">&quot;&quot;</span><span class="s3">)</span>
                <span class="s2">if </span><span class="s4">&quot;.&quot; </span><span class="s2">in </span><span class="s1">fn</span><span class="s3">:</span>
                    <span class="s2">for </span><span class="s1">c </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">goodtypes</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">():</span>
                        <span class="s2">if </span><span class="s1">c </span><span class="s3">!= </span><span class="s1">fn</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s4">&quot;.&quot;</span><span class="s3">)[</span><span class="s5">0</span><span class="s3">] </span><span class="s2">and </span><span class="s3">(</span><span class="s1">c </span><span class="s2">in </span><span class="s1">proto</span><span class="s3">):</span>
                            <span class="s1">proto </span><span class="s3">= </span><span class="s1">re</span><span class="s3">.</span><span class="s1">sub</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">b%s</span><span class="s2">\\</span><span class="s4">b&quot; </span><span class="s3">% </span><span class="s1">c</span><span class="s3">, </span><span class="s1">linkTo</span><span class="s3">(</span><span class="s1">urlprefix</span><span class="s3">+</span><span class="s1">c</span><span class="s3">+</span><span class="s1">urlsuffix</span><span class="s3">, </span><span class="s1">c</span><span class="s3">), </span><span class="s1">proto</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">formattedprotos</span><span class="s3">[</span><span class="s1">fn</span><span class="s3">] = </span><span class="s1">proto</span>
            <span class="s2">return </span><span class="s1">proto</span>
        <span class="s2">elif </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">func</span><span class="s3">, </span><span class="s1">ParseTreeInfo</span><span class="s3">)):</span>
            <span class="s2">return </span><span class="s1">textToHTML</span><span class="s3">(</span><span class="s4">&quot;def &quot;</span><span class="s3">+</span><span class="s1">func</span><span class="s3">.</span><span class="s1">name</span><span class="s3">+</span><span class="s1">func</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">,</span><span class="s4">&quot;&quot;</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">fn</span>

    <span class="s2">def </span><span class="s1">getFunctionComment</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">fn</span><span class="s3">):</span>
        <span class="s1">func </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">funcs</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">func</span><span class="s3">, </span><span class="s1">InterrogateFunction</span><span class="s3">)):</span>
            <span class="s2">return </span><span class="s1">textToHTML</span><span class="s3">(</span><span class="s1">removeFileLicense</span><span class="s3">(</span><span class="s1">func</span><span class="s3">.</span><span class="s1">comment</span><span class="s3">), </span><span class="s4">&quot;/&quot;</span><span class="s3">, </span><span class="s1">JUNKHEADER</span><span class="s3">)</span>
        <span class="s2">elif </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">func</span><span class="s3">, </span><span class="s1">ParseTreeInfo</span><span class="s3">)):</span>
            <span class="s2">return </span><span class="s1">textToHTML</span><span class="s3">(</span><span class="s1">func</span><span class="s3">.</span><span class="s1">docstring</span><span class="s3">, </span><span class="s4">&quot;#&quot;</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">fn</span>

    <span class="s2">def </span><span class="s1">isFunctionPython</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">fn</span><span class="s3">):</span>
        <span class="s1">func </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">funcs</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">func</span><span class="s3">, </span><span class="s1">InterrogateFunction</span><span class="s3">)):</span>
            <span class="s2">return False</span>
        <span class="s2">elif </span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">func</span><span class="s3">, </span><span class="s1">ParseTreeInfo</span><span class="s3">)):</span>
            <span class="s2">return True</span>
        <span class="s2">return False</span>

    <span class="s2">def </span><span class="s1">getFuncExports</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">mod</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">funcExports</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">mod</span><span class="s3">, [])</span>

    <span class="s2">def </span><span class="s1">getTypeExports</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">mod</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">typeExports</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">mod</span><span class="s3">, [])</span>

    <span class="s2">def </span><span class="s1">getVarExports</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">mod</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">varExports</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">mod</span><span class="s3">, [])</span>

<span class="s0">########################################################################</span>
<span class="s0">#</span>
<span class="s0"># The &quot;Class Rename Dictionary&quot; - Yech.</span>
<span class="s0">#</span>
<span class="s0">########################################################################</span>

<span class="s1">CLASS_RENAME_DICT </span><span class="s3">= {</span>
    <span class="s0"># No longer used, now empty.</span>
<span class="s3">}</span>


<span class="s0">########################################################################</span>
<span class="s0">#</span>
<span class="s0"># HTML generation</span>
<span class="s0">#</span>
<span class="s0">########################################################################</span>

<span class="s2">def </span><span class="s1">makeCodeDatabase</span><span class="s3">(</span><span class="s1">indirlist</span><span class="s3">, </span><span class="s1">directdirlist</span><span class="s3">):</span>
    <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">directdirlist</span><span class="s3">, </span><span class="s1">str</span><span class="s3">):</span>
        <span class="s1">directdirlist </span><span class="s3">= [</span><span class="s1">directdirlist</span><span class="s3">]</span>
    <span class="s1">ignore </span><span class="s3">= {}</span>
    <span class="s1">ignore</span><span class="s3">[</span><span class="s4">&quot;__init__.py&quot;</span><span class="s3">] = </span><span class="s5">1</span>
    <span class="s2">for </span><span class="s1">directdir </span><span class="s2">in </span><span class="s1">directdirlist</span><span class="s3">:</span>
        <span class="s1">ignore</span><span class="s3">[</span><span class="s1">directdir </span><span class="s3">+ </span><span class="s4">&quot;/src/directscripts&quot;</span><span class="s3">] = </span><span class="s5">1</span>
        <span class="s1">ignore</span><span class="s3">[</span><span class="s1">directdir </span><span class="s3">+ </span><span class="s4">&quot;/src/extensions&quot;</span><span class="s3">] = </span><span class="s5">1</span>
        <span class="s1">ignore</span><span class="s3">[</span><span class="s1">directdir </span><span class="s3">+ </span><span class="s4">&quot;/src/extensions_native&quot;</span><span class="s3">] = </span><span class="s5">1</span>
        <span class="s1">ignore</span><span class="s3">[</span><span class="s1">directdir </span><span class="s3">+ </span><span class="s4">&quot;/src/ffi&quot;</span><span class="s3">] = </span><span class="s5">1</span>
        <span class="s1">ignore</span><span class="s3">[</span><span class="s1">directdir </span><span class="s3">+ </span><span class="s4">&quot;/built&quot;</span><span class="s3">] = </span><span class="s5">1</span>
    <span class="s1">cxxfiles </span><span class="s3">= []</span>
    <span class="s1">pyfiles </span><span class="s3">= []</span>
    <span class="s1">findFiles</span><span class="s3">(</span><span class="s1">indirlist</span><span class="s3">,     </span><span class="s4">&quot;.in&quot;</span><span class="s3">, </span><span class="s1">ignore</span><span class="s3">, </span><span class="s1">cxxfiles</span><span class="s3">)</span>
    <span class="s1">findFiles</span><span class="s3">(</span><span class="s1">directdirlist</span><span class="s3">, </span><span class="s4">&quot;.py&quot;</span><span class="s3">, </span><span class="s1">ignore</span><span class="s3">, </span><span class="s1">pyfiles</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">CodeDatabase</span><span class="s3">(</span><span class="s1">cxxfiles</span><span class="s3">, </span><span class="s1">pyfiles</span><span class="s3">)</span>

<span class="s2">def </span><span class="s1">generateFunctionDocs</span><span class="s3">(</span><span class="s1">code</span><span class="s3">, </span><span class="s1">method</span><span class="s3">, </span><span class="s1">urlprefix</span><span class="s3">, </span><span class="s1">urlsuffix</span><span class="s3">):</span>
    <span class="s1">name </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getFunctionName</span><span class="s3">(</span><span class="s1">method</span><span class="s3">)</span>
    <span class="s1">proto </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getFunctionPrototype</span><span class="s3">(</span><span class="s1">method</span><span class="s3">, </span><span class="s1">urlprefix</span><span class="s3">, </span><span class="s1">urlsuffix</span><span class="s3">)</span>
    <span class="s1">comment </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getFunctionComment</span><span class="s3">(</span><span class="s1">method</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">comment </span><span class="s3">== </span><span class="s4">&quot;&quot;</span><span class="s3">): </span><span class="s1">comment </span><span class="s3">= </span><span class="s4">&quot;Undocumented function.&lt;br&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">chunk </span><span class="s3">= </span><span class="s4">'&lt;table bgcolor=&quot;e8e8e8&quot; border=0 cellspacing=0 cellpadding=5 width=&quot;100%&quot;&gt;&lt;tr&gt;&lt;td&gt;' </span><span class="s3">+ </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">chunk </span><span class="s3">= </span><span class="s1">chunk </span><span class="s3">+ </span><span class="s4">'&lt;a name=&quot;' </span><span class="s3">+ </span><span class="s1">name </span><span class="s3">+ </span><span class="s4">'&quot;&gt;&lt;b&gt;' </span><span class="s3">+ </span><span class="s1">name </span><span class="s3">+ </span><span class="s4">&quot;&lt;/b&gt;&lt;/a&gt;&lt;br&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">chunk </span><span class="s3">= </span><span class="s1">chunk </span><span class="s3">+ </span><span class="s1">proto </span><span class="s3">+ </span><span class="s4">&quot;&lt;br&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">chunk </span><span class="s3">= </span><span class="s1">chunk </span><span class="s3">+ </span><span class="s1">comment</span>
    <span class="s1">chunk </span><span class="s3">= </span><span class="s1">chunk </span><span class="s3">+ </span><span class="s4">&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;br&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s2">return </span><span class="s1">chunk</span>

<span class="s2">def </span><span class="s1">generateLinkTable</span><span class="s3">(</span><span class="s1">link</span><span class="s3">, </span><span class="s1">text</span><span class="s3">, </span><span class="s1">cols</span><span class="s3">, </span><span class="s1">urlprefix</span><span class="s3">, </span><span class="s1">urlsuffix</span><span class="s3">):</span>
    <span class="s1">column </span><span class="s3">= (</span><span class="s1">len</span><span class="s3">(</span><span class="s1">link</span><span class="s3">)+</span><span class="s1">cols</span><span class="s3">-</span><span class="s5">1</span><span class="s3">)/</span><span class="s1">cols</span>
    <span class="s1">percent </span><span class="s3">= </span><span class="s5">100 </span><span class="s3">/ </span><span class="s1">cols</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s4">'&lt;table width=&quot;100%&quot;&gt;</span><span class="s2">\n</span><span class="s4">'</span>
    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">column</span><span class="s3">):</span>
        <span class="s1">line </span><span class="s3">= </span><span class="s4">&quot;&quot;</span>
        <span class="s2">for </span><span class="s1">j </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">cols</span><span class="s3">):</span>
            <span class="s1">slot </span><span class="s3">= </span><span class="s1">i </span><span class="s3">+ </span><span class="s1">column</span><span class="s3">*</span><span class="s1">j</span>
            <span class="s1">linkval </span><span class="s3">= </span><span class="s4">&quot;&quot;</span>
            <span class="s1">textval </span><span class="s3">= </span><span class="s4">&quot;&quot;</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">slot </span><span class="s3">&lt; </span><span class="s1">len</span><span class="s3">(</span><span class="s1">link</span><span class="s3">)): </span><span class="s1">linkval </span><span class="s3">= </span><span class="s1">link</span><span class="s3">[</span><span class="s1">slot</span><span class="s3">]</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">slot </span><span class="s3">&lt; </span><span class="s1">len</span><span class="s3">(</span><span class="s1">text</span><span class="s3">)): </span><span class="s1">textval </span><span class="s3">= </span><span class="s1">text</span><span class="s3">[</span><span class="s1">slot</span><span class="s3">]</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">i</span><span class="s3">==</span><span class="s5">0</span><span class="s3">):</span>
                <span class="s1">line </span><span class="s3">= </span><span class="s1">line </span><span class="s3">+ </span><span class="s4">'&lt;td width=&quot;' </span><span class="s3">+ </span><span class="s1">str</span><span class="s3">(</span><span class="s1">percent</span><span class="s3">) + </span><span class="s4">'%&quot;&gt;' </span><span class="s3">+ </span><span class="s1">linkTo</span><span class="s3">(</span><span class="s1">urlprefix</span><span class="s3">+</span><span class="s1">linkval</span><span class="s3">+</span><span class="s1">urlsuffix</span><span class="s3">, </span><span class="s1">textval</span><span class="s3">) + </span><span class="s4">&quot;&lt;/td&gt;&quot;</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">line </span><span class="s3">= </span><span class="s1">line </span><span class="s3">+ </span><span class="s4">'&lt;td&gt;' </span><span class="s3">+ </span><span class="s1">linkTo</span><span class="s3">(</span><span class="s1">urlprefix</span><span class="s3">+</span><span class="s1">linkval</span><span class="s3">+</span><span class="s1">urlsuffix</span><span class="s3">, </span><span class="s1">textval</span><span class="s3">) + </span><span class="s4">&quot;&lt;/td&gt;&quot;</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">result </span><span class="s3">+ </span><span class="s4">&quot;&lt;tr&gt;&quot; </span><span class="s3">+ </span><span class="s1">line </span><span class="s3">+ </span><span class="s4">&quot;&lt;/tr&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">result </span><span class="s3">+ </span><span class="s4">&quot;&lt;/table&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s2">return </span><span class="s1">result</span>

<span class="s2">def </span><span class="s1">generate</span><span class="s3">(</span><span class="s1">pversion</span><span class="s3">, </span><span class="s1">indirlist</span><span class="s3">, </span><span class="s1">directdirlist</span><span class="s3">, </span><span class="s1">docdir</span><span class="s3">, </span><span class="s1">header</span><span class="s3">, </span><span class="s1">footer</span><span class="s3">, </span><span class="s1">urlprefix</span><span class="s3">, </span><span class="s1">urlsuffix</span><span class="s3">):</span>
    <span class="s1">code </span><span class="s3">= </span><span class="s1">makeCodeDatabase</span><span class="s3">(</span><span class="s1">indirlist</span><span class="s3">, </span><span class="s1">directdirlist</span><span class="s3">)</span>
    <span class="s1">classes </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getClassList</span><span class="s3">()[:]</span>
    <span class="s1">classes</span><span class="s3">.</span><span class="s1">sort</span><span class="s3">(</span><span class="s2">None</span><span class="s3">, </span><span class="s1">str</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">)</span>
    <span class="s1">xclasses </span><span class="s3">= </span><span class="s1">classes</span><span class="s3">[:]</span>
    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;Generating HTML pages&quot;</span><span class="s3">)</span>
    <span class="s2">for </span><span class="s1">type </span><span class="s2">in </span><span class="s1">classes</span><span class="s3">:</span>
        <span class="s1">body </span><span class="s3">= </span><span class="s4">&quot;&lt;h1&gt;&quot; </span><span class="s3">+ </span><span class="s1">type </span><span class="s3">+ </span><span class="s4">&quot;&lt;/h1&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
        <span class="s1">comment </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getClassComment</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)</span>
        <span class="s1">body </span><span class="s3">= </span><span class="s1">body </span><span class="s3">+ </span><span class="s4">&quot;&lt;ul&gt;</span><span class="s2">\n</span><span class="s4">from &quot; </span><span class="s3">+ </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getClassImport</span><span class="s3">(</span><span class="s1">type</span><span class="s3">) + </span><span class="s4">&quot; import &quot; </span><span class="s3">+ </span><span class="s1">type </span><span class="s3">+ </span><span class="s4">&quot;&lt;/ul&gt;</span><span class="s2">\n\n</span><span class="s4">&quot;</span>
        <span class="s1">body </span><span class="s3">= </span><span class="s1">body </span><span class="s3">+ </span><span class="s4">&quot;&lt;ul&gt;</span><span class="s2">\n</span><span class="s4">&quot; </span><span class="s3">+ </span><span class="s1">comment </span><span class="s3">+ </span><span class="s4">&quot;&lt;/ul&gt;</span><span class="s2">\n\n</span><span class="s4">&quot;</span>
        <span class="s1">inheritance </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getInheritance</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)</span>
        <span class="s1">body </span><span class="s3">= </span><span class="s1">body </span><span class="s3">+ </span><span class="s4">&quot;&lt;h2&gt;Inheritance:&lt;/h2&gt;</span><span class="s2">\n</span><span class="s4">&lt;ul&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
        <span class="s2">for </span><span class="s1">inh </span><span class="s2">in </span><span class="s1">inheritance</span><span class="s3">:</span>
            <span class="s1">line </span><span class="s3">= </span><span class="s4">&quot;  &quot; </span><span class="s3">+ </span><span class="s1">linkTo</span><span class="s3">(</span><span class="s1">urlprefix</span><span class="s3">+</span><span class="s1">inh</span><span class="s3">+</span><span class="s1">urlsuffix</span><span class="s3">, </span><span class="s1">inh</span><span class="s3">) + </span><span class="s4">&quot;: &quot;</span>
            <span class="s2">for </span><span class="s1">parent </span><span class="s2">in </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getClassParents</span><span class="s3">(</span><span class="s1">inh</span><span class="s3">):</span>
                <span class="s1">line </span><span class="s3">= </span><span class="s1">line </span><span class="s3">+ </span><span class="s1">linkTo</span><span class="s3">(</span><span class="s1">urlprefix</span><span class="s3">+</span><span class="s1">parent</span><span class="s3">+</span><span class="s1">urlsuffix</span><span class="s3">, </span><span class="s1">parent</span><span class="s3">) + </span><span class="s4">&quot; &quot;</span>
            <span class="s1">body </span><span class="s3">= </span><span class="s1">body </span><span class="s3">+ </span><span class="s1">line </span><span class="s3">+ </span><span class="s4">&quot;&lt;br&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
        <span class="s1">body </span><span class="s3">= </span><span class="s1">body </span><span class="s3">+ </span><span class="s4">&quot;&lt;/ul&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
        <span class="s2">for </span><span class="s1">sclass </span><span class="s2">in </span><span class="s1">inheritance</span><span class="s3">:</span>
            <span class="s1">methods </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getClassMethods</span><span class="s3">(</span><span class="s1">sclass</span><span class="s3">)[:]</span>
            <span class="s1">methods</span><span class="s3">.</span><span class="s1">sort</span><span class="s3">(</span><span class="s2">None</span><span class="s3">, </span><span class="s1">str</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">)</span>
            <span class="s1">constructors </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getClassConstructors</span><span class="s3">(</span><span class="s1">sclass</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">methods</span><span class="s3">) &gt; </span><span class="s5">0 </span><span class="s2">or </span><span class="s1">len</span><span class="s3">(</span><span class="s1">constructors</span><span class="s3">) &gt; </span><span class="s5">0</span><span class="s3">):</span>
                <span class="s1">body </span><span class="s3">= </span><span class="s1">body </span><span class="s3">+ </span><span class="s4">&quot;&lt;h2&gt;Methods of &quot;</span><span class="s3">+</span><span class="s1">sclass</span><span class="s3">+</span><span class="s4">&quot;:&lt;/h2&gt;</span><span class="s2">\n</span><span class="s4">&lt;ul&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
                <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">constructors</span><span class="s3">) &gt; </span><span class="s5">0</span><span class="s3">:</span>
                    <span class="s1">fn </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getFunctionName</span><span class="s3">(</span><span class="s1">constructors</span><span class="s3">[</span><span class="s5">0</span><span class="s3">])</span>
                    <span class="s1">body </span><span class="s3">= </span><span class="s1">body </span><span class="s3">+ </span><span class="s4">'&lt;a href=&quot;#' </span><span class="s3">+ </span><span class="s1">fn </span><span class="s3">+ </span><span class="s4">'&quot;&gt;' </span><span class="s3">+ </span><span class="s1">fn </span><span class="s3">+ </span><span class="s4">&quot; (Constructor)&lt;/a&gt;&lt;br&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
                <span class="s2">for </span><span class="s1">method </span><span class="s2">in </span><span class="s1">methods</span><span class="s3">:</span>
                    <span class="s1">fn </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getFunctionName</span><span class="s3">(</span><span class="s1">method</span><span class="s3">)</span>
                    <span class="s1">body </span><span class="s3">= </span><span class="s1">body </span><span class="s3">+ </span><span class="s4">'&lt;a href=&quot;#' </span><span class="s3">+ </span><span class="s1">fn </span><span class="s3">+ </span><span class="s4">'&quot;&gt;' </span><span class="s3">+ </span><span class="s1">fn </span><span class="s3">+ </span><span class="s4">&quot;&lt;/a&gt;&lt;br&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
                <span class="s1">body </span><span class="s3">= </span><span class="s1">body </span><span class="s3">+ </span><span class="s4">&quot;&lt;/ul&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
        <span class="s2">for </span><span class="s1">sclass </span><span class="s2">in </span><span class="s1">inheritance</span><span class="s3">:</span>
            <span class="s1">enums </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getClassConstants</span><span class="s3">(</span><span class="s1">sclass</span><span class="s3">)[:]</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">enums</span><span class="s3">) &gt; </span><span class="s5">0</span><span class="s3">):</span>
                <span class="s1">body </span><span class="s3">= </span><span class="s1">body </span><span class="s3">+ </span><span class="s4">&quot;&lt;h2&gt;Constants in &quot;</span><span class="s3">+</span><span class="s1">sclass</span><span class="s3">+</span><span class="s4">&quot;:&lt;/h2&gt;</span><span class="s2">\n</span><span class="s4">&lt;ul&gt;&lt;table&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
                <span class="s2">for </span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">comment</span><span class="s3">) </span><span class="s2">in </span><span class="s1">enums</span><span class="s3">:</span>
                    <span class="s1">body </span><span class="s3">= </span><span class="s1">body </span><span class="s3">+ </span><span class="s4">&quot;&lt;tr&gt;&lt;td&gt;&quot; </span><span class="s3">+ </span><span class="s1">value </span><span class="s3">+ </span><span class="s4">&quot;&lt;/td&gt;&lt;td&gt;&quot; </span><span class="s3">+ </span><span class="s1">comment </span><span class="s3">+ </span><span class="s4">&quot;&lt;/td&gt;&lt;/tr&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
                <span class="s1">body </span><span class="s3">= </span><span class="s1">body </span><span class="s3">+ </span><span class="s4">&quot;&lt;/table&gt;&lt;/ul&gt;&quot;</span>
        <span class="s2">for </span><span class="s1">sclass </span><span class="s2">in </span><span class="s1">inheritance</span><span class="s3">:</span>
            <span class="s1">constructors </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getClassConstructors</span><span class="s3">(</span><span class="s1">sclass</span><span class="s3">)</span>
            <span class="s2">for </span><span class="s1">constructor </span><span class="s2">in </span><span class="s1">constructors</span><span class="s3">:</span>
                <span class="s1">body </span><span class="s3">= </span><span class="s1">body </span><span class="s3">+ </span><span class="s1">generateFunctionDocs</span><span class="s3">(</span><span class="s1">code</span><span class="s3">, </span><span class="s1">constructor</span><span class="s3">, </span><span class="s1">urlprefix</span><span class="s3">, </span><span class="s1">urlsuffix</span><span class="s3">)</span>
            <span class="s1">methods </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getClassMethods</span><span class="s3">(</span><span class="s1">sclass</span><span class="s3">)[:]</span>
            <span class="s1">methods</span><span class="s3">.</span><span class="s1">sort</span><span class="s3">(</span><span class="s2">None</span><span class="s3">, </span><span class="s1">str</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">)</span>
            <span class="s2">for </span><span class="s1">method </span><span class="s2">in </span><span class="s1">methods</span><span class="s3">:</span>
                <span class="s1">body </span><span class="s3">= </span><span class="s1">body </span><span class="s3">+ </span><span class="s1">generateFunctionDocs</span><span class="s3">(</span><span class="s1">code</span><span class="s3">, </span><span class="s1">method</span><span class="s3">, </span><span class="s1">urlprefix</span><span class="s3">, </span><span class="s1">urlsuffix</span><span class="s3">)</span>
        <span class="s1">body </span><span class="s3">= </span><span class="s1">header </span><span class="s3">+ </span><span class="s1">body </span><span class="s3">+ </span><span class="s1">footer</span>
        <span class="s1">writeFile</span><span class="s3">(</span><span class="s1">docdir </span><span class="s3">+ </span><span class="s4">&quot;/&quot; </span><span class="s3">+ </span><span class="s1">type </span><span class="s3">+ </span><span class="s4">&quot;.html&quot;</span><span class="s3">, </span><span class="s1">body</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">type </span><span class="s2">in </span><span class="s1">CLASS_RENAME_DICT</span><span class="s3">:</span>
            <span class="s1">modtype </span><span class="s3">= </span><span class="s1">CLASS_RENAME_DICT</span><span class="s3">[</span><span class="s1">type</span><span class="s3">]</span>
            <span class="s1">writeFile</span><span class="s3">(</span><span class="s1">docdir </span><span class="s3">+ </span><span class="s4">&quot;/&quot; </span><span class="s3">+ </span><span class="s1">modtype </span><span class="s3">+ </span><span class="s4">&quot;.html&quot;</span><span class="s3">, </span><span class="s1">body</span><span class="s3">)</span>
            <span class="s1">xclasses</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">modtype</span><span class="s3">)</span>
    <span class="s1">xclasses</span><span class="s3">.</span><span class="s1">sort</span><span class="s3">(</span><span class="s2">None</span><span class="s3">, </span><span class="s1">str</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">)</span>

    <span class="s1">index </span><span class="s3">= </span><span class="s4">&quot;&lt;h1&gt;List of Classes - Panda &quot; </span><span class="s3">+ </span><span class="s1">pversion </span><span class="s3">+ </span><span class="s4">&quot;&lt;/h1&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s1">generateLinkTable</span><span class="s3">(</span><span class="s1">xclasses</span><span class="s3">, </span><span class="s1">xclasses</span><span class="s3">, </span><span class="s5">3</span><span class="s3">, </span><span class="s1">urlprefix</span><span class="s3">, </span><span class="s1">urlsuffix</span><span class="s3">)</span>
    <span class="s1">fnlist </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getGlobalFunctionList</span><span class="s3">()[:]</span>
    <span class="s1">fnlist</span><span class="s3">.</span><span class="s1">sort</span><span class="s3">(</span><span class="s2">None</span><span class="s3">, </span><span class="s1">str</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">)</span>
    <span class="s1">fnnames </span><span class="s3">= []</span>
    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">fnlist</span><span class="s3">)):</span>
        <span class="s1">fnnames</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">code</span><span class="s3">.</span><span class="s1">getFunctionName</span><span class="s3">(</span><span class="s1">fnlist</span><span class="s3">[</span><span class="s1">i</span><span class="s3">]))</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s1">header </span><span class="s3">+ </span><span class="s1">index </span><span class="s3">+ </span><span class="s1">footer</span>
    <span class="s1">writeFile</span><span class="s3">(</span><span class="s1">docdir </span><span class="s3">+ </span><span class="s4">&quot;/classes.html&quot;</span><span class="s3">, </span><span class="s1">index</span><span class="s3">)</span>

    <span class="s1">index </span><span class="s3">= </span><span class="s4">&quot;&lt;h1&gt;List of Global Functions - Panda &quot; </span><span class="s3">+ </span><span class="s1">pversion </span><span class="s3">+ </span><span class="s4">&quot;&lt;/h1&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s1">generateLinkTable</span><span class="s3">(</span><span class="s1">fnnames</span><span class="s3">, </span><span class="s1">fnnames</span><span class="s3">, </span><span class="s5">3</span><span class="s3">,</span><span class="s4">&quot;#&quot;</span><span class="s3">,</span><span class="s4">&quot;&quot;</span><span class="s3">)</span>
    <span class="s2">for </span><span class="s1">func </span><span class="s2">in </span><span class="s1">fnlist</span><span class="s3">:</span>
        <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s1">generateFunctionDocs</span><span class="s3">(</span><span class="s1">code</span><span class="s3">, </span><span class="s1">func</span><span class="s3">, </span><span class="s1">urlprefix</span><span class="s3">, </span><span class="s1">urlsuffix</span><span class="s3">)</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s1">header </span><span class="s3">+ </span><span class="s1">index </span><span class="s3">+ </span><span class="s1">footer</span>
    <span class="s1">writeFile</span><span class="s3">(</span><span class="s1">docdir </span><span class="s3">+ </span><span class="s4">&quot;/functions.html&quot;</span><span class="s3">, </span><span class="s1">index</span><span class="s3">)</span>

    <span class="s1">table </span><span class="s3">= {}</span>
    <span class="s2">for </span><span class="s1">type </span><span class="s2">in </span><span class="s1">classes</span><span class="s3">:</span>
        <span class="s2">for </span><span class="s1">method </span><span class="s2">in </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getClassMethods</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)[:]:</span>
            <span class="s1">name </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getFunctionName</span><span class="s3">(</span><span class="s1">method</span><span class="s3">)</span>
            <span class="s1">prefix </span><span class="s3">= </span><span class="s1">name</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">upper</span><span class="s3">()</span>
            <span class="s2">if </span><span class="s1">prefix </span><span class="s2">not in </span><span class="s1">table</span><span class="s3">:</span>
                <span class="s1">table</span><span class="s3">[</span><span class="s1">prefix</span><span class="s3">] = {}</span>
            <span class="s2">if </span><span class="s1">name </span><span class="s2">not in </span><span class="s1">table</span><span class="s3">[</span><span class="s1">prefix</span><span class="s3">]:</span>
                <span class="s1">table</span><span class="s3">[</span><span class="s1">prefix</span><span class="s3">][</span><span class="s1">name</span><span class="s3">] = []</span>
            <span class="s1">table</span><span class="s3">[</span><span class="s1">prefix</span><span class="s3">][</span><span class="s1">name</span><span class="s3">].</span><span class="s1">append</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)</span>

    <span class="s1">index </span><span class="s3">= </span><span class="s4">&quot;&lt;h1&gt;List of Methods - Panda &quot; </span><span class="s3">+ </span><span class="s1">pversion </span><span class="s3">+ </span><span class="s4">&quot;&lt;/h1&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>

    <span class="s1">prefixes </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span><span class="s1">table</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">())</span>
    <span class="s1">prefixes</span><span class="s3">.</span><span class="s1">sort</span><span class="s3">(</span><span class="s2">None</span><span class="s3">, </span><span class="s1">str</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">)</span>
    <span class="s2">for </span><span class="s1">prefix </span><span class="s2">in </span><span class="s1">prefixes</span><span class="s3">:</span>
        <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s1">linkTo</span><span class="s3">(</span><span class="s4">&quot;#&quot;</span><span class="s3">+</span><span class="s1">prefix</span><span class="s3">, </span><span class="s1">prefix</span><span class="s3">) + </span><span class="s4">&quot; &quot;</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s4">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>
    <span class="s2">for </span><span class="s1">prefix </span><span class="s2">in </span><span class="s1">prefixes</span><span class="s3">:</span>
        <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s4">'&lt;a name=&quot;' </span><span class="s3">+ </span><span class="s1">prefix </span><span class="s3">+ </span><span class="s4">'&quot;&gt;' </span><span class="s3">+ </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span>
        <span class="s1">names </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span><span class="s1">table</span><span class="s3">[</span><span class="s1">prefix</span><span class="s3">].</span><span class="s1">keys</span><span class="s3">())</span>
        <span class="s1">names</span><span class="s3">.</span><span class="s1">sort</span><span class="s3">(</span><span class="s2">None</span><span class="s3">, </span><span class="s1">str</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">name </span><span class="s2">in </span><span class="s1">names</span><span class="s3">:</span>
            <span class="s1">line </span><span class="s3">= </span><span class="s4">'&lt;b&gt;' </span><span class="s3">+ </span><span class="s1">name </span><span class="s3">+ </span><span class="s4">&quot;:&lt;/b&gt;&lt;ul&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
            <span class="s1">ctypes </span><span class="s3">= </span><span class="s1">table</span><span class="s3">[</span><span class="s1">prefix</span><span class="s3">][</span><span class="s1">name</span><span class="s3">]</span>
            <span class="s1">ctypes</span><span class="s3">.</span><span class="s1">sort</span><span class="s3">(</span><span class="s2">None</span><span class="s3">, </span><span class="s1">str</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">)</span>
            <span class="s2">for </span><span class="s1">type </span><span class="s2">in </span><span class="s1">ctypes</span><span class="s3">:</span>
                <span class="s1">line </span><span class="s3">= </span><span class="s1">line </span><span class="s3">+ </span><span class="s4">&quot;&lt;li&gt;&quot; </span><span class="s3">+ </span><span class="s1">linkTo</span><span class="s3">(</span><span class="s1">urlprefix</span><span class="s3">+</span><span class="s1">type</span><span class="s3">+</span><span class="s1">urlsuffix</span><span class="s3">+</span><span class="s4">&quot;#&quot;</span><span class="s3">+</span><span class="s1">name</span><span class="s3">, </span><span class="s1">type</span><span class="s3">) + </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span>
            <span class="s1">line </span><span class="s3">= </span><span class="s1">line </span><span class="s3">+ </span><span class="s4">&quot;&lt;/ul&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
            <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s1">line </span><span class="s3">+ </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s1">header </span><span class="s3">+ </span><span class="s1">index </span><span class="s3">+ </span><span class="s1">footer</span>
    <span class="s1">writeFile</span><span class="s3">(</span><span class="s1">docdir </span><span class="s3">+ </span><span class="s4">&quot;/methods.html&quot;</span><span class="s3">, </span><span class="s1">index</span><span class="s3">)</span>

    <span class="s1">index </span><span class="s3">= </span><span class="s4">&quot;&lt;h1&gt;Panda &quot; </span><span class="s3">+ </span><span class="s1">pversion </span><span class="s3">+ </span><span class="s4">&quot;&lt;/h1&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s4">&quot;&lt;ul&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s4">&quot;&lt;li&gt;&quot; </span><span class="s3">+ </span><span class="s1">linkTo</span><span class="s3">(</span><span class="s1">urlprefix</span><span class="s3">+</span><span class="s4">&quot;classes&quot;</span><span class="s3">+</span><span class="s1">urlsuffix</span><span class="s3">, </span><span class="s4">&quot;List of all Classes&quot;</span><span class="s3">) + </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s4">&quot;&lt;/ul&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s4">&quot;&lt;ul&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s4">&quot;&lt;li&gt;&quot; </span><span class="s3">+ </span><span class="s1">linkTo</span><span class="s3">(</span><span class="s1">urlprefix</span><span class="s3">+</span><span class="s4">&quot;functions&quot;</span><span class="s3">+</span><span class="s1">urlsuffix</span><span class="s3">, </span><span class="s4">&quot;List of all Global Functions&quot;</span><span class="s3">) + </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s4">&quot;&lt;/ul&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s4">&quot;&lt;ul&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s4">&quot;&lt;li&gt;&quot; </span><span class="s3">+ </span><span class="s1">linkTo</span><span class="s3">(</span><span class="s1">urlprefix</span><span class="s3">+</span><span class="s4">&quot;methods&quot;</span><span class="s3">+</span><span class="s1">urlsuffix</span><span class="s3">, </span><span class="s4">&quot;List of all Methods (very long)&quot;</span><span class="s3">) + </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">index </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s4">&quot;&lt;/ul&gt;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">writeFile</span><span class="s3">(</span><span class="s1">docdir </span><span class="s3">+ </span><span class="s4">&quot;/index.html&quot;</span><span class="s3">, </span><span class="s1">index</span><span class="s3">)</span>


<span class="s0">########################################################################</span>
<span class="s0">#</span>
<span class="s0"># IMPORT repair</span>
<span class="s0">#</span>
<span class="s0">########################################################################</span>

<span class="s2">def </span><span class="s1">expandImports</span><span class="s3">(</span><span class="s1">indirlist</span><span class="s3">, </span><span class="s1">directdirlist</span><span class="s3">, </span><span class="s1">fixdirlist</span><span class="s3">):</span>
    <span class="s1">code </span><span class="s3">= </span><span class="s1">makeCodeDatabase</span><span class="s3">(</span><span class="s1">indirlist</span><span class="s3">, </span><span class="s1">directdirlist</span><span class="s3">)</span>
    <span class="s1">fixfiles </span><span class="s3">= []</span>
    <span class="s1">findFiles</span><span class="s3">(</span><span class="s1">fixdirlist</span><span class="s3">, </span><span class="s4">&quot;.py&quot;</span><span class="s3">, {}, </span><span class="s1">fixfiles</span><span class="s3">)</span>
    <span class="s2">for </span><span class="s1">fixfile </span><span class="s2">in </span><span class="s1">fixfiles</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">isfile</span><span class="s3">(</span><span class="s1">fixfile</span><span class="s3">+</span><span class="s4">&quot;.orig&quot;</span><span class="s3">)):</span>
            <span class="s1">text </span><span class="s3">= </span><span class="s1">readFile</span><span class="s3">(</span><span class="s1">fixfile</span><span class="s3">+</span><span class="s4">&quot;.orig&quot;</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">text </span><span class="s3">= </span><span class="s1">readFile</span><span class="s3">(</span><span class="s1">fixfile</span><span class="s3">)</span>
            <span class="s1">writeFile</span><span class="s3">(</span><span class="s1">fixfile</span><span class="s3">+</span><span class="s4">&quot;.orig&quot;</span><span class="s3">, </span><span class="s1">text</span><span class="s3">)</span>
        <span class="s1">text </span><span class="s3">= </span><span class="s1">text</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\r</span><span class="s4">&quot;</span><span class="s3">,</span><span class="s4">&quot;&quot;</span><span class="s3">)</span>
        <span class="s1">lines </span><span class="s3">= </span><span class="s1">text</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">)</span>
        <span class="s1">used </span><span class="s3">= {}</span>
        <span class="s2">for </span><span class="s1">id </span><span class="s2">in </span><span class="s1">IDENTIFIER</span><span class="s3">.</span><span class="s1">findall</span><span class="s3">(</span><span class="s1">text</span><span class="s3">):</span>
            <span class="s1">used</span><span class="s3">[</span><span class="s1">id</span><span class="s3">] = </span><span class="s5">1</span>
        <span class="s1">result </span><span class="s3">= []</span>
        <span class="s2">for </span><span class="s1">line </span><span class="s2">in </span><span class="s1">lines</span><span class="s3">:</span>
            <span class="s1">mat </span><span class="s3">= </span><span class="s1">IMPORTSTAR</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">line</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">mat</span><span class="s3">):</span>
                <span class="s1">module </span><span class="s3">= </span><span class="s1">mat</span><span class="s3">.</span><span class="s1">group</span><span class="s3">(</span><span class="s5">1</span><span class="s3">)</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">fixfile</span><span class="s3">.</span><span class="s1">count</span><span class="s3">(</span><span class="s4">&quot;/&quot;</span><span class="s3">)!=</span><span class="s5">0</span><span class="s3">) </span><span class="s2">and </span><span class="s3">(</span><span class="s1">module</span><span class="s3">.</span><span class="s1">count</span><span class="s3">(</span><span class="s4">&quot;.&quot;</span><span class="s3">)==</span><span class="s5">0</span><span class="s3">):</span>
                    <span class="s1">modfile </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">dirname</span><span class="s3">(</span><span class="s1">fixfile</span><span class="s3">)+</span><span class="s4">&quot;/&quot;</span><span class="s3">+</span><span class="s1">module</span><span class="s3">+</span><span class="s4">&quot;.py&quot;</span>
                    <span class="s2">if </span><span class="s3">(</span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">isfile</span><span class="s3">(</span><span class="s1">modfile</span><span class="s3">)):</span>
                        <span class="s1">module </span><span class="s3">= </span><span class="s1">pathToModule</span><span class="s3">(</span><span class="s1">modfile</span><span class="s3">)</span>
                <span class="s1">typeExports </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getTypeExports</span><span class="s3">(</span><span class="s1">module</span><span class="s3">)</span>
                <span class="s1">funcExports </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getFuncExports</span><span class="s3">(</span><span class="s1">module</span><span class="s3">)</span>
                <span class="s1">varExports </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getVarExports</span><span class="s3">(</span><span class="s1">module</span><span class="s3">)</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">typeExports</span><span class="s3">)+</span><span class="s1">len</span><span class="s3">(</span><span class="s1">funcExports</span><span class="s3">)+</span><span class="s1">len</span><span class="s3">(</span><span class="s1">varExports</span><span class="s3">)==</span><span class="s5">0</span><span class="s3">):</span>
                    <span class="s1">result</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">line</span><span class="s3">)</span>
                    <span class="s1">print</span><span class="s3">(</span><span class="s1">fixfile </span><span class="s3">+ </span><span class="s4">&quot; : &quot; </span><span class="s3">+ </span><span class="s1">module </span><span class="s3">+ </span><span class="s4">&quot; : no exports&quot;</span><span class="s3">)</span>
                <span class="s2">else</span><span class="s3">:</span>
                    <span class="s1">print</span><span class="s3">(</span><span class="s1">fixfile </span><span class="s3">+ </span><span class="s4">&quot; : &quot; </span><span class="s3">+ </span><span class="s1">module </span><span class="s3">+ </span><span class="s4">&quot; : repairing&quot;</span><span class="s3">)</span>
                    <span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">funcExports</span><span class="s3">:</span>
                        <span class="s1">fn </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">getFunctionName</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>
                        <span class="s2">if </span><span class="s1">fn </span><span class="s2">in </span><span class="s1">used</span><span class="s3">:</span>
                            <span class="s1">result</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">&quot;from &quot;</span><span class="s3">+</span><span class="s1">module</span><span class="s3">+</span><span class="s4">&quot; import &quot;</span><span class="s3">+</span><span class="s1">fn</span><span class="s3">)</span>
                    <span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">typeExports</span><span class="s3">:</span>
                        <span class="s2">if </span><span class="s1">x </span><span class="s2">in </span><span class="s1">used</span><span class="s3">:</span>
                            <span class="s1">result</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">&quot;from &quot;</span><span class="s3">+</span><span class="s1">module</span><span class="s3">+</span><span class="s4">&quot; import &quot;</span><span class="s3">+</span><span class="s1">x</span><span class="s3">)</span>
                    <span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">varExports</span><span class="s3">:</span>
                        <span class="s2">if </span><span class="s1">x </span><span class="s2">in </span><span class="s1">used</span><span class="s3">:</span>
                            <span class="s1">result</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">&quot;from &quot;</span><span class="s3">+</span><span class="s1">module</span><span class="s3">+</span><span class="s4">&quot; import &quot;</span><span class="s3">+</span><span class="s1">x</span><span class="s3">)</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">result</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">line</span><span class="s3">)</span>
        <span class="s1">writeFileLines</span><span class="s3">(</span><span class="s1">fixfile</span><span class="s3">, </span><span class="s1">result</span><span class="s3">)</span>
</pre>
</body>
</html>
<html>
<head>
<title>ControlManager.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #bcbec4;}
.s1 { color: #cf8e6d;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #2aacb8;}
.s5 { color: #6aab73;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
ControlManager.py</font>
</center></td></tr></table>
<pre>
<span class="s1">from </span><span class="s0">direct</span><span class="s2">.</span><span class="s0">showbase</span><span class="s2">.</span><span class="s0">InputStateGlobal </span><span class="s1">import </span><span class="s0">inputState</span>
<span class="s3">#from DirectGui import *</span>
<span class="s3">#from PythonUtil import *</span>
<span class="s3">#from IntervalGlobal import *</span>

<span class="s3">#from otp.avatar import Avatar</span>
<span class="s1">from </span><span class="s0">direct</span><span class="s2">.</span><span class="s0">directnotify </span><span class="s1">import </span><span class="s0">DirectNotifyGlobal</span>
<span class="s3">#import GhostWalker</span>
<span class="s3">#import GravityWalker</span>
<span class="s3">#import NonPhysicsWalker</span>
<span class="s3">#import PhysicsWalker</span>
<span class="s3">#if __debug__:</span>
<span class="s3">#    import DevWalker</span>
<span class="s1">from </span><span class="s0">direct</span><span class="s2">.</span><span class="s0">task </span><span class="s1">import </span><span class="s0">Task</span>
<span class="s1">from </span><span class="s0">panda3d</span><span class="s2">.</span><span class="s0">core </span><span class="s1">import </span><span class="s0">ConfigVariableBool</span>

<span class="s3"># This is a hack, it may be better to use a line instead of a ray.</span>
<span class="s0">CollisionHandlerRayStart </span><span class="s2">= </span><span class="s4">4000.0</span>


<span class="s1">class </span><span class="s0">ControlManager</span><span class="s2">:</span>
    <span class="s0">notify </span><span class="s2">= </span><span class="s0">DirectNotifyGlobal</span><span class="s2">.</span><span class="s0">directNotify</span><span class="s2">.</span><span class="s0">newCategory</span><span class="s2">(</span><span class="s5">&quot;ControlManager&quot;</span><span class="s2">)</span>
    <span class="s0">wantWASD </span><span class="s2">= </span><span class="s0">ConfigVariableBool</span><span class="s2">(</span><span class="s5">'want-WASD'</span><span class="s2">, </span><span class="s1">False</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">__init__</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">enable</span><span class="s2">=</span><span class="s1">True</span><span class="s2">, </span><span class="s0">passMessagesThrough </span><span class="s2">= </span><span class="s1">False</span><span class="s2">):</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debug</span><span class="s2">(</span><span class="s5">&quot;init control manager %s&quot; </span><span class="s2">% (</span><span class="s0">passMessagesThrough</span><span class="s2">))</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debugCall</span><span class="s2">(</span><span class="s0">id</span><span class="s2">(</span><span class="s0">self</span><span class="s2">))</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">passMessagesThrough </span><span class="s2">= </span><span class="s0">passMessagesThrough</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">inputStateTokens </span><span class="s2">= []</span>
        <span class="s3"># Used to switch between strafe and turn. We will reset to whatever was last set.</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">WASDTurnTokens </span><span class="s2">= []</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">__WASDTurn </span><span class="s2">= </span><span class="s1">True</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">controls </span><span class="s2">= {}</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls </span><span class="s2">= </span><span class="s1">None</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControlsName </span><span class="s2">= </span><span class="s1">None</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">isEnabled </span><span class="s2">= </span><span class="s4">0</span>
        <span class="s1">if </span><span class="s0">enable</span><span class="s2">:</span>
            <span class="s0">self</span><span class="s2">.</span><span class="s0">enable</span><span class="s2">()</span>
        <span class="s3">#self.monitorTask = taskMgr.add(self.monitor, &quot;ControlManager-%s&quot;%(id(self)), priority=-1)</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">forceAvJumpToken </span><span class="s2">= </span><span class="s1">None</span>



        <span class="s1">if </span><span class="s0">self</span><span class="s2">.</span><span class="s0">passMessagesThrough</span><span class="s2">: </span><span class="s3"># for not breaking toontown</span>
            <span class="s0">ist</span><span class="s2">=</span><span class="s0">self</span><span class="s2">.</span><span class="s0">inputStateTokens</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;forward&quot;</span><span class="s2">, </span><span class="s5">&quot;arrow_up&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">ArrowKeys</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;reverse&quot;</span><span class="s2">, </span><span class="s5">&quot;arrow_down&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">ArrowKeys</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;turnLeft&quot;</span><span class="s2">, </span><span class="s5">&quot;arrow_left&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">ArrowKeys</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;turnRight&quot;</span><span class="s2">, </span><span class="s5">&quot;arrow_right&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">ArrowKeys</span><span class="s2">))</span>


    <span class="s1">def </span><span class="s0">__str__</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">return </span><span class="s5">'ControlManager: using </span><span class="s1">\'</span><span class="s5">%s</span><span class="s1">\'</span><span class="s5">' </span><span class="s2">% </span><span class="s0">self</span><span class="s2">.</span><span class="s0">currentControlsName</span>

    <span class="s1">def </span><span class="s0">add</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">controls</span><span class="s2">, </span><span class="s0">name</span><span class="s2">=</span><span class="s5">&quot;basic&quot;</span><span class="s2">):</span>
        <span class="s6">&quot;&quot;&quot;Add a control instance to the list of available control systems. 
 
        Args: 
            controls: an avatar control system. 
            name (str): any key that you want to use to refer to the controls 
                later (e.g. using the use(&lt;name&gt;) call). 
 
        See also: :meth:`use()`. 
        &quot;&quot;&quot;</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debugCall</span><span class="s2">(</span><span class="s0">id</span><span class="s2">(</span><span class="s0">self</span><span class="s2">))</span>
        <span class="s1">assert </span><span class="s0">controls </span><span class="s1">is not None</span>
        <span class="s0">oldControls </span><span class="s2">= </span><span class="s0">self</span><span class="s2">.</span><span class="s0">controls</span><span class="s2">.</span><span class="s0">get</span><span class="s2">(</span><span class="s0">name</span><span class="s2">)</span>
        <span class="s1">if </span><span class="s0">oldControls </span><span class="s1">is not None</span><span class="s2">:</span>
            <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debug</span><span class="s2">(</span><span class="s5">&quot;Replacing controls: %s&quot; </span><span class="s2">% </span><span class="s0">name</span><span class="s2">)</span>
            <span class="s0">oldControls</span><span class="s2">.</span><span class="s0">disableAvatarControls</span><span class="s2">()</span>
            <span class="s0">oldControls</span><span class="s2">.</span><span class="s0">setCollisionsActive</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)</span>
            <span class="s0">oldControls</span><span class="s2">.</span><span class="s0">delete</span><span class="s2">()</span>
        <span class="s0">controls</span><span class="s2">.</span><span class="s0">disableAvatarControls</span><span class="s2">()</span>
        <span class="s0">controls</span><span class="s2">.</span><span class="s0">setCollisionsActive</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">controls</span><span class="s2">[</span><span class="s0">name</span><span class="s2">] = </span><span class="s0">controls</span>

    <span class="s1">def </span><span class="s0">get</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">name</span><span class="s2">):</span>
        <span class="s1">return </span><span class="s0">self</span><span class="s2">.</span><span class="s0">controls</span><span class="s2">.</span><span class="s0">get</span><span class="s2">(</span><span class="s0">name</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">remove</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">name</span><span class="s2">):</span>
        <span class="s6">&quot;&quot;&quot;Remove a control instance from the list of available control 
        systems. 
 
        Args: 
            name: any key that was used to refer to the controls when they were 
                added (e.g. using the add(&lt;controls&gt;, &lt;name&gt;) call). 
 
        See also: :meth:`add()`. 
        &quot;&quot;&quot;</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debugCall</span><span class="s2">(</span><span class="s0">id</span><span class="s2">(</span><span class="s0">self</span><span class="s2">))</span>
        <span class="s0">oldControls </span><span class="s2">= </span><span class="s0">self</span><span class="s2">.</span><span class="s0">controls</span><span class="s2">.</span><span class="s0">pop</span><span class="s2">(</span><span class="s0">name</span><span class="s2">,</span><span class="s1">None</span><span class="s2">)</span>
        <span class="s1">if </span><span class="s0">oldControls </span><span class="s1">is not None</span><span class="s2">:</span>
            <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debug</span><span class="s2">(</span><span class="s5">&quot;Removing controls: %s&quot; </span><span class="s2">% </span><span class="s0">name</span><span class="s2">)</span>
            <span class="s0">oldControls</span><span class="s2">.</span><span class="s0">disableAvatarControls</span><span class="s2">()</span>
            <span class="s0">oldControls</span><span class="s2">.</span><span class="s0">setCollisionsActive</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)</span>

    <span class="s1">if __debug__</span><span class="s2">:</span>
        <span class="s1">def </span><span class="s0">lockControls</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
            <span class="s0">self</span><span class="s2">.</span><span class="s0">ignoreUse</span><span class="s2">=</span><span class="s1">True</span>

        <span class="s1">def </span><span class="s0">unlockControls</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
            <span class="s1">if </span><span class="s0">hasattr</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s5">&quot;ignoreUse&quot;</span><span class="s2">):</span>
                <span class="s1">del </span><span class="s0">self</span><span class="s2">.</span><span class="s0">ignoreUse</span>

    <span class="s1">def </span><span class="s0">use</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">name</span><span class="s2">, </span><span class="s0">avatar</span><span class="s2">):</span>
        <span class="s6">&quot;&quot;&quot; 
        name is a key (string) that was previously passed to add(). 
 
        Use a previously added control system. 
 
        See also: :meth:`add()`. 
        &quot;&quot;&quot;</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debugCall</span><span class="s2">(</span><span class="s0">id</span><span class="s2">(</span><span class="s0">self</span><span class="s2">))</span>
        <span class="s1">if __debug__ and </span><span class="s0">hasattr</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s5">&quot;ignoreUse&quot;</span><span class="s2">):</span>
            <span class="s1">return</span>
        <span class="s0">controls </span><span class="s2">= </span><span class="s0">self</span><span class="s2">.</span><span class="s0">controls</span><span class="s2">.</span><span class="s0">get</span><span class="s2">(</span><span class="s0">name</span><span class="s2">)</span>

        <span class="s1">if </span><span class="s0">controls </span><span class="s1">is not None</span><span class="s2">:</span>
            <span class="s1">if </span><span class="s0">controls </span><span class="s1">is not </span><span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">:</span>
                <span class="s1">if </span><span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls </span><span class="s1">is not None</span><span class="s2">:</span>
                    <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">.</span><span class="s0">disableAvatarControls</span><span class="s2">()</span>
                    <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">.</span><span class="s0">setCollisionsActive</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)</span>
                    <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">.</span><span class="s0">setAvatar</span><span class="s2">(</span><span class="s1">None</span><span class="s2">)</span>
                <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls </span><span class="s2">= </span><span class="s0">controls</span>
                <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControlsName </span><span class="s2">= </span><span class="s0">name</span>
                <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">.</span><span class="s0">setAvatar</span><span class="s2">(</span><span class="s0">avatar</span><span class="s2">)</span>
                <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">.</span><span class="s0">setCollisionsActive</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>
                <span class="s1">if </span><span class="s0">self</span><span class="s2">.</span><span class="s0">isEnabled</span><span class="s2">:</span>
                    <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">.</span><span class="s0">enableAvatarControls</span><span class="s2">()</span>
                <span class="s0">messenger</span><span class="s2">.</span><span class="s0">send</span><span class="s2">(</span><span class="s5">'use-%s-controls'</span><span class="s2">%(</span><span class="s0">name</span><span class="s2">,), [</span><span class="s0">avatar</span><span class="s2">])</span>
            <span class="s3">#else:</span>
            <span class="s3">#    print &quot;Controls are already&quot;, name</span>
        <span class="s1">else</span><span class="s2">:</span>
            <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debug</span><span class="s2">(</span><span class="s5">&quot;Unkown controls: %s&quot; </span><span class="s2">% </span><span class="s0">name</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">setSpeeds</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">forwardSpeed</span><span class="s2">, </span><span class="s0">jumpForce</span><span class="s2">,</span>
            <span class="s0">reverseSpeed</span><span class="s2">, </span><span class="s0">rotateSpeed</span><span class="s2">, </span><span class="s0">strafeLeft</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s0">strafeRight</span><span class="s2">=</span><span class="s4">0</span><span class="s2">):</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debugCall</span><span class="s2">(</span><span class="s0">id</span><span class="s2">(</span><span class="s0">self</span><span class="s2">))</span>
        <span class="s1">for </span><span class="s0">controls </span><span class="s1">in </span><span class="s0">self</span><span class="s2">.</span><span class="s0">controls</span><span class="s2">.</span><span class="s0">values</span><span class="s2">():</span>
            <span class="s0">controls</span><span class="s2">.</span><span class="s0">setWalkSpeed</span><span class="s2">(</span>
                <span class="s0">forwardSpeed</span><span class="s2">, </span><span class="s0">jumpForce</span><span class="s2">, </span><span class="s0">reverseSpeed</span><span class="s2">, </span><span class="s0">rotateSpeed</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">delete</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debugCall</span><span class="s2">(</span><span class="s0">id</span><span class="s2">(</span><span class="s0">self</span><span class="s2">))</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">disable</span><span class="s2">()</span>
        <span class="s1">for </span><span class="s0">controls </span><span class="s1">in </span><span class="s0">list</span><span class="s2">(</span><span class="s0">self</span><span class="s2">.</span><span class="s0">controls</span><span class="s2">.</span><span class="s0">keys</span><span class="s2">()):</span>
            <span class="s0">self</span><span class="s2">.</span><span class="s0">remove</span><span class="s2">(</span><span class="s0">controls</span><span class="s2">)</span>
        <span class="s1">del </span><span class="s0">self</span><span class="s2">.</span><span class="s0">controls</span>
        <span class="s1">del </span><span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span>

        <span class="s1">for </span><span class="s0">token </span><span class="s1">in </span><span class="s0">self</span><span class="s2">.</span><span class="s0">inputStateTokens</span><span class="s2">:</span>
            <span class="s0">token</span><span class="s2">.</span><span class="s0">release</span><span class="s2">()</span>

        <span class="s1">for </span><span class="s0">token </span><span class="s1">in </span><span class="s0">self</span><span class="s2">.</span><span class="s0">WASDTurnTokens</span><span class="s2">:</span>
            <span class="s0">token</span><span class="s2">.</span><span class="s0">release</span><span class="s2">()</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">WASDTurnTokens </span><span class="s2">= []</span>

        <span class="s3">#self.monitorTask.remove()</span>

    <span class="s1">def </span><span class="s0">getSpeeds</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">if </span><span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">:</span>
            <span class="s1">return </span><span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">.</span><span class="s0">getSpeeds</span><span class="s2">()</span>
        <span class="s1">return None</span>

    <span class="s1">def </span><span class="s0">getIsAirborne</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">if </span><span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">:</span>
            <span class="s1">return </span><span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">.</span><span class="s0">getIsAirborne</span><span class="s2">()</span>
        <span class="s1">return False</span>

    <span class="s1">def </span><span class="s0">setTag</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">key</span><span class="s2">, </span><span class="s0">value</span><span class="s2">):</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debugCall</span><span class="s2">(</span><span class="s0">id</span><span class="s2">(</span><span class="s0">self</span><span class="s2">))</span>
        <span class="s1">for </span><span class="s0">controls </span><span class="s1">in </span><span class="s0">self</span><span class="s2">.</span><span class="s0">controls</span><span class="s2">.</span><span class="s0">values</span><span class="s2">():</span>
            <span class="s0">controls</span><span class="s2">.</span><span class="s0">setTag</span><span class="s2">(</span><span class="s0">key</span><span class="s2">, </span><span class="s0">value</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">deleteCollisions</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debugCall</span><span class="s2">(</span><span class="s0">id</span><span class="s2">(</span><span class="s0">self</span><span class="s2">))</span>
        <span class="s1">for </span><span class="s0">controls </span><span class="s1">in </span><span class="s0">self</span><span class="s2">.</span><span class="s0">controls</span><span class="s2">.</span><span class="s0">values</span><span class="s2">():</span>
            <span class="s0">controls</span><span class="s2">.</span><span class="s0">deleteCollisions</span><span class="s2">()</span>

    <span class="s1">def </span><span class="s0">collisionsOn</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debugCall</span><span class="s2">(</span><span class="s0">id</span><span class="s2">(</span><span class="s0">self</span><span class="s2">))</span>
        <span class="s1">if </span><span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">:</span>
            <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">.</span><span class="s0">setCollisionsActive</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">collisionsOff</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debugCall</span><span class="s2">(</span><span class="s0">id</span><span class="s2">(</span><span class="s0">self</span><span class="s2">))</span>
        <span class="s1">if </span><span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">:</span>
            <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">.</span><span class="s0">setCollisionsActive</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">placeOnFloor</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debugCall</span><span class="s2">(</span><span class="s0">id</span><span class="s2">(</span><span class="s0">self</span><span class="s2">))</span>
        <span class="s1">if </span><span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">:</span>
            <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">.</span><span class="s0">placeOnFloor</span><span class="s2">()</span>

    <span class="s1">def </span><span class="s0">enable</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debugCall</span><span class="s2">(</span><span class="s0">id</span><span class="s2">(</span><span class="s0">self</span><span class="s2">))</span>

        <span class="s1">if </span><span class="s0">self</span><span class="s2">.</span><span class="s0">isEnabled</span><span class="s2">:</span>
            <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debug</span><span class="s2">(</span><span class="s5">'already isEnabled'</span><span class="s2">)</span>
            <span class="s1">return</span>

        <span class="s0">self</span><span class="s2">.</span><span class="s0">isEnabled </span><span class="s2">= </span><span class="s4">1</span>

        <span class="s3"># keep track of what we do on the inputState so we can undo it later on</span>
        <span class="s3">#self.inputStateTokens = []</span>
        <span class="s0">ist </span><span class="s2">= </span><span class="s0">self</span><span class="s2">.</span><span class="s0">inputStateTokens</span>
        <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watch</span><span class="s2">(</span><span class="s5">&quot;run&quot;</span><span class="s2">, </span><span class="s5">'runningEvent'</span><span class="s2">, </span><span class="s5">&quot;running-on&quot;</span><span class="s2">, </span><span class="s5">&quot;running-off&quot;</span><span class="s2">))</span>

        <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;forward&quot;</span><span class="s2">, </span><span class="s5">&quot;arrow_up&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">ArrowKeys</span><span class="s2">))</span>
        <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watch</span><span class="s2">(</span><span class="s5">&quot;forward&quot;</span><span class="s2">, </span><span class="s5">&quot;force-forward&quot;</span><span class="s2">, </span><span class="s5">&quot;force-forward-stop&quot;</span><span class="s2">))</span>

        <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;reverse&quot;</span><span class="s2">, </span><span class="s5">&quot;arrow_down&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">ArrowKeys</span><span class="s2">))</span>
        <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;reverse&quot;</span><span class="s2">, </span><span class="s5">&quot;mouse4&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">Mouse</span><span class="s2">))</span>

        <span class="s1">if </span><span class="s0">self</span><span class="s2">.</span><span class="s0">wantWASD</span><span class="s2">:</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;turnLeft&quot;</span><span class="s2">, </span><span class="s5">&quot;arrow_left&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">ArrowKeys</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watch</span><span class="s2">(</span><span class="s5">&quot;turnLeft&quot;</span><span class="s2">, </span><span class="s5">&quot;mouse-look_left&quot;</span><span class="s2">, </span><span class="s5">&quot;mouse-look_left-done&quot;</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watch</span><span class="s2">(</span><span class="s5">&quot;turnLeft&quot;</span><span class="s2">, </span><span class="s5">&quot;force-turnLeft&quot;</span><span class="s2">, </span><span class="s5">&quot;force-turnLeft-stop&quot;</span><span class="s2">))</span>

            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;turnRight&quot;</span><span class="s2">, </span><span class="s5">&quot;arrow_right&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">ArrowKeys</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watch</span><span class="s2">(</span><span class="s5">&quot;turnRight&quot;</span><span class="s2">, </span><span class="s5">&quot;mouse-look_right&quot;</span><span class="s2">, </span><span class="s5">&quot;mouse-look_right-done&quot;</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watch</span><span class="s2">(</span><span class="s5">&quot;turnRight&quot;</span><span class="s2">, </span><span class="s5">&quot;force-turnRight&quot;</span><span class="s2">, </span><span class="s5">&quot;force-turnRight-stop&quot;</span><span class="s2">))</span>

            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;forward&quot;</span><span class="s2">, </span><span class="s5">&quot;w&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;reverse&quot;</span><span class="s2">, </span><span class="s5">&quot;s&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">))</span>

            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;slideLeft&quot;</span><span class="s2">, </span><span class="s5">&quot;q&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">QE</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;slideRight&quot;</span><span class="s2">, </span><span class="s5">&quot;e&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">QE</span><span class="s2">))</span>

            <span class="s0">self</span><span class="s2">.</span><span class="s0">setWASDTurn</span><span class="s2">(</span><span class="s0">self</span><span class="s2">.</span><span class="s0">__WASDTurn</span><span class="s2">)</span>
        <span class="s1">else</span><span class="s2">:</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;turnLeft&quot;</span><span class="s2">, </span><span class="s5">&quot;arrow_left&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">ArrowKeys</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watch</span><span class="s2">(</span><span class="s5">&quot;turnLeft&quot;</span><span class="s2">, </span><span class="s5">&quot;mouse-look_left&quot;</span><span class="s2">, </span><span class="s5">&quot;mouse-look_left-done&quot;</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watch</span><span class="s2">(</span><span class="s5">&quot;turnLeft&quot;</span><span class="s2">, </span><span class="s5">&quot;force-turnLeft&quot;</span><span class="s2">, </span><span class="s5">&quot;force-turnLeft-stop&quot;</span><span class="s2">))</span>

            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;turnRight&quot;</span><span class="s2">, </span><span class="s5">&quot;arrow_right&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">ArrowKeys</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watch</span><span class="s2">(</span><span class="s5">&quot;turnRight&quot;</span><span class="s2">, </span><span class="s5">&quot;mouse-look_right&quot;</span><span class="s2">, </span><span class="s5">&quot;mouse-look_right-done&quot;</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watch</span><span class="s2">(</span><span class="s5">&quot;turnRight&quot;</span><span class="s2">, </span><span class="s5">&quot;force-turnRight&quot;</span><span class="s2">, </span><span class="s5">&quot;force-turnRight-stop&quot;</span><span class="s2">))</span>

        <span class="s3"># Jump controls</span>
        <span class="s1">if </span><span class="s0">self</span><span class="s2">.</span><span class="s0">wantWASD</span><span class="s2">:</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;jump&quot;</span><span class="s2">, </span><span class="s5">&quot;space&quot;</span><span class="s2">))</span>
        <span class="s1">else</span><span class="s2">:</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watch</span><span class="s2">(</span><span class="s5">&quot;jump&quot;</span><span class="s2">, </span><span class="s5">&quot;control&quot;</span><span class="s2">, </span><span class="s5">&quot;control-up&quot;</span><span class="s2">))</span>

        <span class="s1">if </span><span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">:</span>
            <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">.</span><span class="s0">enableAvatarControls</span><span class="s2">()</span>

    <span class="s1">def </span><span class="s0">disable</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">notify</span><span class="s2">.</span><span class="s0">debugCall</span><span class="s2">(</span><span class="s0">id</span><span class="s2">(</span><span class="s0">self</span><span class="s2">))</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">isEnabled </span><span class="s2">= </span><span class="s4">0</span>

        <span class="s1">for </span><span class="s0">token </span><span class="s1">in </span><span class="s0">self</span><span class="s2">.</span><span class="s0">inputStateTokens</span><span class="s2">:</span>
            <span class="s0">token</span><span class="s2">.</span><span class="s0">release</span><span class="s2">()</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">inputStateTokens </span><span class="s2">= []</span>

        <span class="s1">for </span><span class="s0">token </span><span class="s1">in </span><span class="s0">self</span><span class="s2">.</span><span class="s0">WASDTurnTokens</span><span class="s2">:</span>
            <span class="s0">token</span><span class="s2">.</span><span class="s0">release</span><span class="s2">()</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">WASDTurnTokens </span><span class="s2">= []</span>

        <span class="s1">if </span><span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">:</span>
            <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">.</span><span class="s0">disableAvatarControls</span><span class="s2">()</span>

        <span class="s1">if </span><span class="s0">self</span><span class="s2">.</span><span class="s0">passMessagesThrough</span><span class="s2">: </span><span class="s3"># for not breaking toontown</span>
            <span class="s0">ist</span><span class="s2">=</span><span class="s0">self</span><span class="s2">.</span><span class="s0">inputStateTokens</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;forward&quot;</span><span class="s2">, </span><span class="s5">&quot;arrow_up&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">ArrowKeys</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;reverse&quot;</span><span class="s2">, </span><span class="s5">&quot;arrow_down&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">ArrowKeys</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;turnLeft&quot;</span><span class="s2">, </span><span class="s5">&quot;arrow_left&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">ArrowKeys</span><span class="s2">))</span>
            <span class="s0">ist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;turnRight&quot;</span><span class="s2">, </span><span class="s5">&quot;arrow_right&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">ArrowKeys</span><span class="s2">))</span>

    <span class="s1">def </span><span class="s0">stop</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">disable</span><span class="s2">()</span>
        <span class="s1">if </span><span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">:</span>
            <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">.</span><span class="s0">setCollisionsActive</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)</span>
            <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls</span><span class="s2">.</span><span class="s0">setAvatar</span><span class="s2">(</span><span class="s1">None</span><span class="s2">)</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">currentControls </span><span class="s2">= </span><span class="s1">None</span>

    <span class="s1">def </span><span class="s0">disableAvatarJump</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s6">&quot;&quot;&quot; 
        prevent 
        &quot;&quot;&quot;</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">forceAvJumpToken </span><span class="s1">is None</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">forceAvJumpToken</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">force</span><span class="s2">(</span>
            <span class="s5">&quot;jump&quot;</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s5">'ControlManager.disableAvatarJump'</span><span class="s2">)</span>

    <span class="s1">def </span><span class="s0">enableAvatarJump</span><span class="s2">(</span><span class="s0">self</span><span class="s2">):</span>
        <span class="s6">&quot;&quot;&quot; 
        Stop forcing the ctrl key to return 0's 
        &quot;&quot;&quot;</span>
        <span class="s1">assert </span><span class="s0">self</span><span class="s2">.</span><span class="s0">forceAvJumpToken </span><span class="s1">is not None</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">forceAvJumpToken</span><span class="s2">.</span><span class="s0">release</span><span class="s2">()</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">forceAvJumpToken </span><span class="s2">= </span><span class="s1">None</span>

    <span class="s1">def </span><span class="s0">monitor</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">foo</span><span class="s2">):</span>
        <span class="s3">#assert self.debugPrint(&quot;monitor()&quot;)</span>
        <span class="s3">#if 1:</span>
        <span class="s3">#    airborneHeight=self.avatar.getAirborneHeight()</span>
        <span class="s3">#    onScreenDebug.add(&quot;airborneHeight&quot;, &quot;% 10.4f&quot;%(airborneHeight,))</span>
        <span class="s1">if </span><span class="s4">0</span><span class="s2">:</span>
            <span class="s0">onScreenDebug</span><span class="s2">.</span><span class="s0">add</span><span class="s2">(</span><span class="s5">&quot;InputState forward&quot;</span><span class="s2">, </span><span class="s5">&quot;%d&quot;</span><span class="s2">%(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">isSet</span><span class="s2">(</span><span class="s5">&quot;forward&quot;</span><span class="s2">)))</span>
            <span class="s0">onScreenDebug</span><span class="s2">.</span><span class="s0">add</span><span class="s2">(</span><span class="s5">&quot;InputState reverse&quot;</span><span class="s2">, </span><span class="s5">&quot;%d&quot;</span><span class="s2">%(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">isSet</span><span class="s2">(</span><span class="s5">&quot;reverse&quot;</span><span class="s2">)))</span>
            <span class="s0">onScreenDebug</span><span class="s2">.</span><span class="s0">add</span><span class="s2">(</span><span class="s5">&quot;InputState turnLeft&quot;</span><span class="s2">, </span><span class="s5">&quot;%d&quot;</span><span class="s2">%(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">isSet</span><span class="s2">(</span><span class="s5">&quot;turnLeft&quot;</span><span class="s2">)))</span>
            <span class="s0">onScreenDebug</span><span class="s2">.</span><span class="s0">add</span><span class="s2">(</span><span class="s5">&quot;InputState turnRight&quot;</span><span class="s2">, </span><span class="s5">&quot;%d&quot;</span><span class="s2">%(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">isSet</span><span class="s2">(</span><span class="s5">&quot;turnRight&quot;</span><span class="s2">)))</span>
            <span class="s0">onScreenDebug</span><span class="s2">.</span><span class="s0">add</span><span class="s2">(</span><span class="s5">&quot;InputState slideLeft&quot;</span><span class="s2">, </span><span class="s5">&quot;%d&quot;</span><span class="s2">%(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">isSet</span><span class="s2">(</span><span class="s5">&quot;slideLeft&quot;</span><span class="s2">)))</span>
            <span class="s0">onScreenDebug</span><span class="s2">.</span><span class="s0">add</span><span class="s2">(</span><span class="s5">&quot;InputState slideRight&quot;</span><span class="s2">, </span><span class="s5">&quot;%d&quot;</span><span class="s2">%(</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">isSet</span><span class="s2">(</span><span class="s5">&quot;slideRight&quot;</span><span class="s2">)))</span>
        <span class="s1">return </span><span class="s0">Task</span><span class="s2">.</span><span class="s0">cont</span>

    <span class="s1">def </span><span class="s0">setWASDTurn</span><span class="s2">(</span><span class="s0">self</span><span class="s2">, </span><span class="s0">turn</span><span class="s2">):</span>
        <span class="s0">self</span><span class="s2">.</span><span class="s0">__WASDTurn </span><span class="s2">= </span><span class="s0">turn</span>

        <span class="s1">if not </span><span class="s0">self</span><span class="s2">.</span><span class="s0">isEnabled</span><span class="s2">:</span>
            <span class="s1">return</span>

        <span class="s0">turnLeftWASDSet </span><span class="s2">= </span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">isSet</span><span class="s2">(</span><span class="s5">&quot;turnLeft&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">)</span>
        <span class="s0">turnRightWASDSet </span><span class="s2">= </span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">isSet</span><span class="s2">(</span><span class="s5">&quot;turnRight&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">)</span>
        <span class="s0">slideLeftWASDSet </span><span class="s2">= </span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">isSet</span><span class="s2">(</span><span class="s5">&quot;slideLeft&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">)</span>
        <span class="s0">slideRightWASDSet </span><span class="s2">= </span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">isSet</span><span class="s2">(</span><span class="s5">&quot;slideRight&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">)</span>

        <span class="s1">for </span><span class="s0">token </span><span class="s1">in </span><span class="s0">self</span><span class="s2">.</span><span class="s0">WASDTurnTokens</span><span class="s2">:</span>
            <span class="s0">token</span><span class="s2">.</span><span class="s0">release</span><span class="s2">()</span>

        <span class="s1">if </span><span class="s0">turn</span><span class="s2">:</span>
            <span class="s0">self</span><span class="s2">.</span><span class="s0">WASDTurnTokens </span><span class="s2">= (</span>
                <span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;turnLeft&quot;</span><span class="s2">, </span><span class="s5">&quot;a&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">),</span>
                <span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;turnRight&quot;</span><span class="s2">, </span><span class="s5">&quot;d&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">),</span>
                <span class="s2">)</span>

            <span class="s0">inputState</span><span class="s2">.</span><span class="s0">set</span><span class="s2">(</span><span class="s5">&quot;turnLeft&quot;</span><span class="s2">, </span><span class="s0">slideLeftWASDSet</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">)</span>
            <span class="s0">inputState</span><span class="s2">.</span><span class="s0">set</span><span class="s2">(</span><span class="s5">&quot;turnRight&quot;</span><span class="s2">, </span><span class="s0">slideRightWASDSet</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">)</span>

            <span class="s0">inputState</span><span class="s2">.</span><span class="s0">set</span><span class="s2">(</span><span class="s5">&quot;slideLeft&quot;</span><span class="s2">, </span><span class="s1">False</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">)</span>
            <span class="s0">inputState</span><span class="s2">.</span><span class="s0">set</span><span class="s2">(</span><span class="s5">&quot;slideRight&quot;</span><span class="s2">, </span><span class="s1">False</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">)</span>

        <span class="s1">else</span><span class="s2">:</span>
            <span class="s0">self</span><span class="s2">.</span><span class="s0">WASDTurnTokens </span><span class="s2">= (</span>
                <span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;slideLeft&quot;</span><span class="s2">, </span><span class="s5">&quot;a&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">),</span>
                <span class="s0">inputState</span><span class="s2">.</span><span class="s0">watchWithModifiers</span><span class="s2">(</span><span class="s5">&quot;slideRight&quot;</span><span class="s2">, </span><span class="s5">&quot;d&quot;</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">),</span>
                <span class="s2">)</span>

            <span class="s0">inputState</span><span class="s2">.</span><span class="s0">set</span><span class="s2">(</span><span class="s5">&quot;slideLeft&quot;</span><span class="s2">, </span><span class="s0">turnLeftWASDSet</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">)</span>
            <span class="s0">inputState</span><span class="s2">.</span><span class="s0">set</span><span class="s2">(</span><span class="s5">&quot;slideRight&quot;</span><span class="s2">, </span><span class="s0">turnRightWASDSet</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">)</span>

            <span class="s0">inputState</span><span class="s2">.</span><span class="s0">set</span><span class="s2">(</span><span class="s5">&quot;turnLeft&quot;</span><span class="s2">, </span><span class="s1">False</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">)</span>
            <span class="s0">inputState</span><span class="s2">.</span><span class="s0">set</span><span class="s2">(</span><span class="s5">&quot;turnRight&quot;</span><span class="s2">, </span><span class="s1">False</span><span class="s2">, </span><span class="s0">inputSource</span><span class="s2">=</span><span class="s0">inputState</span><span class="s2">.</span><span class="s0">WASD</span><span class="s2">)</span>

</pre>
</body>
</html>
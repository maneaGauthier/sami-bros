<html>
<head>
<title>extract_docs.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
extract_docs.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; This script generates a pandadoc.hpp file representing the Python 
wrappers that can be parsed by doxygen to generate the Python documentation. 
You need to run this before invoking Doxyfile.python. 
 
It requires a valid makepanda installation with interrogatedb .in 
files in the lib/pandac/input directory. &quot;&quot;&quot;</span>

<span class="s2">from </span><span class="s1">__future__ </span><span class="s2">import </span><span class="s1">print_function</span>

<span class="s1">__all__ </span><span class="s3">= []</span>

<span class="s2">import </span><span class="s1">os</span><span class="s3">, </span><span class="s1">sys</span>
<span class="s2">from </span><span class="s1">distutils </span><span class="s2">import </span><span class="s1">sysconfig</span>
<span class="s2">import </span><span class="s1">panda3d</span><span class="s3">, </span><span class="s1">pandac</span>
<span class="s2">from </span><span class="s1">panda3d</span><span class="s3">.</span><span class="s1">interrogatedb </span><span class="s2">import </span><span class="s3">*</span>


<span class="s2">if </span><span class="s4">'interrogate_element_is_sequence' </span><span class="s2">not in </span><span class="s1">globals</span><span class="s3">():</span>
    <span class="s2">def </span><span class="s1">interrogate_element_is_sequence</span><span class="s3">(</span><span class="s1">element</span><span class="s3">):</span>
        <span class="s2">return False</span>

<span class="s2">if </span><span class="s4">'interrogate_element_is_mapping' </span><span class="s2">not in </span><span class="s1">globals</span><span class="s3">():</span>
    <span class="s2">def </span><span class="s1">interrogate_element_is_mapping</span><span class="s3">(</span><span class="s1">element</span><span class="s3">):</span>
        <span class="s2">return False</span>


<span class="s1">LICENSE </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;PANDA 3D SOFTWARE 
Copyright (c) Carnegie Mellon University.  All rights reserved. 
All use of this software is subject to the terms of the revised BSD 
license.  You should have received a copy of this license along 
with this source code in a file named </span><span class="s2">\&quot;</span><span class="s4">LICENSE.</span><span class="s2">\&quot;</span><span class="s4">&quot;&quot;&quot;</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">)</span>

<span class="s1">MAINPAGE </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;@mainpage Panda3D Python API Reference 
Welcome to the Panda3D API reference. 
 
Use the links at the top of this page to browse through the list of modules or 
the list of classes. 
 
This reference is automatically generated from comments in the source code. 
&quot;&quot;&quot;</span>


<span class="s2">def </span><span class="s1">comment</span><span class="s3">(</span><span class="s1">code</span><span class="s3">):</span>
    <span class="s2">if not </span><span class="s1">code</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s4">&quot;&quot;</span>

    <span class="s1">comment </span><span class="s3">= </span><span class="s4">''</span>

    <span class="s1">empty_line </span><span class="s3">= </span><span class="s2">False</span>
    <span class="s2">for </span><span class="s1">line </span><span class="s2">in </span><span class="s1">code</span><span class="s3">.</span><span class="s1">splitlines</span><span class="s3">(</span><span class="s2">False</span><span class="s3">):</span>
        <span class="s1">line </span><span class="s3">= </span><span class="s1">line</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">(</span><span class="s4">'</span><span class="s2">\t\n </span><span class="s4">/'</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">line</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">empty_line</span><span class="s3">:</span>
                <span class="s5"># New paragraph.</span>
                <span class="s1">comment </span><span class="s3">+= </span><span class="s4">'</span><span class="s2">\n\n</span><span class="s4">'</span>
                <span class="s1">empty_line </span><span class="s3">= </span><span class="s2">False</span>
            <span class="s2">elif </span><span class="s1">comment</span><span class="s3">:</span>
                <span class="s1">comment </span><span class="s3">+= </span><span class="s4">'</span><span class="s2">\n</span><span class="s4">'</span>
            <span class="s1">comment </span><span class="s3">+= </span><span class="s4">'/// ' </span><span class="s3">+ </span><span class="s1">line</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">empty_line </span><span class="s3">= </span><span class="s2">True</span>

    <span class="s2">if </span><span class="s1">comment</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">comment</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s4">''</span>

<span class="s2">def </span><span class="s1">block_comment</span><span class="s3">(</span><span class="s1">code</span><span class="s3">):</span>
    <span class="s1">code </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">()</span>

    <span class="s2">if not </span><span class="s1">code</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s4">'///&lt;'</span><span class="s3">) </span><span class="s2">and </span><span class="s4">'@verbatim' </span><span class="s2">not in </span><span class="s1">code</span><span class="s3">:</span>
        <span class="s1">code </span><span class="s3">= </span><span class="s1">code</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">'&lt;'</span><span class="s3">, </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">&lt;'</span><span class="s3">).</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">'&gt;'</span><span class="s3">, </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">&gt;'</span><span class="s3">)</span>

    <span class="s2">if not </span><span class="s1">code </span><span class="s2">or </span><span class="s1">code</span><span class="s3">[</span><span class="s6">0</span><span class="s3">] != </span><span class="s4">'/'</span><span class="s3">:</span>
        <span class="s5"># Not really a comment; get rid of it.</span>
        <span class="s2">return </span><span class="s4">&quot;&quot;</span>

    <span class="s2">return </span><span class="s1">code</span>

<span class="s2">def </span><span class="s1">translateFunctionName</span><span class="s3">(</span><span class="s1">name</span><span class="s3">):</span>
    <span class="s2">if </span><span class="s1">name</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s4">&quot;__&quot;</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">name</span>

    <span class="s1">new </span><span class="s3">= </span><span class="s4">&quot;&quot;</span>
    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">name</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s4">&quot;_&quot;</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">new </span><span class="s3">== </span><span class="s4">&quot;&quot;</span><span class="s3">:</span>
            <span class="s1">new </span><span class="s3">+= </span><span class="s1">i</span>
        <span class="s2">elif </span><span class="s1">i </span><span class="s3">== </span><span class="s4">&quot;&quot;</span><span class="s3">:</span>
            <span class="s2">pass</span>
        <span class="s2">elif </span><span class="s1">len</span><span class="s3">(</span><span class="s1">i</span><span class="s3">) == </span><span class="s6">1</span><span class="s3">:</span>
            <span class="s1">new </span><span class="s3">+= </span><span class="s1">i</span><span class="s3">[</span><span class="s6">0</span><span class="s3">].</span><span class="s1">upper</span><span class="s3">()</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">new </span><span class="s3">+= </span><span class="s1">i</span><span class="s3">[</span><span class="s6">0</span><span class="s3">].</span><span class="s1">upper</span><span class="s3">() + </span><span class="s1">i</span><span class="s3">[</span><span class="s6">1</span><span class="s3">:]</span>
    <span class="s2">return </span><span class="s1">new</span>

<span class="s2">def </span><span class="s1">translateTypeName</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">mangle</span><span class="s3">=</span><span class="s2">True</span><span class="s3">):</span>
    <span class="s5"># Equivalent to C++ classNameFromCppName</span>
    <span class="s1">class_name </span><span class="s3">= </span><span class="s4">&quot;&quot;</span>
    <span class="s1">bad_chars </span><span class="s3">= </span><span class="s4">&quot;!@#$%^&amp;*()&lt;&gt;,.-=+~{}? &quot;</span>
    <span class="s1">next_cap </span><span class="s3">= </span><span class="s2">False</span>
    <span class="s1">first_char </span><span class="s3">= </span><span class="s1">mangle</span>

    <span class="s2">for </span><span class="s1">chr </span><span class="s2">in </span><span class="s1">name</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">chr </span><span class="s3">== </span><span class="s4">'_' </span><span class="s2">or </span><span class="s1">chr </span><span class="s3">== </span><span class="s4">' '</span><span class="s3">) </span><span class="s2">and </span><span class="s1">mangle</span><span class="s3">:</span>
            <span class="s1">next_cap </span><span class="s3">= </span><span class="s2">True</span>
        <span class="s2">elif </span><span class="s1">chr </span><span class="s2">in </span><span class="s1">bad_chars</span><span class="s3">:</span>
            <span class="s2">if not </span><span class="s1">mangle</span><span class="s3">:</span>
                <span class="s1">class_name </span><span class="s3">+= </span><span class="s4">'_'</span>
        <span class="s2">elif </span><span class="s1">next_cap </span><span class="s2">or </span><span class="s1">first_char</span><span class="s3">:</span>
            <span class="s1">class_name </span><span class="s3">+= </span><span class="s1">chr</span><span class="s3">.</span><span class="s1">upper</span><span class="s3">()</span>
            <span class="s1">next_cap </span><span class="s3">= </span><span class="s2">False</span>
            <span class="s1">first_char </span><span class="s3">= </span><span class="s2">False</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">class_name </span><span class="s3">+= </span><span class="s1">chr</span>

    <span class="s2">return </span><span class="s1">class_name</span>

<span class="s2">def </span><span class="s1">translated_type_name</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">scoped</span><span class="s3">=</span><span class="s2">True</span><span class="s3">):</span>
    <span class="s2">while </span><span class="s1">interrogate_type_is_wrapped</span><span class="s3">(</span><span class="s1">type</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">interrogate_type_is_const</span><span class="s3">(</span><span class="s1">type</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s4">'const ' </span><span class="s3">+ </span><span class="s1">translated_type_name</span><span class="s3">(</span><span class="s1">interrogate_type_wrapped_type</span><span class="s3">(</span><span class="s1">type</span><span class="s3">))</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">type </span><span class="s3">= </span><span class="s1">interrogate_type_wrapped_type</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)</span>

    <span class="s1">typename </span><span class="s3">= </span><span class="s1">interrogate_type_name</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">typename </span><span class="s2">in </span><span class="s3">(</span><span class="s4">&quot;PyObject&quot;</span><span class="s3">, </span><span class="s4">&quot;_object&quot;</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s4">&quot;object&quot;</span>
    <span class="s2">elif </span><span class="s1">typename </span><span class="s3">== </span><span class="s4">&quot;PN_stdfloat&quot;</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s4">&quot;float&quot;</span>
    <span class="s2">elif </span><span class="s1">typename </span><span class="s3">== </span><span class="s4">&quot;size_t&quot;</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s4">&quot;int&quot;</span>

    <span class="s2">if </span><span class="s1">interrogate_type_is_atomic</span><span class="s3">(</span><span class="s1">type</span><span class="s3">):</span>
        <span class="s1">token </span><span class="s3">= </span><span class="s1">interrogate_type_atomic_token</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">token </span><span class="s3">== </span><span class="s6">7</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s4">'str'</span>
        <span class="s2">elif </span><span class="s1">token </span><span class="s3">== </span><span class="s6">8</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s4">'long'</span>
        <span class="s2">elif </span><span class="s1">token </span><span class="s3">== </span><span class="s6">9</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s4">'NoneType'</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">typename</span>

    <span class="s2">if not </span><span class="s1">typename</span><span class="s3">.</span><span class="s1">endswith</span><span class="s3">(</span><span class="s4">'_t'</span><span class="s3">):</span>
        <span class="s5"># Hack: don't mangle size_t etc.</span>
        <span class="s1">typename </span><span class="s3">= </span><span class="s1">translateTypeName</span><span class="s3">(</span><span class="s1">typename</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">scoped </span><span class="s2">and </span><span class="s1">interrogate_type_is_nested</span><span class="s3">(</span><span class="s1">type</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">translated_type_name</span><span class="s3">(</span><span class="s1">interrogate_type_outer_class</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)) + </span><span class="s4">'::' </span><span class="s3">+ </span><span class="s1">typename</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">typename</span>


<span class="s2">def </span><span class="s1">processElement</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">, </span><span class="s1">element</span><span class="s3">):</span>
    <span class="s2">if </span><span class="s1">interrogate_element_has_comment</span><span class="s3">(</span><span class="s1">element</span><span class="s3">):</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s1">comment</span><span class="s3">(</span><span class="s1">interrogate_element_comment</span><span class="s3">(</span><span class="s1">element</span><span class="s3">)), </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">interrogate_element_has_getter</span><span class="s3">(</span><span class="s1">element</span><span class="s3">):</span>
        <span class="s5"># If the property has no comment, use the comment of the getter.</span>
        <span class="s1">getter </span><span class="s3">= </span><span class="s1">interrogate_element_getter</span><span class="s3">(</span><span class="s1">element</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">interrogate_function_has_comment</span><span class="s3">(</span><span class="s1">getter</span><span class="s3">):</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s1">block_comment</span><span class="s3">(</span><span class="s1">interrogate_function_comment</span><span class="s3">(</span><span class="s1">getter</span><span class="s3">)), </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">interrogate_element_is_mapping</span><span class="s3">(</span><span class="s1">element</span><span class="s3">) </span><span class="s2">or </span><span class="s1">\</span>
       <span class="s1">interrogate_element_is_sequence</span><span class="s3">(</span><span class="s1">element</span><span class="s3">):</span>
        <span class="s1">suffix </span><span class="s3">= </span><span class="s4">&quot;[]&quot;</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">suffix </span><span class="s3">= </span><span class="s4">&quot;&quot;</span>

    <span class="s1">print</span><span class="s3">(</span><span class="s1">translated_type_name</span><span class="s3">(</span><span class="s1">interrogate_element_type</span><span class="s3">(</span><span class="s1">element</span><span class="s3">)), </span><span class="s1">end</span><span class="s3">=</span><span class="s4">' '</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>
    <span class="s1">print</span><span class="s3">(</span><span class="s1">interrogate_element_name</span><span class="s3">(</span><span class="s1">element</span><span class="s3">) + </span><span class="s1">suffix </span><span class="s3">+ </span><span class="s4">';'</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">processFunction</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">, </span><span class="s1">function</span><span class="s3">, </span><span class="s1">isConstructor </span><span class="s3">= </span><span class="s2">False</span><span class="s3">):</span>
    <span class="s2">for </span><span class="s1">i_wrapper </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">interrogate_function_number_of_python_wrappers</span><span class="s3">(</span><span class="s1">function</span><span class="s3">)):</span>
        <span class="s1">wrapper </span><span class="s3">= </span><span class="s1">interrogate_function_python_wrapper</span><span class="s3">(</span><span class="s1">function</span><span class="s3">, </span><span class="s1">i_wrapper</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">interrogate_wrapper_has_comment</span><span class="s3">(</span><span class="s1">wrapper</span><span class="s3">):</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s1">block_comment</span><span class="s3">(</span><span class="s1">interrogate_wrapper_comment</span><span class="s3">(</span><span class="s1">wrapper</span><span class="s3">)), </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>

        <span class="s2">if not </span><span class="s1">isConstructor</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">interrogate_function_is_method</span><span class="s3">(</span><span class="s1">function</span><span class="s3">):</span>
                <span class="s2">if not </span><span class="s1">interrogate_wrapper_number_of_parameters</span><span class="s3">(</span><span class="s1">wrapper</span><span class="s3">) &gt; </span><span class="s6">0 </span><span class="s2">or not </span><span class="s1">interrogate_wrapper_parameter_is_this</span><span class="s3">(</span><span class="s1">wrapper</span><span class="s3">, </span><span class="s6">0</span><span class="s3">):</span>
                    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;static&quot;</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s4">' '</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>

            <span class="s2">if </span><span class="s1">interrogate_wrapper_has_return_value</span><span class="s3">(</span><span class="s1">wrapper</span><span class="s3">):</span>
                <span class="s1">print</span><span class="s3">(</span><span class="s1">translated_type_name</span><span class="s3">(</span><span class="s1">interrogate_wrapper_return_type</span><span class="s3">(</span><span class="s1">wrapper</span><span class="s3">)), </span><span class="s1">end</span><span class="s3">=</span><span class="s4">' '</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s2">pass</span><span class="s5">#print &gt;&gt;handle, &quot;void&quot;,</span>

            <span class="s1">print</span><span class="s3">(</span><span class="s1">translateFunctionName</span><span class="s3">(</span><span class="s1">interrogate_function_name</span><span class="s3">(</span><span class="s1">function</span><span class="s3">)) + </span><span class="s4">&quot;(&quot;</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s4">' '</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;__init__(&quot;</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s4">' '</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>

        <span class="s1">first </span><span class="s3">= </span><span class="s2">True</span>
        <span class="s2">for </span><span class="s1">i_param </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">interrogate_wrapper_number_of_parameters</span><span class="s3">(</span><span class="s1">wrapper</span><span class="s3">)):</span>
            <span class="s2">if not </span><span class="s1">interrogate_wrapper_parameter_is_this</span><span class="s3">(</span><span class="s1">wrapper</span><span class="s3">, </span><span class="s1">i_param</span><span class="s3">):</span>
                <span class="s2">if not </span><span class="s1">first</span><span class="s3">:</span>
                    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;,&quot;</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s4">' '</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>
                <span class="s1">print</span><span class="s3">(</span><span class="s1">translated_type_name</span><span class="s3">(</span><span class="s1">interrogate_wrapper_parameter_type</span><span class="s3">(</span><span class="s1">wrapper</span><span class="s3">, </span><span class="s1">i_param</span><span class="s3">)), </span><span class="s1">end</span><span class="s3">=</span><span class="s4">' '</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>
                <span class="s2">if </span><span class="s1">interrogate_wrapper_parameter_has_name</span><span class="s3">(</span><span class="s1">wrapper</span><span class="s3">, </span><span class="s1">i_param</span><span class="s3">):</span>
                    <span class="s1">print</span><span class="s3">(</span><span class="s1">interrogate_wrapper_parameter_name</span><span class="s3">(</span><span class="s1">wrapper</span><span class="s3">, </span><span class="s1">i_param</span><span class="s3">), </span><span class="s1">end</span><span class="s3">=</span><span class="s4">' '</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>
                <span class="s1">first </span><span class="s3">= </span><span class="s2">False</span>

        <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;);&quot;</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">processType</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">, </span><span class="s1">type</span><span class="s3">):</span>
    <span class="s1">typename </span><span class="s3">= </span><span class="s1">translated_type_name</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">scoped</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
    <span class="s1">derivations </span><span class="s3">= [ </span><span class="s1">translated_type_name</span><span class="s3">(</span><span class="s1">interrogate_type_get_derivation</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">n</span><span class="s3">)) </span><span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">interrogate_type_number_of_derivations</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)) ]</span>

    <span class="s2">if </span><span class="s1">interrogate_type_has_comment</span><span class="s3">(</span><span class="s1">type</span><span class="s3">):</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s1">block_comment</span><span class="s3">(</span><span class="s1">interrogate_type_comment</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)), </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">interrogate_type_is_enum</span><span class="s3">(</span><span class="s1">type</span><span class="s3">):</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;enum %s {&quot; </span><span class="s3">% </span><span class="s1">typename</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">i_value </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">interrogate_type_number_of_enum_values</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)):</span>
            <span class="s1">docstring </span><span class="s3">= </span><span class="s1">comment</span><span class="s3">(</span><span class="s1">interrogate_type_enum_value_comment</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">i_value</span><span class="s3">))</span>
            <span class="s2">if </span><span class="s1">docstring</span><span class="s3">:</span>
                <span class="s1">print</span><span class="s3">(</span><span class="s1">docstring</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s1">interrogate_type_enum_value_name</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">i_value</span><span class="s3">), </span><span class="s4">&quot;=&quot;</span><span class="s3">, </span><span class="s1">interrogate_type_enum_value</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">i_value</span><span class="s3">), </span><span class="s4">&quot;,&quot;</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>

    <span class="s2">elif </span><span class="s1">interrogate_type_is_typedef</span><span class="s3">(</span><span class="s1">type</span><span class="s3">):</span>
        <span class="s1">wrapped_type </span><span class="s3">= </span><span class="s1">interrogate_type_wrapped_type</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">interrogate_type_is_global</span><span class="s3">(</span><span class="s1">wrapped_type</span><span class="s3">):</span>
            <span class="s1">wrapped_type_name </span><span class="s3">= </span><span class="s1">translated_type_name</span><span class="s3">(</span><span class="s1">wrapped_type</span><span class="s3">)</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;typedef %s %s;&quot; </span><span class="s3">% (</span><span class="s1">wrapped_type_name</span><span class="s3">, </span><span class="s1">typename</span><span class="s3">), </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>
        <span class="s2">return</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">interrogate_type_is_struct</span><span class="s3">(</span><span class="s1">type</span><span class="s3">):</span>
            <span class="s1">classtype </span><span class="s3">= </span><span class="s4">&quot;struct&quot;</span>
        <span class="s2">elif </span><span class="s1">interrogate_type_is_class</span><span class="s3">(</span><span class="s1">type</span><span class="s3">):</span>
            <span class="s1">classtype </span><span class="s3">= </span><span class="s4">&quot;class&quot;</span>
        <span class="s2">elif </span><span class="s1">interrogate_type_is_union</span><span class="s3">(</span><span class="s1">type</span><span class="s3">):</span>
            <span class="s1">classtype </span><span class="s3">= </span><span class="s4">&quot;union&quot;</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;I don't know what type %s is&quot; </span><span class="s3">% </span><span class="s1">interrogate_type_true_name</span><span class="s3">(</span><span class="s1">type</span><span class="s3">))</span>
            <span class="s2">return</span>

        <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">derivations</span><span class="s3">) &gt; </span><span class="s6">0</span><span class="s3">:</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;%s %s : public %s {&quot; </span><span class="s3">% (</span><span class="s1">classtype</span><span class="s3">, </span><span class="s1">typename</span><span class="s3">, </span><span class="s4">&quot;, public &quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">derivations</span><span class="s3">)), </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;%s %s {&quot; </span><span class="s3">% (</span><span class="s1">classtype</span><span class="s3">, </span><span class="s1">typename</span><span class="s3">), </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;public:&quot;</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>

    <span class="s2">for </span><span class="s1">i_ntype </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">interrogate_type_number_of_nested_types</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)):</span>
        <span class="s1">processType</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">, </span><span class="s1">interrogate_type_get_nested_type</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">i_ntype</span><span class="s3">))</span>

    <span class="s2">for </span><span class="s1">i_method </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">interrogate_type_number_of_constructors</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)):</span>
        <span class="s1">processFunction</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">, </span><span class="s1">interrogate_type_get_constructor</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">i_method</span><span class="s3">), </span><span class="s2">True</span><span class="s3">)</span>

    <span class="s2">for </span><span class="s1">i_method </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">interrogate_type_number_of_methods</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)):</span>
        <span class="s1">processFunction</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">, </span><span class="s1">interrogate_type_get_method</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">i_method</span><span class="s3">))</span>

    <span class="s2">for </span><span class="s1">i_method </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">interrogate_type_number_of_make_seqs</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)):</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;list&quot;</span><span class="s3">, </span><span class="s1">translateFunctionName</span><span class="s3">(</span><span class="s1">interrogate_make_seq_seq_name</span><span class="s3">(</span><span class="s1">interrogate_type_get_make_seq</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">i_method</span><span class="s3">))), </span><span class="s4">&quot;();&quot;</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>

    <span class="s2">for </span><span class="s1">i_element </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">interrogate_type_number_of_elements</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)):</span>
        <span class="s1">processElement</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">, </span><span class="s1">interrogate_type_get_element</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">i_element</span><span class="s3">))</span>

    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;};&quot;</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>

<span class="s2">def </span><span class="s1">processModule</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">, </span><span class="s1">package</span><span class="s3">):</span>
    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;Processing module %s&quot; </span><span class="s3">% (</span><span class="s1">package</span><span class="s3">))</span>
    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;namespace %s {&quot; </span><span class="s3">% </span><span class="s1">package</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">package </span><span class="s3">!= </span><span class="s4">&quot;core&quot;</span><span class="s3">:</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;using namespace core;&quot;</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>

    <span class="s2">for </span><span class="s1">i_type </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">interrogate_number_of_global_types</span><span class="s3">()):</span>
        <span class="s1">type </span><span class="s3">= </span><span class="s1">interrogate_get_global_type</span><span class="s3">(</span><span class="s1">i_type</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">interrogate_type_has_module_name</span><span class="s3">(</span><span class="s1">type</span><span class="s3">):</span>
            <span class="s1">module_name </span><span class="s3">= </span><span class="s1">interrogate_type_module_name</span><span class="s3">(</span><span class="s1">type</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s4">&quot;panda3d.&quot; </span><span class="s3">+ </span><span class="s1">package </span><span class="s3">== </span><span class="s1">module_name</span><span class="s3">:</span>
                <span class="s1">processType</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">, </span><span class="s1">type</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;Type %s has no module name&quot; </span><span class="s3">% </span><span class="s1">typename</span><span class="s3">)</span>

    <span class="s2">for </span><span class="s1">i_func </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">interrogate_number_of_global_functions</span><span class="s3">()):</span>
        <span class="s1">func </span><span class="s3">= </span><span class="s1">interrogate_get_global_function</span><span class="s3">(</span><span class="s1">i_func</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">interrogate_function_has_module_name</span><span class="s3">(</span><span class="s1">func</span><span class="s3">):</span>
            <span class="s1">module_name </span><span class="s3">= </span><span class="s1">interrogate_function_module_name</span><span class="s3">(</span><span class="s1">func</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s4">&quot;panda3d.&quot; </span><span class="s3">+ </span><span class="s1">package </span><span class="s3">== </span><span class="s1">module_name</span><span class="s3">:</span>
                <span class="s1">processFunction</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">, </span><span class="s1">func</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;Type %s has no module name&quot; </span><span class="s3">% </span><span class="s1">typename</span><span class="s3">)</span>

    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;}&quot;</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>


<span class="s2">if </span><span class="s1">__name__ </span><span class="s3">== </span><span class="s4">&quot;__main__&quot;</span><span class="s3">:</span>
    <span class="s1">handle </span><span class="s3">= </span><span class="s1">open</span><span class="s3">(</span><span class="s4">&quot;pandadoc.hpp&quot;</span><span class="s3">, </span><span class="s4">&quot;w&quot;</span><span class="s3">)</span>

    <span class="s1">mainpage </span><span class="s3">= </span><span class="s1">MAINPAGE</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">()</span>
    <span class="s2">if </span><span class="s1">mainpage</span><span class="s3">:</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;/**</span><span class="s2">\n </span><span class="s4">* &quot; </span><span class="s3">+ </span><span class="s1">mainpage</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">'</span><span class="s2">\n</span><span class="s4">'</span><span class="s3">, </span><span class="s4">'</span><span class="s2">\n </span><span class="s4">* '</span><span class="s3">) + </span><span class="s4">'</span><span class="s2">\n </span><span class="s4">*/'</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>

    <span class="s1">print</span><span class="s3">(</span><span class="s1">comment</span><span class="s3">(</span><span class="s4">&quot;Panda3D modules that are implemented in C++.&quot;</span><span class="s3">), </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>
    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;namespace panda3d {&quot;</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>

    <span class="s5"># Determine the path to the interrogatedb files</span>
    <span class="s1">pandac </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">dirname</span><span class="s3">(</span><span class="s1">pandac</span><span class="s3">.</span><span class="s1">__file__</span><span class="s3">)</span>
    <span class="s1">interrogate_add_search_directory</span><span class="s3">(</span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">pandac</span><span class="s3">, </span><span class="s4">&quot;..&quot;</span><span class="s3">, </span><span class="s4">&quot;..&quot;</span><span class="s3">, </span><span class="s4">&quot;etc&quot;</span><span class="s3">))</span>
    <span class="s1">interrogate_add_search_directory</span><span class="s3">(</span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">pandac</span><span class="s3">, </span><span class="s4">&quot;input&quot;</span><span class="s3">))</span>

    <span class="s2">import </span><span class="s1">panda3d</span><span class="s3">.</span><span class="s1">core</span>
    <span class="s1">processModule</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">, </span><span class="s4">&quot;core&quot;</span><span class="s3">)</span>

    <span class="s5"># Determine the suffix for the extension modules.</span>
    <span class="s2">if </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">version_info </span><span class="s3">&gt;= (</span><span class="s6">3</span><span class="s3">, </span><span class="s6">0</span><span class="s3">):</span>
        <span class="s2">import </span><span class="s1">_imp</span>
        <span class="s1">ext_suffix </span><span class="s3">= </span><span class="s1">_imp</span><span class="s3">.</span><span class="s1">extension_suffixes</span><span class="s3">()[</span><span class="s6">0</span><span class="s3">]</span>
    <span class="s2">elif </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">platform </span><span class="s3">== </span><span class="s4">&quot;win32&quot;</span><span class="s3">:</span>
        <span class="s1">ext_suffix </span><span class="s3">= </span><span class="s4">&quot;.pyd&quot;</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">ext_suffix </span><span class="s3">= </span><span class="s4">&quot;.so&quot;</span>

    <span class="s2">for </span><span class="s1">lib </span><span class="s2">in </span><span class="s1">os</span><span class="s3">.</span><span class="s1">listdir</span><span class="s3">(</span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">dirname</span><span class="s3">(</span><span class="s1">panda3d</span><span class="s3">.</span><span class="s1">__file__</span><span class="s3">)):</span>
        <span class="s2">if </span><span class="s1">lib</span><span class="s3">.</span><span class="s1">endswith</span><span class="s3">(</span><span class="s1">ext_suffix</span><span class="s3">) </span><span class="s2">and not </span><span class="s1">lib</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s4">'core.'</span><span class="s3">):</span>
            <span class="s1">module_name </span><span class="s3">= </span><span class="s1">lib</span><span class="s3">[:-</span><span class="s1">len</span><span class="s3">(</span><span class="s1">ext_suffix</span><span class="s3">)]</span>
            <span class="s1">__import__</span><span class="s3">(</span><span class="s4">&quot;panda3d.&quot; </span><span class="s3">+ </span><span class="s1">module_name</span><span class="s3">)</span>
            <span class="s1">processModule</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">, </span><span class="s1">module_name</span><span class="s3">)</span>

    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;}&quot;</span><span class="s3">, </span><span class="s1">file</span><span class="s3">=</span><span class="s1">handle</span><span class="s3">)</span>
    <span class="s1">handle</span><span class="s3">.</span><span class="s1">close</span><span class="s3">()</span>

    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;Wrote output to pandadoc.hpp.  You can now run:&quot;</span><span class="s3">)</span>
    <span class="s1">print</span><span class="s3">()</span>
    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;  doxygen built/direct/directscripts/Doxyfile.python&quot;</span><span class="s3">)</span>
</pre>
</body>
</html>
<html>
<head>
<title>sample.dc</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #bcbec4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
sample.dc</font>
</center></td></tr></table>
<pre><span class="s0">// It's necessary to explicitly import the Python files that define</span>
<span class="s0">// the Python representation of the classes and structs named in this</span>
<span class="s0">// file.  (Implicitly importing these files turned out to be a bad</span>
<span class="s0">// idea.)</span>

<span class="s0">from direct.distributed import DistributedObject</span>
<span class="s0">from direct.distributed import DistributedNode</span>
<span class="s0">from game.avatar import AvatarObject</span>
<span class="s0">from game.avatar import DistributedObjectHolder</span>

<span class="s0">// All of the named modules are imported into a common Python</span>
<span class="s0">// namespace, which is then searched for each named dclass or struct.</span>
<span class="s0">// It is OK for a dclass to be named in this file that doesn't have a</span>
<span class="s0">// corresponding Python representation, but it is then an error to</span>
<span class="s0">// receive a generate message for one of these objects.</span>


<span class="s0">// A simple typedef provides a name and a semantic context to types.</span>
<span class="s0">typedef uint32 DoId;</span>


<span class="s0">// A dclass defines a collection of &quot;methods&quot; which may be called as</span>
<span class="s0">// network messages.</span>
<span class="s0">dclass DistributedObject {</span>
  <span class="s0">setColor(uint8 red, uint8 green, uint8 blue);</span>

  <span class="s0">// The uint8[] syntax replaces the old uint8array type.  All of the</span>
  <span class="s0">// old hard-coded array types are now deprecated in favor of C-style</span>
  <span class="s0">// array definitions.</span>
  <span class="s0">setPropertiesList(uint8 properties[]);</span>
<span class="s0">};</span>


<span class="s0">// You can also define C-style structs.  This is really the same thing</span>
<span class="s0">// as a dclass, except it can be embedded in a message rather than</span>
<span class="s0">// created as an object in its own right.  The struct may or may not</span>
<span class="s0">// correspond with a Python class of the same name.  If the struct</span>
<span class="s0">// does have a Python representation, an instance of that class is</span>
<span class="s0">// created and passed in to functions that receive this kind of</span>
<span class="s0">// parameter; otherwise, a tuple with all of the fields is passed</span>
<span class="s0">// instead.</span>

<span class="s0">struct AvatarObject {</span>
  <span class="s0">// Limits to numeric ranges may be specified within parentheses</span>
  <span class="s0">// following the typename.</span>
  <span class="s0">uint8(0-10) type;</span>
  <span class="s0">int16(0-999, 2000-2999, 5000-5199) roomId;</span>

  <span class="s0">// You can specify a default initial value in case the value is not</span>
  <span class="s0">// already defined at the time generate is called.</span>
  <span class="s0">int8 code = 0;</span>

  <span class="s0">// You can also define &quot;methods&quot; on a struct, just as on a dclass.</span>
  <span class="s0">// This implies the existence of the corresponding get method</span>
  <span class="s0">// (e.g. getObjectCode() in this case), to query the information at</span>
  <span class="s0">// generate time.</span>
  <span class="s0">setObjectCode(int8(0-50) code, DoId player);</span>
<span class="s0">};</span>


<span class="s0">// Multiple inheritance is also supported.</span>

<span class="s0">dclass DistributedObjectHolder : DistributedObject {</span>
  <span class="s0">dropObject(AvatarObject object);</span>

  <span class="s0">// You can also have an array of structs.  This specifies a</span>
  <span class="s0">// fixed-length array of five elements.  This is slightly more</span>
  <span class="s0">// optimal than an array of unrestricted length, since the length</span>
  <span class="s0">// prefix need not be transmitted as part of the message.</span>
  <span class="s0">setObjectList(AvatarObject objectArray[5]);</span>

  <span class="s0">// In addition to fixed-length arrays and unbounded arrays, you can</span>
  <span class="s0">// specify a range for the valid size of the array:</span>
  <span class="s0">setRelatedObjects(AvatarObject relatedObjects[0, 3 - 5] = []);</span>
<span class="s0">};</span>

<span class="s0">// You can specify a default initial value on the typedef, if you</span>
<span class="s0">// like.  This will be overridden by a default initial value specified</span>
<span class="s0">// on the instance.</span>
<span class="s0">typedef uint8(0-25) DNAColor = 1;</span>
  
<span class="s0">struct AvatarDNA {</span>
  <span class="s0">// This defines a character element that can be any one of the three</span>
  <span class="s0">// specified.  (It is similar in form to the uint8 definitions</span>
  <span class="s0">// below, except that the legal values are ASCII characters instead</span>
  <span class="s0">// of numbers.)</span>
  <span class="s0">char('a','q','x') type;</span>

  <span class="s0">// These specify one-byte numeric elements that can be any of the</span>
  <span class="s0">// values in the specified ranges.</span>
  <span class="s0">uint8(0-10) torsoIndex;</span>
  <span class="s0">uint8(0-5) headIndex;</span>
  <span class="s0">uint8(0-4) legsIndex;</span>

  <span class="s0">// A switch can be used to define alternate versions of the data</span>
  <span class="s0">// according to some value read from the stream.  In this example,</span>
  <span class="s0">// the alternate cases are very similar, but they need not be</span>
  <span class="s0">// similar at all.</span>
  <span class="s0">switch (uint8 gender) {</span>
  <span class="s0">case 1:</span>
    <span class="s0">// Girl clothes</span>
    <span class="s0">uint8(0-35) shirtIndex;</span>
    <span class="s0">DNAColor shirtColor;</span>
    <span class="s0">uint8(0-25) skirtIndex;</span>
    <span class="s0">DNAColor skirtColor;</span>
    <span class="s0">break;</span>

  <span class="s0">case 0:</span>
    <span class="s0">// Boy clothes</span>
    <span class="s0">uint8(0-20) shirtIndex;</span>
    <span class="s0">DNAColor shirtColor;</span>
    <span class="s0">uint8(0-15) shortsIndex;</span>
    <span class="s0">DNAColor shortsColor;</span>
    <span class="s0">break;</span>
  <span class="s0">};</span>

  <span class="s0">// Nested structure references.</span>
  <span class="s0">DNAColor armColor;</span>
  <span class="s0">DNAColor headColor;</span>
<span class="s0">};</span>


<span class="s0">dclass DistributedAvatar {</span>
  <span class="s0">// An example of defining the default value for a complex nested</span>
  <span class="s0">// field, like the above.</span>
  <span class="s0">setDNA(AvatarDNA dna = {'a', 1, 2, 3, { 1, 0, 1, 0, 1 }, 1, 1 }) required broadcast db;</span>
<span class="s0">};</span>
</pre>
</body>
</html>
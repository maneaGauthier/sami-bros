<html>
<head>
<title>runp3d.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #5f826b; font-style: italic;}
.s3 { color: #cf8e6d;}
.s4 { color: #bcbec4;}
.s5 { color: #2aacb8;}
.s6 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
runp3d.py</font>
</center></td></tr></table>
<pre><span class="s0">#! /usr/bin/env python</span>

<span class="s2">&quot;&quot;&quot; 
 
This tool will invoke the AppRunner to execute a packaged p3d 
application.  It requires that that the current Panda3D and Python 
versions match the version expected by the application. 
 
Normally, you do not need to use this tool; instead, use the provided 
standalone panda3d executable to invoke any p3d application.  Using 
panda3d will guarantee that the correct versions of Panda3D and Python 
are used to run the application.  However, there may be occasions when 
it is useful to use this tool to run the application with the current 
build instead of with its advertised version requirements. 
 
Usage: 
 
  runp3d.py app.p3d [args] 
 
The command-line arguments following the application name are passed 
into the application unchanged. 
 
See pack3d.p3d for an application that generates these p3d files. 
 
&quot;&quot;&quot;</span>

<span class="s3">import </span><span class="s1">sys</span>
<span class="s3">import </span><span class="s1">getopt</span>
<span class="s3">from </span><span class="s4">.</span><span class="s1">AppRunner </span><span class="s3">import </span><span class="s1">AppRunner</span><span class="s4">, </span><span class="s1">ArgumentError</span>
<span class="s3">from </span><span class="s1">direct</span><span class="s4">.</span><span class="s1">task</span><span class="s4">.</span><span class="s1">TaskManagerGlobal </span><span class="s3">import </span><span class="s1">taskMgr</span>
<span class="s3">from </span><span class="s1">panda3d</span><span class="s4">.</span><span class="s1">core </span><span class="s3">import </span><span class="s1">Filename</span>

<span class="s3">def </span><span class="s1">parseSysArgs</span><span class="s4">():</span>
    <span class="s2">&quot;&quot;&quot; Handles sys.argv, if there are any local arguments, and 
    returns a new argv suitable for passing into the 
    application. &quot;&quot;&quot;</span>

    <span class="s0"># We prefix a &quot;+&quot; sign, following the GNU convention, to tell</span>
    <span class="s0"># getopt not to parse options following the first non-option</span>
    <span class="s0"># parameter.</span>
    <span class="s1">opts</span><span class="s4">, </span><span class="s1">args </span><span class="s4">= </span><span class="s1">getopt</span><span class="s4">.</span><span class="s1">getopt</span><span class="s4">(</span><span class="s1">sys</span><span class="s4">.</span><span class="s1">argv</span><span class="s4">[</span><span class="s5">1</span><span class="s4">:], </span><span class="s6">'+h'</span><span class="s4">)</span>

    <span class="s3">for </span><span class="s1">option</span><span class="s4">, </span><span class="s1">value </span><span class="s3">in </span><span class="s1">opts</span><span class="s4">:</span>
        <span class="s3">if </span><span class="s1">option </span><span class="s4">== </span><span class="s6">'-h'</span><span class="s4">:</span>
            <span class="s1">print</span><span class="s4">(</span><span class="s1">__doc__</span><span class="s4">)</span>
            <span class="s1">sys</span><span class="s4">.</span><span class="s1">exit</span><span class="s4">(</span><span class="s5">1</span><span class="s4">)</span>

    <span class="s3">if not </span><span class="s1">args </span><span class="s3">or not </span><span class="s1">args</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]:</span>
        <span class="s3">raise </span><span class="s1">ArgumentError</span><span class="s4">(</span><span class="s6">&quot;No Panda app specified.  Use:</span><span class="s3">\n</span><span class="s6">runp3d.py app.p3d&quot;</span><span class="s4">)</span>

    <span class="s1">arg0 </span><span class="s4">= </span><span class="s1">args</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]</span>
    <span class="s1">p3dFilename </span><span class="s4">= </span><span class="s1">Filename</span><span class="s4">.</span><span class="s1">fromOsSpecific</span><span class="s4">(</span><span class="s1">arg0</span><span class="s4">)</span>
    <span class="s3">if </span><span class="s1">p3dFilename</span><span class="s4">.</span><span class="s1">exists</span><span class="s4">():</span>
        <span class="s1">p3dFilename</span><span class="s4">.</span><span class="s1">makeAbsolute</span><span class="s4">()</span>
        <span class="s1">arg0 </span><span class="s4">= </span><span class="s1">p3dFilename</span><span class="s4">.</span><span class="s1">toOsSpecific</span><span class="s4">()</span>

    <span class="s3">return </span><span class="s4">[</span><span class="s1">arg0</span><span class="s4">] + </span><span class="s1">args</span><span class="s4">[</span><span class="s5">1</span><span class="s4">:]</span>

<span class="s3">def </span><span class="s1">runPackedApp</span><span class="s4">(</span><span class="s1">pathname</span><span class="s4">):</span>
    <span class="s1">runner </span><span class="s4">= </span><span class="s1">AppRunner</span><span class="s4">()</span>
    <span class="s1">runner</span><span class="s4">.</span><span class="s1">gotWindow </span><span class="s4">= </span><span class="s3">True</span>
    <span class="s3">try</span><span class="s4">:</span>
        <span class="s1">runner</span><span class="s4">.</span><span class="s1">setP3DFilename</span><span class="s4">(</span><span class="s1">pathname</span><span class="s4">, </span><span class="s1">tokens </span><span class="s4">= [], </span><span class="s1">argv </span><span class="s4">= [],</span>
                              <span class="s1">instanceId </span><span class="s4">= </span><span class="s5">0</span><span class="s4">, </span><span class="s1">interactiveConsole </span><span class="s4">= </span><span class="s3">False</span><span class="s4">)</span>
    <span class="s3">except </span><span class="s1">ArgumentError </span><span class="s3">as </span><span class="s1">e</span><span class="s4">:</span>
        <span class="s1">print</span><span class="s4">(</span><span class="s1">e</span><span class="s4">.</span><span class="s1">args</span><span class="s4">[</span><span class="s5">0</span><span class="s4">])</span>
        <span class="s1">sys</span><span class="s4">.</span><span class="s1">exit</span><span class="s4">(</span><span class="s5">1</span><span class="s4">)</span>

<span class="s3">if </span><span class="s1">__name__ </span><span class="s4">== </span><span class="s6">'__main__'</span><span class="s4">:</span>
    <span class="s1">runner </span><span class="s4">= </span><span class="s1">AppRunner</span><span class="s4">()</span>
    <span class="s1">runner</span><span class="s4">.</span><span class="s1">gotWindow </span><span class="s4">= </span><span class="s3">True</span>
    <span class="s3">try</span><span class="s4">:</span>
        <span class="s1">argv </span><span class="s4">= </span><span class="s1">parseSysArgs</span><span class="s4">()</span>
        <span class="s1">runner</span><span class="s4">.</span><span class="s1">setP3DFilename</span><span class="s4">(</span><span class="s1">argv</span><span class="s4">[</span><span class="s5">0</span><span class="s4">], </span><span class="s1">tokens </span><span class="s4">= [], </span><span class="s1">argv </span><span class="s4">= </span><span class="s1">argv</span><span class="s4">,</span>
                              <span class="s1">instanceId </span><span class="s4">= </span><span class="s5">0</span><span class="s4">, </span><span class="s1">interactiveConsole </span><span class="s4">= </span><span class="s3">False</span><span class="s4">)</span>
    <span class="s3">except </span><span class="s1">ArgumentError </span><span class="s3">as </span><span class="s1">e</span><span class="s4">:</span>
        <span class="s1">print</span><span class="s4">(</span><span class="s1">e</span><span class="s4">.</span><span class="s1">args</span><span class="s4">[</span><span class="s5">0</span><span class="s4">])</span>
        <span class="s1">sys</span><span class="s4">.</span><span class="s1">exit</span><span class="s4">(</span><span class="s5">1</span><span class="s4">)</span>
    <span class="s1">taskMgr</span><span class="s4">.</span><span class="s1">run</span><span class="s4">()</span>
</pre>
</body>
</html>
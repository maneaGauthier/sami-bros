<html>
<head>
<title>mouse.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #7a7e85;}
.s5 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
mouse.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">time</span>
<span class="s0">import </span><span class="s1">traceback</span>
<span class="s0">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">CollisionTraverser</span><span class="s2">, </span><span class="s1">CollisionNode</span>
<span class="s0">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">CollisionHandlerQueue</span><span class="s2">, </span><span class="s1">CollisionRay</span>
<span class="s0">from </span><span class="s1">ursina </span><span class="s0">import </span><span class="s1">application</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">window </span><span class="s0">import </span><span class="s1">instance </span><span class="s0">as </span><span class="s1">window</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">scene </span><span class="s0">import </span><span class="s1">instance </span><span class="s0">as </span><span class="s1">scene</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">camera </span><span class="s0">import </span><span class="s1">instance </span><span class="s0">as </span><span class="s1">camera</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">hit_info </span><span class="s0">import </span><span class="s1">HitInfo</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">vec3 </span><span class="s0">import </span><span class="s1">Vec3</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">ursinamath </span><span class="s0">import </span><span class="s1">distance</span>


<span class="s0">class </span><span class="s1">Mouse</span><span class="s2">():</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">enabled </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">visible </span><span class="s2">= </span><span class="s0">True</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">locked </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_locked_mouse_last_frame </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">position </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">delta </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">)    </span><span class="s4"># movement since you pressed a mouse button.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">prev_x </span><span class="s2">= </span><span class="s3">0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">prev_y </span><span class="s2">= </span><span class="s3">0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">start_x </span><span class="s2">= </span><span class="s3">0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">start_y </span><span class="s2">= </span><span class="s3">0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">velocity </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">moving </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">prev_click_time </span><span class="s2">= </span><span class="s1">time</span><span class="s2">.</span><span class="s1">time</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">prev_click_pos </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">double_click_distance </span><span class="s2">= </span><span class="s3">.5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">double_click_movement_limit </span><span class="s2">= </span><span class="s3">.01</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity </span><span class="s2">= </span><span class="s0">None </span><span class="s4"># returns the closest hovered entity with a collider.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">left </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">right </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">middle </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">delta_drag </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">)   </span><span class="s4"># movement between left mouse down and left mouse up.</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">update_step </span><span class="s2">= </span><span class="s3">1</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">traverse_target </span><span class="s2">= </span><span class="s1">scene  </span><span class="s4"># set this to None to disable collision with scene, which might be a good idea if you have lots of colliders.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_i </span><span class="s2">= </span><span class="s3">0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_mouse_watcher </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_picker </span><span class="s2">= </span><span class="s1">CollisionTraverser</span><span class="s2">()  </span><span class="s4"># Make a traverser</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_pq </span><span class="s2">= </span><span class="s1">CollisionHandlerQueue</span><span class="s2">()  </span><span class="s4"># Make a handler</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNode </span><span class="s2">= </span><span class="s1">CollisionNode</span><span class="s2">(</span><span class="s5">'mouseRay'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNP </span><span class="s2">= </span><span class="s1">camera</span><span class="s2">.</span><span class="s1">attach_new_node</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNode</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerRay </span><span class="s2">= </span><span class="s1">CollisionRay</span><span class="s2">()  </span><span class="s4"># Make our ray</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNode</span><span class="s2">.</span><span class="s1">addSolid</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerRay</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_picker</span><span class="s2">.</span><span class="s1">addCollider</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNP</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_pq</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNode</span><span class="s2">.</span><span class="s1">set_into_collide_mask</span><span class="s2">(</span><span class="s3">0</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">raycast </span><span class="s2">= </span><span class="s0">True</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">collision </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">collisions </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">enabled </span><span class="s2">= </span><span class="s0">True</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">x</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_mouse_watcher</span><span class="s2">.</span><span class="s1">has_mouse</span><span class="s2">():</span>
            <span class="s0">return </span><span class="s3">0</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_mouse_watcher</span><span class="s2">.</span><span class="s1">getMouseX</span><span class="s2">() / </span><span class="s3">2 </span><span class="s2">* </span><span class="s1">window</span><span class="s2">.</span><span class="s1">aspect_ratio  </span><span class="s4"># same space as ui stuff</span>

    <span class="s2">@</span><span class="s1">x</span><span class="s2">.</span><span class="s1">setter</span>
    <span class="s0">def </span><span class="s1">x</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">position </span><span class="s2">= (</span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y</span><span class="s2">)</span>


    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">y</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_mouse_watcher</span><span class="s2">.</span><span class="s1">has_mouse</span><span class="s2">():</span>
            <span class="s0">return </span><span class="s3">0</span>

        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_mouse_watcher</span><span class="s2">.</span><span class="s1">getMouseY</span><span class="s2">() / </span><span class="s3">2</span>

    <span class="s2">@</span><span class="s1">y</span><span class="s2">.</span><span class="s1">setter</span>
    <span class="s0">def </span><span class="s1">y</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">position </span><span class="s2">= (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">x</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>


    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">position</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">x</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">position</span><span class="s2">.</span><span class="s1">setter</span>
    <span class="s0">def </span><span class="s1">position</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s0">if not </span><span class="s1">application</span><span class="s2">.</span><span class="s1">base</span><span class="s2">:</span>
            <span class="s0">return</span>
        <span class="s1">application</span><span class="s2">.</span><span class="s1">base</span><span class="s2">.</span><span class="s1">win</span><span class="s2">.</span><span class="s1">move_pointer</span><span class="s2">(</span>
            <span class="s3">0</span><span class="s2">,</span>
            <span class="s1">round</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s3">0</span><span class="s2">] + (</span><span class="s1">window</span><span class="s2">.</span><span class="s1">size</span><span class="s2">[</span><span class="s3">0</span><span class="s2">]/</span><span class="s3">2</span><span class="s2">) + (</span><span class="s1">value</span><span class="s2">[</span><span class="s3">0</span><span class="s2">]/</span><span class="s3">2</span><span class="s2">*</span><span class="s1">window</span><span class="s2">.</span><span class="s1">size</span><span class="s2">[</span><span class="s3">0</span><span class="s2">]) *</span><span class="s3">1.124</span><span class="s2">), </span><span class="s4"># no idea why I have * with 1.124</span>
            <span class="s1">round</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] + (</span><span class="s1">window</span><span class="s2">.</span><span class="s1">size</span><span class="s2">[</span><span class="s3">1</span><span class="s2">]/</span><span class="s3">2</span><span class="s2">) - (</span><span class="s1">value</span><span class="s2">[</span><span class="s3">1</span><span class="s2">]*</span><span class="s1">window</span><span class="s2">.</span><span class="s1">size</span><span class="s2">[</span><span class="s3">1</span><span class="s2">])),</span>
        <span class="s2">)</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">locked</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">if not </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_locked'</span><span class="s2">):</span>
            <span class="s0">return False</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_locked</span>

    <span class="s2">@</span><span class="s1">locked</span><span class="s2">.</span><span class="s1">setter</span>
    <span class="s0">def </span><span class="s1">locked</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_locked </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s0">if </span><span class="s1">value</span><span class="s2">:</span>
            <span class="s1">window</span><span class="s2">.</span><span class="s1">set_mouse_mode</span><span class="s2">(</span><span class="s1">window</span><span class="s2">.</span><span class="s1">M_confined</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">window</span><span class="s2">.</span><span class="s1">set_mouse_mode</span><span class="s2">(</span><span class="s1">window</span><span class="s2">.</span><span class="s1">M_absolute</span><span class="s2">)</span>

        <span class="s0">if not </span><span class="s1">application</span><span class="s2">.</span><span class="s1">base</span><span class="s2">:</span>
            <span class="s0">return</span>

        <span class="s4"># print('return', value)</span>
        <span class="s4"># self.position = Vec3(0,0,0)</span>
        <span class="s1">window</span><span class="s2">.</span><span class="s1">set_cursor_hidden</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">application</span><span class="s2">.</span><span class="s1">base</span><span class="s2">.</span><span class="s1">win</span><span class="s2">.</span><span class="s1">requestProperties</span><span class="s2">(</span><span class="s1">window</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_locked_mouse_last_frame </span><span class="s2">= </span><span class="s0">True</span>


    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">visible</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">if not </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_visible'</span><span class="s2">):</span>
            <span class="s0">return True</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visible</span>

    <span class="s2">@</span><span class="s1">visible</span><span class="s2">.</span><span class="s1">setter</span>
    <span class="s0">def </span><span class="s1">visible</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_visible </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s1">window</span><span class="s2">.</span><span class="s1">set_cursor_hidden</span><span class="s2">(</span><span class="s0">not </span><span class="s1">value</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">application</span><span class="s2">.</span><span class="s1">base</span><span class="s2">:</span>
            <span class="s1">application</span><span class="s2">.</span><span class="s1">base</span><span class="s2">.</span><span class="s1">win</span><span class="s2">.</span><span class="s1">requestProperties</span><span class="s2">(</span><span class="s1">window</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">key</span><span class="s2">):</span>
        <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">enabled</span><span class="s2">:</span>
            <span class="s0">return</span>

        <span class="s0">if </span><span class="s1">key</span><span class="s2">.</span><span class="s1">endswith</span><span class="s2">(</span><span class="s5">'mouse down'</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">start_x </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">x</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">start_y </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y</span>

        <span class="s0">elif </span><span class="s1">key</span><span class="s2">.</span><span class="s1">endswith</span><span class="s2">(</span><span class="s5">'mouse up'</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">delta_drag </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">x</span><span class="s2">-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">start_x</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y</span><span class="s2">-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">start_y</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">key </span><span class="s2">== </span><span class="s5">'left mouse down'</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">left </span><span class="s2">= </span><span class="s0">True</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity</span><span class="s2">, </span><span class="s5">'on_click'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">callable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity</span><span class="s2">.</span><span class="s1">on_click</span><span class="s2">):</span>
                    <span class="s0">try</span><span class="s2">:</span>
                        <span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity</span><span class="s2">.</span><span class="s1">on_click</span><span class="s2">()</span>
                    <span class="s0">except</span><span class="s2">:</span>
                        <span class="s1">print</span><span class="s2">(</span><span class="s1">traceback</span><span class="s2">.</span><span class="s1">format_exc</span><span class="s2">())</span>
                        <span class="s1">application</span><span class="s2">.</span><span class="s1">quit</span><span class="s2">()</span>

                <span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity</span><span class="s2">.</span><span class="s1">scripts</span><span class="s2">:</span>
                    <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">s</span><span class="s2">, </span><span class="s5">'on_click'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">callable</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">on_click</span><span class="s2">):</span>
                        <span class="s1">s</span><span class="s2">.</span><span class="s1">on_click</span><span class="s2">()</span>

            <span class="s4"># double click</span>
            <span class="s0">if </span><span class="s1">time</span><span class="s2">.</span><span class="s1">time</span><span class="s2">() - </span><span class="s1">self</span><span class="s2">.</span><span class="s1">prev_click_time </span><span class="s2">&lt;= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">double_click_distance</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">prev_click_pos </span><span class="s0">and </span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">x</span><span class="s2">-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">prev_click_pos</span><span class="s2">[</span><span class="s3">0</span><span class="s2">]) &gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">double_click_movement_limit </span><span class="s0">or </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">y</span><span class="s2">-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">prev_click_pos</span><span class="s2">[</span><span class="s3">1</span><span class="s2">]) &gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">double_click_movement_limit</span><span class="s2">):</span>
                    <span class="s0">return </span><span class="s4"># moused moved too much since previous click, so don't register double click.</span>

                <span class="s1">application</span><span class="s2">.</span><span class="s1">base</span><span class="s2">.</span><span class="s1">input</span><span class="s2">(</span><span class="s5">'double click'</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity</span><span class="s2">:</span>
                    <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity</span><span class="s2">, </span><span class="s5">'on_double_click'</span><span class="s2">):</span>
                        <span class="s0">try</span><span class="s2">:</span>
                            <span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity</span><span class="s2">.</span><span class="s1">on_double_click</span><span class="s2">()</span>
                        <span class="s0">except</span><span class="s2">:</span>
                            <span class="s1">print</span><span class="s2">(</span><span class="s1">traceback</span><span class="s2">.</span><span class="s1">format_exc</span><span class="s2">())</span>
                            <span class="s1">application</span><span class="s2">.</span><span class="s1">quit</span><span class="s2">()</span>

                    <span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity</span><span class="s2">.</span><span class="s1">scripts</span><span class="s2">:</span>
                        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">s</span><span class="s2">, </span><span class="s5">'on_double_click'</span><span class="s2">):</span>
                            <span class="s1">s</span><span class="s2">.</span><span class="s1">on_double_click</span><span class="s2">()</span>

            <span class="s1">self</span><span class="s2">.</span><span class="s1">prev_click_time </span><span class="s2">= </span><span class="s1">time</span><span class="s2">.</span><span class="s1">time</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">prev_click_pos </span><span class="s2">= (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">x</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y</span><span class="s2">)</span>


        <span class="s0">if </span><span class="s1">key </span><span class="s2">== </span><span class="s5">'left mouse up'</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">left </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s0">if </span><span class="s1">key </span><span class="s2">== </span><span class="s5">'right mouse down'</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">right </span><span class="s2">= </span><span class="s0">True</span>
        <span class="s0">if </span><span class="s1">key </span><span class="s2">== </span><span class="s5">'right mouse up'</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">right </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s0">if </span><span class="s1">key </span><span class="s2">== </span><span class="s5">'middle mouse down'</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">middle </span><span class="s2">= </span><span class="s0">True</span>
        <span class="s0">if </span><span class="s1">key </span><span class="s2">== </span><span class="s5">'middle mouse up'</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">middle </span><span class="s2">= </span><span class="s0">False</span>



    <span class="s0">def </span><span class="s1">update</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">application</span><span class="s2">.</span><span class="s1">window_type </span><span class="s2">!= </span><span class="s5">'onscreen'</span><span class="s2">:</span>
            <span class="s0">return</span>

        <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">enabled </span><span class="s0">or not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_mouse_watcher</span><span class="s2">.</span><span class="s1">has_mouse</span><span class="s2">() </span><span class="s0">or </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_locked_mouse_last_frame</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">velocity </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_locked_mouse_last_frame </span><span class="s2">= </span><span class="s0">False</span>
            <span class="s0">return</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">moving </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">x </span><span class="s2">+ </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y </span><span class="s2">!= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">prev_x </span><span class="s2">+ </span><span class="s1">self</span><span class="s2">.</span><span class="s1">prev_y</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">moving</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">locked</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">velocity </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">position</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">position </span><span class="s2">= (</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">velocity </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">x </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">prev_x</span><span class="s2">, (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">y </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">prev_y</span><span class="s2">) / </span><span class="s1">window</span><span class="s2">.</span><span class="s1">aspect_ratio </span><span class="s2">,</span><span class="s3">0</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">velocity </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">left </span><span class="s0">or </span><span class="s1">self</span><span class="s2">.</span><span class="s1">right </span><span class="s0">or </span><span class="s1">self</span><span class="s2">.</span><span class="s1">middle</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">delta </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">x </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">start_x</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">start_y</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">prev_x </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">x</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">prev_y </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y</span>


        <span class="s1">self</span><span class="s2">.</span><span class="s1">_i </span><span class="s2">+= </span><span class="s3">1</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_i </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">update_step</span><span class="s2">:</span>
            <span class="s0">return</span>
        <span class="s4"># collide with ui</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNP</span><span class="s2">.</span><span class="s1">reparent_to</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">.</span><span class="s1">ui_camera</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerRay</span><span class="s2">.</span><span class="s1">set_from_lens</span><span class="s2">(</span><span class="s1">camera</span><span class="s2">.</span><span class="s1">_ui_lens_node</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">x </span><span class="s2">* </span><span class="s3">2 </span><span class="s2">/ </span><span class="s1">window</span><span class="s2">.</span><span class="s1">aspect_ratio</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y </span><span class="s2">* </span><span class="s3">2</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_picker</span><span class="s2">.</span><span class="s1">traverse</span><span class="s2">(</span><span class="s1">camera</span><span class="s2">.</span><span class="s1">ui</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_pq</span><span class="s2">.</span><span class="s1">get_num_entries</span><span class="s2">() &gt; </span><span class="s3">0</span><span class="s2">:</span>
            <span class="s4"># print('collided with ui', self._pq.getNumEntries())</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">find_collision</span><span class="s2">()</span>
            <span class="s0">return</span>

        <span class="s4"># collide with world</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNP</span><span class="s2">.</span><span class="s1">reparent_to</span><span class="s2">(</span><span class="s1">camera</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerRay</span><span class="s2">.</span><span class="s1">set_from_lens</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">.</span><span class="s1">camera</span><span class="s2">.</span><span class="s1">lens_node</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">x </span><span class="s2">* </span><span class="s3">2 </span><span class="s2">/ </span><span class="s1">window</span><span class="s2">.</span><span class="s1">aspect_ratio</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y </span><span class="s2">* </span><span class="s3">2</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">traverse_target</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_picker</span><span class="s2">.</span><span class="s1">traverse</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">traverse_target</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_pq</span><span class="s2">.</span><span class="s1">get_num_entries</span><span class="s2">() &gt; </span><span class="s3">0</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">find_collision</span><span class="s2">()</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">collision </span><span class="s2">= </span><span class="s0">None</span>
            <span class="s4"># print('mouse miss', base.render)</span>
            <span class="s4"># unhover all if it didn't hit anything</span>
            <span class="s0">for </span><span class="s1">entity </span><span class="s0">in </span><span class="s1">scene</span><span class="s2">.</span><span class="s1">entities</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">entity</span><span class="s2">, </span><span class="s5">'hovered'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">entity</span><span class="s2">.</span><span class="s1">hovered</span><span class="s2">:</span>
                    <span class="s1">entity</span><span class="s2">.</span><span class="s1">hovered </span><span class="s2">= </span><span class="s0">False</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity </span><span class="s2">= </span><span class="s0">None</span>
                    <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">entity</span><span class="s2">, </span><span class="s5">'on_mouse_exit'</span><span class="s2">):</span>
                        <span class="s1">entity</span><span class="s2">.</span><span class="s1">on_mouse_exit</span><span class="s2">()</span>
                    <span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s1">entity</span><span class="s2">.</span><span class="s1">scripts</span><span class="s2">:</span>
                        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">s</span><span class="s2">, </span><span class="s5">'on_mouse_exit'</span><span class="s2">):</span>
                            <span class="s1">s</span><span class="s2">.</span><span class="s1">on_mouse_exit</span><span class="s2">()</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">normal</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s4"># returns the normal of the polygon, in local space.</span>
        <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collision </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">return None</span>
        <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">collision</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">world_normal</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s4"># returns the normal of the polygon, in world space.</span>
        <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collision </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">return None</span>
        <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">collision</span><span class="s2">.</span><span class="s1">world_normal</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">point</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s4"># returns the point hit, in local space</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collision </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">collision</span><span class="s2">.</span><span class="s1">point</span><span class="s2">)</span>
        <span class="s0">return None</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">world_point</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s4"># returns the point hit, in world space</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collision </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">collision</span><span class="s2">.</span><span class="s1">world_point</span><span class="s2">)</span>
        <span class="s0">return None</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">is_outside</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_mouse_watcher</span><span class="s2">.</span><span class="s1">has_mouse</span><span class="s2">()</span>


    <span class="s0">def </span><span class="s1">find_collision</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">collisions </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">collision </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">raycast </span><span class="s0">or </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_pq</span><span class="s2">.</span><span class="s1">get_num_entries</span><span class="s2">() == </span><span class="s3">0</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">unhover_everything_not_hit</span><span class="s2">()</span>
            <span class="s0">return False</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_pq</span><span class="s2">.</span><span class="s1">sortEntries</span><span class="s2">()</span>

        <span class="s0">for </span><span class="s1">entry </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_pq</span><span class="s2">.</span><span class="s1">getEntries</span><span class="s2">():</span>
            <span class="s0">for </span><span class="s1">entity </span><span class="s0">in </span><span class="s1">scene</span><span class="s2">.</span><span class="s1">entities</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">getIntoNodePath</span><span class="s2">().</span><span class="s1">parent </span><span class="s2">== </span><span class="s1">entity </span><span class="s0">and </span><span class="s1">entity</span><span class="s2">.</span><span class="s1">collision</span><span class="s2">:</span>
                    <span class="s0">if </span><span class="s1">entity</span><span class="s2">.</span><span class="s1">collision</span><span class="s2">:</span>
                        <span class="s1">hit </span><span class="s2">= </span><span class="s1">HitInfo</span><span class="s2">(</span>
                            <span class="s1">hit </span><span class="s2">= </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">collided</span><span class="s2">(),</span>
                            <span class="s1">entity </span><span class="s2">= </span><span class="s1">entity</span><span class="s2">,</span>
                            <span class="s1">distance </span><span class="s2">= </span><span class="s1">distance</span><span class="s2">(</span><span class="s1">entry</span><span class="s2">.</span><span class="s1">getSurfacePoint</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">), </span><span class="s1">camera</span><span class="s2">.</span><span class="s1">getPos</span><span class="s2">()),</span>
                            <span class="s1">point </span><span class="s2">= </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">getSurfacePoint</span><span class="s2">(</span><span class="s1">entity</span><span class="s2">),</span>
                            <span class="s1">world_point </span><span class="s2">= </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">getSurfacePoint</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">),</span>
                            <span class="s1">normal </span><span class="s2">= </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">getSurfaceNormal</span><span class="s2">(</span><span class="s1">entity</span><span class="s2">),</span>
                            <span class="s1">world_normal </span><span class="s2">= </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">getSurfaceNormal</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">),</span>
                            <span class="s2">)</span>
                        <span class="s1">self</span><span class="s2">.</span><span class="s1">collisions</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">hit</span><span class="s2">)</span>
                        <span class="s0">break</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collisions</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">collision </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collisions</span><span class="s2">[</span><span class="s3">0</span><span class="s2">]</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collision</span><span class="s2">.</span><span class="s1">entity</span>
            <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity</span><span class="s2">.</span><span class="s1">hovered</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity</span><span class="s2">.</span><span class="s1">hovered </span><span class="s2">= </span><span class="s0">True</span>
                <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity</span><span class="s2">, </span><span class="s5">'on_mouse_enter'</span><span class="s2">):</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity</span><span class="s2">.</span><span class="s1">on_mouse_enter</span><span class="s2">()</span>
                <span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity</span><span class="s2">.</span><span class="s1">scripts</span><span class="s2">:</span>
                    <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">s</span><span class="s2">, </span><span class="s5">'on_mouse_enter'</span><span class="s2">):</span>
                        <span class="s1">s</span><span class="s2">.</span><span class="s1">on_mouse_enter</span><span class="s2">()</span>


        <span class="s1">self</span><span class="s2">.</span><span class="s1">unhover_everything_not_hit</span><span class="s2">()</span>



    <span class="s0">def </span><span class="s1">unhover_everything_not_hit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">scene</span><span class="s2">.</span><span class="s1">entities</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">e </span><span class="s2">== </span><span class="s1">self</span><span class="s2">.</span><span class="s1">hovered_entity</span><span class="s2">:</span>
                <span class="s0">continue</span>

            <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">e</span><span class="s2">, </span><span class="s5">'hovered'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">e</span><span class="s2">.</span><span class="s1">hovered</span><span class="s2">:</span>
                <span class="s1">e</span><span class="s2">.</span><span class="s1">hovered </span><span class="s2">= </span><span class="s0">False</span>
                <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">e</span><span class="s2">, </span><span class="s5">'on_mouse_exit'</span><span class="s2">):</span>
                    <span class="s1">e</span><span class="s2">.</span><span class="s1">on_mouse_exit</span><span class="s2">()</span>
                <span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s1">e</span><span class="s2">.</span><span class="s1">scripts</span><span class="s2">:</span>
                    <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">s</span><span class="s2">, </span><span class="s5">'on_mouse_exit'</span><span class="s2">):</span>
                        <span class="s1">s</span><span class="s2">.</span><span class="s1">on_mouse_exit</span><span class="s2">()</span>



<span class="s1">instance </span><span class="s2">= </span><span class="s1">Mouse</span><span class="s2">()</span>


<span class="s0">if </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s5">'__main__'</span><span class="s2">:</span>
    <span class="s0">from </span><span class="s1">ursina </span><span class="s0">import </span><span class="s2">*</span>
    <span class="s0">from </span><span class="s1">ursina </span><span class="s0">import </span><span class="s1">Ursina</span><span class="s2">, </span><span class="s1">Button</span><span class="s2">, </span><span class="s1">mouse</span>
    <span class="s1">app </span><span class="s2">= </span><span class="s1">Ursina</span><span class="s2">()</span>
    <span class="s1">Button</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">=</span><span class="s1">scene</span><span class="s2">, </span><span class="s1">text</span><span class="s2">=</span><span class="s5">'a'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">input</span><span class="s2">(</span><span class="s1">key</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">key </span><span class="s2">== </span><span class="s5">'space'</span><span class="s2">:</span>
            <span class="s1">mouse</span><span class="s2">.</span><span class="s1">locked </span><span class="s2">= </span><span class="s0">not </span><span class="s1">mouse</span><span class="s2">.</span><span class="s1">locked</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s1">mouse</span><span class="s2">.</span><span class="s1">velocity</span><span class="s2">)</span>

    <span class="s4"># Cursor()</span>
    <span class="s4"># mouse.visible = False</span>


    <span class="s1">app</span><span class="s2">.</span><span class="s1">run</span><span class="s2">()</span>
</pre>
</body>
</html>
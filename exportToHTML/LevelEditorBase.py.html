<html>
<head>
<title>LevelEditorBase.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #7a7e85;}
.s5 { color: #2aacb8;}
.s6 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
LevelEditorBase.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Base class for Level Editor 
 
You should write your own LevelEditor class inheriting this. 
Refer LevelEditor.py for example. 
&quot;&quot;&quot;</span>

<span class="s2">from </span><span class="s1">direct</span><span class="s3">.</span><span class="s1">showbase</span><span class="s3">.</span><span class="s1">DirectObject </span><span class="s2">import </span><span class="s3">*</span>
<span class="s2">from </span><span class="s1">direct</span><span class="s3">.</span><span class="s1">directtools</span><span class="s3">.</span><span class="s1">DirectUtil </span><span class="s2">import </span><span class="s3">*</span>
<span class="s2">from </span><span class="s1">direct</span><span class="s3">.</span><span class="s1">gui</span><span class="s3">.</span><span class="s1">DirectGui </span><span class="s2">import </span><span class="s3">*</span>

<span class="s2">from </span><span class="s3">.</span><span class="s1">CurveEditor </span><span class="s2">import </span><span class="s3">*</span>
<span class="s2">from </span><span class="s3">.</span><span class="s1">FileMgr </span><span class="s2">import </span><span class="s3">*</span>
<span class="s2">from </span><span class="s3">.</span><span class="s1">ActionMgr </span><span class="s2">import </span><span class="s3">*</span>
<span class="s2">from </span><span class="s3">.</span><span class="s1">MayaConverter </span><span class="s2">import </span><span class="s3">*</span>

<span class="s2">class </span><span class="s1">LevelEditorBase</span><span class="s3">(</span><span class="s1">DirectObject</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; Base Class for Panda3D LevelEditor &quot;&quot;&quot;</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s4">#loadPrcFileData('startup', 'window-type none')</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">currentFile </span><span class="s3">= </span><span class="s2">None</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">fNeedToSave </span><span class="s3">= </span><span class="s2">False</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">actionEvents </span><span class="s3">= []</span>
        <span class="s4">#self.objectMgr = ObjectMgr(self)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">curveEditor </span><span class="s3">= </span><span class="s1">CurveEditor</span><span class="s3">(</span><span class="s1">self</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">fileMgr </span><span class="s3">= </span><span class="s1">FileMgr</span><span class="s3">(</span><span class="s1">self</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">actionMgr </span><span class="s3">= </span><span class="s1">ActionMgr</span><span class="s3">()</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">fMoveCamera </span><span class="s3">= </span><span class="s2">False</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">NPParent </span><span class="s3">= </span><span class="s1">render</span>

        <span class="s4"># define your own config file in inherited class</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">settingsFile </span><span class="s3">= </span><span class="s2">None</span>

        <span class="s4"># you can show/hide specific properties by using propertiesMask and this mode</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">BASE_MODE </span><span class="s3">= </span><span class="s1">BitMask32</span><span class="s3">.</span><span class="s1">bit</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">CREATE_CURVE_MODE </span><span class="s3">= </span><span class="s1">BitMask32</span><span class="s3">.</span><span class="s1">bit</span><span class="s3">(</span><span class="s5">2</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">EDIT_CURVE_MODE </span><span class="s3">= </span><span class="s1">BitMask32</span><span class="s3">.</span><span class="s1">bit</span><span class="s3">(</span><span class="s5">3</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ANIM_MODE </span><span class="s3">= </span><span class="s1">BitMask32</span><span class="s3">.</span><span class="s1">bit</span><span class="s3">(</span><span class="s5">4</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">GRAPH_EDITOR </span><span class="s3">= </span><span class="s2">False</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">mode </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">BASE_MODE</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">preMode </span><span class="s3">= </span><span class="s2">None</span>

    <span class="s2">def </span><span class="s1">initialize</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot; You should call this in your __init__ method of inherited LevelEditor class &quot;&quot;&quot;</span>
        <span class="s4"># specifiy what obj can be 'selected' as objects</span>
        <span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">selected</span><span class="s3">.</span><span class="s1">addTag</span><span class="s3">(</span><span class="s6">'OBJRoot'</span><span class="s3">)</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">actionEvents</span><span class="s3">.</span><span class="s1">extend</span><span class="s3">([</span>
            <span class="s4"># Node path events</span>
            <span class="s3">(</span><span class="s6">'DIRECT-select'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">select</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'DIRECT-delete'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">handleDelete</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'DIRECT-preDeselectAll'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">deselectAll</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'DIRECT_deselectAll'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">deselectAllCB</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'preRemoveNodePath'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">removeNodePathHook</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'DIRECT_deselectedNodePath'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">deselectAllCB</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'DIRECT_selectedNodePath_fMulti_fTag_fLEPane'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">selectedNodePathHook</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'DIRECT_deselectAll'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">deselectAll</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'LE-Undo'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">actionMgr</span><span class="s3">.</span><span class="s1">undo</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'LE-Redo'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">actionMgr</span><span class="s3">.</span><span class="s1">redo</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'LE-Duplicate'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">objectMgr</span><span class="s3">.</span><span class="s1">duplicateSelected</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'DIRECT_manipulateObjectCleanup'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">cleanUpManipulating</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'LE-MakeLive'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">objectMgr</span><span class="s3">.</span><span class="s1">makeSelectedLive</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'LE-NewScene'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">onNew</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'LE-SaveScene'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">onSave</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'LE-OpenScene'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">onOpen</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'LE-Quit'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">quit</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'DIRECT-mouse1'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">handleMouse1</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'DIRECT-mouse1Up'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">handleMouse1Up</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'DIRECT-mouse2'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">handleMouse2</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'DIRECT-mouse2Up'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">handleMouse2Up</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'DIRECT-mouse3'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">handleMouse3</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'DIRECT-mouse3Up'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">handleMouse3Up</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s6">'DIRECT-toggleWidgetVis'</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">toggleWidget</span><span class="s3">),</span>
            <span class="s3">])</span>

        <span class="s4"># Add all the action events</span>
        <span class="s2">for </span><span class="s1">event </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">actionEvents</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">event</span><span class="s3">) == </span><span class="s5">3</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">accept</span><span class="s3">(</span><span class="s1">event</span><span class="s3">[</span><span class="s5">0</span><span class="s3">], </span><span class="s1">event</span><span class="s3">[</span><span class="s5">1</span><span class="s3">], </span><span class="s1">event</span><span class="s3">[</span><span class="s5">2</span><span class="s3">])</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">accept</span><span class="s3">(</span><span class="s1">event</span><span class="s3">[</span><span class="s5">0</span><span class="s3">], </span><span class="s1">event</span><span class="s3">[</span><span class="s5">1</span><span class="s3">])</span>

        <span class="s4"># editor state text display such as edit mode</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">statusReadout </span><span class="s3">= </span><span class="s1">OnscreenText</span><span class="s3">(</span>
            <span class="s1">pos </span><span class="s3">= (-</span><span class="s5">1.2</span><span class="s3">, </span><span class="s5">0.9</span><span class="s3">), </span><span class="s1">bg</span><span class="s3">=</span><span class="s1">Vec4</span><span class="s3">(</span><span class="s5">1</span><span class="s3">,</span><span class="s5">1</span><span class="s3">,</span><span class="s5">1</span><span class="s3">,</span><span class="s5">1</span><span class="s3">),</span>
            <span class="s1">scale </span><span class="s3">= </span><span class="s5">0.05</span><span class="s3">, </span><span class="s1">align </span><span class="s3">= </span><span class="s1">TextNode</span><span class="s3">.</span><span class="s1">ALeft</span><span class="s3">,</span>
            <span class="s1">mayChange </span><span class="s3">= </span><span class="s5">1</span><span class="s3">, </span><span class="s1">font </span><span class="s3">= </span><span class="s1">TextNode</span><span class="s3">.</span><span class="s1">getDefaultFont</span><span class="s3">())</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">statusReadout</span><span class="s3">.</span><span class="s1">setText</span><span class="s3">(</span><span class="s6">&quot;&quot;</span><span class="s3">)</span>
        <span class="s4"># Make sure readout is never lit or drawn in wireframe</span>
        <span class="s1">useDirectRenderStyle</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">statusReadout</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">statusReadout</span><span class="s3">.</span><span class="s1">reparentTo</span><span class="s3">(</span><span class="s1">hidden</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">statusLines </span><span class="s3">= []</span>
        <span class="s1">taskMgr</span><span class="s3">.</span><span class="s1">doMethodLater</span><span class="s3">(</span><span class="s5">5</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">updateStatusReadoutTimeouts</span><span class="s3">, </span><span class="s6">'updateStatus'</span><span class="s3">)</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">loadSettings</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">reset</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">setTitleWithFilename</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">filename</span><span class="s3">=</span><span class="s6">&quot;&quot;</span><span class="s3">):</span>
        <span class="s1">title </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">appname</span>
        <span class="s2">if </span><span class="s1">filename </span><span class="s3">!= </span><span class="s6">&quot;&quot;</span><span class="s3">:</span>
           <span class="s1">filenameshort </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">basename</span><span class="s3">(</span><span class="s1">filename</span><span class="s3">)</span>
           <span class="s1">title </span><span class="s3">= </span><span class="s1">title </span><span class="s3">+ </span><span class="s6">&quot; (%s)&quot;</span><span class="s3">%</span><span class="s1">filenameshort</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">SetLabel</span><span class="s3">(</span><span class="s1">title</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">removeNodePathHook</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">nodePath</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">nodePath </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s2">return</span>
        <span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">deselect</span><span class="s3">(</span><span class="s1">nodePath</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">objectMgr</span><span class="s3">.</span><span class="s1">removeObjectByNodePath</span><span class="s3">(</span><span class="s1">nodePath</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">selected</span><span class="s3">.</span><span class="s1">last </span><span class="s2">is not None and </span><span class="s1">nodePath </span><span class="s3">== </span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">selected</span><span class="s3">.</span><span class="s1">last</span><span class="s3">:</span>
            <span class="s4"># if base.direct.selected.last is refering to this</span>
            <span class="s4"># removed obj, clear the reference</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">__builtins__</span><span class="s3">,</span><span class="s6">'last'</span><span class="s3">)):</span>
                <span class="s1">__builtins__</span><span class="s3">.</span><span class="s1">last </span><span class="s3">= </span><span class="s2">None</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">__builtins__</span><span class="s3">[</span><span class="s6">'last'</span><span class="s3">] = </span><span class="s2">None</span>
            <span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">selected</span><span class="s3">.</span><span class="s1">last </span><span class="s3">= </span><span class="s2">None</span>

    <span class="s2">def </span><span class="s1">toggleWidget</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">objectMgr</span><span class="s3">.</span><span class="s1">currNodePath</span><span class="s3">:</span>
            <span class="s1">obj </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">objectMgr</span><span class="s3">.</span><span class="s1">findObjectByNodePath</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">objectMgr</span><span class="s3">.</span><span class="s1">currNodePath</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">obj </span><span class="s2">and not </span><span class="s1">obj</span><span class="s3">[</span><span class="s1">OG</span><span class="s3">.</span><span class="s1">OBJ_DEF</span><span class="s3">].</span><span class="s1">movable</span><span class="s3">:</span>
                <span class="s2">return</span>
        <span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">toggleWidgetVis</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">handleMouse1</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">modifiers</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">fAlt </span><span class="s2">or </span><span class="s1">modifiers </span><span class="s3">== </span><span class="s5">4</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">fMoveCamera </span><span class="s3">= </span><span class="s2">True</span>
            <span class="s2">return</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">mode </span><span class="s3">== </span><span class="s1">self</span><span class="s3">.</span><span class="s1">CREATE_CURVE_MODE </span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">curveEditor</span><span class="s3">.</span><span class="s1">createCurve</span><span class="s3">()</span>


    <span class="s2">def </span><span class="s1">handleMouse1Up</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">fMoveCamera </span><span class="s3">= </span><span class="s2">False</span>


    <span class="s2">def </span><span class="s1">handleMouse2</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">modifiers</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">fAlt </span><span class="s2">or </span><span class="s1">modifiers </span><span class="s3">== </span><span class="s5">4</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">fMoveCamera </span><span class="s3">= </span><span class="s2">True</span>
            <span class="s2">return</span>

    <span class="s2">def </span><span class="s1">handleMouse2Up</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">fMoveCamera </span><span class="s3">= </span><span class="s2">False</span>

    <span class="s2">def </span><span class="s1">handleMouse3</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">modifiers</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">fAlt </span><span class="s2">or </span><span class="s1">modifiers </span><span class="s3">== </span><span class="s5">4</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">fMoveCamera </span><span class="s3">= </span><span class="s2">True</span>
            <span class="s2">return</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">onRightDown</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">handleMouse3Up</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">fMoveCamera </span><span class="s3">= </span><span class="s2">False</span>

    <span class="s2">def </span><span class="s1">handleDelete</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">oldSelectedNPs </span><span class="s3">= </span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">selected</span><span class="s3">.</span><span class="s1">getSelectedAsList</span><span class="s3">()</span>
        <span class="s1">oldUIDs </span><span class="s3">= []</span>
        <span class="s2">for </span><span class="s1">oldNP </span><span class="s2">in </span><span class="s1">oldSelectedNPs</span><span class="s3">:</span>
            <span class="s1">obj </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">objectMgr</span><span class="s3">.</span><span class="s1">findObjectByNodePath</span><span class="s3">(</span><span class="s1">oldNP</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">obj</span><span class="s3">:</span>
                <span class="s1">oldUIDs</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">[</span><span class="s1">OG</span><span class="s3">.</span><span class="s1">OBJ_UID</span><span class="s3">])</span>

        <span class="s1">action </span><span class="s3">= </span><span class="s1">ActionDeleteObj</span><span class="s3">(</span><span class="s1">self</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">actionMgr</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">action</span><span class="s3">)</span>
        <span class="s1">action</span><span class="s3">()</span>

        <span class="s2">for </span><span class="s1">uid </span><span class="s2">in </span><span class="s1">oldUIDs</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">sceneGraphUI</span><span class="s3">.</span><span class="s1">delete</span><span class="s3">(</span><span class="s1">uid</span><span class="s3">)</span>

<span class="s4">##         reply = wx.MessageBox(&quot;Do you want to delete selected?&quot;, &quot;Delete?&quot;,</span>
<span class="s4">##                               wx.YES_NO | wx.ICON_QUESTION)</span>
<span class="s4">##         if reply == wx.YES:</span>
<span class="s4">##             base.direct.removeAllSelected()</span>
<span class="s4">##         else:</span>
<span class="s4">##             # need to reset COA</span>
<span class="s4">##             dnp = base.direct.selected.last</span>
<span class="s4">##             # Update camera controls coa to this point</span>
<span class="s4">##             # Coa2Camera = Coa2Dnp * Dnp2Camera</span>
<span class="s4">##             mCoa2Camera = dnp.mCoa2Dnp * dnp.getMat(base.direct.camera)</span>
<span class="s4">##             row = mCoa2Camera.getRow(3)</span>
<span class="s4">##             coa = Vec3(row[0], row[1], row[2])</span>
<span class="s4">##             base.direct.cameraControl.updateCoa(coa)</span>

    <span class="s2">def </span><span class="s1">cleanUpManipulating</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">selectedNPs</span><span class="s3">):</span>
        <span class="s2">for </span><span class="s1">np </span><span class="s2">in </span><span class="s1">selectedNPs</span><span class="s3">:</span>
            <span class="s1">obj </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">objectMgr</span><span class="s3">.</span><span class="s1">findObjectByNodePath</span><span class="s3">(</span><span class="s1">np</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">obj</span><span class="s3">:</span>
                <span class="s1">action </span><span class="s3">= </span><span class="s1">ActionTransformObj</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">obj</span><span class="s3">[</span><span class="s1">OG</span><span class="s3">.</span><span class="s1">OBJ_UID</span><span class="s3">], </span><span class="s1">Mat4</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">getMat</span><span class="s3">()))</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">actionMgr</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">action</span><span class="s3">)</span>
                <span class="s1">action</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">select</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">nodePath</span><span class="s3">, </span><span class="s1">fMultiSelect</span><span class="s3">=</span><span class="s5">0</span><span class="s3">, </span><span class="s1">fSelectTag</span><span class="s3">=</span><span class="s5">1</span><span class="s3">, </span><span class="s1">fResetAncestry</span><span class="s3">=</span><span class="s5">1</span><span class="s3">, </span><span class="s1">fLEPane</span><span class="s3">=</span><span class="s5">0</span><span class="s3">, </span><span class="s1">fUndo</span><span class="s3">=</span><span class="s5">1</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">fUndo</span><span class="s3">:</span>
            <span class="s4"># Select tagged object if present</span>
            <span class="s2">if </span><span class="s1">fSelectTag</span><span class="s3">:</span>
                <span class="s2">for </span><span class="s1">tag </span><span class="s2">in </span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">selected</span><span class="s3">.</span><span class="s1">tagList</span><span class="s3">:</span>
                    <span class="s2">if </span><span class="s1">nodePath</span><span class="s3">.</span><span class="s1">hasNetTag</span><span class="s3">(</span><span class="s1">tag</span><span class="s3">):</span>
                        <span class="s1">nodePath </span><span class="s3">= </span><span class="s1">nodePath</span><span class="s3">.</span><span class="s1">findNetTag</span><span class="s3">(</span><span class="s1">tag</span><span class="s3">)</span>
                        <span class="s2">break</span>
            <span class="s1">action </span><span class="s3">= </span><span class="s1">ActionSelectObj</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">nodePath</span><span class="s3">, </span><span class="s1">fMultiSelect</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">actionMgr</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">action</span><span class="s3">)</span>
            <span class="s1">action</span><span class="s3">()</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">selectCB</span><span class="s3">(</span><span class="s1">nodePath</span><span class="s3">, </span><span class="s1">fMultiSelect</span><span class="s3">, </span><span class="s1">fSelectTag</span><span class="s3">, </span><span class="s1">fResetAncestry</span><span class="s3">, </span><span class="s1">fLEPane</span><span class="s3">, </span><span class="s1">fUndo</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">selectedNodePathHook</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">nodePath</span><span class="s3">, </span><span class="s1">fMultiSelect </span><span class="s3">= </span><span class="s5">0</span><span class="s3">, </span><span class="s1">fSelectTag </span><span class="s3">= </span><span class="s5">1</span><span class="s3">, </span><span class="s1">fLEPane </span><span class="s3">= </span><span class="s5">0</span><span class="s3">):</span>
        <span class="s4"># handle unpickable nodepath</span>
        <span class="s2">if </span><span class="s1">nodePath</span><span class="s3">.</span><span class="s1">getName</span><span class="s3">() </span><span class="s2">in </span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">iRay</span><span class="s3">.</span><span class="s1">unpickable</span><span class="s3">:</span>
            <span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">deselect</span><span class="s3">(</span><span class="s1">nodePath</span><span class="s3">)</span>
            <span class="s2">return</span>

        <span class="s2">if </span><span class="s1">fMultiSelect </span><span class="s3">== </span><span class="s5">0 </span><span class="s2">and </span><span class="s1">fLEPane </span><span class="s3">== </span><span class="s5">0</span><span class="s3">:</span>
           <span class="s1">oldSelectedNPs </span><span class="s3">= </span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">selected</span><span class="s3">.</span><span class="s1">getSelectedAsList</span><span class="s3">()</span>
           <span class="s2">for </span><span class="s1">oldNP </span><span class="s2">in </span><span class="s1">oldSelectedNPs</span><span class="s3">:</span>
              <span class="s1">obj </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">objectMgr</span><span class="s3">.</span><span class="s1">findObjectByNodePath</span><span class="s3">(</span><span class="s1">oldNP</span><span class="s3">)</span>
              <span class="s2">if </span><span class="s1">obj</span><span class="s3">:</span>
                 <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">sceneGraphUI</span><span class="s3">.</span><span class="s1">deSelect</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">[</span><span class="s1">OG</span><span class="s3">.</span><span class="s1">OBJ_UID</span><span class="s3">])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">objectMgr</span><span class="s3">.</span><span class="s1">selectObject</span><span class="s3">(</span><span class="s1">nodePath</span><span class="s3">, </span><span class="s1">fLEPane</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">buildContextMenu</span><span class="s3">(</span><span class="s1">nodePath</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">mode </span><span class="s3">== </span><span class="s1">self</span><span class="s3">.</span><span class="s1">EDIT_CURVE_MODE</span><span class="s3">:</span>
            <span class="s1">taskMgr</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">curveEditor</span><span class="s3">.</span><span class="s1">editCurve</span><span class="s3">, </span><span class="s6">&quot;modify&quot;</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">curveEditor</span><span class="s3">.</span><span class="s1">accept</span><span class="s3">(</span><span class="s6">&quot;DIRECT-enter&quot;</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">curveEditor</span><span class="s3">.</span><span class="s1">onBaseMode</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">deselectAll</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">np</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">selected</span><span class="s3">.</span><span class="s1">getSelectedAsList</span><span class="s3">()) ==</span><span class="s5">0</span><span class="s3">:</span>
            <span class="s2">return</span>
        <span class="s1">action </span><span class="s3">= </span><span class="s1">ActionDeselectAll</span><span class="s3">(</span><span class="s1">self</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">actionMgr</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">action</span><span class="s3">)</span>
        <span class="s1">action</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">deselectAllCB</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">dnp</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">objectMgr</span><span class="s3">.</span><span class="s1">deselectAll</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">reset</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">fNeedToSave</span><span class="s3">:</span>
            <span class="s1">reply </span><span class="s3">= </span><span class="s1">wx</span><span class="s3">.</span><span class="s1">MessageBox</span><span class="s3">(</span><span class="s6">&quot;Do you want to save current scene?&quot;</span><span class="s3">, </span><span class="s6">&quot;Save?&quot;</span><span class="s3">,</span>
                               <span class="s1">wx</span><span class="s3">.</span><span class="s1">YES_NO </span><span class="s3">| </span><span class="s1">wx</span><span class="s3">.</span><span class="s1">ICON_QUESTION</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">reply </span><span class="s3">== </span><span class="s1">wx</span><span class="s3">.</span><span class="s1">YES</span><span class="s3">:</span>
                <span class="s1">result </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">onSave</span><span class="s3">()</span>
                <span class="s2">if </span><span class="s1">result </span><span class="s3">== </span><span class="s2">False</span><span class="s3">:</span>
                    <span class="s2">return</span>

        <span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">deselectAll</span><span class="s3">()</span>
        <span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">selected</span><span class="s3">.</span><span class="s1">last </span><span class="s3">= </span><span class="s2">None</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">reset</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">objectMgr</span><span class="s3">.</span><span class="s1">reset</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">animMgr</span><span class="s3">.</span><span class="s1">reset</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">actionMgr</span><span class="s3">.</span><span class="s1">reset</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">perspView</span><span class="s3">.</span><span class="s1">camera</span><span class="s3">.</span><span class="s1">setPos</span><span class="s3">(-</span><span class="s5">19</span><span class="s3">, -</span><span class="s5">19</span><span class="s3">, </span><span class="s5">19</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">perspView</span><span class="s3">.</span><span class="s1">camera</span><span class="s3">.</span><span class="s1">lookAt</span><span class="s3">(</span><span class="s1">Point3</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">))</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">leftView</span><span class="s3">.</span><span class="s1">camera</span><span class="s3">.</span><span class="s1">setPos</span><span class="s3">(</span><span class="s5">600</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">frontView</span><span class="s3">.</span><span class="s1">camera</span><span class="s3">.</span><span class="s1">setPos</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, -</span><span class="s5">600</span><span class="s3">, </span><span class="s5">0</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">topView</span><span class="s3">.</span><span class="s1">camera</span><span class="s3">.</span><span class="s1">setPos</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">600</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">resetOrthoCam</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">topView</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">resetOrthoCam</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">frontView</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">resetOrthoCam</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">leftView</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">fNeedToSave </span><span class="s3">= </span><span class="s2">False</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">setTitleWithFilename</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">resetOrthoCam</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">view</span><span class="s3">):</span>
        <span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">drList</span><span class="s3">[</span><span class="s1">base</span><span class="s3">.</span><span class="s1">camList</span><span class="s3">.</span><span class="s1">index</span><span class="s3">(</span><span class="s1">NodePath</span><span class="s3">(</span><span class="s1">view</span><span class="s3">.</span><span class="s1">camNode</span><span class="s3">))].</span><span class="s1">orthoFactor </span><span class="s3">= </span><span class="s5">0.1</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">view</span><span class="s3">.</span><span class="s1">ClientSize</span><span class="s3">.</span><span class="s1">GetWidth</span><span class="s3">() * </span><span class="s5">0.1</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">view</span><span class="s3">.</span><span class="s1">ClientSize</span><span class="s3">.</span><span class="s1">GetHeight</span><span class="s3">() * </span><span class="s5">0.1</span>
        <span class="s1">view</span><span class="s3">.</span><span class="s1">camLens</span><span class="s3">.</span><span class="s1">setFilmSize</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">save</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">SetCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">StockCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">CURSOR_WAIT</span><span class="s3">))</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">currentFile</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">fileMgr</span><span class="s3">.</span><span class="s1">saveToFile</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">currentFile</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">SetCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">StockCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">CURSOR_ARROW</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">saveAs</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">fileName</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">SetCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">StockCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">CURSOR_WAIT</span><span class="s3">))</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">fileMgr</span><span class="s3">.</span><span class="s1">saveToFile</span><span class="s3">(</span><span class="s1">fileName</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">currentFile </span><span class="s3">= </span><span class="s1">fileName</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">SetCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">StockCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">CURSOR_ARROW</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">load</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">fileName</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">SetCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">StockCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">CURSOR_WAIT</span><span class="s3">))</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">reset</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">fileMgr</span><span class="s3">.</span><span class="s1">loadFromFile</span><span class="s3">(</span><span class="s1">fileName</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">currentFile </span><span class="s3">= </span><span class="s1">fileName</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">SetCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">StockCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">CURSOR_ARROW</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">saveSettings</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">settingsFile </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s2">return</span>

        <span class="s2">try</span><span class="s3">:</span>
            <span class="s1">f </span><span class="s3">= </span><span class="s1">open</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">settingsFile</span><span class="s3">, </span><span class="s6">'w'</span><span class="s3">)</span>
            <span class="s1">f</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s6">'gridSize</span><span class="s2">\n</span><span class="s6">%f</span><span class="s2">\n</span><span class="s6">'</span><span class="s3">%</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">perspView</span><span class="s3">.</span><span class="s1">grid</span><span class="s3">.</span><span class="s1">gridSize</span><span class="s3">)</span>
            <span class="s1">f</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s6">'gridSpacing</span><span class="s2">\n</span><span class="s6">%f</span><span class="s2">\n</span><span class="s6">'</span><span class="s3">%</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">perspView</span><span class="s3">.</span><span class="s1">grid</span><span class="s3">.</span><span class="s1">gridSpacing</span><span class="s3">)</span>
            <span class="s1">f</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s6">'hotKey</span><span class="s2">\n</span><span class="s6">%s</span><span class="s2">\n</span><span class="s6">'</span><span class="s3">%</span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">hotKeyMap</span><span class="s3">)</span>
            <span class="s1">f</span><span class="s3">.</span><span class="s1">close</span><span class="s3">()</span>
        <span class="s2">except</span><span class="s3">:</span>
            <span class="s2">pass</span>

    <span class="s2">def </span><span class="s1">loadSettings</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">settingsFile </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s2">return</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">SetCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">StockCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">CURSOR_WAIT</span><span class="s3">))</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s1">f </span><span class="s3">= </span><span class="s1">open</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">settingsFile</span><span class="s3">, </span><span class="s6">'r'</span><span class="s3">)</span>
            <span class="s1">configLines </span><span class="s3">= </span><span class="s1">f</span><span class="s3">.</span><span class="s1">readlines</span><span class="s3">()</span>
            <span class="s1">f</span><span class="s3">.</span><span class="s1">close</span><span class="s3">()</span>

            <span class="s1">gridSize </span><span class="s3">= </span><span class="s5">100.0</span>
            <span class="s1">gridSpacing </span><span class="s3">= </span><span class="s5">5.0</span>
            <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s1">len</span><span class="s3">(</span><span class="s1">configLines</span><span class="s3">)):</span>
                <span class="s1">line </span><span class="s3">= </span><span class="s1">configLines</span><span class="s3">[</span><span class="s1">i</span><span class="s3">]</span>
                <span class="s1">i </span><span class="s3">= </span><span class="s1">i </span><span class="s3">+ </span><span class="s5">1</span>
                <span class="s2">if </span><span class="s1">line</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s6">'gridSize'</span><span class="s3">):</span>
                    <span class="s1">gridSize </span><span class="s3">= </span><span class="s1">float</span><span class="s3">(</span><span class="s1">configLines</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>
                <span class="s2">elif </span><span class="s1">line</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s6">'gridSpacing'</span><span class="s3">):</span>
                    <span class="s1">gridSpacing </span><span class="s3">= </span><span class="s1">float</span><span class="s3">(</span><span class="s1">configLines</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>
                <span class="s2">elif </span><span class="s1">line</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s6">'hotKey'</span><span class="s3">):</span>
                    <span class="s1">customHotKeyMap </span><span class="s3">= </span><span class="s1">eval</span><span class="s3">(</span><span class="s1">configLines</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>
                    <span class="s1">customHotKeyDict </span><span class="s3">= {}</span>
                    <span class="s2">for </span><span class="s1">hotKey </span><span class="s2">in </span><span class="s1">customHotKeyMap</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">():</span>
                        <span class="s1">desc </span><span class="s3">= </span><span class="s1">customHotKeyMap</span><span class="s3">[</span><span class="s1">hotKey</span><span class="s3">]</span>
                        <span class="s1">customHotKeyDict</span><span class="s3">[</span><span class="s1">desc</span><span class="s3">[</span><span class="s5">1</span><span class="s3">]] = </span><span class="s1">hotKey</span>

                    <span class="s1">overriddenKeys </span><span class="s3">= []</span>
                    <span class="s2">for </span><span class="s1">key </span><span class="s2">in </span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">hotKeyMap</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">():</span>
                        <span class="s1">desc </span><span class="s3">= </span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">hotKeyMap</span><span class="s3">[</span><span class="s1">key</span><span class="s3">]</span>
                        <span class="s2">if </span><span class="s1">desc</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] </span><span class="s2">in </span><span class="s1">customHotKeyDict</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">():</span>
                            <span class="s1">overriddenKeys</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)</span>

                    <span class="s2">for </span><span class="s1">key </span><span class="s2">in </span><span class="s1">overriddenKeys</span><span class="s3">:</span>
                        <span class="s2">del </span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">hotKeyMap</span><span class="s3">[</span><span class="s1">key</span><span class="s3">]</span>

                    <span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">hotKeyMap</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">customHotKeyMap</span><span class="s3">)</span>

            <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">updateGrids</span><span class="s3">(</span><span class="s1">gridSize</span><span class="s3">, </span><span class="s1">gridSpacing</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">updateMenu</span><span class="s3">()</span>
        <span class="s2">except</span><span class="s3">:</span>
            <span class="s2">pass</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">SetCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">StockCursor</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">CURSOR_ARROW</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">convertMaya</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">modelname</span><span class="s3">, </span><span class="s1">callBack</span><span class="s3">, </span><span class="s1">obj</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">isAnim</span><span class="s3">=</span><span class="s2">False</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">obj </span><span class="s2">and </span><span class="s1">isAnim</span><span class="s3">:</span>
            <span class="s1">mayaConverter </span><span class="s3">= </span><span class="s1">MayaConverter</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">, </span><span class="s1">self</span><span class="s3">, </span><span class="s1">modelname</span><span class="s3">, </span><span class="s1">callBack</span><span class="s3">, </span><span class="s1">obj</span><span class="s3">, </span><span class="s1">isAnim</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">reply </span><span class="s3">= </span><span class="s1">wx</span><span class="s3">.</span><span class="s1">MessageBox</span><span class="s3">(</span><span class="s6">&quot;Is it an animation file?&quot;</span><span class="s3">, </span><span class="s6">&quot;Animation?&quot;</span><span class="s3">,</span>
                              <span class="s1">wx</span><span class="s3">.</span><span class="s1">YES_NO </span><span class="s3">| </span><span class="s1">wx</span><span class="s3">.</span><span class="s1">ICON_QUESTION</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">reply </span><span class="s3">== </span><span class="s1">wx</span><span class="s3">.</span><span class="s1">YES</span><span class="s3">:</span>
                <span class="s1">mayaConverter </span><span class="s3">= </span><span class="s1">MayaConverter</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">, </span><span class="s1">self</span><span class="s3">, </span><span class="s1">modelname</span><span class="s3">, </span><span class="s1">callBack</span><span class="s3">, </span><span class="s2">None</span><span class="s3">, </span><span class="s2">True</span><span class="s3">)</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">mayaConverter </span><span class="s3">= </span><span class="s1">MayaConverter</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">, </span><span class="s1">self</span><span class="s3">, </span><span class="s1">modelname</span><span class="s3">, </span><span class="s1">callBack</span><span class="s3">, </span><span class="s2">None</span><span class="s3">, </span><span class="s2">False</span><span class="s3">)</span>
        <span class="s1">mayaConverter</span><span class="s3">.</span><span class="s1">Show</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">convertFromMaya</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">modelname</span><span class="s3">, </span><span class="s1">callBack</span><span class="s3">):</span>
        <span class="s1">mayaConverter </span><span class="s3">= </span><span class="s1">MayaConverter</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">, </span><span class="s1">self</span><span class="s3">, </span><span class="s1">modelname</span><span class="s3">, </span><span class="s1">callBack</span><span class="s3">, </span><span class="s2">None</span><span class="s3">, </span><span class="s2">False</span><span class="s3">)</span>
        <span class="s1">mayaConverter</span><span class="s3">.</span><span class="s1">Show</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">exportToMaya</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">mayaFileName</span><span class="s3">):</span>
        <span class="s1">exportRootNP </span><span class="s3">= </span><span class="s1">render</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">exportToMayaCB</span><span class="s3">(</span><span class="s1">mayaFileName</span><span class="s3">, </span><span class="s1">exportRootNP</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">exportToMayaCB</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">mayaFileName</span><span class="s3">, </span><span class="s1">exportRootNP</span><span class="s3">):</span>
        <span class="s1">bamFileName </span><span class="s3">= </span><span class="s1">mayaFileName </span><span class="s3">+ </span><span class="s6">&quot;.bam&quot;</span>

        <span class="s2">if </span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">selected</span><span class="s3">.</span><span class="s1">last</span><span class="s3">:</span>
            <span class="s1">obj </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">objectMgr</span><span class="s3">.</span><span class="s1">findObjectByNodePath</span><span class="s3">(</span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">selected</span><span class="s3">.</span><span class="s1">last</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">obj</span><span class="s3">:</span>
                <span class="s1">exportRootNP </span><span class="s3">= </span><span class="s1">obj</span><span class="s3">[</span><span class="s1">OG</span><span class="s3">.</span><span class="s1">OBJ_NP</span><span class="s3">]</span>

        <span class="s1">exportRootNP</span><span class="s3">.</span><span class="s1">writeBamFile</span><span class="s3">(</span><span class="s1">bamFileName</span><span class="s3">)</span>
        <span class="s1">mayaConverter </span><span class="s3">= </span><span class="s1">MayaConverter</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">, </span><span class="s1">self</span><span class="s3">, </span><span class="s1">mayaFileName</span><span class="s3">, </span><span class="s2">None</span><span class="s3">, </span><span class="s2">None</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s1">FROM_BAM_TO_MAYA</span><span class="s3">)</span>
        <span class="s1">mayaConverter</span><span class="s3">.</span><span class="s1">Show</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">updateStatusReadout</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">status</span><span class="s3">, </span><span class="s1">color</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">status</span><span class="s3">:</span>
            <span class="s4"># add new status line, first check to see if it already exists</span>
            <span class="s1">alreadyExists </span><span class="s3">= </span><span class="s2">False</span>
            <span class="s2">for </span><span class="s1">currLine </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">statusLines</span><span class="s3">:</span>
                <span class="s2">if </span><span class="s3">(</span><span class="s1">status </span><span class="s3">== </span><span class="s1">currLine</span><span class="s3">[</span><span class="s5">1</span><span class="s3">]):</span>
                    <span class="s1">alreadyExists </span><span class="s3">= </span><span class="s2">True</span>
                    <span class="s2">break</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">alreadyExists </span><span class="s3">== </span><span class="s2">False</span><span class="s3">):</span>
                <span class="s1">time </span><span class="s3">= </span><span class="s1">globalClock</span><span class="s3">.</span><span class="s1">getRealTime</span><span class="s3">() + </span><span class="s5">15</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">statusLines</span><span class="s3">.</span><span class="s1">append</span><span class="s3">([</span><span class="s1">time</span><span class="s3">,</span><span class="s1">status</span><span class="s3">,</span><span class="s1">color</span><span class="s3">])</span>

        <span class="s4"># update display of new status lines</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">statusReadout</span><span class="s3">.</span><span class="s1">reparentTo</span><span class="s3">(</span><span class="s1">aspect2d</span><span class="s3">)</span>
        <span class="s1">statusText </span><span class="s3">= </span><span class="s6">&quot;&quot;</span>
        <span class="s1">lastColor </span><span class="s3">= </span><span class="s2">None</span>
        <span class="s2">for </span><span class="s1">currLine </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">statusLines</span><span class="s3">:</span>
            <span class="s1">statusText </span><span class="s3">+= </span><span class="s1">currLine</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] + </span><span class="s6">'</span><span class="s2">\n</span><span class="s6">'</span>
            <span class="s1">lastColor </span><span class="s3">= </span><span class="s1">currLine</span><span class="s3">[</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">statusReadout</span><span class="s3">.</span><span class="s1">setText</span><span class="s3">(</span><span class="s1">statusText</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">lastColor</span><span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">statusReadout</span><span class="s3">.</span><span class="s1">textNode</span><span class="s3">.</span><span class="s1">setCardColor</span><span class="s3">(</span>
                <span class="s1">lastColor</span><span class="s3">[</span><span class="s5">0</span><span class="s3">], </span><span class="s1">lastColor</span><span class="s3">[</span><span class="s5">1</span><span class="s3">], </span><span class="s1">lastColor</span><span class="s3">[</span><span class="s5">2</span><span class="s3">], </span><span class="s1">lastColor</span><span class="s3">[</span><span class="s5">3</span><span class="s3">])</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">statusReadout</span><span class="s3">.</span><span class="s1">textNode</span><span class="s3">.</span><span class="s1">setCardAsMargin</span><span class="s3">(</span><span class="s5">0.1</span><span class="s3">, </span><span class="s5">0.1</span><span class="s3">, </span><span class="s5">0.1</span><span class="s3">, </span><span class="s5">0.1</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">statusReadout</span><span class="s3">.</span><span class="s1">textNode</span><span class="s3">.</span><span class="s1">setCardColor</span><span class="s3">(</span><span class="s5">1</span><span class="s3">,</span><span class="s5">1</span><span class="s3">,</span><span class="s5">1</span><span class="s3">,</span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">statusReadout</span><span class="s3">.</span><span class="s1">textNode</span><span class="s3">.</span><span class="s1">setCardAsMargin</span><span class="s3">(</span><span class="s5">0.1</span><span class="s3">, </span><span class="s5">0.1</span><span class="s3">, </span><span class="s5">0.1</span><span class="s3">, </span><span class="s5">0.1</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">updateStatusReadoutTimeouts</span><span class="s3">(</span><span class="s1">self</span><span class="s3">,</span><span class="s1">task</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
        <span class="s1">removalList </span><span class="s3">= []</span>
        <span class="s2">for </span><span class="s1">currLine </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">statusLines</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">globalClock</span><span class="s3">.</span><span class="s1">getRealTime</span><span class="s3">() &gt;= </span><span class="s1">currLine</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]):</span>
                <span class="s1">removalList</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">currLine</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">currRemoval </span><span class="s2">in </span><span class="s1">removalList</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">statusLines</span><span class="s3">.</span><span class="s1">remove</span><span class="s3">(</span><span class="s1">currRemoval</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">updateStatusReadout</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>
        <span class="s4"># perform doMethodLater again after delay</span>
        <span class="s4"># This crashes when CTRL-C'ing, so this is a cheap hack.</span>
        <span class="s4">#return 2</span>
        <span class="s2">from </span><span class="s1">direct</span><span class="s3">.</span><span class="s1">task </span><span class="s2">import </span><span class="s1">Task</span>
        <span class="s2">return </span><span class="s1">Task</span><span class="s3">.</span><span class="s1">again</span>

    <span class="s2">def </span><span class="s1">propMeetsReq</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">typeName</span><span class="s3">, </span><span class="s1">parentNP</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ui</span><span class="s3">.</span><span class="s1">parentToSelectedMenuItem</span><span class="s3">.</span><span class="s1">IsChecked</span><span class="s3">():</span>
           <span class="s2">if </span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">selected</span><span class="s3">.</span><span class="s1">last</span><span class="s3">:</span>
              <span class="s1">parent </span><span class="s3">= </span><span class="s1">base</span><span class="s3">.</span><span class="s1">le</span><span class="s3">.</span><span class="s1">objectMgr</span><span class="s3">.</span><span class="s1">findObjectByNodePath</span><span class="s3">(</span><span class="s1">base</span><span class="s3">.</span><span class="s1">direct</span><span class="s3">.</span><span class="s1">selected</span><span class="s3">.</span><span class="s1">last</span><span class="s3">)</span>
              <span class="s2">if </span><span class="s1">parent</span><span class="s3">:</span>
                 <span class="s1">parentNP</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] = </span><span class="s1">parent</span><span class="s3">[</span><span class="s1">OG</span><span class="s3">.</span><span class="s1">OBJ_NP</span><span class="s3">]</span>
        <span class="s2">else</span><span class="s3">:</span>
           <span class="s1">parentNP</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] = </span><span class="s2">None</span>
        <span class="s2">return True</span>
</pre>
</body>
</html>
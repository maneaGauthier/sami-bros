<html>
<head>
<title>pfreeze.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #5f826b; font-style: italic;}
.s3 { color: #cf8e6d;}
.s4 { color: #bcbec4;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
pfreeze.py</font>
</center></td></tr></table>
<pre><span class="s0">#! /usr/bin/env python</span>

<span class="s2">&quot;&quot;&quot; 
 
This script can be used to produce a standalone executable from 
arbitrary Python code.  You supply the name of the starting Python 
file to import, and this script attempts to generate an executable 
that will produce the same results as &quot;python startfile.py&quot;. 
 
This script is actually a wrapper around Panda's FreezeTool.py, which 
is itself a tool to use Python's built-in &quot;freeze&quot; utility to compile 
Python code into a standalone executable.  It also uses Python's 
built-in modulefinder module, which it uses to find all of the modules 
imported directly or indirectly by the original startfile.py. 
 
Usage:: 
 
  pfreeze.py [opts] [startfile] 
 
Options:: 
 
  -o output 
     Specifies the name of the resulting executable file to produce. 
     If this ends in &quot;.mf&quot;, a multifile is written instead of a frozen 
     binary.  If it ends in &quot;.dll&quot;, &quot;.pyd&quot;, or &quot;.so&quot;, a shared library 
     is written. 
 
  -x module[,module...] 
     Specifies a comma-separated list of Python modules to exclude from 
     the resulting file, even if they appear to be referenced.  You 
     may also repeat the -x command for each module. 
 
  -i module[,module...] 
     Specifies a comma-separated list of Python modules to include in 
     the resulting file, even if they do not appear to be referenced. 
     You may also repeat the -i command for each module. 
 
  -p module[,module...] 
     Specifies a list of Python modules that do run-time manipulation 
     of the __path__ variable, and thus must be actually imported to 
     determine the true value of __path__. 
 
  -P path 
     Specifies an additional directory in which we should search for 
     Python modules.  This is equivalent to setting the PYTHONPATH 
     environment variable.  May be repeated. 
 
  -s 
     Adds the standard set of modules that are necessary for embedding 
     the Python interpreter.  Implicitly set if an executable is 
     generated. 
 
  -k 
     Keeps temporary files generated by pfreeze.  Useful when debugging 
     FreezeTool itself. 
 
&quot;&quot;&quot;</span>

<span class="s3">import </span><span class="s1">getopt</span>
<span class="s3">import </span><span class="s1">sys</span>
<span class="s3">import </span><span class="s1">os</span>
<span class="s3">from </span><span class="s4">. </span><span class="s3">import </span><span class="s1">FreezeTool</span>

<span class="s3">def </span><span class="s1">usage</span><span class="s4">(</span><span class="s1">code</span><span class="s4">, </span><span class="s1">msg </span><span class="s4">= </span><span class="s5">''</span><span class="s4">):</span>
    <span class="s3">if </span><span class="s1">__doc__</span><span class="s4">:</span>
        <span class="s1">sys</span><span class="s4">.</span><span class="s1">stderr</span><span class="s4">.</span><span class="s1">write</span><span class="s4">(</span><span class="s1">__doc__ </span><span class="s4">+ </span><span class="s5">'</span><span class="s3">\n</span><span class="s5">'</span><span class="s4">)</span>
    <span class="s1">sys</span><span class="s4">.</span><span class="s1">stderr</span><span class="s4">.</span><span class="s1">write</span><span class="s4">(</span><span class="s1">str</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">) + </span><span class="s5">'</span><span class="s3">\n</span><span class="s5">'</span><span class="s4">)</span>
    <span class="s1">sys</span><span class="s4">.</span><span class="s1">exit</span><span class="s4">(</span><span class="s1">code</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">main</span><span class="s4">(</span><span class="s1">args</span><span class="s4">=</span><span class="s3">None</span><span class="s4">):</span>
    <span class="s3">if </span><span class="s1">args </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s1">args </span><span class="s4">= </span><span class="s1">sys</span><span class="s4">.</span><span class="s1">argv</span><span class="s4">[</span><span class="s6">1</span><span class="s4">:]</span>

    <span class="s1">freezer </span><span class="s4">= </span><span class="s1">FreezeTool</span><span class="s4">.</span><span class="s1">Freezer</span><span class="s4">()</span>

    <span class="s1">basename </span><span class="s4">= </span><span class="s3">None</span>
    <span class="s1">addStartupModules </span><span class="s4">= </span><span class="s3">False</span>

    <span class="s3">try</span><span class="s4">:</span>
        <span class="s1">opts</span><span class="s4">, </span><span class="s1">args </span><span class="s4">= </span><span class="s1">getopt</span><span class="s4">.</span><span class="s1">getopt</span><span class="s4">(</span><span class="s1">args</span><span class="s4">, </span><span class="s5">'o:i:x:p:P:slkh'</span><span class="s4">)</span>
    <span class="s3">except </span><span class="s1">getopt</span><span class="s4">.</span><span class="s1">error </span><span class="s3">as </span><span class="s1">msg</span><span class="s4">:</span>
        <span class="s1">usage</span><span class="s4">(</span><span class="s6">1</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">)</span>

    <span class="s3">for </span><span class="s1">opt</span><span class="s4">, </span><span class="s1">arg </span><span class="s3">in </span><span class="s1">opts</span><span class="s4">:</span>
        <span class="s3">if </span><span class="s1">opt </span><span class="s4">== </span><span class="s5">'-o'</span><span class="s4">:</span>
            <span class="s1">basename </span><span class="s4">= </span><span class="s1">arg</span>
        <span class="s3">elif </span><span class="s1">opt </span><span class="s4">== </span><span class="s5">'-i'</span><span class="s4">:</span>
            <span class="s3">for </span><span class="s1">module </span><span class="s3">in </span><span class="s1">arg</span><span class="s4">.</span><span class="s1">split</span><span class="s4">(</span><span class="s5">','</span><span class="s4">):</span>
                <span class="s1">freezer</span><span class="s4">.</span><span class="s1">addModule</span><span class="s4">(</span><span class="s1">module</span><span class="s4">)</span>
        <span class="s3">elif </span><span class="s1">opt </span><span class="s4">== </span><span class="s5">'-x'</span><span class="s4">:</span>
            <span class="s3">for </span><span class="s1">module </span><span class="s3">in </span><span class="s1">arg</span><span class="s4">.</span><span class="s1">split</span><span class="s4">(</span><span class="s5">','</span><span class="s4">):</span>
                <span class="s1">freezer</span><span class="s4">.</span><span class="s1">excludeModule</span><span class="s4">(</span><span class="s1">module</span><span class="s4">)</span>
        <span class="s3">elif </span><span class="s1">opt </span><span class="s4">== </span><span class="s5">'-p'</span><span class="s4">:</span>
            <span class="s3">for </span><span class="s1">module </span><span class="s3">in </span><span class="s1">arg</span><span class="s4">.</span><span class="s1">split</span><span class="s4">(</span><span class="s5">','</span><span class="s4">):</span>
                <span class="s1">freezer</span><span class="s4">.</span><span class="s1">handleCustomPath</span><span class="s4">(</span><span class="s1">module</span><span class="s4">)</span>
        <span class="s3">elif </span><span class="s1">opt </span><span class="s4">== </span><span class="s5">'-P'</span><span class="s4">:</span>
            <span class="s1">sys</span><span class="s4">.</span><span class="s1">path</span><span class="s4">.</span><span class="s1">append</span><span class="s4">(</span><span class="s1">arg</span><span class="s4">)</span>
        <span class="s3">elif </span><span class="s1">opt </span><span class="s4">== </span><span class="s5">'-s'</span><span class="s4">:</span>
            <span class="s1">addStartupModules </span><span class="s4">= </span><span class="s3">True</span>
        <span class="s3">elif </span><span class="s1">opt </span><span class="s4">== </span><span class="s5">'-l'</span><span class="s4">:</span>
            <span class="s1">freezer</span><span class="s4">.</span><span class="s1">linkExtensionModules </span><span class="s4">= </span><span class="s3">True</span>
        <span class="s3">elif </span><span class="s1">opt </span><span class="s4">== </span><span class="s5">'-k'</span><span class="s4">:</span>
            <span class="s1">freezer</span><span class="s4">.</span><span class="s1">keepTemporaryFiles </span><span class="s4">= </span><span class="s3">True</span>
        <span class="s3">elif </span><span class="s1">opt </span><span class="s4">== </span><span class="s5">'-h'</span><span class="s4">:</span>
            <span class="s1">usage</span><span class="s4">(</span><span class="s6">0</span><span class="s4">)</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s1">print</span><span class="s4">(</span><span class="s5">'illegal option: ' </span><span class="s4">+ </span><span class="s1">flag</span><span class="s4">)</span>
            <span class="s1">sys</span><span class="s4">.</span><span class="s1">exit</span><span class="s4">(</span><span class="s6">1</span><span class="s4">)</span>

    <span class="s3">if not </span><span class="s1">basename</span><span class="s4">:</span>
        <span class="s1">usage</span><span class="s4">(</span><span class="s6">1</span><span class="s4">, </span><span class="s5">'You did not specify an output file.'</span><span class="s4">)</span>

    <span class="s3">if </span><span class="s1">len</span><span class="s4">(</span><span class="s1">args</span><span class="s4">) &gt; </span><span class="s6">1</span><span class="s4">:</span>
        <span class="s1">usage</span><span class="s4">(</span><span class="s6">1</span><span class="s4">, </span><span class="s5">'Only one main file may be specified.'</span><span class="s4">)</span>

    <span class="s1">outputType </span><span class="s4">= </span><span class="s5">'exe'</span>
    <span class="s1">bl </span><span class="s4">= </span><span class="s1">basename</span><span class="s4">.</span><span class="s1">lower</span><span class="s4">()</span>
    <span class="s3">if </span><span class="s1">bl</span><span class="s4">.</span><span class="s1">endswith</span><span class="s4">(</span><span class="s5">'.mf'</span><span class="s4">):</span>
        <span class="s1">outputType </span><span class="s4">= </span><span class="s5">'mf'</span>
    <span class="s3">elif </span><span class="s1">bl</span><span class="s4">.</span><span class="s1">endswith</span><span class="s4">(</span><span class="s5">'.c'</span><span class="s4">):</span>
        <span class="s1">outputType </span><span class="s4">= </span><span class="s5">'c'</span>
    <span class="s3">elif </span><span class="s1">bl</span><span class="s4">.</span><span class="s1">endswith</span><span class="s4">(</span><span class="s5">'.dll'</span><span class="s4">) </span><span class="s3">or </span><span class="s1">bl</span><span class="s4">.</span><span class="s1">endswith</span><span class="s4">(</span><span class="s5">'.pyd'</span><span class="s4">) </span><span class="s3">or </span><span class="s1">bl</span><span class="s4">.</span><span class="s1">endswith</span><span class="s4">(</span><span class="s5">'.so'</span><span class="s4">):</span>
        <span class="s1">basename </span><span class="s4">= </span><span class="s1">os</span><span class="s4">.</span><span class="s1">path</span><span class="s4">.</span><span class="s1">splitext</span><span class="s4">(</span><span class="s1">basename</span><span class="s4">)[</span><span class="s6">0</span><span class="s4">]</span>
        <span class="s1">outputType </span><span class="s4">= </span><span class="s5">'dll'</span>
    <span class="s3">elif </span><span class="s1">bl</span><span class="s4">.</span><span class="s1">endswith</span><span class="s4">(</span><span class="s5">'.exe'</span><span class="s4">):</span>
        <span class="s1">basename </span><span class="s4">= </span><span class="s1">os</span><span class="s4">.</span><span class="s1">path</span><span class="s4">.</span><span class="s1">splitext</span><span class="s4">(</span><span class="s1">basename</span><span class="s4">)[</span><span class="s6">0</span><span class="s4">]</span>

    <span class="s1">compileToExe </span><span class="s4">= </span><span class="s3">False</span>
    <span class="s3">if </span><span class="s1">args</span><span class="s4">:</span>
        <span class="s1">startfile </span><span class="s4">= </span><span class="s1">args</span><span class="s4">[</span><span class="s6">0</span><span class="s4">]</span>
        <span class="s1">startmod </span><span class="s4">= </span><span class="s1">startfile</span>
        <span class="s3">if </span><span class="s1">startfile</span><span class="s4">.</span><span class="s1">endswith</span><span class="s4">(</span><span class="s5">'.py'</span><span class="s4">) </span><span class="s3">or </span><span class="s1">startfile</span><span class="s4">.</span><span class="s1">endswith</span><span class="s4">(</span><span class="s5">'.pyw'</span><span class="s4">) </span><span class="s3">or </span><span class="s1">\</span>
        <span class="s1">startfile</span><span class="s4">.</span><span class="s1">endswith</span><span class="s4">(</span><span class="s5">'.pyc'</span><span class="s4">) </span><span class="s3">or </span><span class="s1">startfile</span><span class="s4">.</span><span class="s1">endswith</span><span class="s4">(</span><span class="s5">'.pyo'</span><span class="s4">):</span>
            <span class="s1">startmod </span><span class="s4">= </span><span class="s1">os</span><span class="s4">.</span><span class="s1">path</span><span class="s4">.</span><span class="s1">splitext</span><span class="s4">(</span><span class="s1">startfile</span><span class="s4">)[</span><span class="s6">0</span><span class="s4">]</span>

        <span class="s3">if </span><span class="s1">outputType </span><span class="s4">== </span><span class="s5">'dll' </span><span class="s3">or </span><span class="s1">outputType </span><span class="s4">== </span><span class="s5">'c'</span><span class="s4">:</span>
            <span class="s1">freezer</span><span class="s4">.</span><span class="s1">addModule</span><span class="s4">(</span><span class="s1">startmod</span><span class="s4">, </span><span class="s1">filename </span><span class="s4">= </span><span class="s1">startfile</span><span class="s4">)</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s1">freezer</span><span class="s4">.</span><span class="s1">addModule</span><span class="s4">(</span><span class="s5">'__main__'</span><span class="s4">, </span><span class="s1">filename </span><span class="s4">= </span><span class="s1">startfile</span><span class="s4">)</span>
            <span class="s1">compileToExe </span><span class="s4">= </span><span class="s3">True</span>
            <span class="s1">addStartupModules </span><span class="s4">= </span><span class="s3">True</span>

    <span class="s3">elif </span><span class="s1">outputType </span><span class="s4">== </span><span class="s5">'exe'</span><span class="s4">:</span>
        <span class="s0"># We must have a main module when making an executable.</span>
        <span class="s1">usage</span><span class="s4">(</span><span class="s6">1</span><span class="s4">, </span><span class="s5">'A main file needs to be specified when creating an executable.'</span><span class="s4">)</span>

    <span class="s1">freezer</span><span class="s4">.</span><span class="s1">done</span><span class="s4">(</span><span class="s1">addStartupModules </span><span class="s4">= </span><span class="s1">addStartupModules</span><span class="s4">)</span>

    <span class="s3">if </span><span class="s1">outputType </span><span class="s4">== </span><span class="s5">'mf'</span><span class="s4">:</span>
        <span class="s1">freezer</span><span class="s4">.</span><span class="s1">writeMultifile</span><span class="s4">(</span><span class="s1">basename</span><span class="s4">)</span>
    <span class="s3">elif </span><span class="s1">outputType </span><span class="s4">== </span><span class="s5">'c'</span><span class="s4">:</span>
        <span class="s1">freezer</span><span class="s4">.</span><span class="s1">writeCode</span><span class="s4">(</span><span class="s1">basename</span><span class="s4">)</span>
    <span class="s3">else</span><span class="s4">:</span>
        <span class="s1">freezer</span><span class="s4">.</span><span class="s1">generateCode</span><span class="s4">(</span><span class="s1">basename</span><span class="s4">, </span><span class="s1">compileToExe </span><span class="s4">= </span><span class="s1">compileToExe</span><span class="s4">)</span>

    <span class="s3">return </span><span class="s6">0</span>


<span class="s3">if </span><span class="s1">__name__ </span><span class="s4">== </span><span class="s5">'__main__'</span><span class="s4">:</span>
    <span class="s1">sys</span><span class="s4">.</span><span class="s1">exit</span><span class="s4">(</span><span class="s1">main</span><span class="s4">())</span>
</pre>
</body>
</html>
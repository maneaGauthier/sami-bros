<html>
<head>
<title>input_handler.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #7a7e85;}
.s5 { color: #2aacb8;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
input_handler.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">collections </span><span class="s0">import </span><span class="s1">defaultdict</span>
<span class="s0">from </span><span class="s1">enum </span><span class="s0">import </span><span class="s1">Enum</span>


<span class="s0">class </span><span class="s1">Keys</span><span class="s2">(</span><span class="s1">Enum</span><span class="s2">):</span>
    <span class="s1">left_mouse_down </span><span class="s2">= </span><span class="s3">'left mouse down'</span>
    <span class="s1">left_mouse_up </span><span class="s2">= </span><span class="s3">'left mouse up'</span>
    <span class="s1">middle_mouse_down </span><span class="s2">= </span><span class="s3">'middle mouse down'</span>
    <span class="s1">middle_mouse_up </span><span class="s2">= </span><span class="s3">'middle mouse up'</span>
    <span class="s1">right_mouse_down </span><span class="s2">= </span><span class="s3">'right mouse down'</span>
    <span class="s1">right_mouse_up </span><span class="s2">= </span><span class="s3">'right mouse up'</span>
    <span class="s1">double_click </span><span class="s2">= </span><span class="s3">'double click'</span>
    <span class="s1">scroll_up </span><span class="s2">= </span><span class="s3">'scroll up'</span>
    <span class="s1">scroll_down </span><span class="s2">= </span><span class="s3">'scroll down'</span>
    <span class="s1">left_arrow </span><span class="s2">= </span><span class="s3">'left arrow'</span>
    <span class="s1">left_arrow_up </span><span class="s2">= </span><span class="s3">'left arrow up'</span>
    <span class="s1">up_arrow </span><span class="s2">= </span><span class="s3">'up arrow'</span>
    <span class="s1">up_arrow_up </span><span class="s2">= </span><span class="s3">'up arrow up'</span>
    <span class="s1">down_arrow </span><span class="s2">= </span><span class="s3">'down arrow'</span>
    <span class="s1">down_arrow_up </span><span class="s2">= </span><span class="s3">'down arrow up'</span>
    <span class="s1">right_arrow </span><span class="s2">= </span><span class="s3">'right arrow'</span>
    <span class="s1">right_arrow_up </span><span class="s2">= </span><span class="s3">'right arrow up'</span>
    <span class="s1">left_control </span><span class="s2">= </span><span class="s3">'left control'</span>
    <span class="s1">right_control </span><span class="s2">= </span><span class="s3">'right control'</span>
    <span class="s1">left_shift </span><span class="s2">= </span><span class="s3">'left shift'</span>
    <span class="s1">right_shift </span><span class="s2">= </span><span class="s3">'right shift'</span>
    <span class="s1">left_alt </span><span class="s2">= </span><span class="s3">'left alt'</span>
    <span class="s1">right_alt </span><span class="s2">= </span><span class="s3">'right alt'</span>
    <span class="s1">left_control_up </span><span class="s2">= </span><span class="s3">'left control up'</span>
    <span class="s1">right_control_up </span><span class="s2">= </span><span class="s3">'right control up'</span>
    <span class="s1">left_shift_up </span><span class="s2">= </span><span class="s3">'left shift up'</span>
    <span class="s1">right_shift_up </span><span class="s2">= </span><span class="s3">'right shift up'</span>
    <span class="s1">left_alt_up </span><span class="s2">= </span><span class="s3">'left alt up'</span>
    <span class="s1">right_alt_up </span><span class="s2">= </span><span class="s3">'right alt up'</span>
    <span class="s1">page_down </span><span class="s2">= </span><span class="s3">'page down'</span>
    <span class="s1">page_down_up </span><span class="s2">= </span><span class="s3">'page down up'</span>
    <span class="s1">page_up </span><span class="s2">= </span><span class="s3">'page up'</span>
    <span class="s1">page_up_up </span><span class="s2">= </span><span class="s3">'page up up'</span>
    <span class="s1">enter </span><span class="s2">= </span><span class="s3">'enter'</span>
    <span class="s1">backspace </span><span class="s2">= </span><span class="s3">'backspace'</span>
    <span class="s1">escape </span><span class="s2">= </span><span class="s3">'escape'</span>
    <span class="s1">tab </span><span class="s2">= </span><span class="s3">'tab'</span>

    <span class="s1">gamepad_left_stick_x </span><span class="s2">= </span><span class="s3">'gamepad left stick x'   </span><span class="s4"># held_keys only</span>
    <span class="s1">gamepad_left_stick_y </span><span class="s2">= </span><span class="s3">'gamepad left stick y'   </span><span class="s4"># held_keys only</span>
    <span class="s1">gamepad_right_stick_x </span><span class="s2">= </span><span class="s3">'gamepad right stick x'   </span><span class="s4"># held_keys only</span>
    <span class="s1">gamepad_right_stick_y </span><span class="s2">= </span><span class="s3">'gamepad right stick y'   </span><span class="s4"># held_keys only</span>
    <span class="s1">gamepad_left_trigger </span><span class="s2">= </span><span class="s3">'gamepad left trigger'   </span><span class="s4"># held_keys only</span>
    <span class="s1">gamepad_right_trigger </span><span class="s2">= </span><span class="s3">'gamepad right trigger'   </span><span class="s4"># held_keys only</span>
    <span class="s1">gamepad_a </span><span class="s2">= </span><span class="s3">'gamepad a'</span>
    <span class="s1">gamepad_a_up </span><span class="s2">= </span><span class="s3">'gamepad a up'</span>
    <span class="s1">gamepad_b </span><span class="s2">= </span><span class="s3">'gamepad b'</span>
    <span class="s1">gamepad_b_up </span><span class="s2">= </span><span class="s3">'gamepad b up'</span>
    <span class="s1">gamepad_x </span><span class="s2">= </span><span class="s3">'gamepad x'</span>
    <span class="s1">gamepad_x_up </span><span class="s2">= </span><span class="s3">'gamepad x up'</span>
    <span class="s1">gamepad_y </span><span class="s2">= </span><span class="s3">'gamepad y'</span>
    <span class="s1">gamepad_y_up </span><span class="s2">= </span><span class="s3">'gamepad y up'</span>
    <span class="s1">gamepad_left_stick </span><span class="s2">= </span><span class="s3">'gamepad left stick'</span>
    <span class="s1">gamepad_left_stick_up </span><span class="s2">= </span><span class="s3">'gamepad left stick up'</span>
    <span class="s1">gamepad_right_stick </span><span class="s2">= </span><span class="s3">'gamepad right stick'</span>
    <span class="s1">gamepad_right_stick_up </span><span class="s2">= </span><span class="s3">'gamepad right stick up'</span>
    <span class="s1">gamepad_back </span><span class="s2">= </span><span class="s3">'gamepad back'</span>
    <span class="s1">gamepad_back_up </span><span class="s2">= </span><span class="s3">'gamepad back up'</span>
    <span class="s1">gamepad_start </span><span class="s2">= </span><span class="s3">'gamepad start'</span>
    <span class="s1">gamepad_dpad_down </span><span class="s2">= </span><span class="s3">'gamepad dpad down'</span>
    <span class="s1">gamepad_dpad_down_up </span><span class="s2">= </span><span class="s3">'gamepad dpad down up'</span>
    <span class="s1">gamepad_dpad_up </span><span class="s2">= </span><span class="s3">'gamepad dpad up'</span>
    <span class="s1">gamepad_dpad_up_up </span><span class="s2">= </span><span class="s3">'gamepad dpad up up'</span>
    <span class="s1">gamepad_dpad_left </span><span class="s2">= </span><span class="s3">'gamepad dpad left'</span>
    <span class="s1">gamepad_dpad_left_up </span><span class="s2">= </span><span class="s3">'gamepad dpad left up'</span>
    <span class="s1">gamepad_dpad_right </span><span class="s2">= </span><span class="s3">'gamepad dpad right'</span>
    <span class="s1">gamepad_dpad_right_up </span><span class="s2">= </span><span class="s3">'gamepad dpad right up'</span>
    <span class="s1">gamepad_left_shoulder </span><span class="s2">= </span><span class="s3">'gamepad left shoulder'</span>
    <span class="s1">gamepad_left_shoulder_up </span><span class="s2">= </span><span class="s3">'gamepad left shoulder up'</span>
    <span class="s1">gamepad_right_shoulder </span><span class="s2">= </span><span class="s3">'gamepad right shoulder'</span>
    <span class="s1">gamepad_right_shoulder_up </span><span class="s2">= </span><span class="s3">'gamepad right shoulder up'</span>



    <span class="s0">def </span><span class="s1">__hash__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">hash</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__eq__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s4"># overridden __eq__ to allow for both str and InputEvent comparisons</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">other</span><span class="s2">, </span><span class="s1">Keys</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">value </span><span class="s2">== </span><span class="s1">other</span><span class="s2">.</span><span class="s1">value</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">value </span><span class="s2">== </span><span class="s1">other</span>



<span class="s1">held_keys </span><span class="s2">= </span><span class="s1">defaultdict</span><span class="s2">(</span><span class="s0">lambda</span><span class="s2">: </span><span class="s5">0</span><span class="s2">)</span>
<span class="s1">rebinds </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">bind</span><span class="s2">(</span><span class="s1">original_key</span><span class="s2">, </span><span class="s1">alternative_key</span><span class="s2">):</span>
    <span class="s1">rebinds</span><span class="s2">[</span><span class="s1">original_key</span><span class="s2">] = </span><span class="s1">alternative_key</span>
    <span class="s0">if </span><span class="s3">' mouse ' </span><span class="s0">in </span><span class="s1">alternative_key</span><span class="s2">:</span>
        <span class="s1">rebinds</span><span class="s2">[</span><span class="s1">original_key </span><span class="s2">+ </span><span class="s3">' up'</span><span class="s2">] = </span><span class="s1">alternative_key</span><span class="s2">[:-</span><span class="s5">5</span><span class="s2">] + </span><span class="s3">' up'</span>
        <span class="s0">return</span>

    <span class="s1">rebinds</span><span class="s2">[</span><span class="s1">original_key </span><span class="s2">+ </span><span class="s3">' hold'</span><span class="s2">] = </span><span class="s1">alternative_key </span><span class="s2">+ </span><span class="s3">' hold'</span>
    <span class="s1">rebinds</span><span class="s2">[</span><span class="s1">original_key </span><span class="s2">+ </span><span class="s3">' up'</span><span class="s2">] = </span><span class="s1">alternative_key </span><span class="s2">+ </span><span class="s3">' up'</span>


<span class="s0">def </span><span class="s1">unbind</span><span class="s2">(</span><span class="s1">key</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">key </span><span class="s0">in </span><span class="s1">rebinds</span><span class="s2">:</span>
        <span class="s0">del </span><span class="s1">rebinds</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
        <span class="s0">del </span><span class="s1">rebinds</span><span class="s2">[</span><span class="s1">key </span><span class="s2">+ </span><span class="s3">' hold'</span><span class="s2">]</span>
        <span class="s0">del </span><span class="s1">rebinds</span><span class="s2">[</span><span class="s1">key </span><span class="s2">+ </span><span class="s3">' up'</span><span class="s2">]</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">rebinds</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s3">'none'</span>


<span class="s0">def </span><span class="s1">rebind</span><span class="s2">(</span><span class="s1">to_key</span><span class="s2">, </span><span class="s1">from_key</span><span class="s2">):</span>
    <span class="s1">unbind</span><span class="s2">(</span><span class="s1">to_key</span><span class="s2">)</span>
    <span class="s1">bind</span><span class="s2">(</span><span class="s1">to_key</span><span class="s2">, </span><span class="s1">from_key</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">input</span><span class="s2">(</span><span class="s1">key</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">key</span><span class="s2">.</span><span class="s1">endswith</span><span class="s2">(</span><span class="s3">'hold'</span><span class="s2">) </span><span class="s0">or </span><span class="s1">key </span><span class="s2">== </span><span class="s1">Keys</span><span class="s2">.</span><span class="s1">scroll_down </span><span class="s0">or </span><span class="s1">key </span><span class="s2">== </span><span class="s1">Keys</span><span class="s2">.</span><span class="s1">scroll_up</span><span class="s2">:</span>
        <span class="s0">return</span>

    <span class="s1">key </span><span class="s2">= </span><span class="s1">key</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s3">'mouse down'</span><span class="s2">, </span><span class="s3">'mouse'</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">key</span><span class="s2">.</span><span class="s1">endswith</span><span class="s2">(</span><span class="s3">' up'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">key </span><span class="s2">!= </span><span class="s3">'page up' </span><span class="s0">and </span><span class="s1">key </span><span class="s2">!= </span><span class="s3">'gamepad dpad up'</span><span class="s2">:</span>
        <span class="s1">held_keys</span><span class="s2">[</span><span class="s1">key</span><span class="s2">[:-</span><span class="s5">3</span><span class="s2">]] = </span><span class="s5">0</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">held_keys</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s5">1</span>


<span class="s0">def </span><span class="s1">get_combined_key</span><span class="s2">(</span><span class="s1">key</span><span class="s2">):</span>
    <span class="s6">''' 
    Adds control, shift and alt prefix to key. 
    Example: holding control and pressing 'f' would result in 'control+f'. 
    This makes it easier to check for a specific combination without manually 
    checking each combination of held_keys['control'], held_keys['shift'] and held_keys['alt']. 
    '''</span>

    <span class="s0">return </span><span class="s3">''</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">e</span><span class="s2">+</span><span class="s3">'+' </span><span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'control'</span><span class="s2">, </span><span class="s3">'shift'</span><span class="s2">, </span><span class="s3">'alt'</span><span class="s2">) </span><span class="s0">if </span><span class="s1">held_keys</span><span class="s2">[</span><span class="s1">e</span><span class="s2">] </span><span class="s0">and not </span><span class="s1">e </span><span class="s2">== </span><span class="s1">key</span><span class="s2">) + </span><span class="s1">key</span>



<span class="s0">if </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s3">'__main__'</span><span class="s2">:</span>
    <span class="s0">from </span><span class="s1">ursina </span><span class="s0">import </span><span class="s2">*</span>
    <span class="s0">from </span><span class="s1">ursina </span><span class="s0">import </span><span class="s1">Ursina</span><span class="s2">, </span><span class="s1">input_handler</span>

    <span class="s1">app </span><span class="s2">= </span><span class="s1">Ursina</span><span class="s2">()</span>
    <span class="s1">input_handler</span><span class="s2">.</span><span class="s1">rebind</span><span class="s2">(</span><span class="s3">'z'</span><span class="s2">, </span><span class="s3">'w'</span><span class="s2">)  </span><span class="s4"># 'z'-key will now be registered as 'w'-key</span>

    <span class="s0">def </span><span class="s1">test</span><span class="s2">():</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s3">'----'</span><span class="s2">)</span>
    <span class="s4"># input_handler.rebind('a', 'f')</span>
    <span class="s0">def </span><span class="s1">input</span><span class="s2">(</span><span class="s1">key</span><span class="s2">):</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">key</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">key </span><span class="s2">== </span><span class="s3">'left mouse down'</span><span class="s2">:</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">'pressed left mouse button'</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">key </span><span class="s2">== </span><span class="s1">Keys</span><span class="s2">.</span><span class="s1">left_mouse_down</span><span class="s2">:   </span><span class="s4"># same as above, but with Keys enum.</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">'pressed left mouse button'</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">update</span><span class="s2">():</span>
        <span class="s0">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">held_keys</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
            <span class="s0">if </span><span class="s1">value </span><span class="s2">!= </span><span class="s5">0</span><span class="s2">:</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>



    <span class="s1">app</span><span class="s2">.</span><span class="s1">run</span><span class="s2">()</span>
</pre>
</body>
</html>
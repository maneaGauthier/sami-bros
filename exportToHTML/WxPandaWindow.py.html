<html>
<head>
<title>WxPandaWindow.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
WxPandaWindow.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; This module implements a Panda3D window that can be embedded 
within a wx.Frame.  The window itself is either an embedded window, 
which is a wx.Window with the Panda window attached to it, or it is a 
wxgl.GLCanvas, with Panda directed to draw into it, depending on the 
platform.  In either case, you may simply embed this window into a 
wx.Frame of your choosing, using sizers or whatever you like. &quot;&quot;&quot;</span>

<span class="s2">import </span><span class="s1">wx</span>
<span class="s2">import </span><span class="s1">platform</span>

<span class="s2">try</span><span class="s3">:</span>
    <span class="s2">import </span><span class="s1">wx</span><span class="s3">.</span><span class="s1">glcanvas </span><span class="s2">as </span><span class="s1">wxgl</span>
<span class="s2">except </span><span class="s1">ImportError</span><span class="s3">:</span>
    <span class="s1">wxgl </span><span class="s3">= </span><span class="s2">None</span>

<span class="s2">from </span><span class="s1">panda3d</span><span class="s3">.</span><span class="s1">core </span><span class="s2">import </span><span class="s3">*</span>

<span class="s1">__all__ </span><span class="s3">= [</span><span class="s4">'WxPandaWindow'</span><span class="s3">]</span>

<span class="s2">class </span><span class="s1">EmbeddedPandaWindow</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">Window</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; This class implements a Panda3D window that is directly 
    embedded within the frame.  It is fully supported on Windows, 
    partially supported on Linux, and not at all on OSX. &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kw</span><span class="s3">):</span>
        <span class="s1">gsg </span><span class="s3">= </span><span class="s2">None</span>
        <span class="s2">if </span><span class="s4">'gsg' </span><span class="s2">in </span><span class="s1">kw</span><span class="s3">:</span>
            <span class="s1">gsg </span><span class="s3">= </span><span class="s1">kw</span><span class="s3">[</span><span class="s4">'gsg'</span><span class="s3">]</span>
            <span class="s2">del </span><span class="s1">kw</span><span class="s3">[</span><span class="s4">'gsg'</span><span class="s3">]</span>

        <span class="s1">base</span><span class="s3">.</span><span class="s1">startWx</span><span class="s3">()</span>
        <span class="s1">wx</span><span class="s3">.</span><span class="s1">Window</span><span class="s3">.</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kw</span><span class="s3">)</span>

        <span class="s1">wp </span><span class="s3">= </span><span class="s1">WindowProperties</span><span class="s3">.</span><span class="s1">getDefault</span><span class="s3">()</span>
        <span class="s2">if </span><span class="s1">platform</span><span class="s3">.</span><span class="s1">system</span><span class="s3">() != </span><span class="s4">'Darwin'</span><span class="s3">:</span>
            <span class="s2">try</span><span class="s3">:</span>
                <span class="s1">wp</span><span class="s3">.</span><span class="s1">setParentWindow</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">GetHandle</span><span class="s3">())</span>
            <span class="s2">except </span><span class="s1">OverflowError</span><span class="s3">:</span>
                <span class="s5"># Sheesh, a negative value from GetHandle().  This can</span>
                <span class="s5"># only happen on 32-bit Windows.</span>
                <span class="s1">wp</span><span class="s3">.</span><span class="s1">setParentWindow</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">GetHandle</span><span class="s3">() &amp; </span><span class="s6">0xffffffff</span><span class="s3">)</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">win </span><span class="s3">= </span><span class="s1">base</span><span class="s3">.</span><span class="s1">openWindow</span><span class="s3">(</span><span class="s1">props </span><span class="s3">= </span><span class="s1">wp</span><span class="s3">, </span><span class="s1">gsg </span><span class="s3">= </span><span class="s1">gsg</span><span class="s3">, </span><span class="s1">type </span><span class="s3">= </span><span class="s4">'onscreen'</span><span class="s3">,</span>
                                   <span class="s1">unexposedDraw </span><span class="s3">= </span><span class="s2">False</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_SIZE</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">onSize</span><span class="s3">)</span>

        <span class="s5"># This doesn't actually do anything, since wx won't call</span>
        <span class="s5"># EVT_CLOSE on a child window, only on the toplevel window</span>
        <span class="s5"># that contains it.</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_CLOSE</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__closeEvent</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">__closeEvent</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">event</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">cleanup</span><span class="s3">()</span>
        <span class="s1">event</span><span class="s3">.</span><span class="s1">Skip</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">cleanup</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot; Parent windows should call cleanup() to clean up the 
        wxPandaWindow explicitly (since we can't catch EVT_CLOSE 
        directly). &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">win</span><span class="s3">:</span>
            <span class="s1">base</span><span class="s3">.</span><span class="s1">closeWindow</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">win</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">win </span><span class="s3">= </span><span class="s2">None</span>

    <span class="s2">def </span><span class="s1">onSize</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">event</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">win</span><span class="s3">:</span>
            <span class="s1">wp </span><span class="s3">= </span><span class="s1">WindowProperties</span><span class="s3">()</span>
            <span class="s1">wp</span><span class="s3">.</span><span class="s1">setOrigin</span><span class="s3">(</span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">)</span>
            <span class="s1">wp</span><span class="s3">.</span><span class="s1">setSize</span><span class="s3">(*</span><span class="s1">self</span><span class="s3">.</span><span class="s1">GetClientSize</span><span class="s3">())</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">win</span><span class="s3">.</span><span class="s1">requestProperties</span><span class="s3">(</span><span class="s1">wp</span><span class="s3">)</span>
        <span class="s1">event</span><span class="s3">.</span><span class="s1">Skip</span><span class="s3">()</span>

<span class="s2">if not </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">wxgl</span><span class="s3">, </span><span class="s4">'GLCanvas'</span><span class="s3">):</span>
    <span class="s1">OpenGLPandaWindow </span><span class="s3">= </span><span class="s2">None</span>
<span class="s2">else</span><span class="s3">:</span>
    <span class="s2">class </span><span class="s1">OpenGLPandaWindow</span><span class="s3">(</span><span class="s1">wxgl</span><span class="s3">.</span><span class="s1">GLCanvas</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot; This class implements a Panda3D &quot;window&quot; that actually draws 
        within the wx GLCanvas object.  It is supported whenever OpenGL is 
        Panda's rendering engine, and GLCanvas is available in wx. &quot;&quot;&quot;</span>

        <span class="s1">removeCallbackWindow </span><span class="s3">= </span><span class="s1">ConfigVariableBool</span><span class="s3">(</span><span class="s4">'remove-callback-window'</span><span class="s3">, </span><span class="s2">True</span><span class="s3">)</span>

        <span class="s1">Keymap </span><span class="s3">= {</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_BACK </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">backspace</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_TAB </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">tab</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_RETURN </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">enter</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_ESCAPE </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">escape</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_DELETE </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">_del</span><span class="s3">(),  </span><span class="s5"># del is a Python keyword</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_SHIFT </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">shift</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_ALT </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">alt</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_CONTROL </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">control</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_MENU </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">meta</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_PAUSE </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">pause</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_END </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">end</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_HOME </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">home</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_LEFT </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">left</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_UP </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">up</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_RIGHT </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">right</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_DOWN </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">down</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_PRINT </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">printScreen</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_INSERT </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">insert</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_F1 </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">f1</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_F2 </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">f2</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_F3 </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">f3</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_F4 </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">f4</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_F5 </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">f5</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_F6 </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">f6</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_F7 </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">f7</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_F8 </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">f8</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_F9 </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">f9</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_F10 </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">f10</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_F11 </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">f11</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_F12 </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">f12</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_NUMLOCK </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">numLock</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_SCROLL </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">scrollLock</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_PAGEUP </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">pageUp</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_PAGEDOWN </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">pageDown</span><span class="s3">(),</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WXK_COMMAND </span><span class="s3">: </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">meta</span><span class="s3">(),</span>
            <span class="s3">}</span>

        <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kw</span><span class="s3">):</span>
            <span class="s1">gsg </span><span class="s3">= </span><span class="s2">None</span>
            <span class="s2">if </span><span class="s4">'gsg' </span><span class="s2">in </span><span class="s1">kw</span><span class="s3">:</span>
                <span class="s1">gsg </span><span class="s3">= </span><span class="s1">kw</span><span class="s3">[</span><span class="s4">'gsg'</span><span class="s3">]</span>
                <span class="s2">del </span><span class="s1">kw</span><span class="s3">[</span><span class="s4">'gsg'</span><span class="s3">]</span>

            <span class="s1">fbprops </span><span class="s3">= </span><span class="s1">kw</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">'fbprops'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">fbprops </span><span class="s3">== </span><span class="s2">None</span><span class="s3">:</span>
                <span class="s1">fbprops </span><span class="s3">= </span><span class="s1">FrameBufferProperties</span><span class="s3">.</span><span class="s1">getDefault</span><span class="s3">()</span>

            <span class="s1">attribList </span><span class="s3">= </span><span class="s1">kw</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">'attribList'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">attribList </span><span class="s2">is None</span><span class="s3">:</span>
                <span class="s1">attribList </span><span class="s3">= [</span>
                    <span class="s1">wxgl</span><span class="s3">.</span><span class="s1">WX_GL_RGBA</span><span class="s3">, </span><span class="s2">True</span><span class="s3">,</span>
                    <span class="s1">wxgl</span><span class="s3">.</span><span class="s1">WX_GL_LEVEL</span><span class="s3">, </span><span class="s6">0</span><span class="s3">,</span>
                    <span class="s3">]</span>
                <span class="s2">if not </span><span class="s1">fbprops</span><span class="s3">.</span><span class="s1">isSingleBuffered</span><span class="s3">():</span>
                    <span class="s1">attribList</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">wxgl</span><span class="s3">.</span><span class="s1">WX_GL_DOUBLEBUFFER</span><span class="s3">)</span>
                    <span class="s1">attribList</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s2">True</span><span class="s3">)</span>
                <span class="s2">if </span><span class="s1">fbprops</span><span class="s3">.</span><span class="s1">getDepthBits</span><span class="s3">() &gt; </span><span class="s6">0</span><span class="s3">:</span>
                    <span class="s1">attribList</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">wxgl</span><span class="s3">.</span><span class="s1">WX_GL_DEPTH_SIZE</span><span class="s3">)</span>
                    <span class="s2">if </span><span class="s1">fbprops</span><span class="s3">.</span><span class="s1">getDepthBits</span><span class="s3">() &lt;= </span><span class="s6">16</span><span class="s3">:</span>
                        <span class="s1">attribList</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s6">16</span><span class="s3">)</span>
                    <span class="s2">elif </span><span class="s1">fbprops</span><span class="s3">.</span><span class="s1">getDepthBits</span><span class="s3">() &lt;= </span><span class="s6">24</span><span class="s3">:</span>
                        <span class="s1">attribList</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s6">24</span><span class="s3">)</span>
                    <span class="s2">else</span><span class="s3">:</span>
                        <span class="s1">attribList</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s6">32</span><span class="s3">)</span>

                <span class="s1">kw</span><span class="s3">[</span><span class="s4">'attribList'</span><span class="s3">] = </span><span class="s1">attribList</span>

            <span class="s1">base</span><span class="s3">.</span><span class="s1">startWx</span><span class="s3">()</span>
            <span class="s1">wxgl</span><span class="s3">.</span><span class="s1">GLCanvas</span><span class="s3">.</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kw</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">visible </span><span class="s3">= </span><span class="s2">False</span>

            <span class="s5"># Can't share the GSG when a new wxgl.GLContext is created</span>
            <span class="s5"># automatically.</span>
            <span class="s1">gsg </span><span class="s3">= </span><span class="s2">None</span>

            <span class="s1">callbackWindowDict </span><span class="s3">= {</span>
                <span class="s4">'Events' </span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__eventsCallback</span><span class="s3">,</span>
                <span class="s4">'Properties' </span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__propertiesCallback</span><span class="s3">,</span>
                <span class="s4">'Render' </span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__renderCallback</span><span class="s3">,</span>
                <span class="s3">}</span>

            <span class="s5"># Make sure we have an OpenGL GraphicsPipe.</span>
            <span class="s2">if not </span><span class="s1">base</span><span class="s3">.</span><span class="s1">pipe</span><span class="s3">:</span>
                <span class="s1">base</span><span class="s3">.</span><span class="s1">makeDefaultPipe</span><span class="s3">()</span>
            <span class="s1">pipe </span><span class="s3">= </span><span class="s1">base</span><span class="s3">.</span><span class="s1">pipe</span>
            <span class="s2">if </span><span class="s1">pipe</span><span class="s3">.</span><span class="s1">getInterfaceName</span><span class="s3">() != </span><span class="s4">'OpenGL'</span><span class="s3">:</span>
                <span class="s1">base</span><span class="s3">.</span><span class="s1">makeAllPipes</span><span class="s3">()</span>
                <span class="s2">for </span><span class="s1">pipe </span><span class="s2">in </span><span class="s1">base</span><span class="s3">.</span><span class="s1">pipeList</span><span class="s3">:</span>
                    <span class="s2">if </span><span class="s1">pipe</span><span class="s3">.</span><span class="s1">getInterfaceName</span><span class="s3">() == </span><span class="s4">'OpenGL'</span><span class="s3">:</span>
                        <span class="s2">break</span>

            <span class="s2">if </span><span class="s1">pipe</span><span class="s3">.</span><span class="s1">getInterfaceName</span><span class="s3">() != </span><span class="s4">'OpenGL'</span><span class="s3">:</span>
                <span class="s2">raise </span><span class="s1">Exception</span><span class="s3">(</span><span class="s4">&quot;Couldn't get an OpenGL pipe.&quot;</span><span class="s3">)</span>

            <span class="s1">self</span><span class="s3">.</span><span class="s1">win </span><span class="s3">= </span><span class="s1">base</span><span class="s3">.</span><span class="s1">openWindow</span><span class="s3">(</span><span class="s1">callbackWindowDict </span><span class="s3">= </span><span class="s1">callbackWindowDict</span><span class="s3">, </span><span class="s1">pipe </span><span class="s3">= </span><span class="s1">pipe</span><span class="s3">, </span><span class="s1">gsg </span><span class="s3">= </span><span class="s1">gsg</span><span class="s3">, </span><span class="s1">type </span><span class="s3">= </span><span class="s4">'onscreen'</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">hasCapture </span><span class="s3">= </span><span class="s2">False</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">inputDevice </span><span class="s3">= </span><span class="s2">None</span>
            <span class="s2">if </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">win</span><span class="s3">, </span><span class="s4">'getInputDevice'</span><span class="s3">):</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">inputDevice </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">win</span><span class="s3">.</span><span class="s1">getInputDevice</span><span class="s3">(</span><span class="s6">0</span><span class="s3">)</span>

            <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_SIZE</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">onSize</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_PAINT</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">onPaint</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_IDLE</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">onIdle</span><span class="s3">)</span>

            <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">inputDevice</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_LEFT_DOWN</span><span class="s3">, </span><span class="s2">lambda </span><span class="s1">event</span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__buttonDown</span><span class="s3">(</span><span class="s1">MouseButton</span><span class="s3">.</span><span class="s1">one</span><span class="s3">()))</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_LEFT_UP</span><span class="s3">, </span><span class="s2">lambda </span><span class="s1">event</span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__buttonUp</span><span class="s3">(</span><span class="s1">MouseButton</span><span class="s3">.</span><span class="s1">one</span><span class="s3">()))</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_MIDDLE_DOWN</span><span class="s3">, </span><span class="s2">lambda </span><span class="s1">event</span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__buttonDown</span><span class="s3">(</span><span class="s1">MouseButton</span><span class="s3">.</span><span class="s1">two</span><span class="s3">()))</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_MIDDLE_UP</span><span class="s3">, </span><span class="s2">lambda </span><span class="s1">event</span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__buttonUp</span><span class="s3">(</span><span class="s1">MouseButton</span><span class="s3">.</span><span class="s1">two</span><span class="s3">()))</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_RIGHT_DOWN</span><span class="s3">, </span><span class="s2">lambda </span><span class="s1">event</span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__buttonDown</span><span class="s3">(</span><span class="s1">MouseButton</span><span class="s3">.</span><span class="s1">three</span><span class="s3">()))</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_RIGHT_UP</span><span class="s3">, </span><span class="s2">lambda </span><span class="s1">event</span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__buttonUp</span><span class="s3">(</span><span class="s1">MouseButton</span><span class="s3">.</span><span class="s1">three</span><span class="s3">()))</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_MOTION</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__mouseMotion</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_MOUSEWHEEL</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__mouseWheel</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_LEAVE_WINDOW</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__mouseLeaveWindow</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_KEY_DOWN</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__keyDown</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_KEY_UP</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__keyUp</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_CHAR</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__keystroke</span><span class="s3">)</span>

            <span class="s5"># This doesn't actually do anything, since wx won't call</span>
            <span class="s5"># EVT_CLOSE on a child window, only on the toplevel window</span>
            <span class="s5"># that contains it.</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">Bind</span><span class="s3">(</span><span class="s1">wx</span><span class="s3">.</span><span class="s1">EVT_CLOSE</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__closeEvent</span><span class="s3">)</span>

        <span class="s2">def </span><span class="s1">__closeEvent</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">event</span><span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">cleanup</span><span class="s3">()</span>
            <span class="s1">event</span><span class="s3">.</span><span class="s1">Skip</span><span class="s3">()</span>

        <span class="s2">def </span><span class="s1">cleanup</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
            <span class="s0">&quot;&quot;&quot; Parent windows should call cleanup() to clean up the 
            wxPandaWindow explicitly (since we can't catch EVT_CLOSE 
            directly). &quot;&quot;&quot;</span>
            <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">win</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">win</span><span class="s3">.</span><span class="s1">clearEventsCallback</span><span class="s3">()</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">win</span><span class="s3">.</span><span class="s1">clearPropertiesCallback</span><span class="s3">()</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">win</span><span class="s3">.</span><span class="s1">clearRenderCallback</span><span class="s3">()</span>
                <span class="s1">base</span><span class="s3">.</span><span class="s1">closeWindow</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">win</span><span class="s3">, </span><span class="s1">removeWindow </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">removeCallbackWindow</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">win </span><span class="s3">= </span><span class="s2">None</span>

        <span class="s2">def </span><span class="s1">__buttonDown</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">button</span><span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">SetFocus</span><span class="s3">()</span>
            <span class="s2">if not </span><span class="s1">self</span><span class="s3">.</span><span class="s1">hasCapture</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">CaptureMouse</span><span class="s3">()</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">hasCapture </span><span class="s3">= </span><span class="s2">True</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">inputDevice</span><span class="s3">.</span><span class="s1">buttonDown</span><span class="s3">(</span><span class="s1">button</span><span class="s3">)</span>

        <span class="s2">def </span><span class="s1">__buttonUp</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">button</span><span class="s3">):</span>
            <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">hasCapture</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">ReleaseMouse</span><span class="s3">()</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">hasCapture </span><span class="s3">= </span><span class="s2">False</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">inputDevice</span><span class="s3">.</span><span class="s1">buttonUp</span><span class="s3">(</span><span class="s1">button</span><span class="s3">)</span>

        <span class="s2">def </span><span class="s1">__mouseMotion</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">event</span><span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">inputDevice</span><span class="s3">.</span><span class="s1">setPointerInWindow</span><span class="s3">(*</span><span class="s1">event</span><span class="s3">.</span><span class="s1">GetPosition</span><span class="s3">())</span>

        <span class="s2">def </span><span class="s1">__mouseWheel</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">event</span><span class="s3">):</span>
            <span class="s1">amount </span><span class="s3">= </span><span class="s1">event</span><span class="s3">.</span><span class="s1">GetWheelRotation</span><span class="s3">()</span>
            <span class="s2">if </span><span class="s1">amount </span><span class="s3">&gt; </span><span class="s6">0.0</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">inputDevice</span><span class="s3">.</span><span class="s1">buttonDown</span><span class="s3">(</span><span class="s1">MouseButton</span><span class="s3">.</span><span class="s1">wheelUp</span><span class="s3">())</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">inputDevice</span><span class="s3">.</span><span class="s1">buttonUp</span><span class="s3">(</span><span class="s1">MouseButton</span><span class="s3">.</span><span class="s1">wheelUp</span><span class="s3">())</span>
            <span class="s2">elif </span><span class="s1">amount </span><span class="s3">&lt; </span><span class="s6">0.0</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">inputDevice</span><span class="s3">.</span><span class="s1">buttonDown</span><span class="s3">(</span><span class="s1">MouseButton</span><span class="s3">.</span><span class="s1">wheelDown</span><span class="s3">())</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">inputDevice</span><span class="s3">.</span><span class="s1">buttonUp</span><span class="s3">(</span><span class="s1">MouseButton</span><span class="s3">.</span><span class="s1">wheelDown</span><span class="s3">())</span>

        <span class="s2">def </span><span class="s1">__mouseLeaveWindow</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">event</span><span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">inputDevice</span><span class="s3">.</span><span class="s1">setPointerOutOfWindow</span><span class="s3">()</span>

        <span class="s2">def </span><span class="s1">__keyDown</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">event</span><span class="s3">):</span>
            <span class="s1">key </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__getkey</span><span class="s3">(</span><span class="s1">event</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">key</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">inputDevice</span><span class="s3">.</span><span class="s1">buttonDown</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)</span>

        <span class="s2">def </span><span class="s1">__keyUp</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">event</span><span class="s3">):</span>
            <span class="s1">key </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__getkey</span><span class="s3">(</span><span class="s1">event</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">key</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">inputDevice</span><span class="s3">.</span><span class="s1">buttonUp</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)</span>

        <span class="s2">def </span><span class="s1">__getkey</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">event</span><span class="s3">):</span>
            <span class="s1">code </span><span class="s3">= </span><span class="s1">event</span><span class="s3">.</span><span class="s1">GetKeyCode</span><span class="s3">()</span>
            <span class="s1">key </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">Keymap</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">code</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">key </span><span class="s2">is not None</span><span class="s3">:</span>
                <span class="s2">return </span><span class="s1">key</span>

            <span class="s2">if </span><span class="s1">code </span><span class="s3">&gt;= </span><span class="s6">0x41 </span><span class="s2">and </span><span class="s1">code </span><span class="s3">&lt;= </span><span class="s6">0x5a</span><span class="s3">:</span>
                <span class="s5"># wxWidgets returns uppercase letters, but Panda expects</span>
                <span class="s5"># lowercase letters.</span>
                <span class="s2">return </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">asciiKey</span><span class="s3">(</span><span class="s1">code </span><span class="s3">+ </span><span class="s6">0x20</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">code </span><span class="s3">&gt;= </span><span class="s6">0x20 </span><span class="s2">and </span><span class="s1">code </span><span class="s3">&lt;= </span><span class="s6">0x80</span><span class="s3">:</span>
                <span class="s5"># Other ASCII keys are treated the same way in wx and Panda.</span>
                <span class="s2">return </span><span class="s1">KeyboardButton</span><span class="s3">.</span><span class="s1">asciiKey</span><span class="s3">(</span><span class="s1">code</span><span class="s3">)</span>

            <span class="s2">return None</span>

        <span class="s2">def </span><span class="s1">__keystroke</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">event</span><span class="s3">):</span>
            <span class="s2">if </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">event</span><span class="s3">, </span><span class="s4">'GetUnicodeKey'</span><span class="s3">):</span>
                <span class="s1">code </span><span class="s3">= </span><span class="s1">event</span><span class="s3">.</span><span class="s1">GetUnicodeKey</span><span class="s3">()</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">code </span><span class="s3">= </span><span class="s1">event</span><span class="s3">.</span><span class="s1">GetKeyCode</span><span class="s3">()</span>
                <span class="s2">if </span><span class="s1">code </span><span class="s3">&lt; </span><span class="s6">0x20 </span><span class="s2">or </span><span class="s1">code </span><span class="s3">&gt;= </span><span class="s6">0x80</span><span class="s3">:</span>
                    <span class="s2">return</span>

            <span class="s1">self</span><span class="s3">.</span><span class="s1">inputDevice</span><span class="s3">.</span><span class="s1">keystroke</span><span class="s3">(</span><span class="s1">code</span><span class="s3">)</span>

        <span class="s2">def </span><span class="s1">__eventsCallback</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">data</span><span class="s3">):</span>
            <span class="s1">data</span><span class="s3">.</span><span class="s1">upcall</span><span class="s3">()</span>

        <span class="s2">def </span><span class="s1">__propertiesCallback</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">data</span><span class="s3">):</span>
            <span class="s1">data</span><span class="s3">.</span><span class="s1">upcall</span><span class="s3">()</span>

        <span class="s2">def </span><span class="s1">__renderCallback</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">data</span><span class="s3">):</span>
            <span class="s1">cbType </span><span class="s3">= </span><span class="s1">data</span><span class="s3">.</span><span class="s1">getCallbackType</span><span class="s3">()</span>
            <span class="s2">if </span><span class="s1">cbType </span><span class="s3">== </span><span class="s1">CallbackGraphicsWindow</span><span class="s3">.</span><span class="s1">RCTBeginFrame</span><span class="s3">:</span>
                <span class="s2">if not </span><span class="s1">self</span><span class="s3">.</span><span class="s1">visible</span><span class="s3">:</span>
                    <span class="s1">data</span><span class="s3">.</span><span class="s1">setRenderFlag</span><span class="s3">(</span><span class="s2">False</span><span class="s3">)</span>
                    <span class="s2">return</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">SetCurrent</span><span class="s3">()</span>

                <span class="s5"># Don't upcall() in this case.</span>
                <span class="s2">return</span>

            <span class="s2">elif </span><span class="s1">cbType </span><span class="s3">== </span><span class="s1">CallbackGraphicsWindow</span><span class="s3">.</span><span class="s1">RCTEndFlip</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">SwapBuffers</span><span class="s3">()</span>

                <span class="s5"># Now that we've swapped, ask for a refresh, so we'll</span>
                <span class="s5"># get another paint message if the window is still</span>
                <span class="s5"># visible onscreen.</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">Refresh</span><span class="s3">()</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">visible </span><span class="s3">= </span><span class="s2">False</span>

            <span class="s1">data</span><span class="s3">.</span><span class="s1">upcall</span><span class="s3">()</span>

        <span class="s2">def </span><span class="s1">onSize</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">event</span><span class="s3">):</span>
            <span class="s1">wp </span><span class="s3">= </span><span class="s1">WindowProperties</span><span class="s3">()</span>
            <span class="s1">wp</span><span class="s3">.</span><span class="s1">setSize</span><span class="s3">(*</span><span class="s1">self</span><span class="s3">.</span><span class="s1">GetClientSize</span><span class="s3">())</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">win</span><span class="s3">.</span><span class="s1">requestProperties</span><span class="s3">(</span><span class="s1">wp</span><span class="s3">)</span>

            <span class="s5"># Apparently, sometimes on Linux we get the onSize event</span>
            <span class="s5"># before the size has actually changed, and the size we</span>
            <span class="s5"># report in GetClientSize() is the *previous* size.  To</span>
            <span class="s5"># work around this unfortunate circumstance, we'll also</span>
            <span class="s5"># ensure an idle event comes in later, and check the size</span>
            <span class="s5"># again then.</span>
            <span class="s1">wx</span><span class="s3">.</span><span class="s1">WakeUpIdle</span><span class="s3">()</span>

            <span class="s1">event</span><span class="s3">.</span><span class="s1">Skip</span><span class="s3">()</span>

        <span class="s2">def </span><span class="s1">onPaint</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">event</span><span class="s3">):</span>
            <span class="s0">&quot;&quot;&quot; This is called whenever we get the first paint event, 
            at which point we can conclude that the window has 
            actually been manifested onscreen.  (In X11, there appears 
            to be no way to know this otherwise.) &quot;&quot;&quot;</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">visible </span><span class="s3">= </span><span class="s2">True</span>

            <span class="s5"># Important not to Skip this event, so the window</span>
            <span class="s5"># subsystem believes we've drawn the window.</span>
            <span class="s5">#event.Skip()</span>

        <span class="s2">def </span><span class="s1">onIdle</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">event</span><span class="s3">):</span>
            <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">win</span><span class="s3">:</span>
                <span class="s1">size </span><span class="s3">= </span><span class="s2">None</span>
                <span class="s1">properties </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">win</span><span class="s3">.</span><span class="s1">getProperties</span><span class="s3">()</span>
                <span class="s2">if </span><span class="s1">properties</span><span class="s3">.</span><span class="s1">hasSize</span><span class="s3">():</span>
                    <span class="s1">size </span><span class="s3">= (</span><span class="s1">properties</span><span class="s3">.</span><span class="s1">getXSize</span><span class="s3">(), </span><span class="s1">properties</span><span class="s3">.</span><span class="s1">getYSize</span><span class="s3">())</span>

                <span class="s2">if </span><span class="s1">tuple</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">GetClientSize</span><span class="s3">()) != </span><span class="s1">size</span><span class="s3">:</span>
                    <span class="s5"># The window has changed size during the idle call.</span>
                    <span class="s5"># This seems to be possible in Linux.</span>
                    <span class="s1">wp </span><span class="s3">= </span><span class="s1">WindowProperties</span><span class="s3">()</span>
                    <span class="s1">wp</span><span class="s3">.</span><span class="s1">setSize</span><span class="s3">(*</span><span class="s1">self</span><span class="s3">.</span><span class="s1">GetClientSize</span><span class="s3">())</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">win</span><span class="s3">.</span><span class="s1">requestProperties</span><span class="s3">(</span><span class="s1">wp</span><span class="s3">)</span>

            <span class="s1">event</span><span class="s3">.</span><span class="s1">Skip</span><span class="s3">()</span>

<span class="s5"># Choose the best implementation of WxPandaWindow for the platform.</span>
<span class="s1">WxPandaWindow </span><span class="s3">= </span><span class="s2">None</span>
<span class="s2">if </span><span class="s1">platform</span><span class="s3">.</span><span class="s1">system</span><span class="s3">() == </span><span class="s4">'Darwin' </span><span class="s2">or </span><span class="s1">platform</span><span class="s3">.</span><span class="s1">system</span><span class="s3">() == </span><span class="s4">'Linux'</span><span class="s3">:</span>
    <span class="s1">WxPandaWindow </span><span class="s3">= </span><span class="s1">OpenGLPandaWindow</span>

<span class="s2">if not </span><span class="s1">WxPandaWindow</span><span class="s3">:</span>
    <span class="s1">WxPandaWindow </span><span class="s3">= </span><span class="s1">EmbeddedPandaWindow</span>
</pre>
</body>
</html>
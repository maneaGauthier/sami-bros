<html>
<head>
<title>pdeploy.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #cf8e6d;}
.s5 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
pdeploy.py</font>
</center></td></tr></table>
<pre><span class="s0">#! /usr/bin/env python</span>

<span class="s1">usageText </span><span class="s2">= </span><span class="s3">&quot;&quot;&quot; 
 
This command will help you to distribute your Panda application, 
consisting of a .p3d package, into a standalone executable, graphical 
installer or an HTML webpage. It will attempt to create packages 
for every platform, if possible. 
Note that pdeploy requires an internet connection to run. 
 
When used with the 'installer' option, it is strongly advisable 
to specify most if not all of the descriptive information that can 
be passed on the command-line. 
 
Usage: 
 
  %(prog)s [opts] app.p3d standalone|installer|html 
 
Modes: 
 
  standalone 
    A standalone executable will be created that embeds the given 
    p3d file. The resulting executable will require an 
    internet connection in order to run properly. 
 
  installer 
    In this mode, installable packages will be created for as many 
    platforms as possible. To create Windows installers on 
    non-Windows platforms, you need to have the &quot;makensis&quot; utility 
    on your system PATH environment variable. 
 
  html 
    An HTML webpage will be generated that can be used to view 
    the provided p3d file in a browser. 
 
Options: 
 
  -n your_app 
     Short, lowercase name of the application or game. May only 
     contain alphanumeric characters, underscore or dash. This 
     name will also define the output file(s) of the process. 
     If omitted, the basename of the p3d file is used. 
 
  -N &quot;Your Application&quot; 
     Full name of the application or game. This is the 
     name that will be displayed to the end-user. 
     The 'display_name' config is used by default.  If it 
     is missing, the short name is used. 
 
  -v version_number 
     This should define the version number of your application 
     or game. In some deploy modes, this argument is required. 
     This should only contain alphanumeric characters, dots and 
     dashes, as otherwise the result of the deployment may be 
     invalid on some platforms. 
 
  -o output_dir 
     Indicates the directory where the output will be stored. 
     Within this directory, subdirectories will be created 
     for every platform, unless -t is provided. 
     If omitted, the current working directory is assumed. 
 
  -t token=value 
     Defines a web token or parameter to pass to the application. 
     Use this to configure how the application will be run. 
     You can pass as many -t options as you need. Some examples of 
     useful token names are width, height, log_basename, auto_start, 
     hidden and console_environment. 
 
  -P platform 
     If this option is provided, it should specify a comma- 
     separated list of platforms that the p3d package will be 
     deployed for. If omitted, it will be built for all platforms. 
     This option may be specified multiple times. 
     Examples of valid platforms are win_i386, linux_amd64 and osx_ppc. 
 
  -c 
     If this option is provided, any -P options are ignored and 
     the p3d package is only deployed for the current platform. 
     Furthermore, no per-platform subdirectories will be created 
     inside the output dirctory. 
 
  -s 
     This option only has effect in 'installer' mode. If it is 
     provided, the resulting installers will be fully self-contained, 
     will not require an internet connection to run, and start up 
     much faster. Note that pdeploy will also take a very long time 
     to finish when -s is provided. 
     If it is omitted, pdeploy will finish much quicker, and the 
     resulting installers will be smaller, but they will require 
     an internet connection for the first run, and the load time 
     will be considerably longer. 
 
  -l &quot;License Name&quot; 
     Specifies the name of the software license that the game 
     or application is licensed under. 
     Only relevant when generating a graphical installer. 
 
  -L licensefile.txt 
     This should point to a file that contains the full text 
     describing the software license that the game or application 
     is licensed under. 
     Only relevant when generating a graphical installer. 
 
  -O 
     Specify this option when generating a graphical installer to omit 
     the default checkboxes for &quot;run this program&quot; and &quot;install a 
     desktop shortcut&quot; on completion. 
 
  -a com.your_company 
     Short identifier of the author of the application. The default 
     is &quot;org.panda3d&quot;, but you will most likely want to change 
     it to your own name or that of your organization or company. 
     Only relevant when generating a graphical installer. 
 
  -A &quot;Your Company&quot; 
     Full name of the author of the application.  The default is 
     determined from the GECOS information of the current user if 
     available; if not, your username is used. 
     Only relevant when generating a graphical installer. 
 
  -e &quot;you@your_company.com&quot; 
     E-mail address of the maintainer of the application.  The default 
     is username@hostname. 
     Only relevant when generating a graphical installer. 
 
  -i &quot;path/icon32.png&quot; -i &quot;path/icon48.png&quot; -i &quot;path/icon128.png&quot; 
     This option should be repeated several times with different square 
     image sizes.  These images will then be combined to form an icon 
     file that will be used to represent the installed application. 
     To support all platforms, it is recommended to supply images of 
     the sizes 16x16, 32x32, 48x48, 128x128, 256x256, and 512x512. 
     The larger icon sizes can safely be omitted if you cannot 
     provide images in that resolution. 
     It is recommended to use .png images for correct transparency. 
     If no images are provided, no icon will be generated. 
     Only relevant when generating a graphical installer. 
 
  -h 
     Display this help 
 
&quot;&quot;&quot;</span>

<span class="s1">DEPLOY_MODES </span><span class="s2">= [</span><span class="s3">&quot;standalone&quot;</span><span class="s2">, </span><span class="s3">&quot;installer&quot;</span><span class="s2">, </span><span class="s3">&quot;html&quot;</span><span class="s2">]</span>

<span class="s4">import </span><span class="s1">sys</span>
<span class="s4">import </span><span class="s1">os</span>
<span class="s4">import </span><span class="s1">getopt</span>
<span class="s4">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">p3d</span><span class="s2">.</span><span class="s1">DeploymentTools </span><span class="s4">import </span><span class="s1">Standalone</span><span class="s2">, </span><span class="s1">Installer</span><span class="s2">, </span><span class="s1">Icon</span>
<span class="s4">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s4">import </span><span class="s1">Filename</span><span class="s2">, </span><span class="s1">PandaSystem</span>

<span class="s4">def </span><span class="s1">usage</span><span class="s2">(</span><span class="s1">code</span><span class="s2">, </span><span class="s1">msg </span><span class="s2">= </span><span class="s3">''</span><span class="s2">):</span>
    <span class="s4">if not </span><span class="s1">msg</span><span class="s2">:</span>
        <span class="s1">sys</span><span class="s2">.</span><span class="s1">stderr</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s1">usageText </span><span class="s2">% {</span><span class="s3">'prog' </span><span class="s2">: </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">argv</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])[</span><span class="s5">1</span><span class="s2">]})</span>
    <span class="s1">sys</span><span class="s2">.</span><span class="s1">stderr</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s1">msg </span><span class="s2">+ </span><span class="s3">'</span><span class="s4">\n</span><span class="s3">'</span><span class="s2">)</span>
    <span class="s1">sys</span><span class="s2">.</span><span class="s1">exit</span><span class="s2">(</span><span class="s1">code</span><span class="s2">)</span>

<span class="s1">shortname </span><span class="s2">= </span><span class="s3">&quot;&quot;</span>
<span class="s1">fullname </span><span class="s2">= </span><span class="s3">&quot;&quot;</span>
<span class="s1">version </span><span class="s2">= </span><span class="s3">&quot;&quot;</span>
<span class="s1">outputDir </span><span class="s2">= </span><span class="s1">Filename</span><span class="s2">(</span><span class="s3">&quot;./&quot;</span><span class="s2">)</span>
<span class="s1">tokens </span><span class="s2">= {}</span>
<span class="s1">platforms </span><span class="s2">= []</span>
<span class="s1">currentPlatform </span><span class="s2">= </span><span class="s4">False</span>
<span class="s1">licensename </span><span class="s2">= </span><span class="s3">&quot;&quot;</span>
<span class="s1">licensefile </span><span class="s2">= </span><span class="s1">Filename</span><span class="s2">()</span>
<span class="s1">authorid </span><span class="s2">= </span><span class="s3">&quot;&quot;</span>
<span class="s1">authorname </span><span class="s2">= </span><span class="s3">&quot;&quot;</span>
<span class="s1">authoremail </span><span class="s2">= </span><span class="s3">&quot;&quot;</span>
<span class="s1">iconFiles </span><span class="s2">= []</span>
<span class="s1">includeRequires </span><span class="s2">= </span><span class="s4">False</span>
<span class="s1">omitDefaultCheckboxes </span><span class="s2">= </span><span class="s4">False</span>

<span class="s4">try</span><span class="s2">:</span>
    <span class="s1">opts</span><span class="s2">, </span><span class="s1">args </span><span class="s2">= </span><span class="s1">getopt</span><span class="s2">.</span><span class="s1">getopt</span><span class="s2">(</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">argv</span><span class="s2">[</span><span class="s5">1</span><span class="s2">:], </span><span class="s3">'n:N:v:o:t:P:csOl:L:a:A:e:i:h'</span><span class="s2">)</span>
<span class="s4">except </span><span class="s1">getopt</span><span class="s2">.</span><span class="s1">error </span><span class="s4">as </span><span class="s1">msg</span><span class="s2">:</span>
    <span class="s1">usage</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">msg </span><span class="s4">or </span><span class="s3">'Invalid option'</span><span class="s2">)</span>

<span class="s4">for </span><span class="s1">opt</span><span class="s2">, </span><span class="s1">arg </span><span class="s4">in </span><span class="s1">opts</span><span class="s2">:</span>
    <span class="s4">if </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-n'</span><span class="s2">:</span>
        <span class="s1">shortname </span><span class="s2">= </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>
    <span class="s4">elif </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-N'</span><span class="s2">:</span>
        <span class="s1">fullname </span><span class="s2">= </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>
    <span class="s4">elif </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-v'</span><span class="s2">:</span>
        <span class="s1">version </span><span class="s2">= </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>
    <span class="s4">elif </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-o'</span><span class="s2">:</span>
        <span class="s1">outputDir </span><span class="s2">= </span><span class="s1">Filename</span><span class="s2">.</span><span class="s1">fromOsSpecific</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">)</span>
    <span class="s4">elif </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-t'</span><span class="s2">:</span>
        <span class="s1">token </span><span class="s2">= </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">().</span><span class="s1">split</span><span class="s2">(</span><span class="s3">&quot;=&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">tokens</span><span class="s2">[</span><span class="s1">token</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]] = </span><span class="s1">token</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>
    <span class="s4">elif </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-P'</span><span class="s2">:</span>
        <span class="s1">platforms</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">)</span>
    <span class="s4">elif </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-c'</span><span class="s2">:</span>
        <span class="s1">currentPlatform </span><span class="s2">= </span><span class="s4">True</span>
    <span class="s4">elif </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-s'</span><span class="s2">:</span>
        <span class="s1">includeRequires </span><span class="s2">= </span><span class="s4">True</span>
    <span class="s4">elif </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-O'</span><span class="s2">:</span>
        <span class="s1">omitDefaultCheckboxes </span><span class="s2">= </span><span class="s4">True</span>
    <span class="s4">elif </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-l'</span><span class="s2">:</span>
        <span class="s1">licensename </span><span class="s2">= </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>
    <span class="s4">elif </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-L'</span><span class="s2">:</span>
        <span class="s1">licensefile </span><span class="s2">= </span><span class="s1">Filename</span><span class="s2">.</span><span class="s1">fromOsSpecific</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">)</span>
    <span class="s4">elif </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-a'</span><span class="s2">:</span>
        <span class="s1">authorid </span><span class="s2">= </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>
    <span class="s4">elif </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-A'</span><span class="s2">:</span>
        <span class="s1">authorname </span><span class="s2">= </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>
    <span class="s4">elif </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-e'</span><span class="s2">:</span>
        <span class="s1">authoremail </span><span class="s2">= </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>
    <span class="s4">elif </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-i'</span><span class="s2">:</span>
        <span class="s1">iconFiles</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">Filename</span><span class="s2">.</span><span class="s1">fromOsSpecific</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">))</span>

    <span class="s4">elif </span><span class="s1">opt </span><span class="s2">== </span><span class="s3">'-h'</span><span class="s2">:</span>
        <span class="s1">usage</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">'illegal option: ' </span><span class="s2">+ </span><span class="s1">flag</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">)</span>
        <span class="s1">sys</span><span class="s2">.</span><span class="s1">exit</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">)</span>

<span class="s4">if not </span><span class="s1">args </span><span class="s4">or </span><span class="s1">len</span><span class="s2">(</span><span class="s1">args</span><span class="s2">) != </span><span class="s5">2</span><span class="s2">:</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s3">'Wrong number of arguments, received %s, expected 2' </span><span class="s2">% (</span>
        <span class="s1">len</span><span class="s2">(</span><span class="s1">args </span><span class="s4">or </span><span class="s2">[]))</span>
    <span class="s1">usage</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">)</span>

<span class="s1">appFilename </span><span class="s2">= </span><span class="s1">Filename</span><span class="s2">.</span><span class="s1">fromOsSpecific</span><span class="s2">(</span><span class="s1">args</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
<span class="s4">if </span><span class="s1">appFilename</span><span class="s2">.</span><span class="s1">getExtension</span><span class="s2">().</span><span class="s1">lower</span><span class="s2">() != </span><span class="s3">'p3d'</span><span class="s2">:</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s3">'Application filename must end in &quot;.p3d&quot;.'</span><span class="s2">)</span>
    <span class="s1">sys</span><span class="s2">.</span><span class="s1">exit</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>
<span class="s1">deploy_mode </span><span class="s2">= </span><span class="s1">args</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">lower</span><span class="s2">()</span>

<span class="s4">if not </span><span class="s1">appFilename</span><span class="s2">.</span><span class="s1">exists</span><span class="s2">():</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s3">'Application filename does not exist!'</span><span class="s2">)</span>
    <span class="s1">sys</span><span class="s2">.</span><span class="s1">exit</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>

<span class="s4">if </span><span class="s1">shortname </span><span class="s2">== </span><span class="s3">''</span><span class="s2">:</span>
    <span class="s1">shortname </span><span class="s2">= </span><span class="s1">appFilename</span><span class="s2">.</span><span class="s1">getBasenameWoExtension</span><span class="s2">()</span>

<span class="s4">if </span><span class="s1">shortname</span><span class="s2">.</span><span class="s1">lower</span><span class="s2">() != </span><span class="s1">shortname </span><span class="s4">or </span><span class="s3">' ' </span><span class="s4">in </span><span class="s1">shortname</span><span class="s2">:</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s3">'</span><span class="s4">\n</span><span class="s3">Provided short name should be lowercase, and may not contain spaces!</span><span class="s4">\n</span><span class="s3">'</span><span class="s2">)</span>

<span class="s4">if </span><span class="s1">version </span><span class="s2">== </span><span class="s3">'' </span><span class="s4">and </span><span class="s1">deploy_mode </span><span class="s2">== </span><span class="s3">'installer'</span><span class="s2">:</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s3">'</span><span class="s4">\n</span><span class="s3">A version number is required in &quot;installer&quot; mode.</span><span class="s4">\n</span><span class="s3">'</span><span class="s2">)</span>
    <span class="s1">sys</span><span class="s2">.</span><span class="s1">exit</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>

<span class="s4">if not </span><span class="s1">outputDir</span><span class="s2">:</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s3">'</span><span class="s4">\n</span><span class="s3">You must name the output directory with the -o parameter.</span><span class="s4">\n</span><span class="s3">'</span><span class="s2">)</span>
    <span class="s1">sys</span><span class="s2">.</span><span class="s1">exit</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>
<span class="s4">if not </span><span class="s1">outputDir</span><span class="s2">.</span><span class="s1">exists</span><span class="s2">():</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s3">'</span><span class="s4">\n</span><span class="s3">The specified output directory does not exist!</span><span class="s4">\n</span><span class="s3">'</span><span class="s2">)</span>
    <span class="s1">sys</span><span class="s2">.</span><span class="s1">exit</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>
<span class="s4">elif not </span><span class="s1">outputDir</span><span class="s2">.</span><span class="s1">isDirectory</span><span class="s2">():</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s3">'</span><span class="s4">\n</span><span class="s3">The specified output directory is a file!</span><span class="s4">\n</span><span class="s3">'</span><span class="s2">)</span>
    <span class="s1">sys</span><span class="s2">.</span><span class="s1">exit</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>

<span class="s4">if </span><span class="s1">deploy_mode </span><span class="s2">== </span><span class="s3">'standalone'</span><span class="s2">:</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s1">Standalone</span><span class="s2">(</span><span class="s1">appFilename</span><span class="s2">, </span><span class="s1">tokens</span><span class="s2">)</span>
    <span class="s1">s</span><span class="s2">.</span><span class="s1">basename </span><span class="s2">= </span><span class="s1">shortname</span>

    <span class="s4">if </span><span class="s1">currentPlatform</span><span class="s2">:</span>
        <span class="s1">platform </span><span class="s2">= </span><span class="s1">PandaSystem</span><span class="s2">.</span><span class="s1">getPlatform</span><span class="s2">()</span>
        <span class="s4">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s3">&quot;win&quot;</span><span class="s2">):</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">build</span><span class="s2">(</span><span class="s1">Filename</span><span class="s2">(</span><span class="s1">outputDir</span><span class="s2">, </span><span class="s1">shortname </span><span class="s2">+ </span><span class="s3">&quot;.exe&quot;</span><span class="s2">), </span><span class="s1">platform</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">build</span><span class="s2">(</span><span class="s1">Filename</span><span class="s2">(</span><span class="s1">outputDir</span><span class="s2">, </span><span class="s1">shortname</span><span class="s2">), </span><span class="s1">platform</span><span class="s2">)</span>
    <span class="s4">elif </span><span class="s1">len</span><span class="s2">(</span><span class="s1">platforms</span><span class="s2">) == </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s1">s</span><span class="s2">.</span><span class="s1">buildAll</span><span class="s2">(</span><span class="s1">outputDir</span><span class="s2">)</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s4">for </span><span class="s1">platform </span><span class="s4">in </span><span class="s1">platforms</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s3">&quot;win&quot;</span><span class="s2">):</span>
                <span class="s1">s</span><span class="s2">.</span><span class="s1">build</span><span class="s2">(</span><span class="s1">Filename</span><span class="s2">(</span><span class="s1">outputDir</span><span class="s2">, </span><span class="s1">platform </span><span class="s2">+ </span><span class="s3">&quot;/&quot; </span><span class="s2">+ </span><span class="s1">shortname </span><span class="s2">+ </span><span class="s3">&quot;.exe&quot;</span><span class="s2">), </span><span class="s1">platform</span><span class="s2">)</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">s</span><span class="s2">.</span><span class="s1">build</span><span class="s2">(</span><span class="s1">Filename</span><span class="s2">(</span><span class="s1">outputDir</span><span class="s2">, </span><span class="s1">platform </span><span class="s2">+ </span><span class="s3">&quot;/&quot; </span><span class="s2">+ </span><span class="s1">shortname</span><span class="s2">), </span><span class="s1">platform</span><span class="s2">)</span>

<span class="s4">elif </span><span class="s1">deploy_mode </span><span class="s2">== </span><span class="s3">'installer'</span><span class="s2">:</span>
    <span class="s4">if </span><span class="s1">includeRequires</span><span class="s2">:</span>
        <span class="s1">tokens</span><span class="s2">[</span><span class="s3">&quot;verify_contents&quot;</span><span class="s2">] = </span><span class="s3">&quot;never&quot;</span>
    <span class="s1">i </span><span class="s2">= </span><span class="s1">Installer</span><span class="s2">(</span><span class="s1">appFilename</span><span class="s2">, </span><span class="s1">shortname</span><span class="s2">, </span><span class="s1">fullname</span><span class="s2">, </span><span class="s1">version</span><span class="s2">, </span><span class="s1">tokens </span><span class="s2">= </span><span class="s1">tokens</span><span class="s2">)</span>
    <span class="s1">i</span><span class="s2">.</span><span class="s1">includeRequires </span><span class="s2">= </span><span class="s1">includeRequires</span>
    <span class="s4">if </span><span class="s1">omitDefaultCheckboxes</span><span class="s2">:</span>
        <span class="s1">i</span><span class="s2">.</span><span class="s1">offerRun </span><span class="s2">= </span><span class="s4">False</span>
        <span class="s1">i</span><span class="s2">.</span><span class="s1">offerDesktopShortcut </span><span class="s2">= </span><span class="s4">False</span>
    <span class="s1">i</span><span class="s2">.</span><span class="s1">licensename </span><span class="s2">= </span><span class="s1">licensename</span>
    <span class="s1">i</span><span class="s2">.</span><span class="s1">licensefile </span><span class="s2">= </span><span class="s1">licensefile</span>
    <span class="s4">if </span><span class="s1">authorid</span><span class="s2">:</span>
        <span class="s1">i</span><span class="s2">.</span><span class="s1">authorid </span><span class="s2">= </span><span class="s1">authorid</span>
    <span class="s4">if </span><span class="s1">authorname</span><span class="s2">:</span>
        <span class="s1">i</span><span class="s2">.</span><span class="s1">authorname </span><span class="s2">= </span><span class="s1">authorname</span>
    <span class="s4">if </span><span class="s1">authoremail</span><span class="s2">:</span>
        <span class="s1">i</span><span class="s2">.</span><span class="s1">authoremail </span><span class="s2">= </span><span class="s1">authoremail</span>
    <span class="s4">if not </span><span class="s1">authorname </span><span class="s4">or not </span><span class="s1">authoremail </span><span class="s4">or not </span><span class="s1">authorid</span><span class="s2">:</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Using author </span><span class="s4">\&quot;</span><span class="s3">%s</span><span class="s4">\&quot; </span><span class="s3">&lt;%s&gt; with ID %s&quot; </span><span class="s2">% </span><span class="s1">\</span>
            <span class="s2">(</span><span class="s1">i</span><span class="s2">.</span><span class="s1">authorname</span><span class="s2">, </span><span class="s1">i</span><span class="s2">.</span><span class="s1">authoremail</span><span class="s2">, </span><span class="s1">i</span><span class="s2">.</span><span class="s1">authorid</span><span class="s2">))</span>

    <span class="s0"># Add the supplied icon images</span>
    <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">iconFiles</span><span class="s2">) &gt; </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s1">failed </span><span class="s2">= </span><span class="s4">False</span>
        <span class="s1">i</span><span class="s2">.</span><span class="s1">icon </span><span class="s2">= </span><span class="s1">Icon</span><span class="s2">()</span>
        <span class="s4">for </span><span class="s1">iconFile </span><span class="s4">in </span><span class="s1">iconFiles</span><span class="s2">:</span>
            <span class="s4">if not </span><span class="s1">i</span><span class="s2">.</span><span class="s1">icon</span><span class="s2">.</span><span class="s1">addImage</span><span class="s2">(</span><span class="s1">iconFile</span><span class="s2">):</span>
                <span class="s1">print</span><span class="s2">(</span><span class="s3">'</span><span class="s4">\n</span><span class="s3">Failed to add icon image &quot;%s&quot;!</span><span class="s4">\n</span><span class="s3">' </span><span class="s2">% </span><span class="s1">iconFile</span><span class="s2">)</span>
                <span class="s1">failed </span><span class="s2">= </span><span class="s4">True</span>
        <span class="s4">if </span><span class="s1">failed</span><span class="s2">:</span>
            <span class="s1">sys</span><span class="s2">.</span><span class="s1">exit</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>

    <span class="s0"># Now build for the requested platforms.</span>
    <span class="s4">if </span><span class="s1">currentPlatform</span><span class="s2">:</span>
        <span class="s1">platform </span><span class="s2">= </span><span class="s1">PandaSystem</span><span class="s2">.</span><span class="s1">getPlatform</span><span class="s2">()</span>
        <span class="s4">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s3">&quot;win&quot;</span><span class="s2">):</span>
            <span class="s1">i</span><span class="s2">.</span><span class="s1">build</span><span class="s2">(</span><span class="s1">outputDir</span><span class="s2">, </span><span class="s1">platform</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">i</span><span class="s2">.</span><span class="s1">build</span><span class="s2">(</span><span class="s1">outputDir</span><span class="s2">, </span><span class="s1">platform</span><span class="s2">)</span>
    <span class="s4">elif </span><span class="s1">len</span><span class="s2">(</span><span class="s1">platforms</span><span class="s2">) == </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s1">i</span><span class="s2">.</span><span class="s1">buildAll</span><span class="s2">(</span><span class="s1">outputDir</span><span class="s2">)</span>
    <span class="s4">else</span><span class="s2">:</span>
        <span class="s4">for </span><span class="s1">platform </span><span class="s4">in </span><span class="s1">platforms</span><span class="s2">:</span>
            <span class="s1">output </span><span class="s2">= </span><span class="s1">Filename</span><span class="s2">(</span><span class="s1">outputDir</span><span class="s2">, </span><span class="s1">platform </span><span class="s2">+ </span><span class="s3">&quot;/&quot;</span><span class="s2">)</span>
            <span class="s1">output</span><span class="s2">.</span><span class="s1">makeDir</span><span class="s2">()</span>
            <span class="s1">i</span><span class="s2">.</span><span class="s1">build</span><span class="s2">(</span><span class="s1">output</span><span class="s2">, </span><span class="s1">platform</span><span class="s2">)</span>

    <span class="s4">del </span><span class="s1">i</span>

<span class="s4">elif </span><span class="s1">deploy_mode </span><span class="s2">== </span><span class="s3">'html'</span><span class="s2">:</span>
    <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;width&quot;</span><span class="s2">, </span><span class="s5">800</span><span class="s2">), </span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;height&quot;</span><span class="s2">, </span><span class="s5">600</span><span class="s2">)</span>
    <span class="s4">if </span><span class="s3">&quot;data&quot; </span><span class="s4">not in </span><span class="s1">tokens</span><span class="s2">:</span>
        <span class="s1">tokens</span><span class="s2">[</span><span class="s3">&quot;data&quot;</span><span class="s2">] = </span><span class="s1">appFilename</span><span class="s2">.</span><span class="s1">getBasename</span><span class="s2">()</span>

    <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;Creating %s.html...&quot; </span><span class="s2">% </span><span class="s1">shortname</span><span class="s2">)</span>
    <span class="s1">html </span><span class="s2">= </span><span class="s1">open</span><span class="s2">(</span><span class="s1">Filename</span><span class="s2">(</span><span class="s1">outputDir</span><span class="s2">, </span><span class="s1">shortname </span><span class="s2">+ </span><span class="s3">&quot;.html&quot;</span><span class="s2">).</span><span class="s1">toOsSpecific</span><span class="s2">(), </span><span class="s3">&quot;w&quot;</span><span class="s2">)</span>
    <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;&lt;!DOCTYPE html PUBLIC </span><span class="s4">\&quot;</span><span class="s3">-//W3C//DTD XHTML 1.0 Transitional//EN</span><span class="s4">\&quot; \&quot;</span><span class="s3">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</span><span class="s4">\&quot;</span><span class="s3">&gt;</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
    <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;&lt;html xmlns=</span><span class="s4">\&quot;</span><span class="s3">http://www.w3.org/1999/xhtml</span><span class="s4">\&quot;</span><span class="s3">&gt;</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
    <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;  &lt;head&gt;</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
    <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;    &lt;title&gt;%s&lt;/title&gt;</span><span class="s4">\n</span><span class="s3">&quot; </span><span class="s2">% </span><span class="s1">fullname</span><span class="s2">)</span>
    <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;    &lt;meta http-equiv=</span><span class="s4">\&quot;</span><span class="s3">Content-type</span><span class="s4">\&quot; </span><span class="s3">content=</span><span class="s4">\&quot;</span><span class="s3">text/html;charset=UTF-8</span><span class="s4">\&quot; </span><span class="s3">/&gt;</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
    <span class="s4">if </span><span class="s1">authorname</span><span class="s2">:</span>
        <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;    &lt;meta name=</span><span class="s4">\&quot;</span><span class="s3">Author</span><span class="s4">\&quot; </span><span class="s3">content=</span><span class="s4">\&quot;</span><span class="s3">%s</span><span class="s4">\&quot; </span><span class="s3">/&gt;</span><span class="s4">\n</span><span class="s3">&quot; </span><span class="s2">% </span><span class="s1">authorname</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s3">'&quot;'</span><span class="s2">, </span><span class="s3">'</span><span class="s4">\\</span><span class="s3">&quot;'</span><span class="s2">))</span>
    <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;  &lt;/head&gt;</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
    <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;  &lt;body&gt;</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
    <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;    &lt;object&quot;</span><span class="s2">)</span>
    <span class="s4">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s4">in </span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
        <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot; %s=</span><span class="s4">\&quot;</span><span class="s3">%s</span><span class="s4">\&quot;</span><span class="s3">&quot; </span><span class="s2">% (</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s3">'&quot;'</span><span class="s2">, </span><span class="s3">'</span><span class="s4">\\</span><span class="s3">&quot;'</span><span class="s2">)))</span>
    <span class="s4">if </span><span class="s3">&quot;width&quot; </span><span class="s4">not in </span><span class="s1">tokens</span><span class="s2">:</span>
        <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot; width=</span><span class="s4">\&quot;</span><span class="s3">%s</span><span class="s4">\&quot;</span><span class="s3">&quot; </span><span class="s2">% </span><span class="s1">w</span><span class="s2">)</span>
    <span class="s4">if </span><span class="s3">&quot;height&quot; </span><span class="s4">not in </span><span class="s1">tokens</span><span class="s2">:</span>
        <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot; height=</span><span class="s4">\&quot;</span><span class="s3">%s</span><span class="s4">\&quot;</span><span class="s3">&quot; </span><span class="s2">% </span><span class="s1">h</span><span class="s2">)</span>
    <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot; type=</span><span class="s4">\&quot;</span><span class="s3">application/x-panda3d</span><span class="s4">\&quot;</span><span class="s3">&gt;&quot;</span><span class="s2">)</span>
    <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;      &lt;object width=</span><span class="s4">\&quot;</span><span class="s3">%s</span><span class="s4">\&quot; </span><span class="s3">height=</span><span class="s4">\&quot;</span><span class="s3">%s</span><span class="s4">\&quot; </span><span class="s3">classid=</span><span class="s4">\&quot;</span><span class="s3">CLSID:924B4927-D3BA-41EA-9F7E-8A89194AB3AC</span><span class="s4">\&quot;</span><span class="s3">&gt;</span><span class="s4">\n</span><span class="s3">&quot; </span><span class="s2">% (</span><span class="s1">w</span><span class="s2">, </span><span class="s1">h</span><span class="s2">))</span>
    <span class="s4">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s4">in </span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
        <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;        &lt;param name=</span><span class="s4">\&quot;</span><span class="s3">%s</span><span class="s4">\&quot; </span><span class="s3">value=</span><span class="s4">\&quot;</span><span class="s3">%s</span><span class="s4">\&quot; </span><span class="s3">/&gt;</span><span class="s4">\n</span><span class="s3">&quot; </span><span class="s2">% (</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s3">'&quot;'</span><span class="s2">, </span><span class="s3">'</span><span class="s4">\\</span><span class="s3">&quot;'</span><span class="s2">)))</span>
    <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;      &lt;/object&gt;</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
    <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;    &lt;/object&gt;</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
    <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;  &lt;/body&gt;</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
    <span class="s1">html</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s3">&quot;&lt;/html&gt;</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s2">)</span>
    <span class="s1">html</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>
<span class="s4">else</span><span class="s2">:</span>
    <span class="s1">usage</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s3">'Invalid deployment mode!'</span><span class="s2">)</span>

<span class="s0"># An explicit call to exit() is required to exit the program, when</span>
<span class="s0"># this module is packaged in a p3d file.</span>
<span class="s1">sys</span><span class="s2">.</span><span class="s1">exit</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>

</pre>
</body>
</html>
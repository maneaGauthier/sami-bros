<html>
<head>
<title>FSMInspector.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #cf8e6d;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
FSMInspector.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Defines the `FSMInspector` class, which opens a Tkinter window for 
inspecting :ref:`finite-state-machines`. 
 
Using the Finite State Inspector 
-------------------------------- 
 
1) In your Config.prc add:: 
 
    want-tk #t 
 
2) Start up the show and create a Finite State Machine:: 
 
    from direct.showbase.ShowBaseGlobal import * 
 
    from direct.fsm import ClassicFSM 
    from direct.fsm import State 
 
    def enterState(): 
        print('enterState') 
 
    def exitState(): 
        print 'exitState' 
 
    fsm = ClassicFSM.ClassicFSM('stopLight', 
              [State.State('red', enterState, exitState, ['green']), 
                State.State('yellow', enterState, exitState, ['red']), 
                State.State('green', enterState, exitState, ['yellow'])], 
              'red', 
              'red') 
 
    import FSMInspector 
 
    inspector = FSMInspector.FSMInspector(fsm, title = fsm.getName()) 
 
    # Note, the inspectorPos argument is optional, the inspector will 
    # automagically position states on startup 
    fsm = ClassicFSM.ClassicFSM('stopLight', [ 
        State.State('yellow', 
                    enterState, 
                    exitState, 
                    ['red'], 
                    inspectorPos = [95.9, 48.0]), 
        State.State('red', 
                    enterState, 
                    exitState, 
                    ['green'], 
                    inspectorPos = [0.0, 0.0]), 
        State.State('green', 
                    enterState, 
                    exitState, 
                    ['yellow'], 
                    inspectorPos = [0.0, 95.9])], 
            'red', 
            'red') 
 
3) Pop open a viewer:: 
 
    import FSMInspector 
    insp = FSMInspector.FSMInspector(fsm) 
 
or if you wish to be fancy:: 
 
    insp = FSMInspector.FSMInspector(fsm, title = fsm.getName()) 
 
Features: 
 
  - Right mouse button over a state pops up a menu allowing you to 
    request a transition to that state 
  - Middle mouse button will grab the canvas and slide things around if 
    your state machine is bigger than the viewing area 
  - There are some self explanatory menu options up at the top, the most 
    useful being: &quot;print ClassicFSM layout&quot; which will print out Python 
    code which will create an ClassicFSM augmented with layout 
    information for the viewer so everything shows up in the same place 
    the next time you inspect the state machine 
 
Caveat 
------ 
 
There is an unexplained problem with using Tk and emacs right now which 
occasionally results in everything locking up.  This procedure seems to 
avoid the problem for me:: 
 
   # Start up the show 
   from direct.showbase.ShowBaseGlobal import * 
 
   # You will see the window and a Tk panel pop open 
 
   # Type a number at the emacs prompt 
   &gt;&gt;&gt; 123 
 
   # At this point everything will lock up and you won't get your prompt back 
 
   # Hit a bunch of Control-C's in rapid succession, in most cases 
   # this will break you out of whatever badness you were in and 
   # from that point on everything will behave normally 
 
 
   # This is how you pop up an inspector 
   import FSMInspector 
   inspector = FSMInspector.FSMInspector(fsm, title = fsm.getName()) 
 
&quot;&quot;&quot;</span>

<span class="s1">__all__ </span><span class="s2">= [</span><span class="s3">'FSMInspector'</span><span class="s2">, </span><span class="s3">'StateInspector'</span><span class="s2">]</span>

<span class="s4">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">tkwidgets</span><span class="s2">.</span><span class="s1">AppShell </span><span class="s4">import </span><span class="s2">*</span>
<span class="s4">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">showbase</span><span class="s2">.</span><span class="s1">TkGlobal </span><span class="s4">import </span><span class="s2">*</span>
<span class="s4">import </span><span class="s1">Pmw</span><span class="s2">, </span><span class="s1">math</span><span class="s2">, </span><span class="s1">operator</span><span class="s2">, </span><span class="s1">sys</span>

<span class="s4">if </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">version_info </span><span class="s2">&gt;= (</span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">):</span>
    <span class="s4">from </span><span class="s1">tkinter</span><span class="s2">.</span><span class="s1">simpledialog </span><span class="s4">import </span><span class="s1">askstring</span>
<span class="s4">else</span><span class="s2">:</span>
    <span class="s4">from </span><span class="s1">tkSimpleDialog </span><span class="s4">import </span><span class="s1">askstring</span>


<span class="s1">DELTA </span><span class="s2">= (</span><span class="s5">5.0 </span><span class="s2">/ </span><span class="s5">360.</span><span class="s2">) * </span><span class="s5">2.0 </span><span class="s2">* </span><span class="s1">math</span><span class="s2">.</span><span class="s1">pi</span>


<span class="s4">class </span><span class="s1">FSMInspector</span><span class="s2">(</span><span class="s1">AppShell</span><span class="s2">):</span>
    <span class="s6"># Override class variables</span>
    <span class="s1">appname </span><span class="s2">= </span><span class="s3">'ClassicFSM Inspector'</span>
    <span class="s1">frameWidth  </span><span class="s2">= </span><span class="s5">400</span>
    <span class="s1">frameHeight </span><span class="s2">= </span><span class="s5">450</span>
    <span class="s1">usecommandarea </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s1">usestatusarea  </span><span class="s2">= </span><span class="s5">0</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fsm</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
        <span class="s1">INITOPT </span><span class="s2">= </span><span class="s1">Pmw</span><span class="s2">.</span><span class="s1">INITOPT</span>
        <span class="s1">optiondefs </span><span class="s2">= (</span>
            <span class="s2">(</span><span class="s3">'title'</span><span class="s2">, </span><span class="s1">fsm</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">(), </span><span class="s4">None</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">'gridSize'</span><span class="s2">, </span><span class="s3">'0.25i'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_setGridSize</span><span class="s2">),</span>
            <span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">defineoptions</span><span class="s2">(</span><span class="s1">kw</span><span class="s2">, </span><span class="s1">optiondefs</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">fsm </span><span class="s2">= </span><span class="s1">fsm</span>
        <span class="s6"># Tell the fsm we are inspecting it so it will send events</span>
        <span class="s6"># when it changes state</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fsm</span><span class="s2">.</span><span class="s1">inspecting </span><span class="s2">= </span><span class="s5">1</span>

        <span class="s1">AppShell</span><span class="s2">.</span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">initialiseoptions</span><span class="s2">(</span><span class="s1">FSMInspector</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">appInit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># Initialize instance variables</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">states </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">stateInspectorDict </span><span class="s2">= {}</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fsm</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">createInterface</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># Create the components</span>
        <span class="s1">interior </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">interior</span><span class="s2">()</span>
        <span class="s1">menuBar </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuBar</span>

        <span class="s6"># ClassicFSM Menu</span>
        <span class="s1">menuBar</span><span class="s2">.</span><span class="s1">addmenu</span><span class="s2">(</span><span class="s3">'ClassicFSM'</span><span class="s2">, </span><span class="s3">'ClassicFSM Operations'</span><span class="s2">)</span>
        <span class="s1">menuBar</span><span class="s2">.</span><span class="s1">addmenuitem</span><span class="s2">(</span><span class="s3">'ClassicFSM'</span><span class="s2">, </span><span class="s3">'command'</span><span class="s2">,</span>
                                  <span class="s3">'Input grid spacing'</span><span class="s2">,</span>
                                  <span class="s1">label </span><span class="s2">= </span><span class="s3">'Grid spacing...'</span><span class="s2">,</span>
                                  <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">popupGridDialog</span><span class="s2">)</span>
        <span class="s6"># Create the checkbutton variable</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_fGridSnap </span><span class="s2">= </span><span class="s1">IntVar</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_fGridSnap</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">menuBar</span><span class="s2">.</span><span class="s1">addmenuitem</span><span class="s2">(</span><span class="s3">'ClassicFSM'</span><span class="s2">, </span><span class="s3">'checkbutton'</span><span class="s2">,</span>
                                  <span class="s3">'Enable/disable grid'</span><span class="s2">,</span>
                                  <span class="s1">label </span><span class="s2">= </span><span class="s3">'Snap to grid'</span><span class="s2">,</span>
                                  <span class="s1">variable </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_fGridSnap</span><span class="s2">,</span>
                                  <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">toggleGridSnap</span><span class="s2">)</span>
        <span class="s1">menuBar</span><span class="s2">.</span><span class="s1">addmenuitem</span><span class="s2">(</span><span class="s3">'ClassicFSM'</span><span class="s2">, </span><span class="s3">'command'</span><span class="s2">,</span>
                                  <span class="s3">'Print out ClassicFSM layout'</span><span class="s2">,</span>
                                  <span class="s1">label </span><span class="s2">= </span><span class="s3">'Print ClassicFSM layout'</span><span class="s2">,</span>
                                  <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">printLayout</span><span class="s2">)</span>

        <span class="s6"># States Menu</span>
        <span class="s1">menuBar</span><span class="s2">.</span><span class="s1">addmenu</span><span class="s2">(</span><span class="s3">'States'</span><span class="s2">, </span><span class="s3">'State Inspector Operations'</span><span class="s2">)</span>
        <span class="s1">menuBar</span><span class="s2">.</span><span class="s1">addcascademenu</span><span class="s2">(</span><span class="s3">'States'</span><span class="s2">, </span><span class="s3">'Font Size'</span><span class="s2">,</span>
                                     <span class="s3">'Set state label size'</span><span class="s2">, </span><span class="s1">tearoff </span><span class="s2">= </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s4">for </span><span class="s1">size </span><span class="s4">in </span><span class="s2">(</span><span class="s5">8</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">18</span><span class="s2">, </span><span class="s5">24</span><span class="s2">):</span>
            <span class="s1">menuBar</span><span class="s2">.</span><span class="s1">addmenuitem</span><span class="s2">(</span><span class="s3">'Font Size'</span><span class="s2">, </span><span class="s3">'command'</span><span class="s2">,</span>
                <span class="s3">'Set font to: ' </span><span class="s2">+ </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">size</span><span class="s2">) + </span><span class="s3">' Pts'</span><span class="s2">, </span><span class="s1">label </span><span class="s2">= </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">size</span><span class="s2">) + </span><span class="s3">' Pts'</span><span class="s2">,</span>
                <span class="s1">command </span><span class="s2">= </span><span class="s4">lambda </span><span class="s1">s </span><span class="s2">= </span><span class="s1">self</span><span class="s2">, </span><span class="s1">sz </span><span class="s2">= </span><span class="s1">size</span><span class="s2">: </span><span class="s1">s</span><span class="s2">.</span><span class="s1">setFontSize</span><span class="s2">(</span><span class="s1">sz</span><span class="s2">))</span>
        <span class="s1">menuBar</span><span class="s2">.</span><span class="s1">addcascademenu</span><span class="s2">(</span><span class="s3">'States'</span><span class="s2">, </span><span class="s3">'Marker Size'</span><span class="s2">,</span>
                                     <span class="s3">'Set state marker size'</span><span class="s2">, </span><span class="s1">tearoff </span><span class="s2">= </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s4">for </span><span class="s1">size </span><span class="s4">in </span><span class="s2">(</span><span class="s3">'Small'</span><span class="s2">, </span><span class="s3">'Medium'</span><span class="s2">, </span><span class="s3">'Large'</span><span class="s2">):</span>
            <span class="s1">sizeDict </span><span class="s2">= {</span><span class="s3">'Small'</span><span class="s2">: </span><span class="s3">'0.25i'</span><span class="s2">, </span><span class="s3">'Medium'</span><span class="s2">: </span><span class="s3">'0.375i'</span><span class="s2">, </span><span class="s3">'Large'</span><span class="s2">: </span><span class="s3">'0.5i'</span><span class="s2">}</span>
            <span class="s1">menuBar</span><span class="s2">.</span><span class="s1">addmenuitem</span><span class="s2">(</span><span class="s3">'Marker Size'</span><span class="s2">, </span><span class="s3">'command'</span><span class="s2">,</span>
                <span class="s1">size </span><span class="s2">+ </span><span class="s3">' markers'</span><span class="s2">, </span><span class="s1">label </span><span class="s2">= </span><span class="s1">size </span><span class="s2">+ </span><span class="s3">' Markers'</span><span class="s2">,</span>
                <span class="s1">command </span><span class="s2">= </span><span class="s4">lambda </span><span class="s1">s </span><span class="s2">= </span><span class="s1">self</span><span class="s2">, </span><span class="s1">sz </span><span class="s2">= </span><span class="s1">size</span><span class="s2">, </span><span class="s1">d </span><span class="s2">= </span><span class="s1">sizeDict</span><span class="s2">:</span>
                    <span class="s1">s</span><span class="s2">.</span><span class="s1">setMarkerSize</span><span class="s2">(</span><span class="s1">d</span><span class="s2">[</span><span class="s1">sz</span><span class="s2">]))</span>

        <span class="s6"># The Scrolled Canvas</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_scrolledCanvas </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createcomponent</span><span class="s2">(</span><span class="s3">'scrolledCanvas'</span><span class="s2">,</span>
                <span class="s2">(), </span><span class="s4">None</span><span class="s2">,</span>
                <span class="s1">Pmw</span><span class="s2">.</span><span class="s1">ScrolledCanvas</span><span class="s2">, (</span><span class="s1">interior</span><span class="s2">,),</span>
                <span class="s1">hull_width </span><span class="s2">= </span><span class="s5">400</span><span class="s2">, </span><span class="s1">hull_height </span><span class="s2">= </span><span class="s5">400</span><span class="s2">,</span>
                <span class="s1">usehullsize </span><span class="s2">= </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_scrolledCanvas</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'canvas'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">[</span><span class="s3">'scrollregion'</span><span class="s2">] = (</span><span class="s3">'-2i'</span><span class="s2">, </span><span class="s3">'-2i'</span><span class="s2">, </span><span class="s3">'2i'</span><span class="s2">, </span><span class="s3">'2i'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_scrolledCanvas</span><span class="s2">.</span><span class="s1">resizescrollregion</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_scrolledCanvas</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">padx </span><span class="s2">= </span><span class="s5">5</span><span class="s2">, </span><span class="s1">pady </span><span class="s2">= </span><span class="s5">5</span><span class="s2">, </span><span class="s1">expand</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">BOTH</span><span class="s2">)</span>

        <span class="s6"># Update lines</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">'&lt;B1-Motion&gt;'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">drawConnections</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">'&lt;ButtonPress-2&gt;'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mouse2Down</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">'&lt;B2-Motion&gt;'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mouse2Motion</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">'&lt;Configure&gt;'</span><span class="s2">,</span>
                          <span class="s4">lambda </span><span class="s1">e</span><span class="s2">, </span><span class="s1">sc </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_scrolledCanvas</span><span class="s2">:</span>
                          <span class="s1">sc</span><span class="s2">.</span><span class="s1">resizescrollregion</span><span class="s2">())</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">createStateInspectors</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">initialiseoptions</span><span class="s2">(</span><span class="s1">FSMInspector</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">scrolledCanvas</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_scrolledCanvas</span>

    <span class="s4">def </span><span class="s1">canvas</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span>

    <span class="s4">def </span><span class="s1">setFontSize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">size</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">itemconfigure</span><span class="s2">(</span><span class="s3">'labels'</span><span class="s2">, </span><span class="s1">font </span><span class="s2">= (</span><span class="s3">'MS Sans Serif'</span><span class="s2">, </span><span class="s1">size</span><span class="s2">))</span>

    <span class="s4">def </span><span class="s1">setMarkerSize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">size</span><span class="s2">):</span>
        <span class="s4">for </span><span class="s1">key </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">stateInspectorDict</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">stateInspectorDict</span><span class="s2">[</span><span class="s1">key</span><span class="s2">].</span><span class="s1">setRadius</span><span class="s2">(</span><span class="s1">size</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">drawConnections</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">drawConnections</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event </span><span class="s2">= </span><span class="s4">None</span><span class="s2">):</span>
        <span class="s6"># Get rid of existing arrows</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">delete</span><span class="s2">(</span><span class="s3">'arrow'</span><span class="s2">)</span>
        <span class="s4">for </span><span class="s1">key </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">stateInspectorDict</span><span class="s2">:</span>
            <span class="s1">si </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">stateInspectorDict</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
            <span class="s1">state </span><span class="s2">= </span><span class="s1">si</span><span class="s2">.</span><span class="s1">state</span>
            <span class="s4">if </span><span class="s1">state</span><span class="s2">.</span><span class="s1">getTransitions</span><span class="s2">():</span>
                <span class="s4">for </span><span class="s1">name </span><span class="s4">in </span><span class="s1">state</span><span class="s2">.</span><span class="s1">getTransitions</span><span class="s2">():</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">connectStates</span><span class="s2">(</span><span class="s1">si</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getStateInspector</span><span class="s2">(</span><span class="s1">name</span><span class="s2">))</span>

    <span class="s4">def </span><span class="s1">connectStates</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fromState</span><span class="s2">, </span><span class="s1">toState</span><span class="s2">):</span>
        <span class="s1">endpts </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">computeEndpoints</span><span class="s2">(</span><span class="s1">fromState</span><span class="s2">, </span><span class="s1">toState</span><span class="s2">)</span>
        <span class="s1">line </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">create_line</span><span class="s2">(</span><span class="s1">endpts</span><span class="s2">, </span><span class="s1">tags </span><span class="s2">= (</span><span class="s3">'arrow'</span><span class="s2">,),</span>
                                        <span class="s1">arrow </span><span class="s2">= </span><span class="s3">'last'</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">computeEndpoints</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fromState</span><span class="s2">, </span><span class="s1">toState</span><span class="s2">):</span>
        <span class="s6"># Compute angle between two points</span>
        <span class="s1">fromCenter </span><span class="s2">= </span><span class="s1">fromState</span><span class="s2">.</span><span class="s1">center</span><span class="s2">()</span>
        <span class="s1">toCenter </span><span class="s2">= </span><span class="s1">toState</span><span class="s2">.</span><span class="s1">center</span><span class="s2">()</span>
        <span class="s1">angle </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">findAngle</span><span class="s2">(</span><span class="s1">fromCenter</span><span class="s2">, </span><span class="s1">toCenter</span><span class="s2">)</span>

        <span class="s6"># Compute offset fromState point</span>
        <span class="s1">newFromPt </span><span class="s2">= </span><span class="s1">map</span><span class="s2">(</span><span class="s1">operator</span><span class="s2">.</span><span class="s1">__add__</span><span class="s2">,</span>
                        <span class="s1">fromCenter</span><span class="s2">,</span>
                        <span class="s1">self</span><span class="s2">.</span><span class="s1">computePoint</span><span class="s2">(</span><span class="s1">fromState</span><span class="s2">.</span><span class="s1">radius</span><span class="s2">,</span>
                                           <span class="s1">angle </span><span class="s2">+ </span><span class="s1">DELTA</span><span class="s2">))</span>

        <span class="s6"># Compute offset toState point</span>
        <span class="s1">newToPt </span><span class="s2">= </span><span class="s1">map</span><span class="s2">(</span><span class="s1">operator</span><span class="s2">.</span><span class="s1">__sub__</span><span class="s2">,</span>
                      <span class="s1">toCenter</span><span class="s2">,</span>
                      <span class="s1">self</span><span class="s2">.</span><span class="s1">computePoint</span><span class="s2">(</span><span class="s1">toState</span><span class="s2">.</span><span class="s1">radius</span><span class="s2">,</span>
                                         <span class="s1">angle </span><span class="s2">- </span><span class="s1">DELTA</span><span class="s2">))</span>
        <span class="s4">return </span><span class="s1">list</span><span class="s2">(</span><span class="s1">newFromPt</span><span class="s2">) + </span><span class="s1">list</span><span class="s2">(</span><span class="s1">newToPt</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">computePoint</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">radius</span><span class="s2">, </span><span class="s1">angle</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">radius </span><span class="s2">* </span><span class="s1">math</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">angle</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">radius </span><span class="s2">* </span><span class="s1">math</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">angle</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">findAngle</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fromPoint</span><span class="s2">, </span><span class="s1">toPoint</span><span class="s2">):</span>
        <span class="s1">dx </span><span class="s2">= </span><span class="s1">toPoint</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] - </span><span class="s1">fromPoint</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s1">dy </span><span class="s2">= </span><span class="s1">toPoint</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] - </span><span class="s1">fromPoint</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>
        <span class="s4">return </span><span class="s1">math</span><span class="s2">.</span><span class="s1">atan2</span><span class="s2">(</span><span class="s1">dy</span><span class="s2">, </span><span class="s1">dx</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">mouse2Down</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_width </span><span class="s2">= </span><span class="s5">1.0 </span><span class="s2">* </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">winfo_width</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_height </span><span class="s2">= </span><span class="s5">1.0 </span><span class="s2">* </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">winfo_height</span><span class="s2">()</span>
        <span class="s1">xview </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">xview</span><span class="s2">()</span>
        <span class="s1">yview </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">yview</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_left </span><span class="s2">= </span><span class="s1">xview</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_top </span><span class="s2">= </span><span class="s1">yview</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_dxview </span><span class="s2">= </span><span class="s1">xview</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] - </span><span class="s1">xview</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_dyview </span><span class="s2">= </span><span class="s1">yview</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] - </span><span class="s1">yview</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_2lx </span><span class="s2">= </span><span class="s1">event</span><span class="s2">.</span><span class="s1">x</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_2ly </span><span class="s2">= </span><span class="s1">event</span><span class="s2">.</span><span class="s1">y</span>

    <span class="s4">def </span><span class="s1">mouse2Motion</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">):</span>
        <span class="s1">newx </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_left </span><span class="s2">- ((</span><span class="s1">event</span><span class="s2">.</span><span class="s1">x </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_2lx</span><span class="s2">)/</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_width</span><span class="s2">) * </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_dxview</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">xview_moveto</span><span class="s2">(</span><span class="s1">newx</span><span class="s2">)</span>
        <span class="s1">newy </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_top </span><span class="s2">- ((</span><span class="s1">event</span><span class="s2">.</span><span class="s1">y </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_2ly</span><span class="s2">)/</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_height</span><span class="s2">) * </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_dyview</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">yview_moveto</span><span class="s2">(</span><span class="s1">newy</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_2lx </span><span class="s2">= </span><span class="s1">event</span><span class="s2">.</span><span class="s1">x</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_2ly </span><span class="s2">= </span><span class="s1">event</span><span class="s2">.</span><span class="s1">y</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_left </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">xview</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_top </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">yview</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">]</span>

    <span class="s4">def </span><span class="s1">createStateInspectors</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fsm </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fsm</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">states </span><span class="s2">= </span><span class="s1">fsm</span><span class="s2">.</span><span class="s1">getStates</span><span class="s2">()</span>
        <span class="s6"># Number of rows/cols needed to fit inspectors in a grid</span>
        <span class="s1">dim </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s1">math</span><span class="s2">.</span><span class="s1">ceil</span><span class="s2">(</span><span class="s1">math</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">states</span><span class="s2">))))</span>
        <span class="s6"># Separation between nodes</span>
        <span class="s1">spacing </span><span class="s2">= </span><span class="s5">2.5 </span><span class="s2">* </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">canvasx</span><span class="s2">(</span><span class="s3">'0.375i'</span><span class="s2">)</span>
        <span class="s1">count </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s4">for </span><span class="s1">state </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">states</span><span class="s2">:</span>
            <span class="s1">si </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">addState</span><span class="s2">(</span><span class="s1">state</span><span class="s2">)</span>
            <span class="s4">if </span><span class="s1">state</span><span class="s2">.</span><span class="s1">getInspectorPos</span><span class="s2">():</span>
                <span class="s1">si</span><span class="s2">.</span><span class="s1">setPos</span><span class="s2">(</span><span class="s1">state</span><span class="s2">.</span><span class="s1">getInspectorPos</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">],</span>
                          <span class="s1">state</span><span class="s2">.</span><span class="s1">getInspectorPos</span><span class="s2">()[</span><span class="s5">1</span><span class="s2">])</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">row </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s1">math</span><span class="s2">.</span><span class="s1">floor</span><span class="s2">(</span><span class="s1">count </span><span class="s2">/ </span><span class="s1">dim</span><span class="s2">))</span>
                <span class="s1">col </span><span class="s2">= </span><span class="s1">count </span><span class="s2">% </span><span class="s1">dim</span>
                <span class="s1">si</span><span class="s2">.</span><span class="s1">setPos</span><span class="s2">(</span><span class="s1">col </span><span class="s2">* </span><span class="s1">spacing</span><span class="s2">, </span><span class="s1">row </span><span class="s2">* </span><span class="s1">spacing </span><span class="s2">+</span>
                          <span class="s5">0.5 </span><span class="s2">* (</span><span class="s5">0</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">)[</span><span class="s1">col </span><span class="s2">% </span><span class="s5">2</span><span class="s2">])</span>
            <span class="s6"># Add hooks</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">accept</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'_' </span><span class="s2">+ </span><span class="s1">si</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">() + </span><span class="s3">'_entered'</span><span class="s2">,</span>
                        <span class="s1">si</span><span class="s2">.</span><span class="s1">enteredState</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">accept</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'_' </span><span class="s2">+ </span><span class="s1">si</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">() + </span><span class="s3">'_exited'</span><span class="s2">,</span>
                        <span class="s1">si</span><span class="s2">.</span><span class="s1">exitedState</span><span class="s2">)</span>
            <span class="s1">count </span><span class="s2">= </span><span class="s1">count </span><span class="s2">+ </span><span class="s5">1</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">drawConnections</span><span class="s2">()</span>
        <span class="s4">if </span><span class="s1">fsm</span><span class="s2">.</span><span class="s1">getCurrentState</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">enteredState</span><span class="s2">(</span><span class="s1">fsm</span><span class="s2">.</span><span class="s1">getCurrentState</span><span class="s2">().</span><span class="s1">getName</span><span class="s2">())</span>

    <span class="s4">def </span><span class="s1">getStateInspector</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">stateInspectorDict</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s4">None</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">addState</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">state</span><span class="s2">):</span>
        <span class="s1">si </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">stateInspectorDict</span><span class="s2">[</span><span class="s1">state</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">()] = (</span>
            <span class="s1">StateInspector</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">state</span><span class="s2">))</span>
        <span class="s4">return </span><span class="s1">si</span>

    <span class="s4">def </span><span class="s1">enteredState</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">stateName</span><span class="s2">):</span>
        <span class="s1">si </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">stateInspectorDict</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">stateName</span><span class="s2">, </span><span class="s4">None</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">si</span><span class="s2">:</span>
            <span class="s1">si</span><span class="s2">.</span><span class="s1">enteredState</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">exitedState</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">stateName</span><span class="s2">):</span>
        <span class="s1">si </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">stateInspectorDict</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">stateName</span><span class="s2">, </span><span class="s4">None</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">si</span><span class="s2">:</span>
            <span class="s1">si</span><span class="s2">.</span><span class="s1">exitedState</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">_setGridSize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_gridSize </span><span class="s2">= </span><span class="s1">self</span><span class="s2">[</span><span class="s3">'gridSize'</span><span class="s2">]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setGridSize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_gridSize</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">setGridSize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">size</span><span class="s2">):</span>
        <span class="s4">for </span><span class="s1">key </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">stateInspectorDict</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">stateInspectorDict</span><span class="s2">[</span><span class="s1">key</span><span class="s2">].</span><span class="s1">setGridSize</span><span class="s2">(</span><span class="s1">size</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">popupGridDialog</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">spacing </span><span class="s2">= </span><span class="s1">askstring</span><span class="s2">(</span><span class="s3">'ClassicFSM Grid Spacing'</span><span class="s2">, </span><span class="s3">'Grid Spacing:'</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">spacing</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">setGridSize</span><span class="s2">(</span><span class="s1">spacing</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_gridSize </span><span class="s2">= </span><span class="s1">spacing</span>

    <span class="s4">def </span><span class="s1">toggleGridSnap</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_fGridSnap</span><span class="s2">.</span><span class="s1">get</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">setGridSize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_gridSize</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">setGridSize</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">printLayout</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">dict </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">stateInspectorDict</span>
        <span class="s1">keys </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">dict</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">())</span>
        <span class="s1">keys</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">()</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;ClassicFSM.ClassicFSM('%s', [&quot; </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)</span>
        <span class="s4">for </span><span class="s1">key </span><span class="s4">in </span><span class="s1">keys</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">]:</span>
            <span class="s1">si </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
            <span class="s1">center </span><span class="s2">= </span><span class="s1">si</span><span class="s2">.</span><span class="s1">center</span><span class="s2">()</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;    State.State('%s',&quot; </span><span class="s2">% </span><span class="s1">si</span><span class="s2">.</span><span class="s1">state</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">())</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;                %s,&quot; </span><span class="s2">% </span><span class="s1">si</span><span class="s2">.</span><span class="s1">state</span><span class="s2">.</span><span class="s1">getEnterFunc</span><span class="s2">().</span><span class="s1">__name__</span><span class="s2">)</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;                %s,&quot; </span><span class="s2">% </span><span class="s1">si</span><span class="s2">.</span><span class="s1">state</span><span class="s2">.</span><span class="s1">getExitFunc</span><span class="s2">().</span><span class="s1">__name__</span><span class="s2">)</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;                %s,&quot; </span><span class="s2">% </span><span class="s1">si</span><span class="s2">.</span><span class="s1">state</span><span class="s2">.</span><span class="s1">getTransitions</span><span class="s2">())</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;                inspectorPos = [%.1f, %.1f]),&quot; </span><span class="s2">% (</span><span class="s1">center</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">center</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]))</span>
        <span class="s4">for </span><span class="s1">key </span><span class="s4">in </span><span class="s1">keys</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">:]:</span>
            <span class="s1">si </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
            <span class="s1">center </span><span class="s2">= </span><span class="s1">si</span><span class="s2">.</span><span class="s1">center</span><span class="s2">()</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;    State.State('%s',&quot; </span><span class="s2">% </span><span class="s1">si</span><span class="s2">.</span><span class="s1">state</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">())</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;                %s,&quot; </span><span class="s2">% </span><span class="s1">si</span><span class="s2">.</span><span class="s1">state</span><span class="s2">.</span><span class="s1">getEnterFunc</span><span class="s2">().</span><span class="s1">__name__</span><span class="s2">)</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;                %s,&quot; </span><span class="s2">% </span><span class="s1">si</span><span class="s2">.</span><span class="s1">state</span><span class="s2">.</span><span class="s1">getExitFunc</span><span class="s2">().</span><span class="s1">__name__</span><span class="s2">)</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;                %s,&quot; </span><span class="s2">% </span><span class="s1">si</span><span class="s2">.</span><span class="s1">state</span><span class="s2">.</span><span class="s1">getTransitions</span><span class="s2">())</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;                inspectorPos = [%.1f, %.1f])],&quot; </span><span class="s2">% (</span><span class="s1">center</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">center</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]))</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;        '%s',&quot; </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fsm</span><span class="s2">.</span><span class="s1">getInitialState</span><span class="s2">().</span><span class="s1">getName</span><span class="s2">())</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s3">&quot;        '%s')&quot; </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fsm</span><span class="s2">.</span><span class="s1">getFinalState</span><span class="s2">().</span><span class="s1">getName</span><span class="s2">())</span>

    <span class="s4">def </span><span class="s1">toggleBalloon</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">toggleBalloonVar</span><span class="s2">.</span><span class="s1">get</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">balloon</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'balloon'</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">balloon</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'none'</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">onDestroy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; Called on ClassicFSM Panel shutdown &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fsm</span><span class="s2">.</span><span class="s1">inspecting </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s4">for </span><span class="s1">si </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">stateInspectorDict</span><span class="s2">.</span><span class="s1">values</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ignore</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'_' </span><span class="s2">+ </span><span class="s1">si</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">() + </span><span class="s3">'_entered'</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ignore</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'_' </span><span class="s2">+ </span><span class="s1">si</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">() + </span><span class="s3">'_exited'</span><span class="s2">)</span>

<span class="s4">class </span><span class="s1">StateInspector</span><span class="s2">(</span><span class="s1">Pmw</span><span class="s2">.</span><span class="s1">MegaArchetype</span><span class="s2">):</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">inspector</span><span class="s2">, </span><span class="s1">state</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>

        <span class="s6"># Record inspector and state</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">inspector </span><span class="s2">= </span><span class="s1">inspector</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s1">state</span>
        <span class="s6"># Create a unique tag which you can use to move a marker and</span>
        <span class="s6"># and its corresponding text around together</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tag </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fsm </span><span class="s2">= </span><span class="s1">inspector</span><span class="s2">.</span><span class="s1">fsm</span>

        <span class="s6"># Pointers to the inspector's components</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">scrolledCanvas </span><span class="s2">= </span><span class="s1">inspector</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'scrolledCanvas'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">scrolledCanvas</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'canvas'</span><span class="s2">)</span>

        <span class="s6">#define the megawidget options</span>
        <span class="s1">optiondefs </span><span class="s2">= (</span>
            <span class="s2">(</span><span class="s3">'radius'</span><span class="s2">, </span><span class="s3">'0.375i'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_setRadius</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">'gridSize'</span><span class="s2">, </span><span class="s3">'0.25i'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_setGridSize</span><span class="s2">),</span>
            <span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">defineoptions</span><span class="s2">(</span><span class="s1">kw</span><span class="s2">, </span><span class="s1">optiondefs</span><span class="s2">)</span>

        <span class="s6"># Initialize the parent class</span>
        <span class="s1">Pmw</span><span class="s2">.</span><span class="s1">MegaArchetype</span><span class="s2">.</span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

        <span class="s6"># Draw the oval</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">x </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">y </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s1">half </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">winfo_fpixels</span><span class="s2">(</span><span class="s1">self</span><span class="s2">[</span><span class="s3">'radius'</span><span class="s2">])</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">marker </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">create_oval</span><span class="s2">((</span><span class="s1">self</span><span class="s2">.</span><span class="s1">x </span><span class="s2">- </span><span class="s1">half</span><span class="s2">),</span>
                                               <span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">y </span><span class="s2">- </span><span class="s1">half</span><span class="s2">),</span>
                                               <span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">x </span><span class="s2">+ </span><span class="s1">half</span><span class="s2">),</span>
                                               <span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">y </span><span class="s2">+ </span><span class="s1">half</span><span class="s2">),</span>
                                              <span class="s1">fill </span><span class="s2">= </span><span class="s3">'CornflowerBlue'</span><span class="s2">,</span>
                                              <span class="s1">tags </span><span class="s2">= (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tag</span><span class="s2">,</span><span class="s3">'markers'</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">text </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">create_text</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">(),</span>
                                           <span class="s1">justify </span><span class="s2">= </span><span class="s1">CENTER</span><span class="s2">,</span>
                                           <span class="s1">tags </span><span class="s2">= (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tag</span><span class="s2">,</span><span class="s3">'labels'</span><span class="s2">))</span>
        <span class="s6"># Is this state contain a sub machine?</span>
        <span class="s4">if </span><span class="s1">state</span><span class="s2">.</span><span class="s1">hasChildren</span><span class="s2">():</span>
            <span class="s6"># reduce half by sqrt of 2.0</span>
            <span class="s1">half </span><span class="s2">= </span><span class="s1">half </span><span class="s2">* </span><span class="s5">0.707106</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">rect </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">create_rectangle</span><span class="s2">((- </span><span class="s1">half</span><span class="s2">), (- </span><span class="s1">half</span><span class="s2">),</span>
                                                     <span class="s1">half</span><span class="s2">, </span><span class="s1">half</span><span class="s2">,</span>
                                                     <span class="s1">tags </span><span class="s2">= (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tag</span><span class="s2">,))</span>


        <span class="s6"># The Popup State Menu</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_popupMenu </span><span class="s2">= </span><span class="s1">Menu</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">, </span><span class="s1">tearoff </span><span class="s2">= </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_popupMenu</span><span class="s2">.</span><span class="s1">add_command</span><span class="s2">(</span><span class="s1">label </span><span class="s2">= </span><span class="s3">'Request transition to ' </span><span class="s2">+</span>
                                    <span class="s1">state</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">(),</span>
                                    <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">transitionTo</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">state</span><span class="s2">.</span><span class="s1">hasChildren</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_popupMenu</span><span class="s2">.</span><span class="s1">add_command</span><span class="s2">(</span><span class="s1">label </span><span class="s2">= </span><span class="s3">'Inspect ' </span><span class="s2">+ </span><span class="s1">state</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">() +</span>
                                        <span class="s3">' submachine'</span><span class="s2">,</span>
                                        <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inspectSubMachine</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">scrolledCanvas</span><span class="s2">.</span><span class="s1">resizescrollregion</span><span class="s2">()</span>

        <span class="s6"># Add bindings</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">tag_bind</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tag</span><span class="s2">, </span><span class="s3">'&lt;Enter&gt;'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mouseEnter</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">tag_bind</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tag</span><span class="s2">, </span><span class="s3">'&lt;Leave&gt;'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mouseLeave</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">tag_bind</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tag</span><span class="s2">, </span><span class="s3">'&lt;ButtonPress-1&gt;'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mouseDown</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">tag_bind</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tag</span><span class="s2">, </span><span class="s3">'&lt;B1-Motion&gt;'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mouseMotion</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">tag_bind</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tag</span><span class="s2">, </span><span class="s3">'&lt;ButtonRelease-1&gt;'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mouseRelease</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">tag_bind</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tag</span><span class="s2">, </span><span class="s3">'&lt;ButtonPress-3&gt;'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">popupStateMenu</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">initialiseoptions</span><span class="s2">(</span><span class="s1">StateInspector</span><span class="s2">)</span>

    <span class="s6"># Utility methods</span>
    <span class="s4">def </span><span class="s1">_setRadius</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setRadius</span><span class="s2">(</span><span class="s1">self</span><span class="s2">[</span><span class="s3">'radius'</span><span class="s2">])</span>

    <span class="s4">def </span><span class="s1">setRadius</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">size</span><span class="s2">):</span>
        <span class="s1">half </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">radius </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">winfo_fpixels</span><span class="s2">(</span><span class="s1">size</span><span class="s2">)</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">center</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">coords</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">marker</span><span class="s2">,</span>
                            <span class="s1">c</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] - </span><span class="s1">half</span><span class="s2">, </span><span class="s1">c</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] - </span><span class="s1">half</span><span class="s2">, </span><span class="s1">c</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] + </span><span class="s1">half</span><span class="s2">, </span><span class="s1">c</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] + </span><span class="s1">half</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">state</span><span class="s2">.</span><span class="s1">hasChildren</span><span class="s2">():</span>
            <span class="s1">half </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">radius </span><span class="s2">* </span><span class="s5">0.707106</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">coords</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">rect</span><span class="s2">,</span>
                            <span class="s1">c</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] - </span><span class="s1">half</span><span class="s2">, </span><span class="s1">c</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] - </span><span class="s1">half</span><span class="s2">, </span><span class="s1">c</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] + </span><span class="s1">half</span><span class="s2">, </span><span class="s1">c</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] + </span><span class="s1">half</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_setGridSize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setGridSize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">[</span><span class="s3">'gridSize'</span><span class="s2">])</span>

    <span class="s4">def </span><span class="s1">setGridSize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">size</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">gridSize </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">winfo_fpixels</span><span class="s2">(</span><span class="s1">size</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">gridSize </span><span class="s2">== </span><span class="s5">0</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">fGridSnap </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">fGridSnap </span><span class="s2">= </span><span class="s5">1</span>

    <span class="s4">def </span><span class="s1">setText</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s4">None</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">itemconfigure</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">text</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s1">text</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">setPos</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">snapToGrid </span><span class="s2">= </span><span class="s5">0</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fGridSnap</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">x </span><span class="s2">= </span><span class="s1">round</span><span class="s2">(</span><span class="s1">x </span><span class="s2">/ </span><span class="s1">self</span><span class="s2">.</span><span class="s1">gridSize</span><span class="s2">) * </span><span class="s1">self</span><span class="s2">.</span><span class="s1">gridSize</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">y </span><span class="s2">= </span><span class="s1">round</span><span class="s2">(</span><span class="s1">y </span><span class="s2">/ </span><span class="s1">self</span><span class="s2">.</span><span class="s1">gridSize</span><span class="s2">) * </span><span class="s1">self</span><span class="s2">.</span><span class="s1">gridSize</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">x </span><span class="s2">= </span><span class="s1">x</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">y </span><span class="s2">= </span><span class="s1">y</span>
        <span class="s6"># How far do we have to move?</span>
        <span class="s1">cx</span><span class="s2">, </span><span class="s1">cy </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">center</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">move</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tag</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">x </span><span class="s2">- </span><span class="s1">cx</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">y </span><span class="s2">- </span><span class="s1">cy</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">center</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">coords</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">marker</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s2">(</span><span class="s1">c</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] + </span><span class="s1">c</span><span class="s2">[</span><span class="s5">2</span><span class="s2">])/</span><span class="s5">2.0</span><span class="s2">, (</span><span class="s1">c</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] + </span><span class="s1">c</span><span class="s2">[</span><span class="s5">3</span><span class="s2">])/</span><span class="s5">2.0</span>

    <span class="s4">def </span><span class="s1">getName</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tag</span>

    <span class="s6"># Event Handlers</span>
    <span class="s4">def </span><span class="s1">mouseEnter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">itemconfig</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">marker</span><span class="s2">, </span><span class="s1">width </span><span class="s2">= </span><span class="s5">2</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">mouseLeave</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">itemconfig</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">marker</span><span class="s2">, </span><span class="s1">width </span><span class="s2">= </span><span class="s5">1</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">mouseDown</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">lift</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tag</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">startx</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">starty </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">center</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">lastx </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">canvasx</span><span class="s2">(</span><span class="s1">event</span><span class="s2">.</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">lasty </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">canvasy</span><span class="s2">(</span><span class="s1">event</span><span class="s2">.</span><span class="s1">y</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">mouseMotion</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">):</span>
        <span class="s1">dx </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">canvasx</span><span class="s2">(</span><span class="s1">event</span><span class="s2">.</span><span class="s1">x</span><span class="s2">) - </span><span class="s1">self</span><span class="s2">.</span><span class="s1">lastx</span>
        <span class="s1">dy </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">canvasy</span><span class="s2">(</span><span class="s1">event</span><span class="s2">.</span><span class="s1">y</span><span class="s2">) - </span><span class="s1">self</span><span class="s2">.</span><span class="s1">lasty</span>
        <span class="s1">newx</span><span class="s2">, </span><span class="s1">newy </span><span class="s2">= </span><span class="s1">map</span><span class="s2">(</span><span class="s1">operator</span><span class="s2">.</span><span class="s1">__add__</span><span class="s2">, (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">startx</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">starty</span><span class="s2">), (</span><span class="s1">dx</span><span class="s2">, </span><span class="s1">dy</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setPos</span><span class="s2">(</span><span class="s1">newx</span><span class="s2">, </span><span class="s1">newy</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">mouseRelease</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">scrolledCanvas</span><span class="s2">.</span><span class="s1">resizescrollregion</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">popupStateMenu</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_popupMenu</span><span class="s2">.</span><span class="s1">post</span><span class="s2">(</span><span class="s1">event</span><span class="s2">.</span><span class="s1">widget</span><span class="s2">.</span><span class="s1">winfo_pointerx</span><span class="s2">(),</span>
                             <span class="s1">event</span><span class="s2">.</span><span class="s1">widget</span><span class="s2">.</span><span class="s1">winfo_pointery</span><span class="s2">())</span>

    <span class="s4">def </span><span class="s1">transitionTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fsm</span><span class="s2">.</span><span class="s1">request</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">())</span>

    <span class="s4">def </span><span class="s1">inspectSubMachine</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s3">'inspect ' </span><span class="s2">+ </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tag </span><span class="s2">+ </span><span class="s3">' subMachine'</span><span class="s2">)</span>
        <span class="s4">for </span><span class="s1">childFSM </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">state</span><span class="s2">.</span><span class="s1">getChildren</span><span class="s2">():</span>
            <span class="s1">FSMInspector</span><span class="s2">(</span><span class="s1">childFSM</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">enteredState</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">itemconfigure</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">marker</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s3">'Red'</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">exitedState</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_canvas</span><span class="s2">.</span><span class="s1">itemconfigure</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">marker</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s3">'CornflowerBlue'</span><span class="s2">)</span>
</pre>
</body>
</html>
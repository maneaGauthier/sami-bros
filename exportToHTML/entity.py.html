<html>
<head>
<title>entity.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #2aacb8;}
.s5 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
entity.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">sys</span>
<span class="s0">import </span><span class="s1">importlib</span>
<span class="s0">import </span><span class="s1">glob</span>
<span class="s0">import </span><span class="s1">ursina</span>
<span class="s0">from </span><span class="s1">pathlib </span><span class="s0">import </span><span class="s1">Path</span>
<span class="s0">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">NodePath</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">vec2 </span><span class="s0">import </span><span class="s1">Vec2</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">vec3 </span><span class="s0">import </span><span class="s1">Vec3</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">vec4 </span><span class="s0">import </span><span class="s1">Vec4</span>
<span class="s0">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">Quat</span>
<span class="s0">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">TransparencyAttrib</span>
<span class="s0">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">Shader</span>
<span class="s0">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">TexGenAttrib</span>

<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">texture </span><span class="s0">import </span><span class="s1">Texture</span>
<span class="s0">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">MovieTexture</span>
<span class="s0">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">TextureStage</span>
<span class="s0">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">CullFaceAttrib</span>

<span class="s0">from </span><span class="s1">ursina </span><span class="s0">import </span><span class="s1">application</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">collider </span><span class="s0">import </span><span class="s1">Collider</span><span class="s2">, </span><span class="s1">BoxCollider</span><span class="s2">, </span><span class="s1">SphereCollider</span><span class="s2">, </span><span class="s1">MeshCollider</span><span class="s2">, </span><span class="s1">CapsuleCollider</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">mesh </span><span class="s0">import </span><span class="s1">Mesh</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">sequence </span><span class="s0">import </span><span class="s1">Sequence</span><span class="s2">, </span><span class="s1">Func</span><span class="s2">, </span><span class="s1">Wait</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">ursinamath </span><span class="s0">import </span><span class="s1">lerp</span>
<span class="s0">from </span><span class="s1">ursina </span><span class="s0">import </span><span class="s1">curve</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">curve </span><span class="s0">import </span><span class="s1">CubicBezier</span>
<span class="s0">from </span><span class="s1">ursina </span><span class="s0">import </span><span class="s1">mesh_importer</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">mesh_importer </span><span class="s0">import </span><span class="s1">load_model</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">texture_importer </span><span class="s0">import </span><span class="s1">load_texture</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">string_utilities </span><span class="s0">import </span><span class="s1">camel_to_snake</span>
<span class="s0">from </span><span class="s1">textwrap </span><span class="s0">import </span><span class="s1">dedent</span>
<span class="s0">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">Shader </span><span class="s0">as </span><span class="s1">Panda3dShader</span>
<span class="s0">from </span><span class="s1">ursina </span><span class="s0">import </span><span class="s1">shader</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">shader </span><span class="s0">import </span><span class="s1">Shader</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">string_utilities </span><span class="s0">import </span><span class="s1">print_info</span><span class="s2">, </span><span class="s1">print_warning</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">ursinamath </span><span class="s0">import </span><span class="s1">Bounds</span>

<span class="s0">from </span><span class="s1">ursina </span><span class="s0">import </span><span class="s1">color</span>
<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">color </span><span class="s0">import </span><span class="s1">Color</span>
<span class="s0">try</span><span class="s2">:</span>
    <span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">scene </span><span class="s0">import </span><span class="s1">instance </span><span class="s0">as </span><span class="s1">scene</span>
<span class="s0">except</span><span class="s2">:</span>
    <span class="s0">pass</span>

<span class="s1">_Ursina_instance </span><span class="s2">= </span><span class="s0">None</span>
<span class="s1">_warn_if_ursina_not_instantiated </span><span class="s2">= </span><span class="s0">True </span><span class="s3"># gets set to True after Ursina.__init__() to ensure the correct order.</span>

<span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">scripts</span><span class="s2">.</span><span class="s1">property_generator </span><span class="s0">import </span><span class="s1">generate_properties_for_class</span>
<span class="s2">@</span><span class="s1">generate_properties_for_class</span><span class="s2">()</span>
<span class="s0">class </span><span class="s1">Entity</span><span class="s2">(</span><span class="s1">NodePath</span><span class="s2">):</span>
    <span class="s1">rotation_directions </span><span class="s2">= (-</span><span class="s4">1</span><span class="s2">,-</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">default_shader </span><span class="s2">= </span><span class="s0">None</span>
    <span class="s1">default_values </span><span class="s2">= {</span>
        <span class="s3"># 'parent':scene,</span>
        <span class="s5">'name'</span><span class="s2">:</span><span class="s5">'entity'</span><span class="s2">, </span><span class="s5">'enabled'</span><span class="s2">:</span><span class="s0">True</span><span class="s2">, </span><span class="s5">'eternal'</span><span class="s2">:</span><span class="s0">False</span><span class="s2">, </span><span class="s5">'position'</span><span class="s2">:</span><span class="s1">Vec3</span><span class="s2">(</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">), </span><span class="s5">'rotation'</span><span class="s2">:</span><span class="s1">Vec3</span><span class="s2">(</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">), </span><span class="s5">'scale'</span><span class="s2">:</span><span class="s1">Vec3</span><span class="s2">(</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">), </span><span class="s5">'model'</span><span class="s2">:</span><span class="s0">None</span><span class="s2">, </span><span class="s5">'origin'</span><span class="s2">:</span><span class="s1">Vec3</span><span class="s2">(</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">),</span>
        <span class="s5">'shader'</span><span class="s2">:</span><span class="s0">None</span><span class="s2">, </span><span class="s5">'texture'</span><span class="s2">:</span><span class="s0">None</span><span class="s2">, </span><span class="s5">'color'</span><span class="s2">:</span><span class="s1">color</span><span class="s2">.</span><span class="s1">white</span><span class="s2">, </span><span class="s5">'collider'</span><span class="s2">:</span><span class="s0">None</span><span class="s2">}</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">add_to_scene_entities</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_children </span><span class="s2">= []</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">camel_to_snake</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ignore </span><span class="s2">= </span><span class="s0">False     </span><span class="s3"># if True, will not try to run code.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ignore_paused </span><span class="s2">= </span><span class="s0">False      </span><span class="s3"># if True, will still run when application is paused. useful when making a pause menu for example.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ignore_input </span><span class="s2">= </span><span class="s0">False</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">parent </span><span class="s2">= </span><span class="s1">scene     </span><span class="s3"># default parent is scene, which means it's in 3d space. to use UI space, set the parent to camera.ui instead.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">add_to_scene_entities </span><span class="s2">= </span><span class="s1">add_to_scene_entities </span><span class="s3"># set to False to be ignored by the engine, but still get rendered.</span>
        <span class="s0">if </span><span class="s1">add_to_scene_entities</span><span class="s2">:</span>
            <span class="s1">scene</span><span class="s2">.</span><span class="s1">entities</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_shader_inputs </span><span class="s2">= {}</span>
        <span class="s0">if </span><span class="s1">Entity</span><span class="s2">.</span><span class="s1">default_shader</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">shader </span><span class="s2">= </span><span class="s1">Entity</span><span class="s2">.</span><span class="s1">default_shader</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">setPythonTag</span><span class="s2">(</span><span class="s5">'Entity'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">)   </span><span class="s3"># for the raycast to get the Entity and not just the NodePath</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">scripts </span><span class="s2">= []   </span><span class="s3"># add with add_script(class_instance). will assign an 'entity' variable to the script.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">animations </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">hovered </span><span class="s2">= </span><span class="s0">False    </span><span class="s3"># will return True if mouse hovers entity.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">line_definition </span><span class="s2">= </span><span class="s0">None </span><span class="s3"># returns a Traceback(filename, lineno, function, code_context, index).</span>

        <span class="s0">if </span><span class="s1">application</span><span class="s2">.</span><span class="s1">trace_entity_definition </span><span class="s0">and </span><span class="s1">add_to_scene_entities </span><span class="s0">or </span><span class="s2">(</span><span class="s0">not </span><span class="s1">_Ursina_instance </span><span class="s0">and </span><span class="s1">_warn_if_ursina_not_instantiated </span><span class="s0">and </span><span class="s1">add_to_scene_entities</span><span class="s2">):</span>
            <span class="s0">from </span><span class="s1">inspect </span><span class="s0">import </span><span class="s1">getframeinfo</span><span class="s2">, </span><span class="s1">stack</span>
            <span class="s1">_stack </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">()</span>
            <span class="s1">caller </span><span class="s2">= </span><span class="s1">getframeinfo</span><span class="s2">(</span><span class="s1">_stack</span><span class="s2">[</span><span class="s4">1</span><span class="s2">][</span><span class="s4">0</span><span class="s2">])</span>
            <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">_stack</span><span class="s2">) &gt; </span><span class="s4">2 </span><span class="s0">and </span><span class="s1">_stack</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">code_context </span><span class="s0">and </span><span class="s5">'super().__init__()' </span><span class="s0">in </span><span class="s1">_stack</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">code_context</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]:</span>
                <span class="s1">caller </span><span class="s2">= </span><span class="s1">getframeinfo</span><span class="s2">(</span><span class="s1">_stack</span><span class="s2">[</span><span class="s4">2</span><span class="s2">][</span><span class="s4">0</span><span class="s2">])</span>

            <span class="s1">self</span><span class="s2">.</span><span class="s1">line_definition </span><span class="s2">= </span><span class="s1">caller</span>
            <span class="s0">if </span><span class="s1">caller</span><span class="s2">.</span><span class="s1">code_context</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">code_context </span><span class="s2">= </span><span class="s1">caller</span><span class="s2">.</span><span class="s1">code_context</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">code_context</span><span class="s2">.</span><span class="s1">count</span><span class="s2">(</span><span class="s5">'('</span><span class="s2">) == </span><span class="s1">self</span><span class="s2">.</span><span class="s1">code_context</span><span class="s2">.</span><span class="s1">count</span><span class="s2">(</span><span class="s5">')'</span><span class="s2">) </span><span class="s0">and</span>
                <span class="s5">' = ' </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">code_context </span><span class="s0">and </span><span class="s5">'name=' </span><span class="s0">not in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">code_context</span>
                <span class="s0">and </span><span class="s5">'Ursina()' </span><span class="s0">not in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">code_context</span><span class="s2">):</span>

                    <span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">code_context</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s5">' = '</span><span class="s2">)[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">strip</span><span class="s2">().</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">'self.'</span><span class="s2">, </span><span class="s5">''</span><span class="s2">)</span>
                    <span class="s3"># print('set name to:', self.code_context.split(' = ')[0].strip().replace('self.', ''))</span>

                <span class="s0">if </span><span class="s1">application</span><span class="s2">.</span><span class="s1">print_entity_definition</span><span class="s2">:</span>
                    <span class="s1">print</span><span class="s2">(</span><span class="s5">f'</span><span class="s0">{</span><span class="s1">Path</span><span class="s2">(</span><span class="s1">caller</span><span class="s2">.</span><span class="s1">filename</span><span class="s2">).</span><span class="s1">name</span><span class="s0">} </span><span class="s5">-&gt;  </span><span class="s0">{</span><span class="s1">caller</span><span class="s2">.</span><span class="s1">lineno</span><span class="s0">} </span><span class="s5">-&gt; </span><span class="s0">{</span><span class="s1">caller</span><span class="s2">.</span><span class="s1">code_context</span><span class="s0">}</span><span class="s5">'</span><span class="s2">)</span>


        <span class="s0">if not </span><span class="s1">_Ursina_instance </span><span class="s0">and </span><span class="s1">_warn_if_ursina_not_instantiated </span><span class="s0">and </span><span class="s1">add_to_scene_entities</span><span class="s2">:</span>
            <span class="s1">print_warning</span><span class="s2">(</span><span class="s5">'Tried to instantiate Entity before Ursina. Please create an instance of Ursina first (app = Ursina())'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">line_definition</span><span class="s2">)</span>


        <span class="s3"># make sure things get set in the correct order. both colliders and texture need the model to be set first.</span>
        <span class="s0">for </span><span class="s1">key </span><span class="s0">in </span><span class="s2">(</span><span class="s5">'model'</span><span class="s2">, </span><span class="s5">'origin'</span><span class="s2">, </span><span class="s5">'origin_x'</span><span class="s2">, </span><span class="s5">'origin_y'</span><span class="s2">, </span><span class="s5">'origin_z'</span><span class="s2">, </span><span class="s5">'collider'</span><span class="s2">, </span><span class="s5">'shader'</span><span class="s2">, </span><span class="s5">'texture'</span><span class="s2">, </span><span class="s5">'texture_scale'</span><span class="s2">, </span><span class="s5">'texture_offset'</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">key </span><span class="s0">in </span><span class="s1">kwargs</span><span class="s2">:</span>
                <span class="s1">setattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">[</span><span class="s1">key</span><span class="s2">])</span>
                <span class="s0">del </span><span class="s1">kwargs</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>

        <span class="s0">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">kwargs</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
            <span class="s1">setattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">enabled </span><span class="s0">and </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'on_enable'</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">on_enable</span><span class="s2">, </span><span class="s1">Sequence</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">on_enable</span><span class="s2">.</span><span class="s1">start</span><span class="s2">()</span>
            <span class="s0">elif </span><span class="s1">callable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">on_enable</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">on_enable</span><span class="s2">()</span>

        <span class="s0">elif not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">enabled </span><span class="s0">and </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'on_disable'</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">on_disable</span><span class="s2">, </span><span class="s1">Sequence</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">on_disable</span><span class="s2">.</span><span class="s1">start</span><span class="s2">()</span>
            <span class="s0">elif </span><span class="s1">callable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">on_disable</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">on_disable</span><span class="s2">()</span>

        <span class="s3"># look for @every decorator and start a looping Sequence for decorated method</span>
        <span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">ursinastuff </span><span class="s0">import </span><span class="s1">every</span><span class="s2">, </span><span class="s1">get_class_name</span>
        <span class="s0">for </span><span class="s1">method </span><span class="s0">in </span><span class="s1">every</span><span class="s2">.</span><span class="s1">decorated_methods</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">get_class_name</span><span class="s2">(</span><span class="s1">method</span><span class="s2">.</span><span class="s1">_func</span><span class="s2">) == </span><span class="s1">self</span><span class="s2">.</span><span class="s1">types</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">animations</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">Sequence</span><span class="s2">(</span><span class="s1">Func</span><span class="s2">(</span><span class="s1">method</span><span class="s2">, </span><span class="s1">self</span><span class="s2">), </span><span class="s1">Wait</span><span class="s2">(</span><span class="s1">method</span><span class="s2">.</span><span class="s1">_every</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">), </span><span class="s1">loop</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">started</span><span class="s2">=</span><span class="s0">True</span><span class="s2">))</span>


    <span class="s0">def </span><span class="s1">_list_to_vec</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, (</span><span class="s1">int</span><span class="s2">, </span><span class="s1">float</span><span class="s2">, </span><span class="s1">complex</span><span class="s2">)):</span>
            <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) % </span><span class="s4">2 </span><span class="s2">== </span><span class="s4">0</span><span class="s2">:</span>
            <span class="s1">new_value </span><span class="s2">= </span><span class="s1">Vec2</span><span class="s2">()</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">value</span><span class="s2">), </span><span class="s4">2</span><span class="s2">):</span>
                <span class="s1">new_value</span><span class="s2">.</span><span class="s1">add_x</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])</span>
                <span class="s1">new_value</span><span class="s2">.</span><span class="s1">add_y</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s1">i</span><span class="s2">+</span><span class="s4">1</span><span class="s2">])</span>

        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) % </span><span class="s4">3 </span><span class="s2">== </span><span class="s4">0</span><span class="s2">:</span>
            <span class="s1">new_value </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">()</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">value</span><span class="s2">), </span><span class="s4">3</span><span class="s2">):</span>
                <span class="s1">new_value</span><span class="s2">.</span><span class="s1">add_x</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])</span>
                <span class="s1">new_value</span><span class="s2">.</span><span class="s1">add_y</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s1">i</span><span class="s2">+</span><span class="s4">1</span><span class="s2">])</span>
                <span class="s1">new_value</span><span class="s2">.</span><span class="s1">add_z</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s1">i</span><span class="s2">+</span><span class="s4">2</span><span class="s2">])</span>

        <span class="s0">return </span><span class="s1">new_value</span>


    <span class="s0">def </span><span class="s1">enable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s3"># same as .enabled = True</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">enabled </span><span class="s2">= </span><span class="s0">True</span>

    <span class="s0">def </span><span class="s1">disable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s3"># same as .enabled = False</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">enabled </span><span class="s2">= </span><span class="s0">False</span>


    <span class="s0">def </span><span class="s1">enabled_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_enabled'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">enabled_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):    </span><span class="s3"># disabled entities will not be visible nor run code.</span>
        <span class="s0">if </span><span class="s1">value </span><span class="s0">and </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'on_enable'</span><span class="s2">) </span><span class="s0">and not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">enabled</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">on_enable</span><span class="s2">, </span><span class="s1">Sequence</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">on_enable</span><span class="s2">.</span><span class="s1">start</span><span class="s2">()</span>
            <span class="s0">elif </span><span class="s1">callable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">on_enable</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">on_enable</span><span class="s2">()</span>

        <span class="s0">elif </span><span class="s1">value </span><span class="s0">is False and </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'on_disable'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">enabled</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">on_disable</span><span class="s2">, </span><span class="s1">Sequence</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">on_disable</span><span class="s2">.</span><span class="s1">start</span><span class="s2">()</span>
            <span class="s0">elif </span><span class="s1">callable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">on_disable</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">on_disable</span><span class="s2">()</span>


        <span class="s0">if </span><span class="s1">value </span><span class="s0">is True</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'is_singleton'</span><span class="s2">) </span><span class="s0">and not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">is_singleton</span><span class="s2">():</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">unstash</span><span class="s2">()</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'is_singleton'</span><span class="s2">) </span><span class="s0">and not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">is_singleton</span><span class="s2">():</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">stash</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_enabled </span><span class="s2">= </span><span class="s1">value</span>


    <span class="s0">def </span><span class="s1">model_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_model'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">model_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):  </span><span class="s3"># set model with model='model_name' (without file type extension)</span>
        <span class="s0">if </span><span class="s1">value </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">removeNode</span><span class="s2">()</span>
                <span class="s3"># print('removed model')</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_model </span><span class="s2">= </span><span class="s1">value</span>
            <span class="s0">return</span>

        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">NodePath</span><span class="s2">): </span><span class="s3"># pass procedural model</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model </span><span class="s0">and </span><span class="s1">value </span><span class="s2">!= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">detachNode</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_model </span><span class="s2">= </span><span class="s1">value</span>

        <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">str</span><span class="s2">): </span><span class="s3"># pass model asset name</span>
            <span class="s1">m </span><span class="s2">= </span><span class="s1">load_model</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">application</span><span class="s2">.</span><span class="s1">asset_folder</span><span class="s2">)</span>
            <span class="s0">if not </span><span class="s1">m</span><span class="s2">:</span>
                <span class="s1">m </span><span class="s2">= </span><span class="s1">load_model</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">application</span><span class="s2">.</span><span class="s1">internal_models_compressed_folder</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">m</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model </span><span class="s0">is not None</span><span class="s2">:</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">removeNode</span><span class="s2">()</span>

                <span class="s1">m</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">value</span>
                <span class="s1">m</span><span class="s2">.</span><span class="s1">setPos</span><span class="s2">(</span><span class="s1">Vec3</span><span class="s2">(</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">))</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_model </span><span class="s2">= </span><span class="s1">m</span>
                <span class="s3"># if not value in mesh_importer.imported_meshes:</span>
                <span class="s3">#     print_info('loaded model successfully:', value)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">application</span><span class="s2">.</span><span class="s1">raise_exception_on_missing_model</span><span class="s2">:</span>
                    <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s5">f&quot;missing model: '</span><span class="s0">{</span><span class="s1">value</span><span class="s0">}</span><span class="s5">'&quot;</span><span class="s2">)</span>

                <span class="s1">print_warning</span><span class="s2">(</span><span class="s5">f&quot;missing model: '</span><span class="s0">{</span><span class="s1">value</span><span class="s0">}</span><span class="s5">'&quot;</span><span class="s2">)</span>
                <span class="s0">return</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">setTransparency</span><span class="s2">(</span><span class="s1">TransparencyAttrib</span><span class="s2">.</span><span class="s1">M_dual</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">color </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">color </span><span class="s3"># reapply color after changing model</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">texture </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">texture </span><span class="s3"># reapply texture after changing model</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_vert_cache </span><span class="s2">= </span><span class="s0">None</span>
            <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">Mesh</span><span class="s2">):</span>
                <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s5">'on_assign'</span><span class="s2">):</span>
                    <span class="s1">value</span><span class="s2">.</span><span class="s1">on_assign</span><span class="s2">(</span><span class="s1">assigned_to</span><span class="s2">=</span><span class="s1">self</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">color_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_color'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">.</span><span class="s1">white</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">color_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">color</span><span class="s2">.</span><span class="s1">hex</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">Vec4</span><span class="s2">):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">Vec4</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">3</span><span class="s2">])</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_color </span><span class="s2">= </span><span class="s1">value</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">:</span>
            <span class="s3"># print('SET COLOR TO', value, self.name)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">setColorScaleOff</span><span class="s2">() </span><span class="s3"># prevent inheriting color from parent</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">setColorScale</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">eternal_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_eternal'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">eternal_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):    </span><span class="s3"># eternal entities does not get destroyed on scene.clear()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_eternal </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">:</span>
            <span class="s1">c</span><span class="s2">.</span><span class="s1">eternal </span><span class="s2">= </span><span class="s1">value</span>

    <span class="s0">def </span><span class="s1">double_sided_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_double_sided'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">double_sided_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_double_sided </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setTwoSided</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">render_queue_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_render_queue'</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">render_queue_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):   </span><span class="s3"># for custom sorting in case of conflict. To sort things in 2d, set .z instead of using this.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_render_queue </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">setBin</span><span class="s2">(</span><span class="s5">'fixed'</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">parent_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_parent'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">parent_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_parent'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_parent </span><span class="s0">and </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_parent</span><span class="s2">, </span><span class="s5">'_children'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">self </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_parent</span><span class="s2">.</span><span class="s1">_children</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_parent</span><span class="s2">.</span><span class="s1">_children</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s5">'_children'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">self </span><span class="s0">not in </span><span class="s1">value</span><span class="s2">.</span><span class="s1">_children</span><span class="s2">:</span>
            <span class="s1">value</span><span class="s2">.</span><span class="s1">_children</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">reparent_to</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">enabled </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">enabled   </span><span class="s3"># parenting will undo the .stash() done when setting .enabled to False, so reapply it here</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_parent </span><span class="s2">= </span><span class="s1">value</span>


    <span class="s0">def </span><span class="s1">world_parent_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_parent'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">world_parent_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):  </span><span class="s3"># change the parent, but keep position, rotation and scale</span>
        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_parent'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_parent </span><span class="s0">and </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_parent</span><span class="s2">, </span><span class="s5">'_children'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">self </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_parent</span><span class="s2">.</span><span class="s1">_children</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_parent</span><span class="s2">.</span><span class="s1">_children</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s5">'_children'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">self </span><span class="s0">not in </span><span class="s1">value</span><span class="s2">.</span><span class="s1">_children</span><span class="s2">:</span>
            <span class="s1">value</span><span class="s2">.</span><span class="s1">_children</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">wrtReparentTo</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">enabled </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_enabled   </span><span class="s3"># parenting will undo the .stash() done when setting .enabled to False, so reapply it here</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_parent </span><span class="s2">= </span><span class="s1">value</span>


    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">types</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s3"># get all class names including those this inhertits from.</span>
        <span class="s0">from </span><span class="s1">inspect </span><span class="s0">import </span><span class="s1">getmro</span>
        <span class="s0">return </span><span class="s2">[</span><span class="s1">c</span><span class="s2">.</span><span class="s1">__name__ </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">getmro</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">)]</span>


    <span class="s0">def </span><span class="s1">visible_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_visible'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">visible_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_visible </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s0">if </span><span class="s1">value</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">show</span><span class="s2">()</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">visible_self_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s3"># set visibility of self, without affecting children.</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_visible_self'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">visible_self_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_visible_self </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">:</span>
            <span class="s0">return</span>
        <span class="s0">if </span><span class="s1">value</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">show</span><span class="s2">()</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">()</span>


    <span class="s0">def </span><span class="s1">collider_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_collider'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">collider_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):   </span><span class="s3"># set to 'box'/'sphere'/'capsule'/'mesh' for auto fitted collider.</span>
        <span class="s0">if </span><span class="s1">value </span><span class="s0">is None and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collider</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider </span><span class="s2">= </span><span class="s0">None</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">collision </span><span class="s2">= </span><span class="s0">False</span>
            <span class="s0">return</span>

        <span class="s3"># destroy existing collider</span>
        <span class="s0">if </span><span class="s1">value </span><span class="s0">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collider</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>

        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">Collider</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider </span><span class="s2">= </span><span class="s1">value</span>

        <span class="s0">elif </span><span class="s1">value </span><span class="s2">== </span><span class="s5">'box'</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">:</span>
                <span class="s1">_bounds </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model_bounds</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider </span><span class="s2">= </span><span class="s1">BoxCollider</span><span class="s2">(</span><span class="s1">entity</span><span class="s2">=</span><span class="s1">self</span><span class="s2">, </span><span class="s1">center</span><span class="s2">=</span><span class="s1">_bounds</span><span class="s2">.</span><span class="s1">center</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">_bounds</span><span class="s2">.</span><span class="s1">size</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider </span><span class="s2">= </span><span class="s1">BoxCollider</span><span class="s2">(</span><span class="s1">entity</span><span class="s2">=</span><span class="s1">self</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">value</span>

        <span class="s0">elif </span><span class="s1">value </span><span class="s2">== </span><span class="s5">'sphere'</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider </span><span class="s2">= </span><span class="s1">SphereCollider</span><span class="s2">(</span><span class="s1">entity</span><span class="s2">=</span><span class="s1">self</span><span class="s2">, </span><span class="s1">center</span><span class="s2">=-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">origin</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">value</span>

        <span class="s0">elif </span><span class="s1">value </span><span class="s2">== </span><span class="s5">'capsule'</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider </span><span class="s2">= </span><span class="s1">CapsuleCollider</span><span class="s2">(</span><span class="s1">entity</span><span class="s2">=</span><span class="s1">self</span><span class="s2">, </span><span class="s1">center</span><span class="s2">=-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">origin</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">value</span>

        <span class="s0">elif </span><span class="s1">value </span><span class="s2">== </span><span class="s5">'mesh' </span><span class="s0">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider </span><span class="s2">= </span><span class="s1">MeshCollider</span><span class="s2">(</span><span class="s1">entity</span><span class="s2">=</span><span class="s1">self</span><span class="s2">, </span><span class="s1">mesh</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">, </span><span class="s1">center</span><span class="s2">=-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">origin</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">value</span>

        <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">Mesh</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider </span><span class="s2">= </span><span class="s1">MeshCollider</span><span class="s2">(</span><span class="s1">entity</span><span class="s2">=</span><span class="s1">self</span><span class="s2">, </span><span class="s1">mesh</span><span class="s2">=</span><span class="s1">value</span><span class="s2">, </span><span class="s1">center</span><span class="s2">=-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">origin</span><span class="s2">)</span>

        <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
            <span class="s1">m </span><span class="s2">= </span><span class="s1">load_model</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
            <span class="s0">if not </span><span class="s1">m</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider </span><span class="s2">= </span><span class="s0">None</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_collision </span><span class="s2">= </span><span class="s0">False</span>
                <span class="s0">return</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider </span><span class="s2">= </span><span class="s1">MeshCollider</span><span class="s2">(</span><span class="s1">entity</span><span class="s2">=</span><span class="s1">self</span><span class="s2">, </span><span class="s1">mesh</span><span class="s2">=</span><span class="s1">m</span><span class="s2">, </span><span class="s1">center</span><span class="s2">=-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">origin</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_collider</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">value</span>


        <span class="s1">self</span><span class="s2">.</span><span class="s1">collision </span><span class="s2">= </span><span class="s1">bool</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_collider</span><span class="s2">)</span>
        <span class="s0">return</span>

    <span class="s0">def </span><span class="s1">collision_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_collision'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">collision_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):  </span><span class="s3"># toggle collision without changing collider.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_collision </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s0">if not </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'collider'</span><span class="s2">) </span><span class="s0">or not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collider</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">self </span><span class="s0">in </span><span class="s1">scene</span><span class="s2">.</span><span class="s1">collidables</span><span class="s2">:</span>
                <span class="s1">scene</span><span class="s2">.</span><span class="s1">collidables</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
            <span class="s0">return</span>

        <span class="s0">if </span><span class="s1">value</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">collider</span><span class="s2">.</span><span class="s1">node_path</span><span class="s2">.</span><span class="s1">unstash</span><span class="s2">()</span>
            <span class="s1">scene</span><span class="s2">.</span><span class="s1">collidables</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">collider</span><span class="s2">.</span><span class="s1">node_path</span><span class="s2">.</span><span class="s1">stash</span><span class="s2">()</span>
            <span class="s0">if </span><span class="s1">self </span><span class="s0">in </span><span class="s1">scene</span><span class="s2">.</span><span class="s1">collidables</span><span class="s2">:</span>
                <span class="s1">scene</span><span class="s2">.</span><span class="s1">collidables</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">origin_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_origin'</span><span class="s2">, </span><span class="s1">Vec3</span><span class="s2">.</span><span class="s1">zero</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">origin_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, (</span><span class="s1">Vec2</span><span class="s2">, </span><span class="s1">Vec3</span><span class="s2">)):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_to_vec</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">Vec2</span><span class="s2">):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">origin_z</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_origin </span><span class="s2">= </span><span class="s1">value</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">setPos</span><span class="s2">(-</span><span class="s1">value</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], -</span><span class="s1">value</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], -</span><span class="s1">value</span><span class="s2">[</span><span class="s4">2</span><span class="s2">])</span>


    <span class="s0">def </span><span class="s1">origin_x_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">origin</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]</span>
    <span class="s0">def </span><span class="s1">origin_x_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">origin </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">origin_y</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">origin_z</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">origin_y_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">origin</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]</span>
    <span class="s0">def </span><span class="s1">origin_y_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">origin </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">origin_x</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">origin_z</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">origin_z_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">origin</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]</span>
    <span class="s0">def </span><span class="s1">origin_z_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">origin </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">origin_x</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">origin_y</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">world_position_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">world_position_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, (</span><span class="s1">Vec2</span><span class="s2">, </span><span class="s1">Vec3</span><span class="s2">)):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_to_vec</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">Vec2</span><span class="s2">):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">z</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">setPos</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">, </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]))</span>

    <span class="s0">def </span><span class="s1">world_x_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getX</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">world_y_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getY</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">world_z_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getZ</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">world_x_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setX</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">world_y_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setY</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">world_z_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setZ</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">position_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">getPos</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">position_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):   </span><span class="s3"># right, up, forward. can also set self.x, self.y, self.z</span>
        <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, (</span><span class="s1">Vec2</span><span class="s2">, </span><span class="s1">Vec3</span><span class="s2">)):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_to_vec</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">Vec2</span><span class="s2">):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">z</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">setPos</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">2</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">x_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getX</span><span class="s2">()</span>
    <span class="s0">def </span><span class="s1">x_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setX</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">y_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getY</span><span class="s2">()</span>
    <span class="s0">def </span><span class="s1">y_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setY</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">z_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getZ</span><span class="s2">()</span>
    <span class="s0">def </span><span class="s1">z_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setZ</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">X</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):    </span><span class="s3"># shortcut for int(entity.x)</span>
        <span class="s0">return </span><span class="s1">int</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">Y</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):    </span><span class="s3"># shortcut for int(entity.y)</span>
        <span class="s0">return </span><span class="s1">int</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">y</span><span class="s2">)</span>
    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">Z</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):    </span><span class="s3"># shortcut for int(entity.z)</span>
        <span class="s0">return </span><span class="s1">int</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">z</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">world_rotation_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rotation </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getHpr</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">rotation</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">rotation</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">rotation</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) * </span><span class="s1">Entity</span><span class="s2">.</span><span class="s1">rotation_directions</span>

    <span class="s0">def </span><span class="s1">world_rotation_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setHpr</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">, </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) * </span><span class="s1">Entity</span><span class="s2">.</span><span class="s1">rotation_directions</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">world_rotation_x_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_rotation</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">world_rotation_x_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">world_rotation </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_rotation</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_rotation</span><span class="s2">[</span><span class="s4">2</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">world_rotation_y_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_rotation</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">world_rotation_y_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">world_rotation </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_rotation</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_rotation</span><span class="s2">[</span><span class="s4">2</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">world_rotation_z_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_rotation</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">world_rotation_z_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">world_rotation </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_rotation</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_rotation</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">rotation_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rotation </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getHpr</span><span class="s2">()</span>
        <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">rotation</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">rotation</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">rotation</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) * </span><span class="s1">Entity</span><span class="s2">.</span><span class="s1">rotation_directions</span>

    <span class="s0">def </span><span class="s1">rotation_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):   </span><span class="s3"># can also set self.rotation_x, self.rotation_y, self.rotation_z</span>
        <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, (</span><span class="s1">Vec2</span><span class="s2">, </span><span class="s1">Vec3</span><span class="s2">)):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_to_vec</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">Vec2</span><span class="s2">):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rotation_z</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">setHpr</span><span class="s2">(</span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) * </span><span class="s1">Entity</span><span class="s2">.</span><span class="s1">rotation_directions</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">rotation_x_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rotation</span><span class="s2">.</span><span class="s1">x</span>
    <span class="s0">def </span><span class="s1">rotation_x_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rotation </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rotation</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rotation</span><span class="s2">[</span><span class="s4">2</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">rotation_y_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rotation</span><span class="s2">.</span><span class="s1">y</span>
    <span class="s0">def </span><span class="s1">rotation_y_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rotation </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">rotation</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rotation</span><span class="s2">[</span><span class="s4">2</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">rotation_z_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rotation</span><span class="s2">.</span><span class="s1">z</span>
    <span class="s0">def </span><span class="s1">rotation_z_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rotation </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">rotation</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rotation</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">quaternion_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">get_quat</span><span class="s2">()</span>
    <span class="s0">def </span><span class="s1">quaternion_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">set_quat</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">world_scale_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">getScale</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">))</span>
    <span class="s0">def </span><span class="s1">world_scale_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, (</span><span class="s1">int</span><span class="s2">, </span><span class="s1">float</span><span class="s2">, </span><span class="s1">complex</span><span class="s2">)):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">setScale</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">world_scale_x_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getScale</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">)[</span><span class="s4">0</span><span class="s2">]</span>
    <span class="s0">def </span><span class="s1">world_scale_x_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setScale</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">, </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_scale_y</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_scale_z</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">world_scale_y_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getScale</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">)[</span><span class="s4">1</span><span class="s2">]</span>
    <span class="s0">def </span><span class="s1">world_scale_y_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setScale</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">, </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_scale_x</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_scale_z</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">world_scale_z_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getScale</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">)[</span><span class="s4">2</span><span class="s2">]</span>
    <span class="s0">def </span><span class="s1">world_scale_z_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setScale</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">, </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_scale_x</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_scale_y</span><span class="s2">, </span><span class="s1">value</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">scale_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">scale </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getScale</span><span class="s2">()</span>
        <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">scale</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">scale</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">scale</span><span class="s2">[</span><span class="s4">2</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">scale_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):  </span><span class="s3"># can also set self.scale_x, self.scale_y, self.scale_z</span>
        <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, (</span><span class="s1">Vec2</span><span class="s2">, </span><span class="s1">Vec3</span><span class="s2">)):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_to_vec</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">Vec2</span><span class="s2">):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale_z</span><span class="s2">)</span>

        <span class="s1">value </span><span class="s2">= [</span><span class="s1">e </span><span class="s0">if </span><span class="s1">e</span><span class="s2">!=</span><span class="s4">0 </span><span class="s0">else </span><span class="s4">.001 </span><span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">value</span><span class="s2">]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setScale</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">2</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">scale_x_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]</span>
    <span class="s0">def </span><span class="s1">scale_x_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setScale</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale_y</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale_z</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">scale_y_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]</span>
    <span class="s0">def </span><span class="s1">scale_y_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setScale</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale_x</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale_z</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">scale_z_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]</span>
    <span class="s0">def </span><span class="s1">scale_z_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setScale</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale_x</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale_y</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">transform_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s3"># get/set position, rotation and scale</span>
        <span class="s0">return </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rotation</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">transform_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rotation</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale </span><span class="s2">= </span><span class="s1">value</span>

    <span class="s0">def </span><span class="s1">world_transform_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s3"># get/set world_position, world_rotation and world_scale</span>
        <span class="s0">return </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_position</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_rotation</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_scale</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">world_transform_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">world_position</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_rotation</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_scale </span><span class="s2">= </span><span class="s1">value</span>


    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">forward</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s3"># get forward direction.</span>
        <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">scene</span><span class="s2">.</span><span class="s1">getRelativeVector</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)))</span>
    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">back</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s3"># get backwards direction.</span>
        <span class="s0">return </span><span class="s2">-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">forward</span>
    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">right</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s3"># get right direction.</span>
        <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">scene</span><span class="s2">.</span><span class="s1">getRelativeVector</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)))</span>
    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">left</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s3"># get left direction.</span>
        <span class="s0">return </span><span class="s2">-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">right</span>
    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">up</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s3"># get up direction.</span>
        <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">scene</span><span class="s2">.</span><span class="s1">getRelativeVector</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)))</span>
    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">down</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s3"># get down direction.</span>
        <span class="s0">return </span><span class="s2">-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">up</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">screen_position</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s3"># get screen position(ui space) from world space.</span>
        <span class="s0">from </span><span class="s1">ursina </span><span class="s0">import </span><span class="s1">camera</span>
        <span class="s1">p3d </span><span class="s2">= </span><span class="s1">camera</span><span class="s2">.</span><span class="s1">getRelativePoint</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">Vec3</span><span class="s2">.</span><span class="s1">zero</span><span class="s2">)</span>
        <span class="s1">full </span><span class="s2">= </span><span class="s1">camera</span><span class="s2">.</span><span class="s1">lens</span><span class="s2">.</span><span class="s1">getProjectionMat</span><span class="s2">().</span><span class="s1">xform</span><span class="s2">(</span><span class="s1">Vec4</span><span class="s2">(*</span><span class="s1">p3d</span><span class="s2">, </span><span class="s4">1</span><span class="s2">))</span>
        <span class="s1">recip_full3 </span><span class="s2">= </span><span class="s4">1</span>
        <span class="s0">if </span><span class="s1">full</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] &gt; </span><span class="s4">0</span><span class="s2">:</span>
            <span class="s1">recip_full3 </span><span class="s2">= </span><span class="s4">1 </span><span class="s2">/ </span><span class="s1">full</span><span class="s2">[</span><span class="s4">3</span><span class="s2">]</span>
        <span class="s1">p2d </span><span class="s2">= </span><span class="s1">full </span><span class="s2">* </span><span class="s1">recip_full3</span>
        <span class="s0">return </span><span class="s1">Vec2</span><span class="s2">(</span><span class="s1">p2d</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]*</span><span class="s1">camera</span><span class="s2">.</span><span class="s1">aspect_ratio</span><span class="s2">/</span><span class="s4">2</span><span class="s2">, </span><span class="s1">p2d</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]/</span><span class="s4">2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">shader_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">if not </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_shader'</span><span class="s2">):</span>
            <span class="s0">return None</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_shader</span>

    <span class="s0">def </span><span class="s1">shader_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">value </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_shader </span><span class="s2">= </span><span class="s1">value</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">setShaderAuto</span><span class="s2">()</span>
            <span class="s0">return</span>

        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">Panda3dShader</span><span class="s2">): </span><span class="s3">#panda3d shader</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_shader </span><span class="s2">= </span><span class="s1">value</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">setShader</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
            <span class="s0">return</span>

        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
            <span class="s0">if not </span><span class="s1">value </span><span class="s0">in </span><span class="s1">shader</span><span class="s2">.</span><span class="s1">imported_shaders</span><span class="s2">:</span>
                <span class="s1">print_warning</span><span class="s2">(</span><span class="s5">'missing shader:'</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>
                <span class="s0">return</span>

            <span class="s1">value </span><span class="s2">= </span><span class="s1">shader</span><span class="s2">.</span><span class="s1">imported_shaders</span><span class="s2">[</span><span class="s1">value</span><span class="s2">]</span>

        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">Shader</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_shader </span><span class="s2">= </span><span class="s1">value</span>
            <span class="s0">if not </span><span class="s1">value</span><span class="s2">.</span><span class="s1">compiled</span><span class="s2">:</span>
                <span class="s1">value</span><span class="s2">.</span><span class="s1">compile</span><span class="s2">()</span>

            <span class="s1">self</span><span class="s2">.</span><span class="s1">setShader</span><span class="s2">(</span><span class="s1">value</span><span class="s2">.</span><span class="s1">_shader</span><span class="s2">)</span>
            <span class="s1">value</span><span class="s2">.</span><span class="s1">entity </span><span class="s2">= </span><span class="s1">self</span>

            <span class="s0">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">value</span><span class="s2">.</span><span class="s1">default_input</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
                <span class="s0">if </span><span class="s1">callable</span><span class="s2">(</span><span class="s1">value</span><span class="s2">):</span>
                    <span class="s1">value </span><span class="s2">= </span><span class="s1">value</span><span class="s2">()</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">set_shader_input</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

            <span class="s0">return</span>

        <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s5">f'</span><span class="s0">{</span><span class="s1">value</span><span class="s0">} </span><span class="s5">is not a Shader'</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">get_shader_input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">name </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_shader_inputs</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_shader_inputs</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]</span>
        <span class="s0">return None</span>


    <span class="s0">def </span><span class="s1">set_shader_input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_shader_inputs</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">value</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">load_texture</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">Texture</span><span class="s2">):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">value</span><span class="s2">.</span><span class="s1">_texture    </span><span class="s3"># make sure to send the panda3d texture to the shader</span>

        <span class="s1">super</span><span class="s2">().</span><span class="s1">set_shader_input</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">texture_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_texture'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">texture_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):    </span><span class="s3"># set model with texture='texture_name'. requires a model to be set beforehand.</span>
        <span class="s0">if </span><span class="s1">value </span><span class="s0">is None and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">texture</span><span class="s2">:</span>
            <span class="s3"># print('remove texture')</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">clearTexture</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_texture </span><span class="s2">= </span><span class="s0">None</span>
            <span class="s0">return</span>

        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
            <span class="s1">texture_name </span><span class="s2">= </span><span class="s1">value</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">load_texture</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
            <span class="s3"># print('loaded texture:', texture)</span>
            <span class="s0">if </span><span class="s1">value </span><span class="s0">is None</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">application</span><span class="s2">.</span><span class="s1">raise_exception_on_missing_texture</span><span class="s2">:</span>
                    <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s5">f&quot;missing texture: '</span><span class="s0">{</span><span class="s1">texture_name</span><span class="s0">}</span><span class="s5">'&quot;</span><span class="s2">)</span>

                <span class="s1">print_warning</span><span class="s2">(</span><span class="s5">f&quot;missing texture: '</span><span class="s0">{</span><span class="s1">texture_name</span><span class="s0">}</span><span class="s5">'&quot;</span><span class="s2">)</span>
                <span class="s0">return</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">setTextureOff</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">value</span><span class="s2">.</span><span class="s1">__class__ </span><span class="s0">is </span><span class="s1">MovieTexture</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_texture </span><span class="s2">= </span><span class="s1">value</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">setTexture</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
            <span class="s0">return</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_texture </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model </span><span class="s0">and </span><span class="s1">value </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">setTexture</span><span class="s2">(</span><span class="s1">value</span><span class="s2">.</span><span class="s1">_texture</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">texture_scale_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_texture_scale'</span><span class="s2">, </span><span class="s1">Vec2</span><span class="s2">(</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">texture_scale_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):  </span><span class="s3"># how many times the texture should repeat, eg. texture_scale=(8,8).</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_texture_scale </span><span class="s2">= </span><span class="s1">Vec2</span><span class="s2">(*</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model </span><span class="s0">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">texture</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">setTexScale</span><span class="s2">(</span><span class="s1">TextureStage</span><span class="s2">.</span><span class="s1">getDefault</span><span class="s2">(), </span><span class="s1">value</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">set_shader_input</span><span class="s2">(</span><span class="s5">'texture_scale'</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">texture_offset_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_texture_offset'</span><span class="s2">, </span><span class="s1">Vec2</span><span class="s2">(</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">texture_offset_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">value </span><span class="s2">= </span><span class="s1">Vec2</span><span class="s2">(*</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model </span><span class="s0">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">texture</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">setTexOffset</span><span class="s2">(</span><span class="s1">TextureStage</span><span class="s2">.</span><span class="s1">getDefault</span><span class="s2">(), </span><span class="s1">value</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">texture </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">texture</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">set_shader_input</span><span class="s2">(</span><span class="s5">'texture_offset'</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_texture_offset </span><span class="s2">= </span><span class="s1">value</span>

    <span class="s0">def </span><span class="s1">tileset_size_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):         </span><span class="s3"># if the texture is a tileset, say how many tiles there are so it only use one tile of the texture, e.g. tileset_size=[8,4]</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tileset_size</span>
    <span class="s0">def </span><span class="s1">tileset_size_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_tileset_size </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">texture_scale </span><span class="s2">= </span><span class="s1">Vec2</span><span class="s2">(</span><span class="s4">1</span><span class="s2">/</span><span class="s1">value</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s4">1</span><span class="s2">/</span><span class="s1">value</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">tile_coordinate_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):      </span><span class="s3"># set the tile coordinate, starts in the lower left.</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tile_coordinate</span>
    <span class="s0">def </span><span class="s1">tile_coordinate_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_tile_coordinate </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">texture_offset </span><span class="s2">= </span><span class="s1">Vec2</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] / </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tileset_size</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] / </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tileset_size</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])</span>


    <span class="s0">def </span><span class="s1">alpha_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">color</span><span class="s2">[</span><span class="s4">3</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">alpha_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">value </span><span class="s2">&gt; </span><span class="s4">1</span><span class="s2">:</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">value </span><span class="s2">/ </span><span class="s4">255</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">color </span><span class="s2">= </span><span class="s1">color</span><span class="s2">.</span><span class="s1">color</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">color</span><span class="s2">.</span><span class="s1">h</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">color</span><span class="s2">.</span><span class="s1">s</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">color</span><span class="s2">.</span><span class="s1">v</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">always_on_top_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_always_on_top'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">always_on_top_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_always_on_top </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">set_bin</span><span class="s2">(</span><span class="s5">&quot;fixed&quot;</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">set_depth_write</span><span class="s2">(</span><span class="s0">not </span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">set_depth_test</span><span class="s2">(</span><span class="s0">not </span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">unlit_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_unlit'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">unlit_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_unlit </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setLightOff</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">billboard_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s3"># set to True to make this Entity always face the camera.</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_billboard'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">billboard_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_billboard </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s0">if </span><span class="s1">value</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">setBillboardPointEye</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">wireframe_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_wireframe'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">wireframe_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_wireframe </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setRenderModeWireframe</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">generate_sphere_map</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">512</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s5">f'sphere_map_</span><span class="s0">{</span><span class="s1">len</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">.</span><span class="s1">entities</span><span class="s2">)</span><span class="s0">}</span><span class="s5">'</span><span class="s2">):</span>
        <span class="s0">from </span><span class="s1">ursina </span><span class="s0">import </span><span class="s1">camera</span>
        <span class="s1">_name </span><span class="s2">= </span><span class="s5">'textures/' </span><span class="s2">+ </span><span class="s1">name </span><span class="s2">+ </span><span class="s5">'.jpg'</span>
        <span class="s1">org_pos </span><span class="s2">= </span><span class="s1">camera</span><span class="s2">.</span><span class="s1">position</span>
        <span class="s1">camera</span><span class="s2">.</span><span class="s1">position </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">position</span>
        <span class="s1">base</span><span class="s2">.</span><span class="s1">saveSphereMap</span><span class="s2">(</span><span class="s1">_name</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">size</span><span class="s2">)</span>
        <span class="s1">camera</span><span class="s2">.</span><span class="s1">position </span><span class="s2">= </span><span class="s1">org_pos</span>

        <span class="s3"># print('saved sphere map:', name)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">setTexGen</span><span class="s2">(</span><span class="s1">TextureStage</span><span class="s2">.</span><span class="s1">getDefault</span><span class="s2">(), </span><span class="s1">TexGenAttrib</span><span class="s2">.</span><span class="s1">MEyeSphereMap</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">reflection_map </span><span class="s2">= </span><span class="s1">name</span>


    <span class="s0">def </span><span class="s1">generate_cube_map</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">512</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s5">f'cube_map_</span><span class="s0">{</span><span class="s1">len</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">.</span><span class="s1">entities</span><span class="s2">)</span><span class="s0">}</span><span class="s5">'</span><span class="s2">):</span>
        <span class="s0">from </span><span class="s1">ursina </span><span class="s0">import </span><span class="s1">camera</span>
        <span class="s1">_name </span><span class="s2">= </span><span class="s5">'textures/' </span><span class="s2">+ </span><span class="s1">name</span>
        <span class="s1">org_pos </span><span class="s2">= </span><span class="s1">camera</span><span class="s2">.</span><span class="s1">position</span>
        <span class="s1">camera</span><span class="s2">.</span><span class="s1">position </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">position</span>
        <span class="s1">base</span><span class="s2">.</span><span class="s1">saveCubeMap</span><span class="s2">(</span><span class="s1">_name</span><span class="s2">+</span><span class="s5">'.jpg'</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">size</span><span class="s2">)</span>
        <span class="s1">camera</span><span class="s2">.</span><span class="s1">position </span><span class="s2">= </span><span class="s1">org_pos</span>

        <span class="s3"># print('saved cube map:', name + '.jpg')</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">setTexGen</span><span class="s2">(</span><span class="s1">TextureStage</span><span class="s2">.</span><span class="s1">getDefault</span><span class="s2">(), </span><span class="s1">TexGenAttrib</span><span class="s2">.</span><span class="s1">MWorldCubeMap</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">reflection_map </span><span class="s2">= </span><span class="s1">_name </span><span class="s2">+ </span><span class="s5">'#.jpg'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">setTexture</span><span class="s2">(</span><span class="s1">loader</span><span class="s2">.</span><span class="s1">loadCubeMap</span><span class="s2">(</span><span class="s1">_name </span><span class="s2">+ </span><span class="s5">'#.jpg'</span><span class="s2">), </span><span class="s4">1</span><span class="s2">)</span>


    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">model_bounds</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">:</span>
            <span class="s1">start</span><span class="s2">, </span><span class="s1">end </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">getTightBounds</span><span class="s2">()</span>
            <span class="s1">start </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">start</span><span class="s2">)</span>
            <span class="s1">end </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">end</span><span class="s2">)</span>
            <span class="s1">center </span><span class="s2">= (</span><span class="s1">start </span><span class="s2">+ </span><span class="s1">end</span><span class="s2">) / </span><span class="s4">2</span>
            <span class="s1">size </span><span class="s2">= </span><span class="s1">end </span><span class="s2">- </span><span class="s1">start</span>
            <span class="s0">return </span><span class="s1">Bounds</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">=</span><span class="s1">end</span><span class="s2">, </span><span class="s1">center</span><span class="s2">=</span><span class="s1">center</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">size</span><span class="s2">)</span>

        <span class="s0">return </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">)</span>


    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">bounds</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">_bounds </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model_bounds</span>
        <span class="s0">return </span><span class="s1">Bounds</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s1">_bounds</span><span class="s2">.</span><span class="s1">start</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale</span><span class="s2">, </span><span class="s1">end</span><span class="s2">=</span><span class="s1">_bounds</span><span class="s2">.</span><span class="s1">end</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale</span><span class="s2">, </span><span class="s1">center</span><span class="s2">=</span><span class="s1">_bounds</span><span class="s2">.</span><span class="s1">center</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">_bounds</span><span class="s2">.</span><span class="s1">size</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">get_position</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">relative_to</span><span class="s2">=</span><span class="s1">scene</span><span class="s2">):  </span><span class="s3"># get position relative to on other Entity. In most cases, use .position instead.</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getPos</span><span class="s2">(</span><span class="s1">relative_to</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">set_position</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">relative_to</span><span class="s2">=</span><span class="s1">scene</span><span class="s2">): </span><span class="s3"># set position relative to on other Entity. In most cases, use .position instead.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setPos</span><span class="s2">(</span><span class="s1">relative_to</span><span class="s2">, </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]))</span>


    <span class="s0">def </span><span class="s1">rotate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">relative_to</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):  </span><span class="s3"># rotate around local axis.</span>
        <span class="s0">if not </span><span class="s1">relative_to</span><span class="s2">:</span>
            <span class="s1">relative_to </span><span class="s2">= </span><span class="s1">self</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">setHpr</span><span class="s2">(</span><span class="s1">relative_to</span><span class="s2">, </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">value</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]) * </span><span class="s1">Entity</span><span class="s2">.</span><span class="s1">rotation_directions</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">add_script</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">class_instance</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">class_instance</span><span class="s2">, </span><span class="s1">object</span><span class="s2">) </span><span class="s0">and not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">class_instance</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
            <span class="s1">class_instance</span><span class="s2">.</span><span class="s1">entity </span><span class="s2">= </span><span class="s1">self</span>
            <span class="s1">class_instance</span><span class="s2">.</span><span class="s1">enabled </span><span class="s2">= </span><span class="s0">True</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">scripts</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">class_instance</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">class_instance</span><span class="s2">, </span><span class="s5">'on_script_added'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">callable</span><span class="s2">(</span><span class="s1">class_instance</span><span class="s2">.</span><span class="s1">on_script_added</span><span class="s2">):</span>
                <span class="s1">class_instance</span><span class="s2">.</span><span class="s1">on_script_added</span><span class="s2">()</span>
            <span class="s3"># print('added script:', camel_to_snake(name.__class__.__name__))</span>
            <span class="s0">return </span><span class="s1">class_instance</span>


    <span class="s0">def </span><span class="s1">combine</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">analyze</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">auto_destroy</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">ignore</span><span class="s2">=[]):</span>
        <span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">scripts</span><span class="s2">.</span><span class="s1">combine </span><span class="s0">import </span><span class="s1">combine</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">model </span><span class="s2">= </span><span class="s1">combine</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">analyze</span><span class="s2">, </span><span class="s1">auto_destroy</span><span class="s2">, </span><span class="s1">ignore</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">model</span>


    <span class="s0">def </span><span class="s1">flipped_faces_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_flipped_faces'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">flipped_faces_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_flipped_faces </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s0">if </span><span class="s1">value</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">setAttrib</span><span class="s2">(</span><span class="s1">CullFaceAttrib</span><span class="s2">.</span><span class="s1">make</span><span class="s2">(</span><span class="s1">CullFaceAttrib</span><span class="s2">.</span><span class="s1">MCullClockwise</span><span class="s2">))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">setAttrib</span><span class="s2">(</span><span class="s1">CullFaceAttrib</span><span class="s2">.</span><span class="s1">make</span><span class="s2">(</span><span class="s1">CullFaceAttrib</span><span class="s2">.</span><span class="s1">MCullCounterClockwise</span><span class="s2">))</span>


    <span class="s0">def </span><span class="s1">look_at</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">target</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s5">'forward'</span><span class="s2">, </span><span class="s1">up</span><span class="s2">=</span><span class="s0">None</span><span class="s2">): </span><span class="s3"># up defaults to self.up</span>
        <span class="s0">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">Quat</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">target</span><span class="s2">, </span><span class="s1">Entity</span><span class="s2">):</span>
            <span class="s1">target </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">target</span><span class="s2">.</span><span class="s1">world_position</span><span class="s2">)</span>
        <span class="s0">elif not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">target</span><span class="s2">, </span><span class="s1">Vec3</span><span class="s2">):</span>
            <span class="s1">target </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">target</span><span class="s2">)</span>

        <span class="s1">up_axis </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">up</span>
        <span class="s0">if </span><span class="s1">up</span><span class="s2">:</span>
            <span class="s1">up_axis </span><span class="s2">= </span><span class="s1">up</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">lookAt</span><span class="s2">(</span><span class="s1">target</span><span class="s2">, </span><span class="s1">up_axis</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">axis </span><span class="s2">== </span><span class="s5">'forward'</span><span class="s2">:</span>
            <span class="s0">return</span>

        <span class="s1">rotation_offset </span><span class="s2">= {</span>
            <span class="s5">'back'    </span><span class="s2">: </span><span class="s1">Quat</span><span class="s2">(</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">0</span><span class="s2">),</span>
            <span class="s5">'down'    </span><span class="s2">: </span><span class="s1">Quat</span><span class="s2">(-</span><span class="s4">.707</span><span class="s2">,</span><span class="s4">.707</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">),</span>
            <span class="s5">'up'      </span><span class="s2">: </span><span class="s1">Quat</span><span class="s2">(-</span><span class="s4">.707</span><span class="s2">,-</span><span class="s4">.707</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">),</span>
            <span class="s5">'right'   </span><span class="s2">: </span><span class="s1">Quat</span><span class="s2">(-</span><span class="s4">.707</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">.707</span><span class="s2">,</span><span class="s4">0</span><span class="s2">),</span>
            <span class="s5">'left'    </span><span class="s2">: </span><span class="s1">Quat</span><span class="s2">(-</span><span class="s4">.707</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,-</span><span class="s4">.707</span><span class="s2">,</span><span class="s4">0</span><span class="s2">),</span>
            <span class="s2">}[</span><span class="s1">axis</span><span class="s2">]</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">setQuat</span><span class="s2">(</span><span class="s1">rotation_offset </span><span class="s2">* </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getQuat</span><span class="s2">())</span>


    <span class="s0">def </span><span class="s1">look_at_2d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">target</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s5">'z'</span><span class="s2">):</span>
        <span class="s0">from </span><span class="s1">math </span><span class="s0">import </span><span class="s1">degrees</span><span class="s2">, </span><span class="s1">atan2</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">target</span><span class="s2">, </span><span class="s1">Entity</span><span class="s2">):</span>
            <span class="s1">target </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">target</span><span class="s2">.</span><span class="s1">world_position</span><span class="s2">)</span>

        <span class="s1">pos </span><span class="s2">= </span><span class="s1">target </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_position</span>
        <span class="s0">if </span><span class="s1">axis </span><span class="s2">== </span><span class="s5">'z'</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">rotation_z </span><span class="s2">= </span><span class="s1">degrees</span><span class="s2">(</span><span class="s1">atan2</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">pos</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]))</span>
        <span class="s0">elif </span><span class="s1">axis </span><span class="s2">== </span><span class="s5">'y'</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">rotation_y </span><span class="s2">= </span><span class="s1">degrees</span><span class="s2">(</span><span class="s1">atan2</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">pos</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]))</span>
        <span class="s0">elif </span><span class="s1">axis </span><span class="s2">== </span><span class="s5">'x'</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">rotation_x </span><span class="s2">= </span><span class="s1">degrees</span><span class="s2">(</span><span class="s1">atan2</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">pos</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]))</span>

    <span class="s0">def </span><span class="s1">look_at_xy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">target</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">look_at_2d</span><span class="s2">(</span><span class="s1">target</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">look_at_xz</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">target</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">look_at_2d</span><span class="s2">(</span><span class="s1">target</span><span class="s2">, </span><span class="s5">'y'</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">has_ancestor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">possible_ancestor</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parent </span><span class="s2">== </span><span class="s1">possible_ancestor</span><span class="s2">:</span>
            <span class="s0">return True</span>

        <span class="s1">p </span><span class="s2">= </span><span class="s1">self</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">possible_ancestor</span><span class="s2">, </span><span class="s1">Entity</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">100</span><span class="s2">):</span>
                <span class="s0">if </span><span class="s1">p</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">:</span>
                    <span class="s0">if </span><span class="s1">p</span><span class="s2">.</span><span class="s1">parent </span><span class="s2">== </span><span class="s1">possible_ancestor</span><span class="s2">:</span>
                        <span class="s0">return True</span>

                    <span class="s1">p </span><span class="s2">= </span><span class="s1">p</span><span class="s2">.</span><span class="s1">parent</span>

        <span class="s0">return False</span>

    <span class="s0">def </span><span class="s1">has_disabled_ancestor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">p </span><span class="s2">= </span><span class="s1">self</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">100</span><span class="s2">):</span>
            <span class="s0">if not </span><span class="s1">p</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">:</span>
                <span class="s0">return False</span>
            <span class="s0">if not </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s5">'parent'</span><span class="s2">) </span><span class="s0">or not </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">p</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">, </span><span class="s5">'enabled'</span><span class="s2">):</span>
                <span class="s0">return False</span>

            <span class="s1">p </span><span class="s2">= </span><span class="s1">p</span><span class="s2">.</span><span class="s1">parent</span>

            <span class="s0">if </span><span class="s1">p</span><span class="s2">.</span><span class="s1">enabled </span><span class="s0">is False</span><span class="s2">:</span>
                <span class="s0">return True</span>

        <span class="s0">return False</span>

    <span class="s0">def </span><span class="s1">children_getter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s2">[</span><span class="s1">e </span><span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_children'</span><span class="s2">, []) </span><span class="s0">if </span><span class="s1">e</span><span class="s2">]     </span><span class="s3"># make sure list doesn't contain destroyed entities</span>

    <span class="s0">def </span><span class="s1">children_setter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_children </span><span class="s2">= </span><span class="s1">value</span>


    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">attributes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s3"># attribute names. used by duplicate().</span>
        <span class="s0">return </span><span class="s2">(</span><span class="s5">'name'</span><span class="s2">, </span><span class="s5">'enabled'</span><span class="s2">, </span><span class="s5">'eternal'</span><span class="s2">, </span><span class="s5">'visible'</span><span class="s2">, </span><span class="s5">'parent'</span><span class="s2">,</span>
            <span class="s5">'origin'</span><span class="s2">, </span><span class="s5">'position'</span><span class="s2">, </span><span class="s5">'rotation'</span><span class="s2">, </span><span class="s5">'scale'</span><span class="s2">,</span>
            <span class="s5">'model'</span><span class="s2">, </span><span class="s5">'color'</span><span class="s2">, </span><span class="s5">'texture'</span><span class="s2">, </span><span class="s5">'texture_scale'</span><span class="s2">, </span><span class="s5">'texture_offset'</span><span class="s2">,</span>
            <span class="s5">'render_queue'</span><span class="s2">, </span><span class="s5">'always_on_top'</span><span class="s2">, </span><span class="s5">'collider'</span><span class="s2">, </span><span class="s5">'collision'</span><span class="s2">, </span><span class="s5">'scripts'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__str__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">try</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span>
        <span class="s0">except</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s5">'*destroyed entity*'</span>

    <span class="s0">def </span><span class="s1">get_changes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">target_class</span><span class="s2">=</span><span class="s0">None</span><span class="s2">): </span><span class="s3"># returns a dict of all the changes</span>
        <span class="s0">if not </span><span class="s1">target_class</span><span class="s2">:</span>
            <span class="s1">target_class </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__class__</span>

        <span class="s1">changes </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">()</span>
        <span class="s0">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">target_class</span><span class="s2">.</span><span class="s1">default_values</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
            <span class="s1">attr </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">attr </span><span class="s2">== </span><span class="s1">target_class</span><span class="s2">.</span><span class="s1">default_values</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]:</span>
                <span class="s0">continue</span>

            <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">attr</span><span class="s2">, </span><span class="s5">'__name__'</span><span class="s2">):</span>
                <span class="s1">attr </span><span class="s2">= </span><span class="s1">attr</span><span class="s2">.</span><span class="s1">__name__</span>
                <span class="s1">changes</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">attr</span>
                <span class="s0">continue</span>

            <span class="s0">if </span><span class="s1">attr </span><span class="s0">and </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">attr</span><span class="s2">, </span><span class="s5">'name'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">attr</span><span class="s2">.</span><span class="s1">name </span><span class="s0">and </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">attr</span><span class="s2">.</span><span class="s1">name</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
                <span class="s1">attr </span><span class="s2">= </span><span class="s1">attr</span><span class="s2">.</span><span class="s1">name</span>
                <span class="s0">if </span><span class="s5">'.' </span><span class="s0">in </span><span class="s1">attr</span><span class="s2">:</span>
                    <span class="s1">attr </span><span class="s2">= </span><span class="s1">attr</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s5">'.'</span><span class="s2">)[</span><span class="s4">0</span><span class="s2">]</span>

            <span class="s3"># print('attr changed:', key, 'from:', target_class.default_values[key], 'to:', attr)</span>
            <span class="s0">if </span><span class="s1">key </span><span class="s2">== </span><span class="s5">'color'</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">attr</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
                    <span class="s0">if not </span><span class="s1">attr</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s5">'#'</span><span class="s2">):</span>
                        <span class="s1">attr </span><span class="s2">= </span><span class="s5">f'color.</span><span class="s0">{</span><span class="s1">attr</span><span class="s0">}</span><span class="s5">'</span>
                <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">attr</span><span class="s2">, </span><span class="s1">Color</span><span class="s2">):</span>
                    <span class="s1">attr </span><span class="s2">= </span><span class="s5">f&quot;'</span><span class="s0">{</span><span class="s1">color</span><span class="s2">.</span><span class="s1">rgb_to_hex</span><span class="s2">(*</span><span class="s1">attr</span><span class="s2">)</span><span class="s0">}</span><span class="s5">'&quot;</span>

            <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">attr</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
                <span class="s1">attr </span><span class="s2">= </span><span class="s5">f&quot;'</span><span class="s0">{</span><span class="s1">attr</span><span class="s0">}</span><span class="s5">'&quot;</span>

            <span class="s0">if </span><span class="s1">attr </span><span class="s2">== </span><span class="s5">&quot;'mesh'&quot;</span><span class="s2">:</span>
                <span class="s0">continue</span>

            <span class="s1">changes</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">attr</span>
        <span class="s0">return </span><span class="s1">changes</span>



    <span class="s0">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">changes </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">get_changes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s5">f'</span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span><span class="s0">}</span><span class="s5">(' </span><span class="s2">+  </span><span class="s5">''</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s5">f'</span><span class="s0">{</span><span class="s1">key</span><span class="s0">}</span><span class="s5">=</span><span class="s0">{</span><span class="s1">value</span><span class="s0">}</span><span class="s5">, ' </span><span class="s0">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">changes</span><span class="s2">.</span><span class="s1">items</span><span class="s2">()) + </span><span class="s5">')'</span>


    <span class="s0">def </span><span class="s1">__deepcopy__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">eval</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">))</span>


<span class="s3">#------------</span>
<span class="s3"># ANIMATIONS</span>
<span class="s3">#------------</span>
    <span class="s0">def </span><span class="s1">animate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">=</span><span class="s4">.1</span><span class="s2">, </span><span class="s1">delay</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">curve</span><span class="s2">=</span><span class="s1">curve</span><span class="s2">.</span><span class="s1">in_expo</span><span class="s2">, </span><span class="s1">loop</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">resolution</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">interrupt</span><span class="s2">=</span><span class="s5">'kill'</span><span class="s2">, </span><span class="s1">time_step</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">unscaled</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">auto_play</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">auto_destroy</span><span class="s2">=</span><span class="s0">True</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">duration </span><span class="s2">== </span><span class="s4">0 </span><span class="s0">and </span><span class="s1">delay </span><span class="s2">== </span><span class="s4">0</span><span class="s2">:</span>
            <span class="s1">setattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>
            <span class="s0">return None</span>

        <span class="s0">if </span><span class="s1">delay</span><span class="s2">:</span>
            <span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">ursinastuff </span><span class="s0">import </span><span class="s1">invoke</span>
            <span class="s0">return </span><span class="s1">invoke</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">animate</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">=</span><span class="s1">duration</span><span class="s2">, </span><span class="s1">curve</span><span class="s2">=</span><span class="s1">curve</span><span class="s2">, </span><span class="s1">loop</span><span class="s2">=</span><span class="s1">loop</span><span class="s2">, </span><span class="s1">resolution</span><span class="s2">=</span><span class="s1">resolution</span><span class="s2">, </span><span class="s1">time_step</span><span class="s2">=</span><span class="s1">time_step</span><span class="s2">, </span><span class="s1">auto_destroy</span><span class="s2">=</span><span class="s1">auto_destroy</span><span class="s2">, </span><span class="s1">delay</span><span class="s2">=</span><span class="s1">delay</span><span class="s2">, </span><span class="s1">unscaled</span><span class="s2">=</span><span class="s1">unscaled</span><span class="s2">)</span>

        <span class="s1">animator_name </span><span class="s2">= </span><span class="s1">name </span><span class="s2">+ </span><span class="s5">'_animator'</span>
        <span class="s3"># print('start animating value:', name, animator_name )</span>
        <span class="s0">if </span><span class="s1">interrupt </span><span class="s0">and </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">animator_name</span><span class="s2">):</span>
            <span class="s1">getattr</span><span class="s2">(</span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">animator_name</span><span class="s2">), </span><span class="s1">interrupt</span><span class="s2">)() </span><span class="s3"># call kill() or finish() depending on what the interrupt value is.</span>
            <span class="s3"># print('interrupt', interrupt, animator_name)</span>
        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">animator_name</span><span class="s2">) </span><span class="s0">and </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">animator_name</span><span class="s2">) </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">animations</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">animations</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">animator_name</span><span class="s2">))</span>

        <span class="s1">sequence </span><span class="s2">= </span><span class="s1">Sequence</span><span class="s2">(</span><span class="s1">loop</span><span class="s2">=</span><span class="s1">loop</span><span class="s2">, </span><span class="s1">time_step</span><span class="s2">=</span><span class="s1">time_step</span><span class="s2">, </span><span class="s1">auto_destroy</span><span class="s2">=</span><span class="s1">auto_destroy</span><span class="s2">, </span><span class="s1">unscaled</span><span class="s2">=</span><span class="s1">unscaled</span><span class="s2">)</span>

        <span class="s1">setattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">animator_name</span><span class="s2">, </span><span class="s1">sequence</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">animations</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">sequence</span><span class="s2">)</span>

        <span class="s0">if not </span><span class="s1">resolution</span><span class="s2">:</span>
            <span class="s1">resolution </span><span class="s2">= </span><span class="s1">max</span><span class="s2">(</span><span class="s1">int</span><span class="s2">(</span><span class="s1">duration </span><span class="s2">* </span><span class="s4">60</span><span class="s2">), </span><span class="s4">1</span><span class="s2">)</span>

        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">resolution</span><span class="s2">+</span><span class="s4">1</span><span class="s2">):</span>
            <span class="s1">t </span><span class="s2">= </span><span class="s1">i </span><span class="s2">/ </span><span class="s1">resolution</span>
            <span class="s1">t </span><span class="s2">= </span><span class="s1">curve</span><span class="s2">(</span><span class="s1">t</span><span class="s2">)</span>

            <span class="s1">sequence</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">Wait</span><span class="s2">(</span><span class="s1">duration </span><span class="s2">/ </span><span class="s1">resolution</span><span class="s2">))</span>
            <span class="s1">sequence</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">Func</span><span class="s2">(</span><span class="s1">setattr</span><span class="s2">, </span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">lerp</span><span class="s2">(</span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">), </span><span class="s1">value</span><span class="s2">, </span><span class="s1">t</span><span class="s2">)))</span>

        <span class="s0">if </span><span class="s1">auto_play</span><span class="s2">:</span>
            <span class="s1">sequence</span><span class="s2">.</span><span class="s1">start</span><span class="s2">()</span>
        <span class="s0">return </span><span class="s1">sequence</span>

    <span class="s0">def </span><span class="s1">animate_position</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">=</span><span class="s4">.1</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">animate</span><span class="s2">(</span><span class="s5">'x'</span><span class="s2">, </span><span class="s1">value</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">duration</span><span class="s2">,  **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">animate</span><span class="s2">(</span><span class="s5">'y'</span><span class="s2">, </span><span class="s1">value</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">duration</span><span class="s2">,  **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) &gt; </span><span class="s4">2</span><span class="s2">:</span>
            <span class="s1">z </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">animate</span><span class="s2">(</span><span class="s5">'z'</span><span class="s2">, </span><span class="s1">value</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">duration</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span>

    <span class="s0">def </span><span class="s1">animate_rotation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">=</span><span class="s4">.1</span><span class="s2">,  **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">animate</span><span class="s2">(</span><span class="s5">'rotation_x'</span><span class="s2">, </span><span class="s1">value</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">duration</span><span class="s2">,  **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">animate</span><span class="s2">(</span><span class="s5">'rotation_y'</span><span class="s2">, </span><span class="s1">value</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">duration</span><span class="s2">,  **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">animate</span><span class="s2">(</span><span class="s5">'rotation_z'</span><span class="s2">, </span><span class="s1">value</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">duration</span><span class="s2">,  **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span>

    <span class="s0">def </span><span class="s1">animate_scale</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">=</span><span class="s4">.1</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, (</span><span class="s1">int</span><span class="s2">, </span><span class="s1">float</span><span class="s2">, </span><span class="s1">complex</span><span class="s2">)):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">) </span><span class="s0">and </span><span class="s1">len</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) == </span><span class="s4">2</span><span class="s2">:</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">value</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">z</span><span class="s2">)</span>

        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">animate</span><span class="s2">(</span><span class="s5">'scale'</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">=</span><span class="s1">duration</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s3"># generate animation functions</span>
    <span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s2">(</span><span class="s5">'x'</span><span class="s2">, </span><span class="s5">'y'</span><span class="s2">, </span><span class="s5">'z'</span><span class="s2">, </span><span class="s5">'rotation_x'</span><span class="s2">, </span><span class="s5">'rotation_y'</span><span class="s2">, </span><span class="s5">'rotation_z'</span><span class="s2">, </span><span class="s5">'scale_x'</span><span class="s2">, </span><span class="s5">'scale_y'</span><span class="s2">, </span><span class="s5">'scale_z'</span><span class="s2">):</span>
        <span class="s1">exec</span><span class="s2">(</span><span class="s1">dedent</span><span class="s2">(</span><span class="s5">f'''</span>
            <span class="s5">def animate_</span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s5">(self, value, duration=.1, delay=0, unscaled=False, **kwargs):</span>
                <span class="s5">return self.animate('</span><span class="s0">{</span><span class="s1">e</span><span class="s0">}</span><span class="s5">', value, duration=duration, delay=delay, unscaled=unscaled, **kwargs)</span>
        <span class="s5">'''</span><span class="s2">))</span>


    <span class="s0">def </span><span class="s1">shake</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">=</span><span class="s4">.2</span><span class="s2">, </span><span class="s1">magnitude</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">speed</span><span class="s2">=</span><span class="s4">.05</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">=(</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">), </span><span class="s1">delay</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">attr_name</span><span class="s2">=</span><span class="s5">'position'</span><span class="s2">, </span><span class="s1">interrupt</span><span class="s2">=</span><span class="s5">'finish'</span><span class="s2">, </span><span class="s1">unscaled</span><span class="s2">=</span><span class="s0">False</span><span class="s2">):</span>
        <span class="s0">import </span><span class="s1">random</span>

        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'shake_sequence'</span><span class="s2">) </span><span class="s0">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shake_sequence</span><span class="s2">:</span>
            <span class="s1">getattr</span><span class="s2">(</span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'shake_sequence'</span><span class="s2">), </span><span class="s1">interrupt</span><span class="s2">)()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">shake_sequence </span><span class="s2">= </span><span class="s1">Sequence</span><span class="s2">(</span><span class="s1">Wait</span><span class="s2">(</span><span class="s1">delay</span><span class="s2">))</span>
        <span class="s1">original_position </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">attr_name</span><span class="s2">)</span>

        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">int</span><span class="s2">(</span><span class="s1">duration </span><span class="s2">/ </span><span class="s1">speed</span><span class="s2">)):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">shake_sequence</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">Func</span><span class="s2">(</span><span class="s1">setattr</span><span class="s2">, </span><span class="s1">self</span><span class="s2">, </span><span class="s1">attr_name</span><span class="s2">,</span>
                <span class="s1">Vec3</span><span class="s2">(</span>
                    <span class="s1">original_position</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] + (</span><span class="s1">random</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">(-</span><span class="s4">.1</span><span class="s2">, </span><span class="s4">.1</span><span class="s2">) * </span><span class="s1">magnitude </span><span class="s2">* </span><span class="s1">direction</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]),</span>
                    <span class="s1">original_position</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] + (</span><span class="s1">random</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">(-</span><span class="s4">.1</span><span class="s2">, </span><span class="s4">.1</span><span class="s2">) * </span><span class="s1">magnitude </span><span class="s2">* </span><span class="s1">direction</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]),</span>
                    <span class="s1">original_position</span><span class="s2">[</span><span class="s4">2</span><span class="s2">],</span>
                <span class="s2">)))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">shake_sequence</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">Wait</span><span class="s2">(</span><span class="s1">speed</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">shake_sequence</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">Func</span><span class="s2">(</span><span class="s1">setattr</span><span class="s2">, </span><span class="s1">self</span><span class="s2">, </span><span class="s1">attr_name</span><span class="s2">, </span><span class="s1">original_position</span><span class="s2">))</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">animations</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">shake_sequence</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">shake_sequence</span><span class="s2">.</span><span class="s1">unscaled </span><span class="s2">= </span><span class="s1">unscaled</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">shake_sequence</span><span class="s2">.</span><span class="s1">start</span><span class="s2">()</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shake_sequence</span>

    <span class="s0">def </span><span class="s1">animate_color</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">=</span><span class="s4">.1</span><span class="s2">, </span><span class="s1">interrupt</span><span class="s2">=</span><span class="s5">'finish'</span><span class="s2">, </span><span class="s1">unscaled</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">animate</span><span class="s2">(</span><span class="s5">'color'</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">, </span><span class="s1">interrupt</span><span class="s2">=</span><span class="s1">interrupt</span><span class="s2">, </span><span class="s1">unscaled</span><span class="s2">=</span><span class="s1">unscaled</span><span class="s2">,**</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">fade_out</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">=</span><span class="s4">.5</span><span class="s2">, </span><span class="s1">unscaled</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">animate</span><span class="s2">(</span><span class="s5">'color'</span><span class="s2">, </span><span class="s1">Vec4</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">color</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">self</span><span class="s2">.</span><span class="s1">color</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">self</span><span class="s2">.</span><span class="s1">color</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">value</span><span class="s2">), </span><span class="s1">duration</span><span class="s2">=</span><span class="s1">duration</span><span class="s2">, </span><span class="s1">unscaled</span><span class="s2">=</span><span class="s1">unscaled</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">fade_in</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">=</span><span class="s4">.5</span><span class="s2">, </span><span class="s1">unscaled</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">animate</span><span class="s2">(</span><span class="s5">'color'</span><span class="s2">, </span><span class="s1">Vec4</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">color</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">self</span><span class="s2">.</span><span class="s1">color</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">self</span><span class="s2">.</span><span class="s1">color</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">value</span><span class="s2">), </span><span class="s1">duration</span><span class="s2">=</span><span class="s1">duration</span><span class="s2">, </span><span class="s1">unscaled</span><span class="s2">=</span><span class="s1">unscaled</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">blink</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">=</span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">color</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">=</span><span class="s4">.1</span><span class="s2">, </span><span class="s1">delay</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">curve</span><span class="s2">=</span><span class="s1">curve</span><span class="s2">.</span><span class="s1">in_expo_boomerang</span><span class="s2">, </span><span class="s1">interrupt</span><span class="s2">=</span><span class="s5">'finish'</span><span class="s2">, </span><span class="s1">unscaled</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">animate_color</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">=</span><span class="s1">duration</span><span class="s2">, </span><span class="s1">delay</span><span class="s2">=</span><span class="s1">delay</span><span class="s2">, </span><span class="s1">curve</span><span class="s2">=</span><span class="s1">curve</span><span class="s2">, </span><span class="s1">interrupt</span><span class="s2">=</span><span class="s1">interrupt</span><span class="s2">, </span><span class="s1">unscaled</span><span class="s2">=</span><span class="s1">unscaled</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>



    <span class="s0">def </span><span class="s1">intersects</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">traverse_target</span><span class="s2">=</span><span class="s1">scene</span><span class="s2">, </span><span class="s1">ignore</span><span class="s2">:</span><span class="s1">list</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">debug</span><span class="s2">=</span><span class="s0">False</span><span class="s2">):</span>
        <span class="s0">if not </span><span class="s1">ignore</span><span class="s2">:</span>
            <span class="s1">ignore </span><span class="s2">= []</span>
        <span class="s1">ignore </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">ignore</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">collider</span><span class="s2">, </span><span class="s1">MeshCollider</span><span class="s2">):</span>
            <span class="s0">raise </span><span class="s1">Exception</span><span class="s2">(</span><span class="s5">'''error: mesh colliders can't intersect other shapes, only primitive shapes can. Mesh colliders can &quot;receive&quot; collisions though.'''</span><span class="s2">)</span>

        <span class="s0">from </span><span class="s1">ursina</span><span class="s2">.</span><span class="s1">hit_info </span><span class="s0">import </span><span class="s1">HitInfo</span>

        <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collision </span><span class="s0">or not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collider</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">hit </span><span class="s2">= </span><span class="s1">HitInfo</span><span class="s2">(</span><span class="s1">hit</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">hit</span>

        <span class="s0">from </span><span class="s1">ursina </span><span class="s0">import </span><span class="s1">distance</span>
        <span class="s0">if not </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_picker'</span><span class="s2">):</span>
            <span class="s0">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">CollisionTraverser</span><span class="s2">, </span><span class="s1">CollisionNode</span><span class="s2">, </span><span class="s1">CollisionHandlerQueue</span>

            <span class="s1">self</span><span class="s2">.</span><span class="s1">_picker </span><span class="s2">= </span><span class="s1">CollisionTraverser</span><span class="s2">()  </span><span class="s3"># Make a traverser</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_pq </span><span class="s2">= </span><span class="s1">CollisionHandlerQueue</span><span class="s2">()  </span><span class="s3"># Make a handler</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNode </span><span class="s2">= </span><span class="s1">CollisionNode</span><span class="s2">(</span><span class="s5">'raycaster'</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNode</span><span class="s2">.</span><span class="s1">set_into_collide_mask</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNP </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">attach_new_node</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNode</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_picker</span><span class="s2">.</span><span class="s1">addCollider</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNP</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_pq</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNP</span><span class="s2">.</span><span class="s1">show</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNode</span><span class="s2">.</span><span class="s1">addSolid</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_collider</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">debug</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNP</span><span class="s2">.</span><span class="s1">show</span><span class="s2">()</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_pickerNP</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_picker</span><span class="s2">.</span><span class="s1">traverse</span><span class="s2">(</span><span class="s1">traverse_target</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_pq</span><span class="s2">.</span><span class="s1">get_num_entries</span><span class="s2">() == </span><span class="s4">0</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">hit </span><span class="s2">= </span><span class="s1">HitInfo</span><span class="s2">(</span><span class="s1">hit</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">hit</span>

        <span class="s1">ignore</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s1">ignore</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">((</span><span class="s1">e </span><span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">scene</span><span class="s2">.</span><span class="s1">entities </span><span class="s0">if not </span><span class="s1">e</span><span class="s2">.</span><span class="s1">collision</span><span class="s2">))</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_pq</span><span class="s2">.</span><span class="s1">sort_entries</span><span class="s2">()</span>
        <span class="s1">entries </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_pq</span><span class="s2">.</span><span class="s1">getEntries</span><span class="s2">()</span>
        <span class="s1">entities </span><span class="s2">= [</span><span class="s1">e</span><span class="s2">.</span><span class="s1">get_into_node_path</span><span class="s2">().</span><span class="s1">parent </span><span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">entries</span><span class="s2">]</span>

        <span class="s1">entries </span><span class="s2">= [        </span><span class="s3"># filter out ignored entities</span>
            <span class="s1">e </span><span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">e </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">entries</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">entities</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] </span><span class="s0">in </span><span class="s1">scene</span><span class="s2">.</span><span class="s1">collidables</span>
            <span class="s0">and </span><span class="s1">entities</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] </span><span class="s0">not in </span><span class="s1">ignore</span>
            <span class="s2">]</span>

        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">entries</span><span class="s2">) == </span><span class="s4">0</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">HitInfo</span><span class="s2">(</span><span class="s1">hit</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

        <span class="s1">hit_info </span><span class="s2">= </span><span class="s1">HitInfo</span><span class="s2">(</span><span class="s1">hit</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">hit_info</span><span class="s2">.</span><span class="s1">entities </span><span class="s2">= [</span><span class="s1">e</span><span class="s2">.</span><span class="s1">get_into_node_path</span><span class="s2">().</span><span class="s1">parent</span><span class="s2">.</span><span class="s1">getPythonTag</span><span class="s2">(</span><span class="s5">'Entity'</span><span class="s2">) </span><span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">entries</span><span class="s2">]</span>
        <span class="s1">hit_info</span><span class="s2">.</span><span class="s1">entity </span><span class="s2">= </span><span class="s1">hit_info</span><span class="s2">.</span><span class="s1">entities</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]</span>

        <span class="s1">collision </span><span class="s2">= </span><span class="s1">entries</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]</span>
        <span class="s3"># nP = collision.get_into_node_path().parent</span>
        <span class="s1">hit_info</span><span class="s2">.</span><span class="s1">point </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">collision</span><span class="s2">.</span><span class="s1">get_surface_point</span><span class="s2">(</span><span class="s1">hit_info</span><span class="s2">.</span><span class="s1">entity</span><span class="s2">))</span>
        <span class="s1">hit_info</span><span class="s2">.</span><span class="s1">world_point </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">collision</span><span class="s2">.</span><span class="s1">get_surface_point</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">))</span>
        <span class="s1">hit_info</span><span class="s2">.</span><span class="s1">distance </span><span class="s2">= </span><span class="s1">distance</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">world_position</span><span class="s2">, </span><span class="s1">hit_info</span><span class="s2">.</span><span class="s1">world_point</span><span class="s2">)</span>
        <span class="s1">hit_info</span><span class="s2">.</span><span class="s1">normal </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">collision</span><span class="s2">.</span><span class="s1">get_surface_normal</span><span class="s2">(</span><span class="s1">collision</span><span class="s2">.</span><span class="s1">get_into_node_path</span><span class="s2">().</span><span class="s1">parent</span><span class="s2">).</span><span class="s1">normalized</span><span class="s2">())</span>
        <span class="s1">hit_info</span><span class="s2">.</span><span class="s1">world_normal </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(*</span><span class="s1">collision</span><span class="s2">.</span><span class="s1">get_surface_normal</span><span class="s2">(</span><span class="s1">scene</span><span class="s2">).</span><span class="s1">normalized</span><span class="s2">())</span>

        <span class="s0">return </span><span class="s1">hit_info</span>


    <span class="s0">def </span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s0">try</span><span class="s2">:</span>
            <span class="s1">super</span><span class="s2">().</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>
        <span class="s0">except</span><span class="s2">:</span>
            <span class="s0">pass</span>
            <span class="s3"># print('failed to set attribute:', name)</span>



<span class="s0">if </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s5">'__main__'</span><span class="s2">:</span>
    <span class="s0">from </span><span class="s1">ursina </span><span class="s0">import </span><span class="s2">*</span>
    <span class="s1">app </span><span class="s2">= </span><span class="s1">Ursina</span><span class="s2">()</span>

    <span class="s1">e </span><span class="s2">= </span><span class="s1">Entity</span><span class="s2">(</span><span class="s1">model</span><span class="s2">=</span><span class="s5">'quad'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s1">color</span><span class="s2">.</span><span class="s1">orange</span><span class="s2">, </span><span class="s1">position</span><span class="s2">=(</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">1</span><span class="s2">), </span><span class="s1">scale</span><span class="s2">=</span><span class="s4">1.5</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=(</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">45</span><span class="s2">), </span><span class="s1">texture</span><span class="s2">=</span><span class="s5">'brick'</span><span class="s2">)</span>

    <span class="s5">'''example of inheriting Entity'''</span>
    <span class="s0">class </span><span class="s1">Player</span><span class="s2">(</span><span class="s1">Entity</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
            <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">model</span><span class="s2">=</span><span class="s5">'cube'</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">color </span><span class="s2">= </span><span class="s1">color</span><span class="s2">.</span><span class="s1">red</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">scale_y </span><span class="s2">= </span><span class="s4">2</span>

            <span class="s0">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">kwargs</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
                <span class="s1">setattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

        <span class="s3"># input and update functions gets automatically called by the engine</span>
        <span class="s0">def </span><span class="s1">input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">key</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">key </span><span class="s2">== </span><span class="s5">'space'</span><span class="s2">:</span>
                <span class="s3"># self.color = self.color.inverse()</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">animate_x</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>

        <span class="s0">def </span><span class="s1">update</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">x </span><span class="s2">+= </span><span class="s1">held_keys</span><span class="s2">[</span><span class="s5">'d'</span><span class="s2">] * </span><span class="s1">time</span><span class="s2">.</span><span class="s1">dt </span><span class="s2">* </span><span class="s4">10</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">x </span><span class="s2">-= </span><span class="s1">held_keys</span><span class="s2">[</span><span class="s5">'a'</span><span class="s2">] * </span><span class="s1">time</span><span class="s2">.</span><span class="s1">dt </span><span class="s2">* </span><span class="s4">10</span>

    <span class="s1">player </span><span class="s2">= </span><span class="s1">Player</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=-</span><span class="s4">1</span><span class="s2">)</span>


    <span class="s3"># test</span>
    <span class="s1">e </span><span class="s2">= </span><span class="s1">Entity</span><span class="s2">(</span><span class="s1">model</span><span class="s2">=</span><span class="s5">'cube'</span><span class="s2">, </span><span class="s1">collider</span><span class="s2">=</span><span class="s5">'box'</span><span class="s2">, </span><span class="s1">texture</span><span class="s2">=</span><span class="s5">'shore'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s1">hsv</span><span class="s2">(</span><span class="s4">.3</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">.5</span><span class="s2">))</span>
    <span class="s1">print</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">e</span><span class="s2">))</span>
    <span class="s3"># a = Entity()</span>
    <span class="s3"># b = Entity(parent=a)</span>


    <span class="s3"># e.animate_x(3, duration=2, delay=.5, loop=True)</span>
    <span class="s3"># e.animate_position(Vec3(1,1,1), duration=1, loop=True)</span>
    <span class="s3"># e.animate_rotation(Vec3(45,45,45))</span>
    <span class="s3"># e.animate_scale(2, duration=1, curve=curve.out_expo_boomerang, loop=True)</span>
    <span class="s3"># e.animate_color(color.green, loop=True)</span>
    <span class="s3"># e.shake()</span>
    <span class="s3"># e.fade_out(delay=.5)</span>
    <span class="s3"># e.fade_in(delay=2.5)</span>
    <span class="s3"># e.blink(color.red, duration=1, curve=curve.linear_boomerang, loop=True)</span>

    <span class="s1">app</span><span class="s2">.</span><span class="s1">run</span><span class="s2">()</span>
</pre>
</body>
</html>
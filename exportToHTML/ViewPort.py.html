<html>
<head>
<title>ViewPort.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #cf8e6d;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
ViewPort.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Contains classes useful for 3D viewports. 
 
Originally written by pro-rsoft, 
Modified by gjeon. 
Modified by Summer 2010 Carnegie Mellon University ETC PandaLE team: fixed a bug in Viewport.Close 
&quot;&quot;&quot;</span>

<span class="s1">__all__ </span><span class="s2">= [</span><span class="s3">&quot;Viewport&quot;</span><span class="s2">, </span><span class="s3">&quot;ViewportManager&quot;</span><span class="s2">]</span>

<span class="s4">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">showbase</span><span class="s2">.</span><span class="s1">DirectObject </span><span class="s4">import </span><span class="s1">DirectObject</span>
<span class="s4">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">directtools</span><span class="s2">.</span><span class="s1">DirectGrid </span><span class="s4">import </span><span class="s1">DirectGrid</span>
<span class="s4">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">showbase</span><span class="s2">.</span><span class="s1">ShowBase </span><span class="s4">import </span><span class="s1">WindowControls</span>
<span class="s4">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">directtools</span><span class="s2">.</span><span class="s1">DirectGlobals </span><span class="s4">import </span><span class="s2">*</span>
<span class="s4">from </span><span class="s2">.</span><span class="s1">WxPandaWindow </span><span class="s4">import </span><span class="s1">WxPandaWindow</span>
<span class="s4">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s4">import </span><span class="s1">OrthographicLens</span><span class="s2">, </span><span class="s1">Point3</span><span class="s2">, </span><span class="s1">Plane</span><span class="s2">, </span><span class="s1">CollisionPlane</span><span class="s2">, </span><span class="s1">CollisionNode</span><span class="s2">, </span><span class="s1">NodePath</span>
<span class="s4">import </span><span class="s1">wx</span>

<span class="s1">HORIZONTAL </span><span class="s2">= </span><span class="s1">wx</span><span class="s2">.</span><span class="s1">SPLIT_HORIZONTAL</span>
<span class="s1">VERTICAL   </span><span class="s2">= </span><span class="s1">wx</span><span class="s2">.</span><span class="s1">SPLIT_VERTICAL</span>
<span class="s1">CREATENEW  </span><span class="s2">= </span><span class="s5">99</span>
<span class="s1">VPLEFT     </span><span class="s2">= </span><span class="s5">10</span>
<span class="s1">VPFRONT    </span><span class="s2">= </span><span class="s5">11</span>
<span class="s1">VPTOP      </span><span class="s2">= </span><span class="s5">12</span>
<span class="s1">VPPERSPECTIVE </span><span class="s2">= </span><span class="s5">13</span>

<span class="s4">class </span><span class="s1">ViewportManager</span><span class="s2">:</span>
  <span class="s0">&quot;&quot;&quot;Manages the global viewport stuff.&quot;&quot;&quot;</span>
  <span class="s1">viewports </span><span class="s2">= []</span>
  <span class="s1">gsg </span><span class="s2">= </span><span class="s4">None</span>

  <span class="s2">@</span><span class="s1">staticmethod</span>
  <span class="s4">def </span><span class="s1">initializeAll</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;Calls initialize() on all the viewports.&quot;&quot;&quot;</span>
    <span class="s4">for </span><span class="s1">v </span><span class="s4">in </span><span class="s1">ViewportManager</span><span class="s2">.</span><span class="s1">viewports</span><span class="s2">:</span>
      <span class="s1">v</span><span class="s2">.</span><span class="s1">initialize</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

  <span class="s2">@</span><span class="s1">staticmethod</span>
  <span class="s4">def </span><span class="s1">updateAll</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;Calls Update() on all the viewports.&quot;&quot;&quot;</span>
    <span class="s4">for </span><span class="s1">v </span><span class="s4">in </span><span class="s1">ViewportManager</span><span class="s2">.</span><span class="s1">viewports</span><span class="s2">:</span>
      <span class="s1">v</span><span class="s2">.</span><span class="s1">Update</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

  <span class="s2">@</span><span class="s1">staticmethod</span>
  <span class="s4">def </span><span class="s1">layoutAll</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;Calls Layout() on all the viewports.&quot;&quot;&quot;</span>
    <span class="s4">for </span><span class="s1">v </span><span class="s4">in </span><span class="s1">ViewportManager</span><span class="s2">.</span><span class="s1">viewports</span><span class="s2">:</span>
      <span class="s1">v</span><span class="s2">.</span><span class="s1">Layout</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

<span class="s4">class </span><span class="s1">Viewport</span><span class="s2">(</span><span class="s1">WxPandaWindow</span><span class="s2">, </span><span class="s1">DirectObject</span><span class="s2">):</span>
  <span class="s0">&quot;&quot;&quot;Class representing a 3D Viewport.&quot;&quot;&quot;</span>
  <span class="s1">CREATENEW  </span><span class="s2">= </span><span class="s1">CREATENEW</span>
  <span class="s1">VPLEFT     </span><span class="s2">= </span><span class="s1">VPLEFT</span>
  <span class="s1">VPFRONT    </span><span class="s2">= </span><span class="s1">VPFRONT</span>
  <span class="s1">VPTOP      </span><span class="s2">= </span><span class="s1">VPTOP</span>
  <span class="s1">VPPERSPECTIVE </span><span class="s2">= </span><span class="s1">VPPERSPECTIVE</span>
  <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">name</span>
    <span class="s1">DirectObject</span><span class="s2">.</span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

    <span class="s1">kwargs</span><span class="s2">[</span><span class="s3">'gsg'</span><span class="s2">] = </span><span class="s1">ViewportManager</span><span class="s2">.</span><span class="s1">gsg</span>
    <span class="s1">WxPandaWindow</span><span class="s2">.</span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s1">ViewportManager</span><span class="s2">.</span><span class="s1">viewports</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
    <span class="s4">if </span><span class="s1">ViewportManager</span><span class="s2">.</span><span class="s1">gsg </span><span class="s2">== </span><span class="s4">None</span><span class="s2">:</span>
      <span class="s1">ViewportManager</span><span class="s2">.</span><span class="s1">gsg </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">win</span><span class="s2">.</span><span class="s1">getGsg</span><span class="s2">()</span>

    <span class="s1">self</span><span class="s2">.</span><span class="s1">camera </span><span class="s2">= </span><span class="s4">None</span>
    <span class="s1">self</span><span class="s2">.</span><span class="s1">lens </span><span class="s2">= </span><span class="s4">None</span>
    <span class="s1">self</span><span class="s2">.</span><span class="s1">camPos </span><span class="s2">= </span><span class="s4">None</span>
    <span class="s1">self</span><span class="s2">.</span><span class="s1">camLookAt </span><span class="s2">= </span><span class="s4">None</span>
    <span class="s1">self</span><span class="s2">.</span><span class="s1">initialized </span><span class="s2">= </span><span class="s4">False</span>
    <span class="s1">self</span><span class="s2">.</span><span class="s1">grid </span><span class="s2">= </span><span class="s4">None</span>
    <span class="s1">self</span><span class="s2">.</span><span class="s1">collPlane </span><span class="s2">= </span><span class="s4">None</span>

  <span class="s4">def </span><span class="s1">initialize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
    <span class="s1">self</span><span class="s2">.</span><span class="s1">Update</span><span class="s2">()</span>
    <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">win</span><span class="s2">:</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">cam2d </span><span class="s2">= </span><span class="s1">base</span><span class="s2">.</span><span class="s1">makeCamera2d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">win</span><span class="s2">)</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">cam2d</span><span class="s2">.</span><span class="s1">node</span><span class="s2">().</span><span class="s1">setCameraMask</span><span class="s2">(</span><span class="s1">LE_CAM_MASKS</span><span class="s2">[</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">])</span>

    <span class="s1">self</span><span class="s2">.</span><span class="s1">cam </span><span class="s2">= </span><span class="s1">base</span><span class="s2">.</span><span class="s1">camList</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]</span>
    <span class="s1">self</span><span class="s2">.</span><span class="s1">camera </span><span class="s2">= </span><span class="s1">render</span><span class="s2">.</span><span class="s1">attachNewNode</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)</span>
    <span class="s6">#self.camera.setName(self.name)</span>
    <span class="s6">#self.camera.reparentTo(render)</span>
    <span class="s1">self</span><span class="s2">.</span><span class="s1">cam</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">camera</span><span class="s2">)</span>
    <span class="s1">self</span><span class="s2">.</span><span class="s1">camNode </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cam</span><span class="s2">.</span><span class="s1">node</span><span class="s2">()</span>

    <span class="s1">self</span><span class="s2">.</span><span class="s1">camNode</span><span class="s2">.</span><span class="s1">setCameraMask</span><span class="s2">(</span><span class="s1">LE_CAM_MASKS</span><span class="s2">[</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">])</span>

    <span class="s1">self</span><span class="s2">.</span><span class="s1">bt </span><span class="s2">= </span><span class="s1">base</span><span class="s2">.</span><span class="s1">setupMouse</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">win</span><span class="s2">, </span><span class="s4">True</span><span class="s2">)</span>
    <span class="s1">self</span><span class="s2">.</span><span class="s1">bt</span><span class="s2">.</span><span class="s1">node</span><span class="s2">().</span><span class="s1">setPrefix</span><span class="s2">(</span><span class="s3">'_le_%s_'</span><span class="s2">%</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">[:</span><span class="s5">3</span><span class="s2">])</span>
    <span class="s1">mw </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">bt</span><span class="s2">.</span><span class="s1">getParent</span><span class="s2">()</span>
    <span class="s1">mk </span><span class="s2">= </span><span class="s1">mw</span><span class="s2">.</span><span class="s1">getParent</span><span class="s2">()</span>
    <span class="s1">winCtrl </span><span class="s2">= </span><span class="s1">WindowControls</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">win</span><span class="s2">, </span><span class="s1">mouseWatcher</span><span class="s2">=</span><span class="s1">mw</span><span class="s2">,</span>
                <span class="s1">cam</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">camera</span><span class="s2">,</span>
                <span class="s1">camNode </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">camNode</span><span class="s2">,</span>
                <span class="s1">cam2d</span><span class="s2">=</span><span class="s4">None</span><span class="s2">,</span>
                <span class="s1">mouseKeyboard </span><span class="s2">=</span><span class="s1">mk</span><span class="s2">,</span>
                <span class="s1">grid </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">)</span>
    <span class="s1">base</span><span class="s2">.</span><span class="s1">setupWindowControls</span><span class="s2">(</span><span class="s1">winCtrl</span><span class="s2">)</span>

    <span class="s1">self</span><span class="s2">.</span><span class="s1">initialized </span><span class="s2">= </span><span class="s4">True</span>
    <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">lens </span><span class="s2">!= </span><span class="s4">None</span><span class="s2">:      </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cam</span><span class="s2">.</span><span class="s1">node</span><span class="s2">().</span><span class="s1">setLens</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">lens</span><span class="s2">)</span>
    <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">camPos </span><span class="s2">!= </span><span class="s4">None</span><span class="s2">:    </span><span class="s1">self</span><span class="s2">.</span><span class="s1">camera</span><span class="s2">.</span><span class="s1">setPos</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">camPos</span><span class="s2">)</span>
    <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">camLookAt </span><span class="s2">!= </span><span class="s4">None</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">camera</span><span class="s2">.</span><span class="s1">lookAt</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">camLookAt</span><span class="s2">)</span>

    <span class="s1">self</span><span class="s2">.</span><span class="s1">camLens </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">camNode</span><span class="s2">.</span><span class="s1">getLens</span><span class="s2">()</span>

    <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s4">in </span><span class="s2">[</span><span class="s3">'top'</span><span class="s2">, </span><span class="s3">'front'</span><span class="s2">, </span><span class="s3">'left'</span><span class="s2">]:</span>
      <span class="s1">x </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ClientSize</span><span class="s2">.</span><span class="s1">GetWidth</span><span class="s2">() * </span><span class="s5">0.1</span>
      <span class="s1">y </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ClientSize</span><span class="s2">.</span><span class="s1">GetHeight</span><span class="s2">() * </span><span class="s5">0.1</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">camLens</span><span class="s2">.</span><span class="s1">setFilmSize</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

    <span class="s1">self</span><span class="s2">.</span><span class="s1">Bind</span><span class="s2">(</span><span class="s1">wx</span><span class="s2">.</span><span class="s1">EVT_SIZE</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">onSize</span><span class="s2">)</span>

<span class="s6">##     self.accept(&quot;wheel_down&quot;, self.zoomOut)</span>
<span class="s6">##     self.accept(&quot;wheel_up&quot;, self.zoomIn)</span>
<span class="s6">##     self.accept(&quot;page_down&quot;, self.zoomOut)</span>
<span class="s6">##     self.accept(&quot;page_down-repeat&quot;, self.zoomOut)</span>
<span class="s6">##     self.accept(&quot;page_up&quot;, self.zoomIn)</span>
<span class="s6">##     self.accept(&quot;page_up-repeat&quot;, self.zoomIn)</span>
    <span class="s6">#self.accept(&quot;mouse3&quot;, self.onRightDown)</span>

  <span class="s4">def </span><span class="s1">Close</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;Closes the viewport.&quot;&quot;&quot;</span>
    <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">initialized</span><span class="s2">:</span>
       <span class="s1">wx</span><span class="s2">.</span><span class="s1">Window</span><span class="s2">.</span><span class="s1">Close</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
    <span class="s6">#base.closeWindow(self.win)</span>
    <span class="s1">ViewportManager</span><span class="s2">.</span><span class="s1">viewports</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

  <span class="s4">def </span><span class="s1">onSize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">evt</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;Invoked when the viewport is resized.&quot;&quot;&quot;</span>
    <span class="s1">WxPandaWindow</span><span class="s2">.</span><span class="s1">onSize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">evt</span><span class="s2">)</span>

    <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">win </span><span class="s2">!= </span><span class="s4">None</span><span class="s2">:</span>
      <span class="s1">newWidth </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ClientSize</span><span class="s2">.</span><span class="s1">GetWidth</span><span class="s2">()</span>
      <span class="s1">newHeight </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ClientSize</span><span class="s2">.</span><span class="s1">GetHeight</span><span class="s2">()</span>

      <span class="s4">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">base</span><span class="s2">, </span><span class="s3">&quot;direct&quot;</span><span class="s2">) </span><span class="s4">and </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">:</span>
        <span class="s4">for </span><span class="s1">dr </span><span class="s4">in </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">drList</span><span class="s2">:</span>
          <span class="s4">if </span><span class="s1">dr</span><span class="s2">.</span><span class="s1">camNode </span><span class="s2">== </span><span class="s1">self</span><span class="s2">.</span><span class="s1">camNode</span><span class="s2">:</span>
            <span class="s1">dr</span><span class="s2">.</span><span class="s1">updateFilmSize</span><span class="s2">(</span><span class="s1">newWidth</span><span class="s2">, </span><span class="s1">newHeight</span><span class="s2">)</span>
            <span class="s4">break</span>

  <span class="s4">def </span><span class="s1">onRightDown</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">evt </span><span class="s2">= </span><span class="s4">None</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;Invoked when the viewport is right-clicked.&quot;&quot;&quot;</span>
    <span class="s4">if </span><span class="s1">evt </span><span class="s2">== </span><span class="s4">None</span><span class="s2">:</span>
      <span class="s1">mpos </span><span class="s2">= </span><span class="s1">wx</span><span class="s2">.</span><span class="s1">GetMouseState</span><span class="s2">()</span>
      <span class="s1">mpos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ScreenToClient</span><span class="s2">((</span><span class="s1">mpos</span><span class="s2">.</span><span class="s1">x</span><span class="s2">, </span><span class="s1">mpos</span><span class="s2">.</span><span class="s1">y</span><span class="s2">))</span>
    <span class="s4">else</span><span class="s2">:</span>
      <span class="s1">mpos </span><span class="s2">= </span><span class="s1">evt</span><span class="s2">.</span><span class="s1">GetPosition</span><span class="s2">()</span>
    <span class="s1">self</span><span class="s2">.</span><span class="s1">Update</span><span class="s2">()</span>
    <span class="s6">#self.PopupMenu(self.menu, mpos)</span>
    <span class="s6">#self.menu.Destroy()</span>

  <span class="s4">def </span><span class="s1">zoomOut</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
    <span class="s1">self</span><span class="s2">.</span><span class="s1">camera</span><span class="s2">.</span><span class="s1">setY</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">camera</span><span class="s2">, -</span><span class="s1">MOUSE_ZOO_SPEED</span><span class="s2">)</span>

  <span class="s4">def </span><span class="s1">zoomIn</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
    <span class="s1">self</span><span class="s2">.</span><span class="s1">camera</span><span class="s2">.</span><span class="s1">setY</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">camera</span><span class="s2">,  </span><span class="s1">MOUSE_ZOOM_SPEED</span><span class="s2">)</span>

  <span class="s2">@</span><span class="s1">staticmethod</span>
  <span class="s4">def </span><span class="s1">make</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, </span><span class="s1">vpType </span><span class="s2">= </span><span class="s4">None</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot;Safe constructor that also takes CREATENEW, VPLEFT, VPTOP, etc.&quot;&quot;&quot;</span>
    <span class="s4">if </span><span class="s1">vpType </span><span class="s2">== </span><span class="s4">None or </span><span class="s1">vpType </span><span class="s2">== </span><span class="s1">CREATENEW</span><span class="s2">:</span>
      <span class="s4">return </span><span class="s1">Viewport</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">)</span>
    <span class="s4">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">vpType</span><span class="s2">, </span><span class="s1">Viewport</span><span class="s2">): </span><span class="s4">return </span><span class="s1">vpType</span>
    <span class="s4">if </span><span class="s1">vpType </span><span class="s2">== </span><span class="s1">VPLEFT</span><span class="s2">:  </span><span class="s4">return </span><span class="s1">Viewport</span><span class="s2">.</span><span class="s1">makeLeft</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">)</span>
    <span class="s4">if </span><span class="s1">vpType </span><span class="s2">== </span><span class="s1">VPFRONT</span><span class="s2">: </span><span class="s4">return </span><span class="s1">Viewport</span><span class="s2">.</span><span class="s1">makeFront</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">)</span>
    <span class="s4">if </span><span class="s1">vpType </span><span class="s2">== </span><span class="s1">VPTOP</span><span class="s2">:   </span><span class="s4">return </span><span class="s1">Viewport</span><span class="s2">.</span><span class="s1">makeTop</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">)</span>
    <span class="s4">if </span><span class="s1">vpType </span><span class="s2">== </span><span class="s1">VPPERSPECTIVE</span><span class="s2">:  </span><span class="s4">return </span><span class="s1">Viewport</span><span class="s2">.</span><span class="s1">makePerspective</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">)</span>
    <span class="s4">raise </span><span class="s1">TypeError</span><span class="s2">(</span><span class="s3">&quot;Unknown viewport type: %s&quot; </span><span class="s2">% </span><span class="s1">vpType</span><span class="s2">)</span>

  <span class="s2">@</span><span class="s1">staticmethod</span>
  <span class="s4">def </span><span class="s1">makeOrthographic</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">campos</span><span class="s2">):</span>
    <span class="s1">v </span><span class="s2">= </span><span class="s1">Viewport</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">)</span>
    <span class="s1">v</span><span class="s2">.</span><span class="s1">lens </span><span class="s2">= </span><span class="s1">OrthographicLens</span><span class="s2">()</span>
    <span class="s1">v</span><span class="s2">.</span><span class="s1">lens</span><span class="s2">.</span><span class="s1">setFilmSize</span><span class="s2">(</span><span class="s5">30</span><span class="s2">)</span>
    <span class="s1">v</span><span class="s2">.</span><span class="s1">camPos </span><span class="s2">= </span><span class="s1">campos</span>
    <span class="s1">v</span><span class="s2">.</span><span class="s1">camLookAt </span><span class="s2">= </span><span class="s1">Point3</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">v</span><span class="s2">.</span><span class="s1">grid </span><span class="s2">= </span><span class="s1">DirectGrid</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">=</span><span class="s1">render</span><span class="s2">)</span>
    <span class="s4">if </span><span class="s1">name </span><span class="s2">== </span><span class="s3">'left'</span><span class="s2">:</span>
      <span class="s1">v</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">.</span><span class="s1">setHpr</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">90</span><span class="s2">)</span>
      <span class="s1">collPlane </span><span class="s2">= </span><span class="s1">CollisionNode</span><span class="s2">(</span><span class="s3">'LeftGridCol'</span><span class="s2">)</span>
      <span class="s1">collPlane</span><span class="s2">.</span><span class="s1">addSolid</span><span class="s2">(</span><span class="s1">CollisionPlane</span><span class="s2">(</span><span class="s1">Plane</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)))</span>
      <span class="s1">collPlane</span><span class="s2">.</span><span class="s1">setIntoCollideMask</span><span class="s2">(</span><span class="s1">BitMask32</span><span class="s2">.</span><span class="s1">bit</span><span class="s2">(</span><span class="s5">21</span><span class="s2">))</span>
      <span class="s1">v</span><span class="s2">.</span><span class="s1">collPlane </span><span class="s2">= </span><span class="s1">NodePath</span><span class="s2">(</span><span class="s1">collPlane</span><span class="s2">)</span>
      <span class="s1">v</span><span class="s2">.</span><span class="s1">collPlane</span><span class="s2">.</span><span class="s1">wrtReparentTo</span><span class="s2">(</span><span class="s1">v</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">)</span>
      <span class="s6">#v.grid.gridBack.findAllMatches(&quot;**/+GeomNode&quot;)[0].setName(&quot;_leftViewGridBack&quot;)</span>
      <span class="s1">LE_showInOneCam</span><span class="s2">(</span><span class="s1">v</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)</span>
    <span class="s4">elif </span><span class="s1">name </span><span class="s2">== </span><span class="s3">'front'</span><span class="s2">:</span>
      <span class="s1">v</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">.</span><span class="s1">setHpr</span><span class="s2">(</span><span class="s5">90</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">90</span><span class="s2">)</span>
      <span class="s1">collPlane </span><span class="s2">= </span><span class="s1">CollisionNode</span><span class="s2">(</span><span class="s3">'FrontGridCol'</span><span class="s2">)</span>
      <span class="s1">collPlane</span><span class="s2">.</span><span class="s1">addSolid</span><span class="s2">(</span><span class="s1">CollisionPlane</span><span class="s2">(</span><span class="s1">Plane</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)))</span>
      <span class="s1">collPlane</span><span class="s2">.</span><span class="s1">setIntoCollideMask</span><span class="s2">(</span><span class="s1">BitMask32</span><span class="s2">.</span><span class="s1">bit</span><span class="s2">(</span><span class="s5">21</span><span class="s2">))</span>
      <span class="s1">v</span><span class="s2">.</span><span class="s1">collPlane </span><span class="s2">= </span><span class="s1">NodePath</span><span class="s2">(</span><span class="s1">collPlane</span><span class="s2">)</span>
      <span class="s1">v</span><span class="s2">.</span><span class="s1">collPlane</span><span class="s2">.</span><span class="s1">wrtReparentTo</span><span class="s2">(</span><span class="s1">v</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">)</span>
      <span class="s6">#v.grid.gridBack.findAllMatches(&quot;**/+GeomNode&quot;)[0].setName(&quot;_frontViewGridBack&quot;)</span>
      <span class="s1">LE_showInOneCam</span><span class="s2">(</span><span class="s1">v</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)</span>
    <span class="s4">else</span><span class="s2">:</span>
      <span class="s1">collPlane </span><span class="s2">= </span><span class="s1">CollisionNode</span><span class="s2">(</span><span class="s3">'TopGridCol'</span><span class="s2">)</span>
      <span class="s1">collPlane</span><span class="s2">.</span><span class="s1">addSolid</span><span class="s2">(</span><span class="s1">CollisionPlane</span><span class="s2">(</span><span class="s1">Plane</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)))</span>
      <span class="s1">collPlane</span><span class="s2">.</span><span class="s1">setIntoCollideMask</span><span class="s2">(</span><span class="s1">BitMask32</span><span class="s2">.</span><span class="s1">bit</span><span class="s2">(</span><span class="s5">21</span><span class="s2">))</span>
      <span class="s1">v</span><span class="s2">.</span><span class="s1">collPlane </span><span class="s2">= </span><span class="s1">NodePath</span><span class="s2">(</span><span class="s1">collPlane</span><span class="s2">)</span>
      <span class="s1">v</span><span class="s2">.</span><span class="s1">collPlane</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">v</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">)</span>
      <span class="s6">#v.grid.gridBack.findAllMatches(&quot;**/+GeomNode&quot;)[0].setName(&quot;_topViewGridBack&quot;)</span>
      <span class="s1">LE_showInOneCam</span><span class="s2">(</span><span class="s1">v</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)</span>
    <span class="s4">return </span><span class="s1">v</span>

  <span class="s2">@</span><span class="s1">staticmethod</span>
  <span class="s4">def </span><span class="s1">makePerspective</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">):</span>
    <span class="s1">v </span><span class="s2">= </span><span class="s1">Viewport</span><span class="s2">(</span><span class="s3">'persp'</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">)</span>
    <span class="s1">v</span><span class="s2">.</span><span class="s1">camPos </span><span class="s2">= </span><span class="s1">Point3</span><span class="s2">(-</span><span class="s5">19</span><span class="s2">, -</span><span class="s5">19</span><span class="s2">, </span><span class="s5">19</span><span class="s2">)</span>
    <span class="s1">v</span><span class="s2">.</span><span class="s1">camLookAt </span><span class="s2">= </span><span class="s1">Point3</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>

    <span class="s1">v</span><span class="s2">.</span><span class="s1">grid </span><span class="s2">= </span><span class="s1">DirectGrid</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">=</span><span class="s1">render</span><span class="s2">)</span>
    <span class="s1">collPlane </span><span class="s2">= </span><span class="s1">CollisionNode</span><span class="s2">(</span><span class="s3">'PerspGridCol'</span><span class="s2">)</span>
    <span class="s1">collPlane</span><span class="s2">.</span><span class="s1">addSolid</span><span class="s2">(</span><span class="s1">CollisionPlane</span><span class="s2">(</span><span class="s1">Plane</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)))</span>
    <span class="s6">#oldBitmask = collPlane.getIntoCollideMask()</span>
    <span class="s6">#collPlane.setIntoCollideMask(BitMask32.bit(21)|oldBitmask)</span>
    <span class="s1">collPlane</span><span class="s2">.</span><span class="s1">setIntoCollideMask</span><span class="s2">(</span><span class="s1">BitMask32</span><span class="s2">.</span><span class="s1">bit</span><span class="s2">(</span><span class="s5">21</span><span class="s2">))</span>
    <span class="s1">v</span><span class="s2">.</span><span class="s1">collPlane </span><span class="s2">= </span><span class="s1">NodePath</span><span class="s2">(</span><span class="s1">collPlane</span><span class="s2">)</span>
    <span class="s1">v</span><span class="s2">.</span><span class="s1">collPlane</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">v</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">)</span>

    <span class="s1">collPlane2 </span><span class="s2">= </span><span class="s1">CollisionNode</span><span class="s2">(</span><span class="s3">'PerspGridCol2'</span><span class="s2">)</span>
    <span class="s1">collPlane2</span><span class="s2">.</span><span class="s1">addSolid</span><span class="s2">(</span><span class="s1">CollisionPlane</span><span class="s2">(</span><span class="s1">Plane</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)))</span>
    <span class="s6">#oldBitmask = collPlane2.getIntoCollideMask()</span>
    <span class="s6">#collPlane2.setIntoCollideMask(BitMask32.bit(21)|oldBitmask)</span>
    <span class="s1">collPlane2</span><span class="s2">.</span><span class="s1">setIntoCollideMask</span><span class="s2">(</span><span class="s1">BitMask32</span><span class="s2">.</span><span class="s1">bit</span><span class="s2">(</span><span class="s5">21</span><span class="s2">))</span>
    <span class="s1">v</span><span class="s2">.</span><span class="s1">collPlane2 </span><span class="s2">= </span><span class="s1">NodePath</span><span class="s2">(</span><span class="s1">collPlane2</span><span class="s2">)</span>
    <span class="s1">v</span><span class="s2">.</span><span class="s1">collPlane2</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">v</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">)</span>

    <span class="s6">#v.grid.gridBack.findAllMatches(&quot;**/+GeomNode&quot;)[0].setName(&quot;_perspViewGridBack&quot;)</span>
    <span class="s1">LE_showInOneCam</span><span class="s2">(</span><span class="s1">v</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">, </span><span class="s3">'persp'</span><span class="s2">)</span>
    <span class="s4">return </span><span class="s1">v</span>

  <span class="s2">@</span><span class="s1">staticmethod</span>
  <span class="s4">def </span><span class="s1">makeLeft</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">): </span><span class="s4">return </span><span class="s1">Viewport</span><span class="s2">.</span><span class="s1">makeOrthographic</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, </span><span class="s3">'left'</span><span class="s2">, </span><span class="s1">Point3</span><span class="s2">(</span><span class="s5">600</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">))</span>
  <span class="s2">@</span><span class="s1">staticmethod</span>
  <span class="s4">def </span><span class="s1">makeFront</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">): </span><span class="s4">return </span><span class="s1">Viewport</span><span class="s2">.</span><span class="s1">makeOrthographic</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, </span><span class="s3">'front'</span><span class="s2">, </span><span class="s1">Point3</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">600</span><span class="s2">, </span><span class="s5">0</span><span class="s2">))</span>
  <span class="s2">@</span><span class="s1">staticmethod</span>
  <span class="s4">def </span><span class="s1">makeTop</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">): </span><span class="s4">return </span><span class="s1">Viewport</span><span class="s2">.</span><span class="s1">makeOrthographic</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, </span><span class="s3">'top'</span><span class="s2">, </span><span class="s1">Point3</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">600</span><span class="s2">))</span>

</pre>
</body>
</html>
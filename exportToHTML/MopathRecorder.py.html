<html>
<head>
<title>MopathRecorder.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #7a7e85;}
.s5 { color: #cf8e6d;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
MopathRecorder.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; Mopath Recorder Panel Module &quot;&quot;&quot;</span>

<span class="s1">__all__ </span><span class="s2">= [</span><span class="s3">'MopathRecorder'</span><span class="s2">]</span>

<span class="s4"># Import Tkinter, Pmw, and the dial code from this directory tree.</span>
<span class="s5">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s5">import </span><span class="s2">*</span>
<span class="s5">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">showbase </span><span class="s5">import </span><span class="s1">ShowBaseGlobal</span>
<span class="s5">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">showbase</span><span class="s2">.</span><span class="s1">DirectObject </span><span class="s5">import </span><span class="s1">DirectObject</span>
<span class="s5">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">showbase</span><span class="s2">.</span><span class="s1">TkGlobal </span><span class="s5">import </span><span class="s2">*</span>
<span class="s5">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">tkwidgets</span><span class="s2">.</span><span class="s1">AppShell </span><span class="s5">import </span><span class="s2">*</span>
<span class="s5">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">directtools</span><span class="s2">.</span><span class="s1">DirectGlobals </span><span class="s5">import </span><span class="s2">*</span>
<span class="s5">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">directtools</span><span class="s2">.</span><span class="s1">DirectUtil </span><span class="s5">import </span><span class="s2">*</span>
<span class="s5">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">directtools</span><span class="s2">.</span><span class="s1">DirectGeometry </span><span class="s5">import </span><span class="s2">*</span>
<span class="s5">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">directtools</span><span class="s2">.</span><span class="s1">DirectSelection </span><span class="s5">import </span><span class="s2">*</span>
<span class="s5">import </span><span class="s1">Pmw</span><span class="s2">, </span><span class="s1">os</span><span class="s2">, </span><span class="s1">sys</span>
<span class="s5">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">tkwidgets </span><span class="s5">import </span><span class="s1">Dial</span>
<span class="s5">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">tkwidgets </span><span class="s5">import </span><span class="s1">Floater</span>
<span class="s5">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">tkwidgets </span><span class="s5">import </span><span class="s1">Slider</span>
<span class="s5">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">tkwidgets </span><span class="s5">import </span><span class="s1">EntryScale</span>
<span class="s5">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">tkwidgets </span><span class="s5">import </span><span class="s1">VectorWidgets</span>

<span class="s5">if </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">version_info </span><span class="s2">&gt;= (</span><span class="s6">3</span><span class="s2">, </span><span class="s6">0</span><span class="s2">):</span>
    <span class="s5">from </span><span class="s1">tkinter</span><span class="s2">.</span><span class="s1">filedialog </span><span class="s5">import </span><span class="s2">*</span>
<span class="s5">else</span><span class="s2">:</span>
    <span class="s5">from </span><span class="s1">tkFileDialog </span><span class="s5">import </span><span class="s2">*</span>


<span class="s1">PRF_UTILITIES </span><span class="s2">= [</span>
    <span class="s3">'lambda: base.direct.camera.lookAt(render)'</span><span class="s2">,</span>
    <span class="s3">'lambda: base.direct.camera.setZ(render, 0.0)'</span><span class="s2">,</span>
    <span class="s3">'lambda s = self: s.playbackMarker.lookAt(render)'</span><span class="s2">,</span>
    <span class="s3">'lambda s = self: s.playbackMarker.setZ(render, 0.0)'</span><span class="s2">,</span>
    <span class="s3">'lambda s = self: s.followTerrain(10.0)'</span><span class="s2">]</span>

<span class="s5">class </span><span class="s1">MopathRecorder</span><span class="s2">(</span><span class="s1">AppShell</span><span class="s2">, </span><span class="s1">DirectObject</span><span class="s2">):</span>
    <span class="s4"># Override class variables here</span>
    <span class="s1">appname </span><span class="s2">= </span><span class="s3">'Mopath Recorder Panel'</span>
    <span class="s1">frameWidth      </span><span class="s2">= </span><span class="s6">450</span>
    <span class="s1">frameHeight     </span><span class="s2">= </span><span class="s6">550</span>
    <span class="s1">usecommandarea </span><span class="s2">= </span><span class="s6">0</span>
    <span class="s1">usestatusarea  </span><span class="s2">= </span><span class="s6">0</span>
    <span class="s1">count </span><span class="s2">= </span><span class="s6">0</span>

    <span class="s5">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">parent </span><span class="s2">= </span><span class="s5">None</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
        <span class="s1">INITOPT </span><span class="s2">= </span><span class="s1">Pmw</span><span class="s2">.</span><span class="s1">INITOPT</span>
        <span class="s1">name </span><span class="s2">= </span><span class="s3">'recorder-%d' </span><span class="s2">% </span><span class="s1">MopathRecorder</span><span class="s2">.</span><span class="s1">count</span>
        <span class="s1">MopathRecorder</span><span class="s2">.</span><span class="s1">count </span><span class="s2">+= </span><span class="s6">1</span>
        <span class="s1">optiondefs </span><span class="s2">= (</span>
            <span class="s2">(</span><span class="s3">'title'</span><span class="s2">,       </span><span class="s1">self</span><span class="s2">.</span><span class="s1">appname</span><span class="s2">,         </span><span class="s5">None</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">'nodePath'</span><span class="s2">,    </span><span class="s5">None</span><span class="s2">,                 </span><span class="s5">None</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">'name'</span><span class="s2">,        </span><span class="s1">name</span><span class="s2">,                 </span><span class="s5">None</span><span class="s2">)</span>
            <span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">defineoptions</span><span class="s2">(</span><span class="s1">kw</span><span class="s2">, </span><span class="s1">optiondefs</span><span class="s2">)</span>

        <span class="s4"># Call superclass initialization function</span>
        <span class="s1">AppShell</span><span class="s2">.</span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">initialiseoptions</span><span class="s2">(</span><span class="s1">MopathRecorder</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">selectNodePathNamed</span><span class="s2">(</span><span class="s3">'camera'</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">appInit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">self</span><span class="s2">[</span><span class="s3">'name'</span><span class="s2">]</span>
        <span class="s4"># Dictionary of widgets</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict </span><span class="s2">= {}</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">variableDict </span><span class="s2">= {}</span>
        <span class="s4"># Initialize state</span>
        <span class="s4"># The active node path</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath </span><span class="s2">= </span><span class="s1">self</span><span class="s2">[</span><span class="s3">'nodePath'</span><span class="s2">]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackNodePath </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span>
        <span class="s4"># The active node path's parent</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent </span><span class="s2">= </span><span class="s1">render</span>
        <span class="s4"># Top level node path</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">recorderNodePath </span><span class="s2">= </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">group</span><span class="s2">.</span><span class="s1">attachNewNode</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)</span>
        <span class="s4"># Temp CS for use in refinement/path extension</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tempCS </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recorderNodePath</span><span class="s2">.</span><span class="s1">attachNewNode</span><span class="s2">(</span>
            <span class="s3">'mopathRecorderTempCS'</span><span class="s2">)</span>
        <span class="s4"># Marker for use in playback</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker </span><span class="s2">= </span><span class="s1">loader</span><span class="s2">.</span><span class="s1">loadModel</span><span class="s2">(</span><span class="s3">'models/misc/smiley'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">setName</span><span class="s2">(</span><span class="s3">'Playback Marker'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recorderNodePath</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarkerIds </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getChildIds</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">getChild</span><span class="s2">(</span><span class="s6">0</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">()</span>
        <span class="s4"># Tangent marker</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentGroup </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">attachNewNode</span><span class="s2">(</span><span class="s3">'Tangent Group'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentGroup</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker </span><span class="s2">= </span><span class="s1">loader</span><span class="s2">.</span><span class="s1">loadModel</span><span class="s2">(</span><span class="s3">'models/misc/sphere'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tangentGroup</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker</span><span class="s2">.</span><span class="s1">setScale</span><span class="s2">(</span><span class="s6">0.5</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker</span><span class="s2">.</span><span class="s1">setColor</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker</span><span class="s2">.</span><span class="s1">setName</span><span class="s2">(</span><span class="s3">'Tangent Marker'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarkerIds </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getChildIds</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker</span><span class="s2">.</span><span class="s1">getChild</span><span class="s2">(</span><span class="s6">0</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentLines </span><span class="s2">= </span><span class="s1">LineNodePath</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tangentGroup</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentLines</span><span class="s2">.</span><span class="s1">setColor</span><span class="s2">(</span><span class="s1">VBase4</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentLines</span><span class="s2">.</span><span class="s1">setThickness</span><span class="s2">(</span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentLines</span><span class="s2">.</span><span class="s1">moveTo</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentLines</span><span class="s2">.</span><span class="s1">drawTo</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentLines</span><span class="s2">.</span><span class="s1">create</span><span class="s2">()</span>
        <span class="s4"># Active node path dictionary</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathDict </span><span class="s2">= {}</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathDict</span><span class="s2">[</span><span class="s3">'marker'</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathDict</span><span class="s2">[</span><span class="s3">'camera'</span><span class="s2">] = </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">camera</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathDict</span><span class="s2">[</span><span class="s3">'widget'</span><span class="s2">] = </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">widget</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathDict</span><span class="s2">[</span><span class="s3">'mopathRecorderTempCS'</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tempCS</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathNames </span><span class="s2">= [</span><span class="s3">'marker'</span><span class="s2">, </span><span class="s3">'camera'</span><span class="s2">, </span><span class="s3">'selected'</span><span class="s2">]</span>
        <span class="s4"># ID of selected object</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manipulandumId </span><span class="s2">= </span><span class="s5">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">trace </span><span class="s2">= </span><span class="s1">LineNodePath</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recorderNodePath</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">oldPlaybackNodePath </span><span class="s2">= </span><span class="s5">None</span>
        <span class="s4"># Count of point sets recorded</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">prePoints </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">postPoints </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">pointSetDict </span><span class="s2">= {}</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">pointSetCount </span><span class="s2">= </span><span class="s6">0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">pointSetName </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'-ps-' </span><span class="s2">+ </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSetCount</span><span class="s2">)</span>
        <span class="s4"># User callback to call before recording point</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">samplingMode </span><span class="s2">= </span><span class="s3">'Continuous'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">preRecordFunc </span><span class="s2">= </span><span class="s5">None</span>
        <span class="s4"># Hook to start/stop recording</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">startStopHook </span><span class="s2">= </span><span class="s3">'f6'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">keyframeHook </span><span class="s2">= </span><span class="s3">'f10'</span>
        <span class="s4"># Curve fitter object</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">lastPos </span><span class="s2">= </span><span class="s1">Point3</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter </span><span class="s2">= </span><span class="s1">CurveFitter</span><span class="s2">()</span>
        <span class="s4"># Curve variables</span>
        <span class="s4"># Number of ticks per parametric unit</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">numTicks </span><span class="s2">= </span><span class="s6">1</span>
        <span class="s4"># Number of segments to represent each parametric unit</span>
        <span class="s4"># This just affects the visual appearance of the curve</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">numSegs </span><span class="s2">= </span><span class="s6">40</span>
        <span class="s4"># The nurbs curves</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection </span><span class="s2">= </span><span class="s5">None</span>
        <span class="s4"># Curve drawers</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer </span><span class="s2">= </span><span class="s1">NurbsCurveDrawer</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setCurves</span><span class="s2">(</span><span class="s1">ParametricCurveCollection</span><span class="s2">())</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setNumSegs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">numSegs</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setShowHull</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setShowCvs</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setNumTicks</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setTickScale</span><span class="s2">(</span><span class="s6">5.0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveNodePath </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recorderNodePath</span><span class="s2">.</span><span class="s1">attachNewNode</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">getGeomNode</span><span class="s2">())</span>
        <span class="s1">useDirectRenderStyle</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveNodePath</span><span class="s2">)</span>
        <span class="s4"># Playback variables</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">maxT </span><span class="s2">= </span><span class="s6">0.0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackTime </span><span class="s2">= </span><span class="s6">0.0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">loopPlayback </span><span class="s2">= </span><span class="s6">1</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackSF </span><span class="s2">= </span><span class="s6">1.0</span>
        <span class="s4"># Sample variables</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">desampleFrequency </span><span class="s2">= </span><span class="s6">1</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">numSamples </span><span class="s2">= </span><span class="s6">100</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart </span><span class="s2">= </span><span class="s6">0.0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">deltaTime </span><span class="s2">= </span><span class="s6">0.0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart </span><span class="s2">= </span><span class="s6">0.0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">controlStop </span><span class="s2">= </span><span class="s6">0.0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop </span><span class="s2">= </span><span class="s6">0.0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cropFrom </span><span class="s2">= </span><span class="s6">0.0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cropTo </span><span class="s2">= </span><span class="s6">0.0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues </span><span class="s2">= </span><span class="s6">0</span>
        <span class="s4"># For terrain following</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">iRayCS </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recorderNodePath</span><span class="s2">.</span><span class="s1">attachNewNode</span><span class="s2">(</span>
            <span class="s3">'mopathRecorderIRayCS'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">iRay </span><span class="s2">= </span><span class="s1">SelectionRay</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">iRayCS</span><span class="s2">)</span>
        <span class="s4"># Set up event hooks</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">actionEvents </span><span class="s2">= [</span>
            <span class="s2">(</span><span class="s3">'DIRECT_undo'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">undoHook</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">'DIRECT_pushUndo'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pushUndoHook</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">'DIRECT_undoListEmpty'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">undoListEmptyHook</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">'DIRECT_redo'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">redoHook</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">'DIRECT_pushRedo'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pushRedoHook</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">'DIRECT_redoListEmpty'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">redoListEmptyHook</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">'DIRECT_selectedNodePath'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">selectedNodePathHook</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">'DIRECT_deselectedNodePath'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">deselectedNodePathHook</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">'DIRECT_manipulateObjectStart'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">manipulateObjectStartHook</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">'DIRECT_manipulateObjectCleanup'</span><span class="s2">,</span>
             <span class="s1">self</span><span class="s2">.</span><span class="s1">manipulateObjectCleanupHook</span><span class="s2">),</span>
            <span class="s2">]</span>
        <span class="s5">for </span><span class="s1">event</span><span class="s2">, </span><span class="s1">method </span><span class="s5">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">actionEvents</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">accept</span><span class="s2">(</span><span class="s1">event</span><span class="s2">, </span><span class="s1">method</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">createInterface</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">interior </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">interior</span><span class="s2">()</span>
        <span class="s4"># FILE MENU</span>
        <span class="s4"># Get a handle on the file menu so commands can be inserted</span>
        <span class="s4"># before quit item</span>
        <span class="s1">fileMenu </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuBar</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'File-menu'</span><span class="s2">)</span>
        <span class="s1">fileMenu</span><span class="s2">.</span><span class="s1">insert_command</span><span class="s2">(</span>
            <span class="s1">fileMenu</span><span class="s2">.</span><span class="s1">index</span><span class="s2">(</span><span class="s3">'Quit'</span><span class="s2">),</span>
            <span class="s1">label </span><span class="s2">= </span><span class="s3">'Load Curve'</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">loadCurveFromFile</span><span class="s2">)</span>
        <span class="s1">fileMenu</span><span class="s2">.</span><span class="s1">insert_command</span><span class="s2">(</span>
            <span class="s1">fileMenu</span><span class="s2">.</span><span class="s1">index</span><span class="s2">(</span><span class="s3">'Quit'</span><span class="s2">),</span>
            <span class="s1">label </span><span class="s2">= </span><span class="s3">'Save Curve'</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">saveCurveToFile</span><span class="s2">)</span>

        <span class="s4"># Add mopath recorder commands to menubar</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">menuBar</span><span class="s2">.</span><span class="s1">addmenu</span><span class="s2">(</span><span class="s3">'Recorder'</span><span class="s2">, </span><span class="s3">'Mopath Recorder Panel Operations'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">menuBar</span><span class="s2">.</span><span class="s1">addmenuitem</span><span class="s2">(</span>
            <span class="s3">'Recorder'</span><span class="s2">, </span><span class="s3">'command'</span><span class="s2">,</span>
            <span class="s3">'Save current curve as a new point set'</span><span class="s2">,</span>
            <span class="s1">label </span><span class="s2">= </span><span class="s3">'Save Point Set'</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">extractPointSetFromCurveCollection</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">menuBar</span><span class="s2">.</span><span class="s1">addmenuitem</span><span class="s2">(</span>
            <span class="s3">'Recorder'</span><span class="s2">, </span><span class="s3">'command'</span><span class="s2">,</span>
            <span class="s3">'Toggle widget visability'</span><span class="s2">,</span>
            <span class="s1">label </span><span class="s2">= </span><span class="s3">'Toggle Widget Vis'</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">toggleWidgetVis</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">menuBar</span><span class="s2">.</span><span class="s1">addmenuitem</span><span class="s2">(</span>
            <span class="s3">'Recorder'</span><span class="s2">, </span><span class="s3">'command'</span><span class="s2">,</span>
            <span class="s3">'Toggle widget manipulation mode'</span><span class="s2">,</span>
            <span class="s1">label </span><span class="s2">= </span><span class="s3">'Toggle Widget Mode'</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">manipulationControl</span><span class="s2">.</span><span class="s1">toggleObjectHandlesMode</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">createComboBox</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuFrame</span><span class="s2">, </span><span class="s3">'Mopath'</span><span class="s2">, </span><span class="s3">'History'</span><span class="s2">,</span>
                            <span class="s3">'Select input points to fit curve to'</span><span class="s2">, </span><span class="s3">''</span><span class="s2">,</span>
                            <span class="s1">self</span><span class="s2">.</span><span class="s1">selectPointSetNamed</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">undoButton </span><span class="s2">= </span><span class="s1">Button</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuFrame</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s3">'Undo'</span><span class="s2">,</span>
                                 <span class="s1">command </span><span class="s2">= </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">undo</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">undoList</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">undoButton</span><span class="s2">[</span><span class="s3">'state'</span><span class="s2">] = </span><span class="s3">'normal'</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">undoButton</span><span class="s2">[</span><span class="s3">'state'</span><span class="s2">] = </span><span class="s3">'disabled'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">undoButton</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">undoButton</span><span class="s2">, </span><span class="s3">'Undo last operation'</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">redoButton </span><span class="s2">= </span><span class="s1">Button</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">menuFrame</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s3">'Redo'</span><span class="s2">,</span>
                                 <span class="s1">command </span><span class="s2">= </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">redo</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">redoList</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">redoButton</span><span class="s2">[</span><span class="s3">'state'</span><span class="s2">] = </span><span class="s3">'normal'</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">redoButton</span><span class="s2">[</span><span class="s3">'state'</span><span class="s2">] = </span><span class="s3">'disabled'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">redoButton</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">redoButton</span><span class="s2">, </span><span class="s3">'Redo last operation'</span><span class="s2">)</span>

        <span class="s4"># Record button</span>
        <span class="s1">mainFrame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">interior</span><span class="s2">, </span><span class="s1">relief </span><span class="s2">= </span><span class="s1">SUNKEN</span><span class="s2">, </span><span class="s1">borderwidth </span><span class="s2">= </span><span class="s6">2</span><span class="s2">)</span>
        <span class="s1">frame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">mainFrame</span><span class="s2">)</span>
        <span class="s4"># Active node path</span>
        <span class="s4"># Button to select active node path</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createButton</span><span class="s2">(</span><span class="s1">frame</span><span class="s2">, </span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Node Path:'</span><span class="s2">,</span>
                                   <span class="s3">'Select Active Mopath Node Path'</span><span class="s2">,</span>
                                   <span class="s5">lambda </span><span class="s1">s </span><span class="s2">= </span><span class="s1">self</span><span class="s2">: </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">select</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">),</span>
                                   <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'relief'</span><span class="s2">] = </span><span class="s1">FLAT</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathMenu </span><span class="s2">= </span><span class="s1">Pmw</span><span class="s2">.</span><span class="s1">ComboBox</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s1">entry_width </span><span class="s2">= </span><span class="s6">20</span><span class="s2">,</span>
            <span class="s1">selectioncommand </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">selectNodePathNamed</span><span class="s2">,</span>
            <span class="s1">scrolledlist_items </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathNames</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathMenu</span><span class="s2">.</span><span class="s1">selectitem</span><span class="s2">(</span><span class="s3">'camera'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathMenuEntry </span><span class="s2">= (</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathMenu</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'entryfield_entry'</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathMenuBG </span><span class="s2">= (</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathMenuEntry</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s3">'background'</span><span class="s2">)[</span><span class="s6">3</span><span class="s2">])</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathMenu</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathMenu</span><span class="s2">,</span>
                  <span class="s3">'Select active node path used for recording and playback'</span><span class="s2">)</span>
        <span class="s4"># Recording type</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType </span><span class="s2">= </span><span class="s1">StringVar</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s3">'New Curve'</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createRadiobutton</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s3">'left'</span><span class="s2">,</span>
            <span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'New Curve'</span><span class="s2">,</span>
            <span class="s2">(</span><span class="s3">'Next record session records a new path'</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">, </span><span class="s3">'New Curve'</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createRadiobutton</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s3">'left'</span><span class="s2">,</span>
            <span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Refine'</span><span class="s2">,</span>
            <span class="s2">(</span><span class="s3">'Next record session refines existing path'</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">, </span><span class="s3">'Refine'</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createRadiobutton</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s3">'left'</span><span class="s2">,</span>
            <span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Extend'</span><span class="s2">,</span>
            <span class="s2">(</span><span class="s3">'Next record session extends existing path'</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">, </span><span class="s3">'Extend'</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">frame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>

        <span class="s1">frame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">mainFrame</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createCheckbutton</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Record'</span><span class="s2">,</span>
            <span class="s3">'On: path is being recorded'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">toggleRecord</span><span class="s2">, </span><span class="s6">0</span><span class="s2">,</span>
            <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">BOTH</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">foreground </span><span class="s2">= </span><span class="s3">'Red'</span><span class="s2">, </span><span class="s1">relief </span><span class="s2">= </span><span class="s1">RAISED</span><span class="s2">, </span><span class="s1">borderwidth </span><span class="s2">= </span><span class="s6">2</span><span class="s2">,</span>
                         <span class="s1">anchor </span><span class="s2">= </span><span class="s1">CENTER</span><span class="s2">, </span><span class="s1">width </span><span class="s2">= </span><span class="s6">16</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createButton</span><span class="s2">(</span><span class="s1">frame</span><span class="s2">, </span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Add Keyframe'</span><span class="s2">,</span>
                                   <span class="s3">'Add Keyframe To Current Path'</span><span class="s2">,</span>
                                   <span class="s1">self</span><span class="s2">.</span><span class="s1">addKeyframe</span><span class="s2">,</span>
                                   <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">frame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>

        <span class="s1">mainFrame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">pady </span><span class="s2">= </span><span class="s6">3</span><span class="s2">)</span>

        <span class="s4"># Playback controls</span>
        <span class="s1">playbackFrame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">interior</span><span class="s2">, </span><span class="s1">relief </span><span class="s2">= </span><span class="s1">SUNKEN</span><span class="s2">,</span>
                              <span class="s1">borderwidth </span><span class="s2">= </span><span class="s6">2</span><span class="s2">)</span>
        <span class="s1">Label</span><span class="s2">(</span><span class="s1">playbackFrame</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s3">'PLAYBACK CONTROLS'</span><span class="s2">,</span>
              <span class="s1">font</span><span class="s2">=(</span><span class="s3">'MSSansSerif'</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, </span><span class="s3">'bold'</span><span class="s2">)).</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>
        <span class="s4"># Main playback control slider</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createEntryScale</span><span class="s2">(</span>
            <span class="s1">playbackFrame</span><span class="s2">, </span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Time'</span><span class="s2">, </span><span class="s3">'Set current playback time'</span><span class="s2">,</span>
            <span class="s1">resolution </span><span class="s2">= </span><span class="s6">0.01</span><span class="s2">, </span><span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackGoTo</span><span class="s2">, </span><span class="s1">side </span><span class="s2">= </span><span class="s1">TOP</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'hull'</span><span class="s2">)[</span><span class="s3">'relief'</span><span class="s2">] = </span><span class="s1">RIDGE</span>
        <span class="s4"># Kill playback task if drag slider</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'preCallback'</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">stopPlayback</span>
        <span class="s4"># Jam duration entry into entry scale</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">createLabeledEntry</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">.</span><span class="s1">labelFrame</span><span class="s2">, </span><span class="s3">'Resample'</span><span class="s2">, </span><span class="s3">'Path Duration'</span><span class="s2">,</span>
                                <span class="s3">'Set total curve duration'</span><span class="s2">,</span>
                                <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setPathDuration</span><span class="s2">,</span>
                                <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s4"># Start stop buttons</span>
        <span class="s1">frame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">playbackFrame</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createButton</span><span class="s2">(</span><span class="s1">frame</span><span class="s2">, </span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'&lt;&lt;'</span><span class="s2">,</span>
                                   <span class="s3">'Jump to start of playback'</span><span class="s2">,</span>
                                   <span class="s1">self</span><span class="s2">.</span><span class="s1">jumpToStartOfPlayback</span><span class="s2">,</span>
                                   <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'font'</span><span class="s2">] = ((</span><span class="s3">'MSSansSerif'</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, </span><span class="s3">'bold'</span><span class="s2">))</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createCheckbutton</span><span class="s2">(</span><span class="s1">frame</span><span class="s2">, </span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Play'</span><span class="s2">,</span>
                                        <span class="s3">'Start/Stop playback'</span><span class="s2">,</span>
                                        <span class="s1">self</span><span class="s2">.</span><span class="s1">startStopPlayback</span><span class="s2">, </span><span class="s6">0</span><span class="s2">,</span>
                                        <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">BOTH</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">anchor </span><span class="s2">= </span><span class="s3">'center'</span><span class="s2">, </span><span class="s1">justify </span><span class="s2">= </span><span class="s3">'center'</span><span class="s2">,</span>
                         <span class="s1">relief </span><span class="s2">= </span><span class="s1">RAISED</span><span class="s2">, </span><span class="s1">font </span><span class="s2">= (</span><span class="s3">'MSSansSerif'</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, </span><span class="s3">'bold'</span><span class="s2">))</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createButton</span><span class="s2">(</span><span class="s1">frame</span><span class="s2">, </span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'&gt;&gt;'</span><span class="s2">,</span>
                                   <span class="s3">'Jump to end of playback'</span><span class="s2">,</span>
                                   <span class="s1">self</span><span class="s2">.</span><span class="s1">jumpToEndOfPlayback</span><span class="s2">,</span>
                                   <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'font'</span><span class="s2">] = ((</span><span class="s3">'MSSansSerif'</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, </span><span class="s3">'bold'</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">createCheckbutton</span><span class="s2">(</span><span class="s1">frame</span><span class="s2">, </span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Loop'</span><span class="s2">,</span>
                               <span class="s3">'On: loop playback'</span><span class="s2">,</span>
                               <span class="s1">self</span><span class="s2">.</span><span class="s1">setLoopPlayback</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">loopPlayback</span><span class="s2">,</span>
                               <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">BOTH</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">frame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>

        <span class="s4"># Speed control</span>
        <span class="s1">frame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">playbackFrame</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">Button</span><span class="s2">(</span><span class="s1">frame</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s3">'PB Speed Vernier'</span><span class="s2">, </span><span class="s1">relief </span><span class="s2">= </span><span class="s1">FLAT</span><span class="s2">,</span>
                        <span class="s1">command </span><span class="s2">= </span><span class="s5">lambda </span><span class="s1">s </span><span class="s2">= </span><span class="s1">self</span><span class="s2">: </span><span class="s1">s</span><span class="s2">.</span><span class="s1">setSpeedScale</span><span class="s2">(</span><span class="s6">1.0</span><span class="s2">))</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">speedScale </span><span class="s2">= </span><span class="s1">Scale</span><span class="s2">(</span><span class="s1">frame</span><span class="s2">, </span><span class="s1">from_ </span><span class="s2">= -</span><span class="s6">1</span><span class="s2">, </span><span class="s1">to </span><span class="s2">= </span><span class="s6">1</span><span class="s2">,</span>
                                <span class="s1">resolution </span><span class="s2">= </span><span class="s6">0.01</span><span class="s2">, </span><span class="s1">showvalue </span><span class="s2">= </span><span class="s6">0</span><span class="s2">,</span>
                                <span class="s1">width </span><span class="s2">= </span><span class="s6">10</span><span class="s2">, </span><span class="s1">orient </span><span class="s2">= </span><span class="s3">'horizontal'</span><span class="s2">,</span>
                                <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setPlaybackSF</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">speedScale</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">speedVar </span><span class="s2">= </span><span class="s1">StringVar</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">speedVar</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s3">&quot;0.00&quot;</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">speedEntry </span><span class="s2">= </span><span class="s1">Entry</span><span class="s2">(</span><span class="s1">frame</span><span class="s2">, </span><span class="s1">textvariable </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">speedVar</span><span class="s2">,</span>
                                <span class="s1">width </span><span class="s2">= </span><span class="s6">8</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">speedEntry</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span>
            <span class="s3">'&lt;Return&gt;'</span><span class="s2">,</span>
            <span class="s5">lambda </span><span class="s1">e </span><span class="s2">= </span><span class="s5">None</span><span class="s2">, </span><span class="s1">s </span><span class="s2">= </span><span class="s1">self</span><span class="s2">: </span><span class="s1">s</span><span class="s2">.</span><span class="s1">setSpeedScale</span><span class="s2">(</span>
            <span class="s1">float</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">speedVar</span><span class="s2">.</span><span class="s1">get</span><span class="s2">())))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">speedEntry</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">frame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>

        <span class="s1">playbackFrame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">pady </span><span class="s2">= </span><span class="s6">2</span><span class="s2">)</span>

        <span class="s4"># Create notebook pages</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">mainNotebook </span><span class="s2">= </span><span class="s1">Pmw</span><span class="s2">.</span><span class="s1">NoteBook</span><span class="s2">(</span><span class="s1">interior</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">mainNotebook</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">BOTH</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">resamplePage </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mainNotebook</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s3">'Resample'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">refinePage </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mainNotebook</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s3">'Refine'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">extendPage </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mainNotebook</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s3">'Extend'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cropPage </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mainNotebook</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s3">'Crop'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">drawPage </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mainNotebook</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s3">'Draw'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">optionsPage </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mainNotebook</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s3">'Options'</span><span class="s2">)</span>

        <span class="s4">## RESAMPLE PAGE</span>
        <span class="s1">label </span><span class="s2">= </span><span class="s1">Label</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">resamplePage</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s3">'RESAMPLE CURVE'</span><span class="s2">,</span>
                      <span class="s1">font</span><span class="s2">=(</span><span class="s3">'MSSansSerif'</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, </span><span class="s3">'bold'</span><span class="s2">))</span>
        <span class="s1">label</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>

        <span class="s4"># Resample</span>
        <span class="s1">resampleFrame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">resamplePage</span><span class="s2">, </span><span class="s1">relief </span><span class="s2">= </span><span class="s1">SUNKEN</span><span class="s2">, </span><span class="s1">borderwidth </span><span class="s2">= </span><span class="s6">2</span><span class="s2">)</span>
        <span class="s1">label </span><span class="s2">= </span><span class="s1">Label</span><span class="s2">(</span><span class="s1">resampleFrame</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s3">'RESAMPLE CURVE'</span><span class="s2">,</span>
                      <span class="s1">font</span><span class="s2">=(</span><span class="s3">'MSSansSerif'</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, </span><span class="s3">'bold'</span><span class="s2">)).</span><span class="s1">pack</span><span class="s2">()</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createSlider</span><span class="s2">(</span>
            <span class="s1">resampleFrame</span><span class="s2">, </span><span class="s3">'Resample'</span><span class="s2">, </span><span class="s3">'Num. Samples'</span><span class="s2">,</span>
            <span class="s3">'Number of samples in resampled curve'</span><span class="s2">,</span>
            <span class="s1">resolution </span><span class="s2">= </span><span class="s6">1</span><span class="s2">, </span><span class="s1">min </span><span class="s2">= </span><span class="s6">2</span><span class="s2">, </span><span class="s1">max </span><span class="s2">= </span><span class="s6">1000</span><span class="s2">, </span><span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setNumSamples</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'hull'</span><span class="s2">)[</span><span class="s3">'relief'</span><span class="s2">] = </span><span class="s1">RIDGE</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'postCallback'</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">sampleCurve</span>

        <span class="s1">frame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">resampleFrame</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">createButton</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s3">'Resample'</span><span class="s2">, </span><span class="s3">'Make Even'</span><span class="s2">,</span>
            <span class="s3">'Apply timewarp so resulting path has constant velocity'</span><span class="s2">,</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">makeEven</span><span class="s2">, </span><span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">createButton</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s3">'Resample'</span><span class="s2">, </span><span class="s3">'Face Forward'</span><span class="s2">,</span>
            <span class="s3">'Compute HPR so resulting hpr curve faces along xyz tangent'</span><span class="s2">,</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">faceForward</span><span class="s2">, </span><span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">frame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">resampleFrame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">, </span><span class="s1">pady </span><span class="s2">= </span><span class="s6">2</span><span class="s2">)</span>

        <span class="s4"># Desample</span>
        <span class="s1">desampleFrame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">resamplePage</span><span class="s2">, </span><span class="s1">relief </span><span class="s2">= </span><span class="s1">SUNKEN</span><span class="s2">, </span><span class="s1">borderwidth </span><span class="s2">= </span><span class="s6">2</span><span class="s2">)</span>
        <span class="s1">Label</span><span class="s2">(</span><span class="s1">desampleFrame</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s3">'DESAMPLE CURVE'</span><span class="s2">,</span>
              <span class="s1">font</span><span class="s2">=(</span><span class="s3">'MSSansSerif'</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, </span><span class="s3">'bold'</span><span class="s2">)).</span><span class="s1">pack</span><span class="s2">()</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createSlider</span><span class="s2">(</span>
            <span class="s1">desampleFrame</span><span class="s2">, </span><span class="s3">'Resample'</span><span class="s2">, </span><span class="s3">'Points Between Samples'</span><span class="s2">,</span>
            <span class="s3">'Specify number of points to skip between samples'</span><span class="s2">,</span>
            <span class="s1">min </span><span class="s2">= </span><span class="s6">1</span><span class="s2">, </span><span class="s1">max </span><span class="s2">= </span><span class="s6">100</span><span class="s2">, </span><span class="s1">resolution </span><span class="s2">= </span><span class="s6">1</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setDesampleFrequency</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'hull'</span><span class="s2">)[</span><span class="s3">'relief'</span><span class="s2">] = </span><span class="s1">RIDGE</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'postCallback'</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">desampleCurve</span>
        <span class="s1">desampleFrame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">, </span><span class="s1">pady </span><span class="s2">= </span><span class="s6">2</span><span class="s2">)</span>

        <span class="s4">## REFINE PAGE ##</span>
        <span class="s1">refineFrame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">refinePage</span><span class="s2">, </span><span class="s1">relief </span><span class="s2">= </span><span class="s1">SUNKEN</span><span class="s2">,</span>
                            <span class="s1">borderwidth </span><span class="s2">= </span><span class="s6">2</span><span class="s2">)</span>
        <span class="s1">label </span><span class="s2">= </span><span class="s1">Label</span><span class="s2">(</span><span class="s1">refineFrame</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s3">'REFINE CURVE'</span><span class="s2">,</span>
                      <span class="s1">font</span><span class="s2">=(</span><span class="s3">'MSSansSerif'</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, </span><span class="s3">'bold'</span><span class="s2">))</span>
        <span class="s1">label</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>

        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createSlider</span><span class="s2">(</span><span class="s1">refineFrame</span><span class="s2">,</span>
                                       <span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Refine From'</span><span class="s2">,</span>
                                       <span class="s3">'Begin time of refine pass'</span><span class="s2">,</span>
                                       <span class="s1">resolution </span><span class="s2">= </span><span class="s6">0.01</span><span class="s2">,</span>
                                       <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setRecordStart</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'preCallback'</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setRefineMode</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'postCallback'</span><span class="s2">] = </span><span class="s5">lambda </span><span class="s1">s </span><span class="s2">= </span><span class="s1">self</span><span class="s2">: </span><span class="s1">s</span><span class="s2">.</span><span class="s1">getPrePoints</span><span class="s2">(</span><span class="s3">'Refine'</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createSlider</span><span class="s2">(</span>
            <span class="s1">refineFrame</span><span class="s2">, </span><span class="s3">'Refine Page'</span><span class="s2">,</span>
            <span class="s3">'Control Start'</span><span class="s2">,</span>
            <span class="s3">'Time when full control of node path is given during refine pass'</span><span class="s2">,</span>
            <span class="s1">resolution </span><span class="s2">= </span><span class="s6">0.01</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setControlStart</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'preCallback'</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setRefineMode</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createSlider</span><span class="s2">(</span>
            <span class="s1">refineFrame</span><span class="s2">, </span><span class="s3">'Refine Page'</span><span class="s2">,</span>
            <span class="s3">'Control Stop'</span><span class="s2">,</span>
            <span class="s3">'Time when node path begins transition back to original curve'</span><span class="s2">,</span>
            <span class="s1">resolution </span><span class="s2">= </span><span class="s6">0.01</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setControlStop</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'preCallback'</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setRefineMode</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createSlider</span><span class="s2">(</span><span class="s1">refineFrame</span><span class="s2">, </span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Refine To'</span><span class="s2">,</span>
                                       <span class="s3">'Stop time of refine pass'</span><span class="s2">,</span>
                                       <span class="s1">resolution </span><span class="s2">= </span><span class="s6">0.01</span><span class="s2">,</span>
                                       <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setRefineStop</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'preCallback'</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setRefineMode</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'postCallback'</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getPostPoints</span>
        <span class="s1">refineFrame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>

        <span class="s4">## EXTEND PAGE ##</span>
        <span class="s1">extendFrame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">extendPage</span><span class="s2">, </span><span class="s1">relief </span><span class="s2">= </span><span class="s1">SUNKEN</span><span class="s2">,</span>
                            <span class="s1">borderwidth </span><span class="s2">= </span><span class="s6">2</span><span class="s2">)</span>
        <span class="s1">label </span><span class="s2">= </span><span class="s1">Label</span><span class="s2">(</span><span class="s1">extendFrame</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s3">'EXTEND CURVE'</span><span class="s2">,</span>
                      <span class="s1">font</span><span class="s2">=(</span><span class="s3">'MSSansSerif'</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, </span><span class="s3">'bold'</span><span class="s2">))</span>
        <span class="s1">label</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>

        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createSlider</span><span class="s2">(</span><span class="s1">extendFrame</span><span class="s2">,</span>
                                       <span class="s3">'Extend Page'</span><span class="s2">, </span><span class="s3">'Extend From'</span><span class="s2">,</span>
                                       <span class="s3">'Begin time of extend pass'</span><span class="s2">,</span>
                                       <span class="s1">resolution </span><span class="s2">= </span><span class="s6">0.01</span><span class="s2">,</span>
                                       <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setRecordStart</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'preCallback'</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setExtendMode</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'postCallback'</span><span class="s2">] = </span><span class="s5">lambda </span><span class="s1">s </span><span class="s2">= </span><span class="s1">self</span><span class="s2">: </span><span class="s1">s</span><span class="s2">.</span><span class="s1">getPrePoints</span><span class="s2">(</span><span class="s3">'Extend'</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createSlider</span><span class="s2">(</span>
            <span class="s1">extendFrame</span><span class="s2">, </span><span class="s3">'Extend Page'</span><span class="s2">,</span>
            <span class="s3">'Control Start'</span><span class="s2">,</span>
            <span class="s3">'Time when full control of node path is given during extend pass'</span><span class="s2">,</span>
            <span class="s1">resolution </span><span class="s2">= </span><span class="s6">0.01</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setControlStart</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'preCallback'</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setExtendMode</span>
        <span class="s1">extendFrame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>

        <span class="s4">## CROP PAGE ##</span>
        <span class="s1">cropFrame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">cropPage</span><span class="s2">, </span><span class="s1">relief </span><span class="s2">= </span><span class="s1">SUNKEN</span><span class="s2">,</span>
                            <span class="s1">borderwidth </span><span class="s2">= </span><span class="s6">2</span><span class="s2">)</span>
        <span class="s1">label </span><span class="s2">= </span><span class="s1">Label</span><span class="s2">(</span><span class="s1">cropFrame</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s3">'CROP CURVE'</span><span class="s2">,</span>
                      <span class="s1">font</span><span class="s2">=(</span><span class="s3">'MSSansSerif'</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, </span><span class="s3">'bold'</span><span class="s2">))</span>
        <span class="s1">label</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>

        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createSlider</span><span class="s2">(</span>
            <span class="s1">cropFrame</span><span class="s2">,</span>
            <span class="s3">'Crop Page'</span><span class="s2">, </span><span class="s3">'Crop From'</span><span class="s2">,</span>
            <span class="s3">'Delete all curve points before this time'</span><span class="s2">,</span>
            <span class="s1">resolution </span><span class="s2">= </span><span class="s6">0.01</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setCropFrom</span><span class="s2">)</span>

        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createSlider</span><span class="s2">(</span>
            <span class="s1">cropFrame</span><span class="s2">,</span>
            <span class="s3">'Crop Page'</span><span class="s2">, </span><span class="s3">'Crop To'</span><span class="s2">,</span>
            <span class="s3">'Delete all curve points after this time'</span><span class="s2">,</span>
            <span class="s1">resolution </span><span class="s2">= </span><span class="s6">0.01</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setCropTo</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">createButton</span><span class="s2">(</span><span class="s1">cropFrame</span><span class="s2">, </span><span class="s3">'Crop Page'</span><span class="s2">, </span><span class="s3">'Crop Curve'</span><span class="s2">,</span>
                          <span class="s3">'Crop curve to specified from to times'</span><span class="s2">,</span>
                          <span class="s1">self</span><span class="s2">.</span><span class="s1">cropCurve</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">NONE</span><span class="s2">)</span>
        <span class="s1">cropFrame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>

        <span class="s4">## DRAW PAGE ##</span>
        <span class="s1">drawFrame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">drawPage</span><span class="s2">, </span><span class="s1">relief </span><span class="s2">= </span><span class="s1">SUNKEN</span><span class="s2">,</span>
                           <span class="s1">borderwidth </span><span class="s2">= </span><span class="s6">2</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">sf </span><span class="s2">= </span><span class="s1">Pmw</span><span class="s2">.</span><span class="s1">ScrolledFrame</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">drawPage</span><span class="s2">, </span><span class="s1">horizflex </span><span class="s2">= </span><span class="s3">'elastic'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">sf</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s3">'both'</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">sfFrame </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">sf</span><span class="s2">.</span><span class="s1">interior</span><span class="s2">()</span>

        <span class="s1">label </span><span class="s2">= </span><span class="s1">Label</span><span class="s2">(</span><span class="s1">sfFrame</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s3">'CURVE RENDERING STYLE'</span><span class="s2">,</span>
                      <span class="s1">font</span><span class="s2">=(</span><span class="s3">'MSSansSerif'</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, </span><span class="s3">'bold'</span><span class="s2">))</span>
        <span class="s1">label</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>

        <span class="s1">frame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">sfFrame</span><span class="s2">)</span>
        <span class="s1">Label</span><span class="s2">(</span><span class="s1">frame</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s3">'SHOW:'</span><span class="s2">).</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createCheckbutton</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Path'</span><span class="s2">,</span>
            <span class="s3">'On: path is visible'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setPathVis</span><span class="s2">, </span><span class="s6">1</span><span class="s2">,</span>
            <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createCheckbutton</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Knots'</span><span class="s2">,</span>
            <span class="s3">'On: path knots are visible'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setKnotVis</span><span class="s2">, </span><span class="s6">1</span><span class="s2">,</span>
            <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createCheckbutton</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'CVs'</span><span class="s2">,</span>
            <span class="s3">'On: path CVs are visible'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setCvVis</span><span class="s2">, </span><span class="s6">0</span><span class="s2">,</span>
            <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createCheckbutton</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Hull'</span><span class="s2">,</span>
            <span class="s3">'On: path hull is visible'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setHullVis</span><span class="s2">, </span><span class="s6">0</span><span class="s2">,</span>
            <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createCheckbutton</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Trace'</span><span class="s2">,</span>
            <span class="s3">'On: record is visible'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setTraceVis</span><span class="s2">, </span><span class="s6">0</span><span class="s2">,</span>
            <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createCheckbutton</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Marker'</span><span class="s2">,</span>
            <span class="s3">'On: playback marker is visible'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setMarkerVis</span><span class="s2">, </span><span class="s6">0</span><span class="s2">,</span>
            <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">frame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s4"># Sliders</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createSlider</span><span class="s2">(</span>
            <span class="s1">sfFrame</span><span class="s2">, </span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Num Segs'</span><span class="s2">,</span>
            <span class="s3">'Set number of segments used to approximate each parametric unit'</span><span class="s2">,</span>
            <span class="s1">min </span><span class="s2">= </span><span class="s6">1.0</span><span class="s2">, </span><span class="s1">max </span><span class="s2">= </span><span class="s6">400</span><span class="s2">, </span><span class="s1">resolution </span><span class="s2">= </span><span class="s6">1.0</span><span class="s2">,</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s6">40</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setNumSegs</span><span class="s2">, </span><span class="s1">side </span><span class="s2">= </span><span class="s1">TOP</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'hull'</span><span class="s2">)[</span><span class="s3">'relief'</span><span class="s2">] = </span><span class="s1">RIDGE</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createSlider</span><span class="s2">(</span>
            <span class="s1">sfFrame</span><span class="s2">, </span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Num Ticks'</span><span class="s2">,</span>
            <span class="s3">'Set number of tick marks drawn for each unit of time'</span><span class="s2">,</span>
            <span class="s1">min </span><span class="s2">= </span><span class="s6">0.0</span><span class="s2">, </span><span class="s1">max </span><span class="s2">= </span><span class="s6">10.0</span><span class="s2">, </span><span class="s1">resolution </span><span class="s2">= </span><span class="s6">1.0</span><span class="s2">,</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s6">0.0</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setNumTicks</span><span class="s2">, </span><span class="s1">side </span><span class="s2">= </span><span class="s1">TOP</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'hull'</span><span class="s2">)[</span><span class="s3">'relief'</span><span class="s2">] = </span><span class="s1">RIDGE</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createSlider</span><span class="s2">(</span>
            <span class="s1">sfFrame</span><span class="s2">, </span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Tick Scale'</span><span class="s2">,</span>
            <span class="s3">'Set visible size of time tick marks'</span><span class="s2">,</span>
            <span class="s1">min </span><span class="s2">= </span><span class="s6">0.01</span><span class="s2">, </span><span class="s1">max </span><span class="s2">= </span><span class="s6">100.0</span><span class="s2">, </span><span class="s1">resolution </span><span class="s2">= </span><span class="s6">0.01</span><span class="s2">,</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s6">5.0</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setTickScale</span><span class="s2">, </span><span class="s1">side </span><span class="s2">= </span><span class="s1">TOP</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'hull'</span><span class="s2">)[</span><span class="s3">'relief'</span><span class="s2">] = </span><span class="s1">RIDGE</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">createColorEntry</span><span class="s2">(</span>
            <span class="s1">sfFrame</span><span class="s2">, </span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Path Color'</span><span class="s2">,</span>
            <span class="s3">'Color of curve'</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setPathColor</span><span class="s2">,</span>
            <span class="s1">value </span><span class="s2">= [</span><span class="s6">255.0</span><span class="s2">, </span><span class="s6">255.0</span><span class="s2">, </span><span class="s6">255.0</span><span class="s2">, </span><span class="s6">255.0</span><span class="s2">])</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">createColorEntry</span><span class="s2">(</span>
            <span class="s1">sfFrame</span><span class="s2">, </span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Knot Color'</span><span class="s2">,</span>
            <span class="s3">'Color of knots'</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setKnotColor</span><span class="s2">,</span>
            <span class="s1">value </span><span class="s2">= [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">255.0</span><span class="s2">, </span><span class="s6">255.0</span><span class="s2">])</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">createColorEntry</span><span class="s2">(</span>
            <span class="s1">sfFrame</span><span class="s2">, </span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'CV Color'</span><span class="s2">,</span>
            <span class="s3">'Color of CVs'</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setCvColor</span><span class="s2">,</span>
            <span class="s1">value </span><span class="s2">= [</span><span class="s6">255.0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">255.0</span><span class="s2">])</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">createColorEntry</span><span class="s2">(</span>
            <span class="s1">sfFrame</span><span class="s2">, </span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Tick Color'</span><span class="s2">,</span>
            <span class="s3">'Color of Ticks'</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setTickColor</span><span class="s2">,</span>
            <span class="s1">value </span><span class="s2">= [</span><span class="s6">255.0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">255.0</span><span class="s2">])</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">createColorEntry</span><span class="s2">(</span>
            <span class="s1">sfFrame</span><span class="s2">, </span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Hull Color'</span><span class="s2">,</span>
            <span class="s3">'Color of Hull'</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setHullColor</span><span class="s2">,</span>
            <span class="s1">value </span><span class="s2">= [</span><span class="s6">255.0</span><span class="s2">, </span><span class="s6">128.0</span><span class="s2">, </span><span class="s6">128.0</span><span class="s2">, </span><span class="s6">255.0</span><span class="s2">])</span>

        <span class="s4">#drawFrame.pack(fill = X)</span>

        <span class="s4">## OPTIONS PAGE ##</span>
        <span class="s1">optionsFrame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">optionsPage</span><span class="s2">, </span><span class="s1">relief </span><span class="s2">= </span><span class="s1">SUNKEN</span><span class="s2">,</span>
                            <span class="s1">borderwidth </span><span class="s2">= </span><span class="s6">2</span><span class="s2">)</span>
        <span class="s1">label </span><span class="s2">= </span><span class="s1">Label</span><span class="s2">(</span><span class="s1">optionsFrame</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s3">'RECORDING OPTIONS'</span><span class="s2">,</span>
                      <span class="s1">font</span><span class="s2">=(</span><span class="s3">'MSSansSerif'</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, </span><span class="s3">'bold'</span><span class="s2">))</span>
        <span class="s1">label</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>
        <span class="s4"># Hooks</span>
        <span class="s1">frame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">optionsFrame</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createLabeledEntry</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Record Hook'</span><span class="s2">,</span>
            <span class="s3">'Hook used to start/stop recording'</span><span class="s2">,</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">startStopHook</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setStartStopHook</span><span class="s2">)[</span><span class="s6">0</span><span class="s2">]</span>
        <span class="s1">label </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Record Hook-Label'</span><span class="s2">)</span>
        <span class="s1">label</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">width </span><span class="s2">= </span><span class="s6">16</span><span class="s2">, </span><span class="s1">anchor </span><span class="s2">= </span><span class="s1">W</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setStartStopHook</span><span class="s2">()</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createLabeledEntry</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Keyframe Hook'</span><span class="s2">,</span>
            <span class="s3">'Hook used to add a new keyframe'</span><span class="s2">,</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">keyframeHook</span><span class="s2">,</span>
            <span class="s1">command </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setKeyframeHook</span><span class="s2">)[</span><span class="s6">0</span><span class="s2">]</span>
        <span class="s1">label </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Keyframe Hook-Label'</span><span class="s2">)</span>
        <span class="s1">label</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">width </span><span class="s2">= </span><span class="s6">16</span><span class="s2">, </span><span class="s1">anchor </span><span class="s2">= </span><span class="s1">W</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setKeyframeHook</span><span class="s2">()</span>
        <span class="s1">frame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>
        <span class="s4"># PreRecordFunc</span>
        <span class="s1">frame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">optionsFrame</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createComboBox</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">, </span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Pre-Record Func'</span><span class="s2">,</span>
            <span class="s3">'Function called before sampling each point'</span><span class="s2">,</span>
            <span class="s1">PRF_UTILITIES</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">setPreRecordFunc</span><span class="s2">,</span>
            <span class="s1">history </span><span class="s2">= </span><span class="s6">1</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">label_width </span><span class="s2">= </span><span class="s6">16</span><span class="s2">, </span><span class="s1">label_anchor </span><span class="s2">= </span><span class="s1">W</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">entryfield_entry_state </span><span class="s2">= </span><span class="s3">'normal'</span><span class="s2">)</span>
        <span class="s4"># Initialize preRecordFunc</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">preRecordFunc </span><span class="s2">= </span><span class="s1">eval</span><span class="s2">(</span><span class="s1">PRF_UTILITIES</span><span class="s2">[</span><span class="s6">0</span><span class="s2">])</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">createCheckbutton</span><span class="s2">(</span><span class="s1">frame</span><span class="s2">, </span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'PRF Active'</span><span class="s2">,</span>
                               <span class="s3">'On: Pre Record Func enabled'</span><span class="s2">,</span>
                               <span class="s5">None</span><span class="s2">, </span><span class="s6">0</span><span class="s2">,</span>
                               <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">BOTH</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">frame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>
        <span class="s4"># Pack record frame</span>
        <span class="s1">optionsFrame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">pady </span><span class="s2">= </span><span class="s6">2</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">mainNotebook</span><span class="s2">.</span><span class="s1">setnaturalsize</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">pushUndo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fResetRedo </span><span class="s2">= </span><span class="s6">1</span><span class="s2">):</span>
        <span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">pushUndo</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">])</span>

    <span class="s5">def </span><span class="s1">undoHook</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">nodePathList </span><span class="s2">= []):</span>
        <span class="s4"># Reflect new changes</span>
        <span class="s5">pass</span>

    <span class="s5">def </span><span class="s1">pushUndoHook</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Make sure button is reactivated</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">undoButton</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'normal'</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">undoListEmptyHook</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Make sure button is deactivated</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">undoButton</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'disabled'</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">pushRedo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">pushRedo</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">])</span>

    <span class="s5">def </span><span class="s1">redoHook</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">nodePathList </span><span class="s2">= []):</span>
        <span class="s4"># Reflect new changes</span>
        <span class="s5">pass</span>

    <span class="s5">def </span><span class="s1">pushRedoHook</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Make sure button is reactivated</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">redoButton</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'normal'</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">redoListEmptyHook</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Make sure button is deactivated</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">redoButton</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'disabled'</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">selectedNodePathHook</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">nodePath</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Hook called upon selection of a node path used to select playback 
        marker if subnode selected 
        &quot;&quot;&quot;</span>
        <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'-curveEditTask'</span><span class="s2">)</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">getKey</span><span class="s2">())</span>
        <span class="s5">if </span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">id</span><span class="s2">() </span><span class="s5">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarkerIds</span><span class="s2">:</span>
            <span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">select</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">)</span>
        <span class="s5">elif </span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">id</span><span class="s2">() </span><span class="s5">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarkerIds</span><span class="s2">:</span>
            <span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">select</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker</span><span class="s2">)</span>
        <span class="s5">elif </span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">id</span><span class="s2">() == </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">id</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentGroup</span><span class="s2">.</span><span class="s1">show</span><span class="s2">()</span>
            <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveEditTask</span><span class="s2">,</span>
                                     <span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'-curveEditTask'</span><span class="s2">)</span>
        <span class="s5">elif </span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">id</span><span class="s2">() == </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker</span><span class="s2">.</span><span class="s1">id</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentGroup</span><span class="s2">.</span><span class="s1">show</span><span class="s2">()</span>
            <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveEditTask</span><span class="s2">,</span>
                                     <span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'-curveEditTask'</span><span class="s2">)</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentGroup</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">getChildIds</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">nodePath</span><span class="s2">):</span>
        <span class="s1">ids </span><span class="s2">= [</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">id</span><span class="s2">()]</span>
        <span class="s1">kids </span><span class="s2">= </span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">getChildren</span><span class="s2">()</span>
        <span class="s5">for </span><span class="s1">kid </span><span class="s5">in </span><span class="s1">kids</span><span class="s2">:</span>
            <span class="s1">ids </span><span class="s2">+= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getChildIds</span><span class="s2">(</span><span class="s1">kid</span><span class="s2">)</span>
        <span class="s5">return </span><span class="s1">ids</span>

    <span class="s5">def </span><span class="s1">deselectedNodePathHook</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">nodePath</span><span class="s2">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Hook called upon deselection of a node path used to select playback 
        marker if subnode selected 
        &quot;&quot;&quot;</span>
        <span class="s5">if </span><span class="s2">((</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">id</span><span class="s2">() == </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">id</span><span class="s2">()) </span><span class="s5">or</span>
            <span class="s2">(</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">id</span><span class="s2">() == </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker</span><span class="s2">.</span><span class="s1">id</span><span class="s2">())):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentGroup</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">curveEditTask</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">state</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection </span><span class="s2">!= </span><span class="s5">None</span><span class="s2">:</span>
            <span class="s4"># Update curve position</span>
            <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">manipulandumId </span><span class="s2">== </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">id</span><span class="s2">():</span>
                <span class="s4"># Show playback marker</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">getChild</span><span class="s2">(</span><span class="s6">0</span><span class="s2">).</span><span class="s1">show</span><span class="s2">()</span>
                <span class="s1">pos </span><span class="s2">= </span><span class="s1">Point3</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
                <span class="s1">hpr </span><span class="s2">= </span><span class="s1">Point3</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
                <span class="s1">pos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">getPos</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">)</span>
                <span class="s1">hpr </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">getHpr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">adjustXyz</span><span class="s2">(</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackTime</span><span class="s2">, </span><span class="s1">VBase3</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">pos</span><span class="s2">[</span><span class="s6">1</span><span class="s2">], </span><span class="s1">pos</span><span class="s2">[</span><span class="s6">2</span><span class="s2">]))</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">adjustHpr</span><span class="s2">(</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackTime</span><span class="s2">, </span><span class="s1">VBase3</span><span class="s2">(</span><span class="s1">hpr</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">hpr</span><span class="s2">[</span><span class="s6">1</span><span class="s2">], </span><span class="s1">hpr</span><span class="s2">[</span><span class="s6">2</span><span class="s2">]))</span>
                <span class="s4"># Note: this calls recompute on the curves</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
            <span class="s4"># Update tangent</span>
            <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">manipulandumId </span><span class="s2">== </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker</span><span class="s2">.</span><span class="s1">id</span><span class="s2">():</span>
                <span class="s4"># If manipulating marker, update tangent</span>
                <span class="s4"># Hide playback marker</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">getChild</span><span class="s2">(</span><span class="s6">0</span><span class="s2">).</span><span class="s1">hide</span><span class="s2">()</span>
                <span class="s4"># Where is tangent marker relative to playback marker</span>
                <span class="s1">tan </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker</span><span class="s2">.</span><span class="s1">getPos</span><span class="s2">()</span>
                <span class="s4"># Transform this vector to curve space</span>
                <span class="s1">tan2Curve </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">getMat</span><span class="s2">(</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">).</span><span class="s1">xformVec</span><span class="s2">(</span><span class="s1">tan</span><span class="s2">))</span>
                <span class="s4"># Update nurbs curve</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">getXyzCurve</span><span class="s2">().</span><span class="s1">adjustTangent</span><span class="s2">(</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackTime</span><span class="s2">,</span>
                    <span class="s1">tan2Curve</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">tan2Curve</span><span class="s2">[</span><span class="s6">1</span><span class="s2">], </span><span class="s1">tan2Curve</span><span class="s2">[</span><span class="s6">2</span><span class="s2">])</span>
                <span class="s4"># Note: this calls recompute on the curves</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
            <span class="s5">else</span><span class="s2">:</span>
                <span class="s4"># Show playback marker</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">getChild</span><span class="s2">(</span><span class="s6">0</span><span class="s2">).</span><span class="s1">show</span><span class="s2">()</span>
                <span class="s4"># Update tangent marker line</span>
                <span class="s1">tan </span><span class="s2">= </span><span class="s1">Point3</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">getXyzCurve</span><span class="s2">().</span><span class="s1">getTangent</span><span class="s2">(</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackTime</span><span class="s2">, </span><span class="s1">tan</span><span class="s2">)</span>
                <span class="s4"># Transform this point to playback marker space</span>
                <span class="s1">tan</span><span class="s2">.</span><span class="s1">assign</span><span class="s2">(</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">.</span><span class="s1">getMat</span><span class="s2">(</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">).</span><span class="s1">xformVec</span><span class="s2">(</span><span class="s1">tan</span><span class="s2">))</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker</span><span class="s2">.</span><span class="s1">setPos</span><span class="s2">(</span><span class="s1">tan</span><span class="s2">)</span>
            <span class="s4"># In either case update tangent line</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentLines</span><span class="s2">.</span><span class="s1">setVertex</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s1">tan</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">tan</span><span class="s2">[</span><span class="s6">1</span><span class="s2">], </span><span class="s1">tan</span><span class="s2">[</span><span class="s6">2</span><span class="s2">])</span>
        <span class="s5">return </span><span class="s1">Task</span><span class="s2">.</span><span class="s1">cont</span>

    <span class="s5">def </span><span class="s1">manipulateObjectStartHook</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manipulandumId </span><span class="s2">= </span><span class="s5">None</span>
        <span class="s5">if </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">.</span><span class="s1">last</span><span class="s2">:</span>
            <span class="s5">if </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">.</span><span class="s1">last</span><span class="s2">.</span><span class="s1">id</span><span class="s2">() == </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">id</span><span class="s2">():</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">manipulandumId </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">id</span><span class="s2">()</span>
            <span class="s5">elif </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">.</span><span class="s1">last</span><span class="s2">.</span><span class="s1">id</span><span class="s2">() == </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker</span><span class="s2">.</span><span class="s1">id</span><span class="s2">():</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">manipulandumId </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker</span><span class="s2">.</span><span class="s1">id</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">manipulateObjectCleanupHook</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">nodePathList </span><span class="s2">= []):</span>
        <span class="s4"># Clear flag</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manipulandumId </span><span class="s2">= </span><span class="s5">None</span>

    <span class="s5">def </span><span class="s1">onDestroy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">):</span>
        <span class="s4"># Remove hooks</span>
        <span class="s5">for </span><span class="s1">event</span><span class="s2">, </span><span class="s1">method </span><span class="s5">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">actionEvents</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ignore</span><span class="s2">(</span><span class="s1">event</span><span class="s2">)</span>
        <span class="s4"># remove start stop hook</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ignore</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">startStopHook</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ignore</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">keyframeHook</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveNodePath</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recorderNodePath</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recorderNodePath</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">recorderNodePath</span><span class="s2">.</span><span class="s1">removeNode</span><span class="s2">()</span>
        <span class="s4"># Make sure markers are deselected</span>
        <span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">deselect</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">)</span>
        <span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">deselect</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker</span><span class="s2">)</span>
        <span class="s4"># Remove tasks</span>
        <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'-recordTask'</span><span class="s2">)</span>
        <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'-playbackTask'</span><span class="s2">)</span>
        <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'-curveEditTask'</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">createNewPointSet</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">pointSetName </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'-ps-' </span><span class="s2">+ </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSetCount</span><span class="s2">)</span>
        <span class="s4"># Update dictionary and record pointer to new point set</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSetDict</span><span class="s2">[</span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSetName</span><span class="s2">] = []</span>
        <span class="s4"># Update combo box</span>
        <span class="s1">comboBox </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Mopath'</span><span class="s2">, </span><span class="s3">'History'</span><span class="s2">)</span>
        <span class="s1">scrolledList </span><span class="s2">= </span><span class="s1">comboBox</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'scrolledlist'</span><span class="s2">)</span>
        <span class="s1">listbox </span><span class="s2">= </span><span class="s1">scrolledList</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'listbox'</span><span class="s2">)</span>
        <span class="s1">names </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">listbox</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s6">0</span><span class="s2">,</span><span class="s3">'end'</span><span class="s2">))</span>
        <span class="s1">names</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSetName</span><span class="s2">)</span>
        <span class="s1">scrolledList</span><span class="s2">.</span><span class="s1">setlist</span><span class="s2">(</span><span class="s1">names</span><span class="s2">)</span>
        <span class="s1">comboBox</span><span class="s2">.</span><span class="s1">selectitem</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSetName</span><span class="s2">)</span>
        <span class="s4"># Update count</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">pointSetCount </span><span class="s2">+= </span><span class="s6">1</span>

    <span class="s5">def </span><span class="s1">extractPointSetFromCurveFitter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Get new point set based on newly created curve</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">createNewPointSet</span><span class="s2">()</span>
        <span class="s5">for </span><span class="s1">i </span><span class="s5">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">getNumSamples</span><span class="s2">()):</span>
            <span class="s1">time </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">getSampleT</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)</span>
            <span class="s1">pos </span><span class="s2">= </span><span class="s1">Point3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">getSampleXyz</span><span class="s2">(</span><span class="s1">i</span><span class="s2">))</span>
            <span class="s1">hpr </span><span class="s2">= </span><span class="s1">Point3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">getSampleHpr</span><span class="s2">(</span><span class="s1">i</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s1">time</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">])</span>

    <span class="s5">def </span><span class="s1">extractPointSetFromCurveCollection</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Use curve to compute new point set</span>
        <span class="s4"># Record maxT</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">maxT </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">getMaxT</span><span class="s2">()</span>
        <span class="s4"># Determine num samples</span>
        <span class="s4"># Limit point set to 1000 points and samples per second to 30</span>
        <span class="s1">samplesPerSegment </span><span class="s2">= </span><span class="s1">min</span><span class="s2">(</span><span class="s6">30.0</span><span class="s2">, </span><span class="s6">1000.0</span><span class="s2">/</span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">getMaxT</span><span class="s2">())</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setNumSamples</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">maxT </span><span class="s2">* </span><span class="s1">samplesPerSegment</span><span class="s2">)</span>
        <span class="s4"># Sample the curve but don't create a new curve collection</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">sampleCurve</span><span class="s2">(</span><span class="s1">fCompute </span><span class="s2">= </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s4"># Update widgets based on new data</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">updateWidgets</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">selectPointSetNamed</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSetDict</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s5">None</span><span class="s2">)</span>
        <span class="s4"># Reload points into curve fitter</span>
        <span class="s4"># Reset curve fitters</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">reset</span><span class="s2">()</span>
        <span class="s5">for </span><span class="s1">time</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr </span><span class="s5">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span><span class="s2">:</span>
            <span class="s4"># Add it to the curve fitters</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">addXyzHpr</span><span class="s2">(</span><span class="s1">time</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">)</span>
        <span class="s4"># Compute curve</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">computeCurves</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">setPathVis</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Path'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">curveNodePath</span><span class="s2">.</span><span class="s1">show</span><span class="s2">()</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">curveNodePath</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">setKnotVis</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setShowKnots</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Knots'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">())</span>

    <span class="s5">def </span><span class="s1">setCvVis</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setShowCvs</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'CVs'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">())</span>

    <span class="s5">def </span><span class="s1">setHullVis</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setShowHull</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Hull'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">())</span>

    <span class="s5">def </span><span class="s1">setTraceVis</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Trace'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">.</span><span class="s1">show</span><span class="s2">()</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">setMarkerVis</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Style'</span><span class="s2">, </span><span class="s3">'Marker'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recorderNodePath</span><span class="s2">)</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">ShowBaseGlobal</span><span class="s2">.</span><span class="s1">hidden</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setNumSegs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">numSegs </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setNumSegs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">numSegs</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setNumTicks</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setNumTicks</span><span class="s2">(</span><span class="s1">float</span><span class="s2">(</span><span class="s1">value</span><span class="s2">))</span>

    <span class="s5">def </span><span class="s1">setTickScale</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setTickScale</span><span class="s2">(</span><span class="s1">float</span><span class="s2">(</span><span class="s1">value</span><span class="s2">))</span>

    <span class="s5">def </span><span class="s1">setPathColor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">color</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setColor</span><span class="s2">(</span>
            <span class="s1">color</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]/</span><span class="s6">255.0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">[</span><span class="s6">1</span><span class="s2">]/</span><span class="s6">255.0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">[</span><span class="s6">2</span><span class="s2">]/</span><span class="s6">255.0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">setKnotColor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">color</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setKnotColor</span><span class="s2">(</span>
            <span class="s1">color</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]/</span><span class="s6">255.0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">[</span><span class="s6">1</span><span class="s2">]/</span><span class="s6">255.0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">[</span><span class="s6">2</span><span class="s2">]/</span><span class="s6">255.0</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setCvColor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">color</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setCvColor</span><span class="s2">(</span>
            <span class="s1">color</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]/</span><span class="s6">255.0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">[</span><span class="s6">1</span><span class="s2">]/</span><span class="s6">255.0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">[</span><span class="s6">2</span><span class="s2">]/</span><span class="s6">255.0</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setTickColor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">color</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setTickColor</span><span class="s2">(</span>
            <span class="s1">color</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]/</span><span class="s6">255.0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">[</span><span class="s6">1</span><span class="s2">]/</span><span class="s6">255.0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">[</span><span class="s6">2</span><span class="s2">]/</span><span class="s6">255.0</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setHullColor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">color</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setHullColor</span><span class="s2">(</span>
            <span class="s1">color</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]/</span><span class="s6">255.0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">[</span><span class="s6">1</span><span class="s2">]/</span><span class="s6">255.0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">[</span><span class="s6">2</span><span class="s2">]/</span><span class="s6">255.0</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setStartStopHook</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event </span><span class="s2">= </span><span class="s5">None</span><span class="s2">):</span>
        <span class="s4"># Clear out old hook</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ignore</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">startStopHook</span><span class="s2">)</span>
        <span class="s4"># Record new one</span>
        <span class="s1">hook </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Record Hook'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">startStopHook </span><span class="s2">= </span><span class="s1">hook</span>
        <span class="s4"># Add new one</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">accept</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">startStopHook</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">toggleRecordVar</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setKeyframeHook</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event </span><span class="s2">= </span><span class="s5">None</span><span class="s2">):</span>
        <span class="s4"># Clear out old hook</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ignore</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">keyframeHook</span><span class="s2">)</span>
        <span class="s4"># Record new one</span>
        <span class="s1">hook </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Keyframe Hook'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">keyframeHook </span><span class="s2">= </span><span class="s1">hook</span>
        <span class="s4"># Add new one</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">accept</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">keyframeHook</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">addKeyframe</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">reset</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">hasPoints </span><span class="s2">= </span><span class="s6">0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection </span><span class="s2">= </span><span class="s5">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">reset</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">setSamplingMode</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">samplingMode </span><span class="s2">= </span><span class="s1">mode</span>

    <span class="s5">def </span><span class="s1">disableKeyframeButton</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Add Keyframe'</span><span class="s2">)[</span><span class="s3">'state'</span><span class="s2">] = </span><span class="s3">'disabled'</span>
    <span class="s5">def </span><span class="s1">enableKeyframeButton</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Add Keyframe'</span><span class="s2">)[</span><span class="s3">'state'</span><span class="s2">] = </span><span class="s3">'normal'</span>

    <span class="s5">def </span><span class="s1">setRecordingType</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">type</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">type</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setNewCurveMode</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setRecordingType</span><span class="s2">(</span><span class="s3">'New Curve'</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setRefineMode</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setRecordingType</span><span class="s2">(</span><span class="s3">'Refine'</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setExtendMode</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setRecordingType</span><span class="s2">(</span><span class="s3">'Extend'</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">toggleRecordVar</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Get recording variable</span>
        <span class="s1">v </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Record'</span><span class="s2">)</span>
        <span class="s4"># Toggle it</span>
        <span class="s1">v</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s6">1 </span><span class="s2">- </span><span class="s1">v</span><span class="s2">.</span><span class="s1">get</span><span class="s2">())</span>
        <span class="s4"># Call the command</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">toggleRecord</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">toggleRecord</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Record'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">():</span>
            <span class="s4"># Kill old tasks</span>
            <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'-recordTask'</span><span class="s2">)</span>
            <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'-curveEditTask'</span><span class="s2">)</span>
            <span class="s4"># Remove old curve</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">()</span>
            <span class="s4"># Reset curve fitters</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">reset</span><span class="s2">()</span>
            <span class="s4"># Update sampling mode button if necessary</span>
            <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">samplingMode </span><span class="s2">== </span><span class="s3">'Continuous'</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">disableKeyframeButton</span><span class="s2">()</span>
            <span class="s4"># Create a new point set to hold raw data</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">createNewPointSet</span><span class="s2">()</span>
            <span class="s4"># Clear out old trace, get ready to draw new</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">initTrace</span><span class="s2">()</span>
            <span class="s4"># Keyframe mode?</span>
            <span class="s5">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">samplingMode </span><span class="s2">== </span><span class="s3">'Keyframe'</span><span class="s2">):</span>
                <span class="s4"># Record first point</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">lastPos</span><span class="s2">.</span><span class="s1">assign</span><span class="s2">(</span><span class="s1">Point3</span><span class="s2">(</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">getPos</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">)))</span>
                <span class="s4"># Init delta time</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">deltaTime </span><span class="s2">= </span><span class="s6">0.0</span>
                <span class="s4"># Record first point</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">recordPoint</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart</span><span class="s2">)</span>
            <span class="s4"># Everything else</span>
            <span class="s5">else</span><span class="s2">:</span>
                <span class="s5">if </span><span class="s2">((</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">.</span><span class="s1">get</span><span class="s2">() == </span><span class="s3">'Refine'</span><span class="s2">) </span><span class="s5">or</span>
                    <span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">.</span><span class="s1">get</span><span class="s2">() == </span><span class="s3">'Extend'</span><span class="s2">)):</span>
                    <span class="s4"># Turn off looping playback</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">loopPlayback </span><span class="s2">= </span><span class="s6">0</span>
                    <span class="s4"># Update widget to reflect new value</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Loop'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
                    <span class="s4"># Select tempCS as playback nodepath</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">oldPlaybackNodePath </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackNodePath</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">setPlaybackNodePath</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tempCS</span><span class="s2">)</span>
                    <span class="s4"># Parent record node path to temp</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackNodePath</span><span class="s2">)</span>
                    <span class="s4"># Align with temp</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">setPosHpr</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
                    <span class="s4"># Set playback start to self.recordStart</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackGoTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart</span><span class="s2">)</span>
                    <span class="s4"># start flying nodePath along path</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">startPlayback</span><span class="s2">()</span>
                <span class="s4"># Start new task</span>
                <span class="s1">t </span><span class="s2">= </span><span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">recordTask</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'-recordTask'</span><span class="s2">)</span>
                <span class="s1">t</span><span class="s2">.</span><span class="s1">startTime </span><span class="s2">= </span><span class="s1">globalClock</span><span class="s2">.</span><span class="s1">getFrameTime</span><span class="s2">()</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">samplingMode </span><span class="s2">== </span><span class="s3">'Continuous'</span><span class="s2">:</span>
                <span class="s4"># Kill old task</span>
                <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'-recordTask'</span><span class="s2">)</span>
                <span class="s5">if </span><span class="s2">((</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">.</span><span class="s1">get</span><span class="s2">() == </span><span class="s3">'Refine'</span><span class="s2">) </span><span class="s5">or</span>
                    <span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">.</span><span class="s1">get</span><span class="s2">() == </span><span class="s3">'Extend'</span><span class="s2">)):</span>
                    <span class="s4"># Reparent node path back to parent</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">wrtReparentTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">)</span>
                    <span class="s4"># Restore playback Node Path</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">setPlaybackNodePath</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">oldPlaybackNodePath</span><span class="s2">)</span>
            <span class="s5">else</span><span class="s2">:</span>
                <span class="s4"># Add last point</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">addKeyframe</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
            <span class="s4"># Reset sampling mode</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">setSamplingMode</span><span class="s2">(</span><span class="s3">'Continuous'</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">enableKeyframeButton</span><span class="s2">()</span>
            <span class="s4"># Clean up after refine or extend</span>
            <span class="s5">if </span><span class="s2">((</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">.</span><span class="s1">get</span><span class="s2">() == </span><span class="s3">'Refine'</span><span class="s2">) </span><span class="s5">or</span>
                <span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">.</span><span class="s1">get</span><span class="s2">() == </span><span class="s3">'Extend'</span><span class="s2">)):</span>
                <span class="s4"># Merge prePoints, pointSet, postPoints</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">mergePoints</span><span class="s2">()</span>
                <span class="s4"># Clear out pre and post list</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">prePoints </span><span class="s2">= []</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">postPoints </span><span class="s2">= []</span>
                <span class="s4"># Reset recording mode</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">setNewCurveMode</span><span class="s2">()</span>
            <span class="s4"># Compute curve</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">computeCurves</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">recordTask</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">state</span><span class="s2">):</span>
        <span class="s4"># Record raw data point</span>
        <span class="s1">time </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart </span><span class="s2">+ (</span>
            <span class="s1">globalClock</span><span class="s2">.</span><span class="s1">getFrameTime</span><span class="s2">() - </span><span class="s1">state</span><span class="s2">.</span><span class="s1">startTime</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">recordPoint</span><span class="s2">(</span><span class="s1">time</span><span class="s2">)</span>
        <span class="s5">return </span><span class="s1">Task</span><span class="s2">.</span><span class="s1">cont</span>

    <span class="s5">def </span><span class="s1">addKeyframe</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fToggleRecord </span><span class="s2">= </span><span class="s6">1</span><span class="s2">):</span>
        <span class="s4"># Make sure we're in a recording mode!</span>
        <span class="s5">if </span><span class="s2">(</span><span class="s1">fToggleRecord </span><span class="s5">and</span>
            <span class="s2">(</span><span class="s5">not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'Record'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">())):</span>
            <span class="s4"># Set sampling mode</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">setSamplingMode</span><span class="s2">(</span><span class="s3">'Keyframe'</span><span class="s2">)</span>
            <span class="s4"># This will automatically add the first point</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">toggleRecordVar</span><span class="s2">()</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s4"># Use distance as a time</span>
            <span class="s1">pos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">getPos</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">)</span>
            <span class="s1">deltaPos </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">pos </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">lastPos</span><span class="s2">).</span><span class="s1">length</span><span class="s2">()</span>
            <span class="s5">if </span><span class="s1">deltaPos </span><span class="s2">!= </span><span class="s6">0</span><span class="s2">:</span>
                <span class="s4"># If we've moved at all, use delta Pos as time</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">deltaTime </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">deltaTime </span><span class="s2">+ </span><span class="s1">deltaPos</span>
            <span class="s5">else</span><span class="s2">:</span>
                <span class="s4"># Otherwise add one second</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">deltaTime </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">deltaTime </span><span class="s2">+ </span><span class="s6">1.0</span>
            <span class="s4"># Record point at new time</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">recordPoint</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart </span><span class="s2">+ </span><span class="s1">self</span><span class="s2">.</span><span class="s1">deltaTime</span><span class="s2">)</span>
            <span class="s4"># Update last pos</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">lastPos</span><span class="s2">.</span><span class="s1">assign</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">easeInOut</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">t</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">t </span><span class="s2">* </span><span class="s1">t</span>
        <span class="s5">return </span><span class="s2">(</span><span class="s6">3 </span><span class="s2">* </span><span class="s1">x</span><span class="s2">) - (</span><span class="s6">2 </span><span class="s2">* </span><span class="s1">t </span><span class="s2">* </span><span class="s1">x</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setPreRecordFunc</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">func</span><span class="s2">):</span>
        <span class="s4"># Note: If func is one defined at command prompt, need to set</span>
        <span class="s4"># __builtins__.func = func at command line</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">preRecordFunc </span><span class="s2">= </span><span class="s1">eval</span><span class="s2">(</span><span class="s1">func</span><span class="s2">)</span>
        <span class="s4"># Update widget to reflect new value</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'PRF Active'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s6">1</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">recordPoint</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">time</span><span class="s2">):</span>
        <span class="s4"># Call user define callback before recording point</span>
        <span class="s5">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Recording'</span><span class="s2">, </span><span class="s3">'PRF Active'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">() </span><span class="s5">and</span>
            <span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">preRecordFunc </span><span class="s2">!= </span><span class="s5">None</span><span class="s2">)):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">preRecordFunc</span><span class="s2">()</span>
        <span class="s4"># Get point</span>
        <span class="s1">pos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">getPos</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">)</span>
        <span class="s1">hpr </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">getHpr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">)</span>
        <span class="s1">qNP </span><span class="s2">= </span><span class="s1">Quat</span><span class="s2">()</span>
        <span class="s1">qNP</span><span class="s2">.</span><span class="s1">setHpr</span><span class="s2">(</span><span class="s1">hpr</span><span class="s2">)</span>
        <span class="s4"># Blend between recordNodePath and self.nodePath</span>
        <span class="s5">if </span><span class="s2">((</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">.</span><span class="s1">get</span><span class="s2">() == </span><span class="s3">'Refine'</span><span class="s2">) </span><span class="s5">or</span>
            <span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">.</span><span class="s1">get</span><span class="s2">() == </span><span class="s3">'Extend'</span><span class="s2">)):</span>
            <span class="s5">if </span><span class="s2">((</span><span class="s1">time </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart</span><span class="s2">) </span><span class="s5">and</span>
                <span class="s2">((</span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart</span><span class="s2">) != </span><span class="s6">0.0</span><span class="s2">)):</span>
                <span class="s1">rPos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackNodePath</span><span class="s2">.</span><span class="s1">getPos</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">)</span>
                <span class="s1">rHpr </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackNodePath</span><span class="s2">.</span><span class="s1">getHpr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">)</span>
                <span class="s1">qR </span><span class="s2">= </span><span class="s1">Quat</span><span class="s2">()</span>
                <span class="s1">qR</span><span class="s2">.</span><span class="s1">setHpr</span><span class="s2">(</span><span class="s1">rHpr</span><span class="s2">)</span>
                <span class="s1">t </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">easeInOut</span><span class="s2">(((</span><span class="s1">time </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart</span><span class="s2">)/</span>
                                    <span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart</span><span class="s2">)))</span>
                <span class="s4"># Transition between the recorded node path and the driven one</span>
                <span class="s1">pos </span><span class="s2">= (</span><span class="s1">rPos </span><span class="s2">* (</span><span class="s6">1 </span><span class="s2">- </span><span class="s1">t</span><span class="s2">)) + (</span><span class="s1">pos </span><span class="s2">* </span><span class="s1">t</span><span class="s2">)</span>
                <span class="s1">q </span><span class="s2">= </span><span class="s1">qSlerp</span><span class="s2">(</span><span class="s1">qR</span><span class="s2">, </span><span class="s1">qNP</span><span class="s2">, </span><span class="s1">t</span><span class="s2">)</span>
                <span class="s1">hpr</span><span class="s2">.</span><span class="s1">assign</span><span class="s2">(</span><span class="s1">q</span><span class="s2">.</span><span class="s1">getHpr</span><span class="s2">())</span>
            <span class="s5">elif </span><span class="s2">((</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">.</span><span class="s1">get</span><span class="s2">() == </span><span class="s3">'Refine'</span><span class="s2">) </span><span class="s5">and</span>
                  <span class="s2">(</span><span class="s1">time </span><span class="s2">&gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStop</span><span class="s2">) </span><span class="s5">and</span>
                  <span class="s2">((</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStop</span><span class="s2">) != </span><span class="s6">0.0</span><span class="s2">)):</span>
                <span class="s1">rPos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackNodePath</span><span class="s2">.</span><span class="s1">getPos</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">)</span>
                <span class="s1">rHpr </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackNodePath</span><span class="s2">.</span><span class="s1">getHpr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">)</span>
                <span class="s1">qR </span><span class="s2">= </span><span class="s1">Quat</span><span class="s2">()</span>
                <span class="s1">qR</span><span class="s2">.</span><span class="s1">setHpr</span><span class="s2">(</span><span class="s1">rHpr</span><span class="s2">)</span>
                <span class="s1">t </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">easeInOut</span><span class="s2">(((</span><span class="s1">time </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStop</span><span class="s2">)/</span>
                                    <span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStop</span><span class="s2">)))</span>
                <span class="s4"># Transition between the recorded node path and the driven one</span>
                <span class="s1">pos </span><span class="s2">= (</span><span class="s1">pos </span><span class="s2">* (</span><span class="s6">1 </span><span class="s2">- </span><span class="s1">t</span><span class="s2">)) + (</span><span class="s1">rPos </span><span class="s2">* </span><span class="s1">t</span><span class="s2">)</span>
                <span class="s1">q </span><span class="s2">= </span><span class="s1">qSlerp</span><span class="s2">(</span><span class="s1">qNP</span><span class="s2">, </span><span class="s1">qR</span><span class="s2">, </span><span class="s1">t</span><span class="s2">)</span>
                <span class="s1">hpr</span><span class="s2">.</span><span class="s1">assign</span><span class="s2">(</span><span class="s1">q</span><span class="s2">.</span><span class="s1">getHpr</span><span class="s2">())</span>
        <span class="s4"># Add it to the point set</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s1">time</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">])</span>
        <span class="s4"># Add it to the curve fitters</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">addXyzHpr</span><span class="s2">(</span><span class="s1">time</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">)</span>
        <span class="s4"># Update trace now if recording keyframes</span>
        <span class="s5">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">samplingMode </span><span class="s2">== </span><span class="s3">'Keyframe'</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">.</span><span class="s1">reset</span><span class="s2">()</span>
            <span class="s5">for </span><span class="s1">t</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">h </span><span class="s5">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">.</span><span class="s1">drawTo</span><span class="s2">(</span><span class="s1">p</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">p</span><span class="s2">[</span><span class="s6">1</span><span class="s2">], </span><span class="s1">p</span><span class="s2">[</span><span class="s6">2</span><span class="s2">])</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">.</span><span class="s1">create</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">computeCurves</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check to make sure curve fitters have points</span>
        <span class="s5">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">getNumSamples</span><span class="s2">() == </span><span class="s6">0</span><span class="s2">):</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">'MopathRecorder.computeCurves: Must define curve first'</span><span class="s2">)</span>
            <span class="s5">return</span>
        <span class="s4"># Create curves</span>
        <span class="s4"># XYZ</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">sortPoints</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">wrapHpr</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">computeTangents</span><span class="s2">(</span><span class="s6">1</span><span class="s2">)</span>
        <span class="s4"># This is really a collection</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">makeNurbs</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setCurves</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s4"># Update widget based on new curve</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">updateWidgets</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">initTrace</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">.</span><span class="s1">reset</span><span class="s2">()</span>
        <span class="s4"># Put trace line segs under node path's parent</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">)</span>
        <span class="s4"># Show it</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">.</span><span class="s1">show</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">updateWidgets</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">:</span>
            <span class="s5">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues </span><span class="s2">= </span><span class="s6">1</span>
        <span class="s4"># Widgets depending on max T</span>
        <span class="s1">maxT </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">getMaxT</span><span class="s2">()</span>
        <span class="s1">maxT_text </span><span class="s2">= </span><span class="s3">'%0.2f' </span><span class="s2">% </span><span class="s1">maxT</span>
        <span class="s4"># Playback controls</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Time'</span><span class="s2">).</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">max </span><span class="s2">= </span><span class="s1">maxT_text</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Resample'</span><span class="s2">, </span><span class="s3">'Path Duration'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s1">maxT_text</span><span class="s2">)</span>
        <span class="s4"># Refine widgets</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Refine From'</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">max </span><span class="s2">= </span><span class="s1">maxT</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s6">0.0</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Control Start'</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">max </span><span class="s2">= </span><span class="s1">maxT</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s6">0.0</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Control Stop'</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">max </span><span class="s2">= </span><span class="s1">maxT</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">float</span><span class="s2">(</span><span class="s1">maxT</span><span class="s2">))</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Refine To'</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">max </span><span class="s2">= </span><span class="s1">maxT</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">float</span><span class="s2">(</span><span class="s1">maxT</span><span class="s2">))</span>
        <span class="s4"># Extend widgets</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Extend Page'</span><span class="s2">, </span><span class="s3">'Extend From'</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">max </span><span class="s2">= </span><span class="s1">maxT</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">float</span><span class="s2">(</span><span class="s6">0.0</span><span class="s2">))</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Extend Page'</span><span class="s2">, </span><span class="s3">'Control Start'</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">max </span><span class="s2">= </span><span class="s1">maxT</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">float</span><span class="s2">(</span><span class="s6">0.0</span><span class="s2">))</span>
        <span class="s4"># Crop widgets</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Crop Page'</span><span class="s2">, </span><span class="s3">'Crop From'</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">max </span><span class="s2">= </span><span class="s1">maxT</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">float</span><span class="s2">(</span><span class="s6">0.0</span><span class="s2">))</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Crop Page'</span><span class="s2">, </span><span class="s3">'Crop To'</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">max </span><span class="s2">= </span><span class="s1">maxT</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">float</span><span class="s2">(</span><span class="s1">maxT</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">maxT </span><span class="s2">= </span><span class="s1">float</span><span class="s2">(</span><span class="s1">maxT</span><span class="s2">)</span>
        <span class="s4"># Widgets depending on number of samples</span>
        <span class="s1">numSamples </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">getNumSamples</span><span class="s2">()</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Resample'</span><span class="s2">, </span><span class="s3">'Points Between Samples'</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">max</span><span class="s2">=</span><span class="s1">numSamples</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Resample'</span><span class="s2">, </span><span class="s3">'Num. Samples'</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">max </span><span class="s2">= </span><span class="s6">4 </span><span class="s2">* </span><span class="s1">numSamples</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">numSamples</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues </span><span class="s2">= </span><span class="s6">0</span>

    <span class="s5">def </span><span class="s1">selectNodePathNamed</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s1">nodePath </span><span class="s2">= </span><span class="s5">None</span>
        <span class="s5">if </span><span class="s1">name </span><span class="s2">== </span><span class="s3">'init'</span><span class="s2">:</span>
            <span class="s1">nodePath </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span>
            <span class="s4"># Add Combo box entry for the initial node path</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">addNodePath</span><span class="s2">(</span><span class="s1">nodePath</span><span class="s2">)</span>
        <span class="s5">elif </span><span class="s1">name </span><span class="s2">== </span><span class="s3">'selected'</span><span class="s2">:</span>
            <span class="s1">nodePath </span><span class="s2">= </span><span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">.</span><span class="s1">last</span>
            <span class="s4"># Add Combo box entry for this selected object</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">addNodePath</span><span class="s2">(</span><span class="s1">nodePath</span><span class="s2">)</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">nodePath </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathDict</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s5">None</span><span class="s2">)</span>
            <span class="s5">if </span><span class="s2">(</span><span class="s1">nodePath </span><span class="s2">== </span><span class="s5">None</span><span class="s2">):</span>
                <span class="s4"># See if this evaluates into a node path</span>
                <span class="s5">try</span><span class="s2">:</span>
                    <span class="s1">nodePath </span><span class="s2">= </span><span class="s1">eval</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)</span>
                    <span class="s5">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">nodePath</span><span class="s2">, </span><span class="s1">NodePath</span><span class="s2">):</span>
                        <span class="s1">self</span><span class="s2">.</span><span class="s1">addNodePath</span><span class="s2">(</span><span class="s1">nodePath</span><span class="s2">)</span>
                    <span class="s5">else</span><span class="s2">:</span>
                        <span class="s4"># Good eval but not a node path, give up</span>
                        <span class="s1">nodePath </span><span class="s2">= </span><span class="s5">None</span>
                <span class="s5">except</span><span class="s2">:</span>
                    <span class="s4"># Bogus eval</span>
                    <span class="s1">nodePath </span><span class="s2">= </span><span class="s5">None</span>
                    <span class="s4"># Clear bogus entry from listbox</span>
                    <span class="s1">listbox </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathMenu</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'scrolledlist'</span><span class="s2">)</span>
                    <span class="s1">listbox</span><span class="s2">.</span><span class="s1">setlist</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathNames</span><span class="s2">)</span>
            <span class="s5">else</span><span class="s2">:</span>
                <span class="s5">if </span><span class="s1">name </span><span class="s2">== </span><span class="s3">'widget'</span><span class="s2">:</span>
                    <span class="s4"># Record relationship between selected nodes and widget</span>
                    <span class="s1">base</span><span class="s2">.</span><span class="s1">direct</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">.</span><span class="s1">getWrtAll</span><span class="s2">()</span>
                <span class="s5">if </span><span class="s1">name </span><span class="s2">== </span><span class="s3">'marker'</span><span class="s2">:</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">show</span><span class="s2">()</span>
                    <span class="s4"># Initialize tangent marker position</span>
                    <span class="s1">tan </span><span class="s2">= </span><span class="s1">Point3</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
                    <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection </span><span class="s2">!= </span><span class="s5">None</span><span class="s2">:</span>
                        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">getXyzCurve</span><span class="s2">().</span><span class="s1">getTangent</span><span class="s2">(</span>
                            <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackTime</span><span class="s2">, </span><span class="s1">tan</span><span class="s2">)</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">tangentMarker</span><span class="s2">.</span><span class="s1">setPos</span><span class="s2">(</span><span class="s1">tan</span><span class="s2">)</span>
                <span class="s5">else</span><span class="s2">:</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackMarker</span><span class="s2">.</span><span class="s1">hide</span><span class="s2">()</span>
        <span class="s4"># Update active node path</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setNodePath</span><span class="s2">(</span><span class="s1">nodePath</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setNodePath</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">nodePath</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackNodePath </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath </span><span class="s2">= </span><span class="s1">nodePath</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">:</span>
            <span class="s4"># Record nopath's parent</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">getParent</span><span class="s2">()</span>
            <span class="s4"># Put curve drawer under record node path's parent</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">curveNodePath</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">)</span>
            <span class="s4"># Set entry color</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathMenuEntry</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span>
                <span class="s1">background </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathMenuBG</span><span class="s2">)</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s4"># Flash entry</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathMenuEntry</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">background </span><span class="s2">= </span><span class="s3">'Pink'</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setPlaybackNodePath</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">nodePath</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackNodePath </span><span class="s2">= </span><span class="s1">nodePath</span>

    <span class="s5">def </span><span class="s1">addNodePath</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">nodePath</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">addNodePathToDict</span><span class="s2">(</span><span class="s1">nodePath</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathNames</span><span class="s2">,</span>
                               <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathMenu</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathDict</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">addNodePathToDict</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">nodePath</span><span class="s2">, </span><span class="s1">names</span><span class="s2">, </span><span class="s1">menu</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">):</span>
        <span class="s5">if not </span><span class="s1">nodePath</span><span class="s2">:</span>
            <span class="s5">return</span>
        <span class="s4"># Get node path's name</span>
        <span class="s1">name </span><span class="s2">= </span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">()</span>
        <span class="s5">if </span><span class="s1">name </span><span class="s5">in </span><span class="s2">[</span><span class="s3">'mopathRecorderTempCS'</span><span class="s2">, </span><span class="s3">'widget'</span><span class="s2">, </span><span class="s3">'camera'</span><span class="s2">, </span><span class="s3">'marker'</span><span class="s2">]:</span>
            <span class="s1">dictName </span><span class="s2">= </span><span class="s1">name</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s4"># Generate a unique name for the dict</span>
            <span class="s1">dictName </span><span class="s2">= </span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">id</span><span class="s2">())</span>
        <span class="s5">if </span><span class="s1">dictName </span><span class="s5">not in </span><span class="s1">dict</span><span class="s2">:</span>
            <span class="s4"># Update combo box to include new item</span>
            <span class="s1">names</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">dictName</span><span class="s2">)</span>
            <span class="s1">listbox </span><span class="s2">= </span><span class="s1">menu</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'scrolledlist'</span><span class="s2">)</span>
            <span class="s1">listbox</span><span class="s2">.</span><span class="s1">setlist</span><span class="s2">(</span><span class="s1">names</span><span class="s2">)</span>
            <span class="s4"># Add new item to dictionary</span>
            <span class="s1">dict</span><span class="s2">[</span><span class="s1">dictName</span><span class="s2">] = </span><span class="s1">nodePath</span>
        <span class="s1">menu</span><span class="s2">.</span><span class="s1">selectitem</span><span class="s2">(</span><span class="s1">dictName</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setLoopPlayback</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">loopPlayback </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Loop'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">playbackGoTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">time</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection </span><span class="s2">== </span><span class="s5">None</span><span class="s2">:</span>
            <span class="s5">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackTime </span><span class="s2">= </span><span class="s1">CLAMP</span><span class="s2">(</span><span class="s1">time</span><span class="s2">, </span><span class="s6">0.0</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">maxT</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection </span><span class="s2">!= </span><span class="s5">None</span><span class="s2">:</span>
            <span class="s1">pos </span><span class="s2">= </span><span class="s1">Point3</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
            <span class="s1">hpr </span><span class="s2">= </span><span class="s1">Point3</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">evaluate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackTime</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackNodePath</span><span class="s2">.</span><span class="s1">setPosHpr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePathParent</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">startPlayback</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection </span><span class="s2">== </span><span class="s5">None</span><span class="s2">:</span>
            <span class="s5">return</span>
        <span class="s4"># Kill any existing tasks</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">stopPlayback</span><span class="s2">()</span>
        <span class="s4"># Make sure checkbutton is set</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Play'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s6">1</span><span class="s2">)</span>
        <span class="s4"># Start new playback task</span>
        <span class="s1">t </span><span class="s2">= </span><span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackTask</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'-playbackTask'</span><span class="s2">)</span>
        <span class="s1">t</span><span class="s2">.</span><span class="s1">currentTime </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackTime</span>
        <span class="s1">t</span><span class="s2">.</span><span class="s1">lastTime </span><span class="s2">= </span><span class="s1">globalClock</span><span class="s2">.</span><span class="s1">getFrameTime</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">setSpeedScale</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">speedScale</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">math</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s1">value</span><span class="s2">))</span>

    <span class="s5">def </span><span class="s1">setPlaybackSF</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">playbackSF </span><span class="s2">= </span><span class="s1">pow</span><span class="s2">(</span><span class="s6">10.0</span><span class="s2">, </span><span class="s1">float</span><span class="s2">(</span><span class="s1">value</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">speedVar</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s3">'%0.2f' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackSF</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">playbackTask</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">state</span><span class="s2">):</span>
        <span class="s1">time </span><span class="s2">= </span><span class="s1">globalClock</span><span class="s2">.</span><span class="s1">getFrameTime</span><span class="s2">()</span>
        <span class="s1">dTime </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">playbackSF </span><span class="s2">* (</span><span class="s1">time </span><span class="s2">- </span><span class="s1">state</span><span class="s2">.</span><span class="s1">lastTime</span><span class="s2">)</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">lastTime </span><span class="s2">= </span><span class="s1">time</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">loopPlayback</span><span class="s2">:</span>
            <span class="s1">cTime </span><span class="s2">= (</span><span class="s1">state</span><span class="s2">.</span><span class="s1">currentTime </span><span class="s2">+ </span><span class="s1">dTime</span><span class="s2">) % </span><span class="s1">self</span><span class="s2">.</span><span class="s1">maxT</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">cTime </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">currentTime </span><span class="s2">+ </span><span class="s1">dTime</span>
        <span class="s4"># Stop task if not looping and at end of curve</span>
        <span class="s4"># Or if refining curve and past recordStop</span>
        <span class="s5">if </span><span class="s2">((</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">.</span><span class="s1">get</span><span class="s2">() == </span><span class="s3">'Refine'</span><span class="s2">) </span><span class="s5">and</span>
              <span class="s2">(</span><span class="s1">cTime </span><span class="s2">&gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop</span><span class="s2">)):</span>
            <span class="s4"># Go to recordStop</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Time'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop</span><span class="s2">)</span>
            <span class="s4"># Then stop playback</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">stopPlayback</span><span class="s2">()</span>
            <span class="s4"># Also kill record task</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">toggleRecordVar</span><span class="s2">()</span>
            <span class="s5">return </span><span class="s1">Task</span><span class="s2">.</span><span class="s1">done</span>
        <span class="s5">elif </span><span class="s2">((</span><span class="s1">self</span><span class="s2">.</span><span class="s1">loopPlayback </span><span class="s2">== </span><span class="s6">0</span><span class="s2">) </span><span class="s5">and </span><span class="s2">(</span><span class="s1">cTime </span><span class="s2">&gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">maxT</span><span class="s2">)):</span>
            <span class="s4"># Go to maxT</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Time'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">maxT</span><span class="s2">)</span>
            <span class="s4"># Then stop playback</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">stopPlayback</span><span class="s2">()</span>
            <span class="s5">return </span><span class="s1">Task</span><span class="s2">.</span><span class="s1">done</span>
        <span class="s5">elif </span><span class="s2">((</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordingType</span><span class="s2">.</span><span class="s1">get</span><span class="s2">() == </span><span class="s3">'Extend'</span><span class="s2">) </span><span class="s5">and</span>
              <span class="s2">(</span><span class="s1">cTime </span><span class="s2">&gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart</span><span class="s2">)):</span>
            <span class="s4"># Go to final point</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Time'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart</span><span class="s2">)</span>
            <span class="s4"># Stop playback</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">stopPlayback</span><span class="s2">()</span>
            <span class="s5">return </span><span class="s1">Task</span><span class="s2">.</span><span class="s1">done</span>
        <span class="s4"># Otherwise go to specified time and continue</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Time'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s1">cTime</span><span class="s2">)</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">currentTime </span><span class="s2">= </span><span class="s1">cTime</span>
        <span class="s5">return </span><span class="s1">Task</span><span class="s2">.</span><span class="s1">cont</span>

    <span class="s5">def </span><span class="s1">stopPlayback</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Play'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">taskMgr</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">'-playbackTask'</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">jumpToStartOfPlayback</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">stopPlayback</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Time'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s6">0.0</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">jumpToEndOfPlayback</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">stopPlayback</span><span class="s2">()</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection </span><span class="s2">!= </span><span class="s5">None</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Time'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">maxT</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">startStopPlayback</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getVariable</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Play'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">startPlayback</span><span class="s2">()</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">stopPlayback</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">setDesampleFrequency</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">frequency</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">desampleFrequency </span><span class="s2">= </span><span class="s1">frequency</span>

    <span class="s5">def </span><span class="s1">desampleCurve</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">getNumSamples</span><span class="s2">() == </span><span class="s6">0</span><span class="s2">):</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">'MopathRecorder.desampleCurve: Must define curve first'</span><span class="s2">)</span>
            <span class="s5">return</span>
        <span class="s4"># NOTE: This is destructive, points will be deleted from curve fitter</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">desample</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">desampleFrequency</span><span class="s2">)</span>
        <span class="s4"># Compute new curve based on desampled data</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">computeCurves</span><span class="s2">()</span>
        <span class="s4"># Get point set from the curve fitter</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">extractPointSetFromCurveFitter</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">setNumSamples</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">numSamples</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">numSamples </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s1">numSamples</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">sampleCurve</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fCompute </span><span class="s2">= </span><span class="s6">1</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection </span><span class="s2">== </span><span class="s5">None</span><span class="s2">:</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">'MopathRecorder.sampleCurve: Must define curve first'</span><span class="s2">)</span>
            <span class="s5">return</span>
        <span class="s4"># Reset curve fitters</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">reset</span><span class="s2">()</span>
        <span class="s4"># Sample curve using specified number of samples</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">sample</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">numSamples</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">fCompute</span><span class="s2">:</span>
            <span class="s4"># Now recompute curves</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">computeCurves</span><span class="s2">()</span>
        <span class="s4"># Get point set from the curve fitter</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">extractPointSetFromCurveFitter</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">makeEven</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Note: segments_per_unit = 2 seems to give a good fit</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">makeEven</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">maxT</span><span class="s2">, </span><span class="s6">2</span><span class="s2">)</span>
        <span class="s4"># Get point set from curve</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">extractPointSetFromCurveCollection</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">faceForward</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Note: segments_per_unit = 2 seems to give a good fit</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">faceForward</span><span class="s2">(</span><span class="s6">2</span><span class="s2">)</span>
        <span class="s4"># Get point set from curve</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">extractPointSetFromCurveCollection</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">setPathDuration</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">event</span><span class="s2">):</span>
        <span class="s1">newMaxT </span><span class="s2">= </span><span class="s1">float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Resample'</span><span class="s2">, </span><span class="s3">'Path Duration'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">())</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setPathDurationTo</span><span class="s2">(</span><span class="s1">newMaxT</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setPathDurationTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">newMaxT</span><span class="s2">):</span>
        <span class="s4"># Compute scale factor</span>
        <span class="s1">sf </span><span class="s2">= </span><span class="s1">newMaxT</span><span class="s2">/</span><span class="s1">self</span><span class="s2">.</span><span class="s1">maxT</span>
        <span class="s4"># Scale curve collection</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">resetMaxT</span><span class="s2">(</span><span class="s1">newMaxT</span><span class="s2">)</span>
        <span class="s4"># Scale point set</span>
        <span class="s4"># Save handle to old point set</span>
        <span class="s1">oldPointSet </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span>
        <span class="s4"># Create new point set</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">createNewPointSet</span><span class="s2">()</span>
        <span class="s4"># Reset curve fitters</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">reset</span><span class="s2">()</span>
        <span class="s4"># Now scale values</span>
        <span class="s5">for </span><span class="s1">time</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr </span><span class="s5">in </span><span class="s1">oldPointSet</span><span class="s2">:</span>
            <span class="s1">newTime </span><span class="s2">= </span><span class="s1">time </span><span class="s2">* </span><span class="s1">sf</span>
            <span class="s4"># Update point set</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s1">newTime</span><span class="s2">, </span><span class="s1">Point3</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">), </span><span class="s1">Point3</span><span class="s2">(</span><span class="s1">hpr</span><span class="s2">)])</span>
            <span class="s4"># Add it to the curve fitters</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">addXyzHpr</span><span class="s2">(</span><span class="s1">newTime</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">)</span>
        <span class="s4"># Update widgets</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">updateWidgets</span><span class="s2">()</span>
        <span class="s4"># Compute curve</span>
        <span class="s4">#self.computeCurves()</span>

    <span class="s5">def </span><span class="s1">setRecordStart</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s4"># Someone else is adjusting values, let them take care of it</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues</span><span class="s2">:</span>
            <span class="s5">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues </span><span class="s2">= </span><span class="s6">1</span>
        <span class="s4"># Adjust refine widgets</span>
        <span class="s4"># Make sure we're in sync</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Refine From'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Extend Page'</span><span class="s2">, </span><span class="s3">'Extend From'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart</span><span class="s2">)</span>
        <span class="s4"># Check bounds</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart </span><span class="s2">&gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Control Start'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Extend Page'</span><span class="s2">, </span><span class="s3">'Control Start'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart </span><span class="s2">&gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStop</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Control Stop'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart </span><span class="s2">&gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Refine To'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart</span><span class="s2">)</span>
        <span class="s4"># Move playback node path to specified time</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Time'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues </span><span class="s2">= </span><span class="s6">0</span>

    <span class="s5">def </span><span class="s1">getPrePoints</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">type </span><span class="s2">= </span><span class="s3">'Refine'</span><span class="s2">):</span>
        <span class="s4"># Switch to appropriate recording type</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setRecordingType</span><span class="s2">(</span><span class="s1">type</span><span class="s2">)</span>
        <span class="s4"># Reset prePoints</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">prePoints </span><span class="s2">= []</span>
        <span class="s4"># See if we need to save any points before recordStart</span>
        <span class="s5">for </span><span class="s1">i </span><span class="s5">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span><span class="s2">)):</span>
            <span class="s4"># Have we passed recordStart?</span>
            <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span><span class="s2">[</span><span class="s1">i</span><span class="s2">][</span><span class="s6">0</span><span class="s2">]:</span>
                <span class="s4"># Get a copy of the points prior to recordStart</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">prePoints </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span><span class="s2">[:</span><span class="s1">i</span><span class="s2">-</span><span class="s6">1</span><span class="s2">]</span>
                <span class="s5">break</span>

    <span class="s5">def </span><span class="s1">setControlStart</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s4"># Someone else is adjusting values, let them take care of it</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues</span><span class="s2">:</span>
            <span class="s5">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues </span><span class="s2">= </span><span class="s6">1</span>
        <span class="s4"># Adjust refine widgets</span>
        <span class="s4"># Make sure both pages are in sync</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Control Start'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Extend Page'</span><span class="s2">, </span><span class="s3">'Control Start'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart</span><span class="s2">)</span>
        <span class="s4"># Check bounds on other widgets</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Refine From'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Extend Page'</span><span class="s2">, </span><span class="s3">'Extend From'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart </span><span class="s2">&gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStop</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Control Stop'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart </span><span class="s2">&gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Refine To'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart</span><span class="s2">)</span>
        <span class="s4"># Move playback node path to specified time</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Time'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues </span><span class="s2">= </span><span class="s6">0</span>

    <span class="s5">def </span><span class="s1">setControlStop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">controlStop </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s4"># Someone else is adjusting values, let them take care of it</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues</span><span class="s2">:</span>
            <span class="s5">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues </span><span class="s2">= </span><span class="s6">1</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStop </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Refine From'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">controlStop</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStop </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Control Start'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">controlStop</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStop </span><span class="s2">&gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Refine To'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">controlStop</span><span class="s2">)</span>
        <span class="s4"># Move playback node path to specified time</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Time'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues </span><span class="s2">= </span><span class="s6">0</span>

    <span class="s5">def </span><span class="s1">setRefineStop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s4"># Someone else is adjusting values, let them take care of it</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues</span><span class="s2">:</span>
            <span class="s5">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues </span><span class="s2">= </span><span class="s6">1</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStart</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Refine From'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStart</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Control Start'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">controlStop</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Refine Page'</span><span class="s2">, </span><span class="s3">'Control Stop'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop</span><span class="s2">)</span>
        <span class="s4"># Move playback node path to specified time</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Time'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues </span><span class="s2">= </span><span class="s6">0</span>

    <span class="s5">def </span><span class="s1">getPostPoints</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Set flag so we know to do a refine pass</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setRefineMode</span><span class="s2">()</span>
        <span class="s4"># Reset postPoints</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">postPoints </span><span class="s2">= []</span>
        <span class="s4"># See if we need to save any points after recordStop</span>
        <span class="s5">for </span><span class="s1">i </span><span class="s5">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span><span class="s2">)):</span>
            <span class="s4"># Have we reached recordStop?</span>
            <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span><span class="s2">[</span><span class="s1">i</span><span class="s2">][</span><span class="s6">0</span><span class="s2">]:</span>
                <span class="s4"># Get a copy of the points after recordStop</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">postPoints </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span><span class="s2">[</span><span class="s1">i</span><span class="s2">:]</span>
                <span class="s5">break</span>

    <span class="s5">def </span><span class="s1">mergePoints</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># prepend pre points</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span><span class="s2">[</span><span class="s6">0</span><span class="s2">:</span><span class="s6">0</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">prePoints</span>
        <span class="s5">for </span><span class="s1">time</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr </span><span class="s5">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">prePoints</span><span class="s2">:</span>
            <span class="s4"># Add it to the curve fitters</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">addXyzHpr</span><span class="s2">(</span><span class="s1">time</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">)</span>
        <span class="s4"># And post points</span>
        <span class="s4"># What is end time of pointSet?</span>
        <span class="s1">endTime </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span><span class="s2">[-</span><span class="s6">1</span><span class="s2">][</span><span class="s6">0</span><span class="s2">]</span>
        <span class="s5">for </span><span class="s1">time</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr </span><span class="s5">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">postPoints</span><span class="s2">:</span>
            <span class="s1">adjustedTime </span><span class="s2">= </span><span class="s1">endTime </span><span class="s2">+ (</span><span class="s1">time </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">recordStop</span><span class="s2">)</span>
            <span class="s4"># Add it to point set</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s1">adjustedTime</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">])</span>
            <span class="s4"># Add it to the curve fitters</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">addXyzHpr</span><span class="s2">(</span><span class="s1">adjustedTime</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">setCropFrom</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cropFrom </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s4"># Someone else is adjusting values, let them take care of it</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues</span><span class="s2">:</span>
            <span class="s5">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues </span><span class="s2">= </span><span class="s6">1</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cropFrom </span><span class="s2">&gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cropTo</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Crop Page'</span><span class="s2">, </span><span class="s3">'Crop To'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">cropFrom</span><span class="s2">)</span>
        <span class="s4"># Move playback node path to specified time</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Time'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues </span><span class="s2">= </span><span class="s6">0</span>

    <span class="s5">def </span><span class="s1">setCropTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cropTo </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s4"># Someone else is adjusting values, let them take care of it</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues</span><span class="s2">:</span>
            <span class="s5">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues </span><span class="s2">= </span><span class="s6">1</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cropTo </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cropFrom</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Crop Page'</span><span class="s2">, </span><span class="s3">'Crop From'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">cropTo</span><span class="s2">)</span>
        <span class="s4"># Move playback node path to specified time</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">getWidget</span><span class="s2">(</span><span class="s3">'Playback'</span><span class="s2">, </span><span class="s3">'Time'</span><span class="s2">).</span><span class="s1">set</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fAdjustingValues </span><span class="s2">= </span><span class="s6">0</span>

    <span class="s5">def </span><span class="s1">cropCurve</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet </span><span class="s2">== </span><span class="s5">None</span><span class="s2">:</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">'Empty Point Set'</span><span class="s2">)</span>
            <span class="s5">return</span>
        <span class="s4"># Keep handle on old points</span>
        <span class="s1">oldPoints </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span>
        <span class="s4"># Create new point set</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">createNewPointSet</span><span class="s2">()</span>
        <span class="s4"># Copy over points between from/to</span>
        <span class="s4"># Reset curve fitters</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">reset</span><span class="s2">()</span>
        <span class="s4"># Add start point</span>
        <span class="s1">pos </span><span class="s2">= </span><span class="s1">Point3</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">hpr </span><span class="s2">= </span><span class="s1">Point3</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">evaluate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">cropFrom</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">addXyzHpr</span><span class="s2">(</span><span class="s6">0.0</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">)</span>
        <span class="s4"># Get points within bounds</span>
        <span class="s5">for </span><span class="s1">time</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr </span><span class="s5">in </span><span class="s1">oldPoints</span><span class="s2">:</span>
            <span class="s4"># Is it within the time?</span>
            <span class="s5">if </span><span class="s2">((</span><span class="s1">time </span><span class="s2">&gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cropFrom</span><span class="s2">) </span><span class="s5">and</span>
                <span class="s2">(</span><span class="s1">time </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cropTo</span><span class="s2">)):</span>
                <span class="s4"># Add it to the curve fitters</span>
                <span class="s1">t </span><span class="s2">= </span><span class="s1">time </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cropFrom</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">addXyzHpr</span><span class="s2">(</span><span class="s1">t</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">)</span>
                <span class="s4"># And the point set</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">pointSet</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s1">t</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">])</span>
        <span class="s4"># Add last point</span>
        <span class="s1">pos </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">hpr </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">evaluate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">cropTo</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">curveFitter</span><span class="s2">.</span><span class="s1">addXyzHpr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">cropTo </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cropFrom</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">hpr</span><span class="s2">)</span>
        <span class="s4"># Compute curve</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">computeCurves</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">loadCurveFromFile</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Use first directory in model path</span>
        <span class="s1">mPath </span><span class="s2">= </span><span class="s1">getModelPath</span><span class="s2">()</span>
        <span class="s5">if </span><span class="s1">mPath</span><span class="s2">.</span><span class="s1">getNumDirectories</span><span class="s2">() &gt; </span><span class="s6">0</span><span class="s2">:</span>
            <span class="s5">if </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">mPath</span><span class="s2">.</span><span class="s1">getDirectory</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)) == </span><span class="s3">'.'</span><span class="s2">:</span>
                <span class="s1">path </span><span class="s2">= </span><span class="s3">'.'</span>
            <span class="s5">else</span><span class="s2">:</span>
                <span class="s1">path </span><span class="s2">= </span><span class="s1">mPath</span><span class="s2">.</span><span class="s1">getDirectory</span><span class="s2">(</span><span class="s6">0</span><span class="s2">).</span><span class="s1">toOsSpecific</span><span class="s2">()</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">path </span><span class="s2">= </span><span class="s3">'.'</span>
        <span class="s5">if not </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">isdir</span><span class="s2">(</span><span class="s1">path</span><span class="s2">):</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">'MopathRecorder Info: Empty Model Path!'</span><span class="s2">)</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">'Using current directory'</span><span class="s2">)</span>
            <span class="s1">path </span><span class="s2">= </span><span class="s3">'.'</span>
        <span class="s1">mopathFilename </span><span class="s2">= </span><span class="s1">askopenfilename</span><span class="s2">(</span>
            <span class="s1">defaultextension </span><span class="s2">= </span><span class="s3">'.egg'</span><span class="s2">,</span>
            <span class="s1">filetypes </span><span class="s2">= ((</span><span class="s3">'Egg Files'</span><span class="s2">, </span><span class="s3">'*.egg'</span><span class="s2">),</span>
                         <span class="s2">(</span><span class="s3">'Bam Files'</span><span class="s2">, </span><span class="s3">'*.bam'</span><span class="s2">),</span>
                         <span class="s2">(</span><span class="s3">'All files'</span><span class="s2">, </span><span class="s3">'*'</span><span class="s2">)),</span>
            <span class="s1">initialdir </span><span class="s2">= </span><span class="s1">path</span><span class="s2">,</span>
            <span class="s1">title </span><span class="s2">= </span><span class="s3">'Load Nurbs Curve'</span><span class="s2">,</span>
            <span class="s1">parent </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">mopathFilename </span><span class="s5">and </span><span class="s1">mopathFilename </span><span class="s2">!= </span><span class="s3">'None'</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">reset</span><span class="s2">()</span>
            <span class="s1">nodePath </span><span class="s2">= </span><span class="s1">loader</span><span class="s2">.</span><span class="s1">loadModel</span><span class="s2">(</span>
                <span class="s1">Filename</span><span class="s2">.</span><span class="s1">fromOsSpecific</span><span class="s2">(</span><span class="s1">mopathFilename</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection </span><span class="s2">= </span><span class="s1">ParametricCurveCollection</span><span class="s2">()</span>
            <span class="s4"># MRM: Add error check</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">addCurves</span><span class="s2">(</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">node</span><span class="s2">())</span>
            <span class="s1">nodePath</span><span class="s2">.</span><span class="s1">removeNode</span><span class="s2">()</span>
            <span class="s5">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">:</span>
                <span class="s4"># Draw the curve</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">setCurves</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">nurbsCurveDrawer</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
                <span class="s4"># Save a pointset for this curve</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">extractPointSetFromCurveCollection</span><span class="s2">()</span>
            <span class="s5">else</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">reset</span><span class="s2">()</span>

    <span class="s5">def </span><span class="s1">saveCurveToFile</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Use first directory in model path</span>
        <span class="s1">mPath </span><span class="s2">= </span><span class="s1">getModelPath</span><span class="s2">()</span>
        <span class="s5">if </span><span class="s1">mPath</span><span class="s2">.</span><span class="s1">getNumDirectories</span><span class="s2">() &gt; </span><span class="s6">0</span><span class="s2">:</span>
            <span class="s5">if </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">mPath</span><span class="s2">.</span><span class="s1">getDirectory</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)) == </span><span class="s3">'.'</span><span class="s2">:</span>
                <span class="s1">path </span><span class="s2">= </span><span class="s3">'.'</span>
            <span class="s5">else</span><span class="s2">:</span>
                <span class="s1">path </span><span class="s2">= </span><span class="s1">mPath</span><span class="s2">.</span><span class="s1">getDirectory</span><span class="s2">(</span><span class="s6">0</span><span class="s2">).</span><span class="s1">toOsSpecific</span><span class="s2">()</span>
        <span class="s5">else</span><span class="s2">:</span>
            <span class="s1">path </span><span class="s2">= </span><span class="s3">'.'</span>
        <span class="s5">if not </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">isdir</span><span class="s2">(</span><span class="s1">path</span><span class="s2">):</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">'MopathRecorder Info: Empty Model Path!'</span><span class="s2">)</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s3">'Using current directory'</span><span class="s2">)</span>
            <span class="s1">path </span><span class="s2">= </span><span class="s3">'.'</span>
        <span class="s1">mopathFilename </span><span class="s2">= </span><span class="s1">asksaveasfilename</span><span class="s2">(</span>
            <span class="s1">defaultextension </span><span class="s2">= </span><span class="s3">'.egg'</span><span class="s2">,</span>
            <span class="s1">filetypes </span><span class="s2">= ((</span><span class="s3">'Egg Files'</span><span class="s2">, </span><span class="s3">'*.egg'</span><span class="s2">),</span>
                         <span class="s2">(</span><span class="s3">'Bam Files'</span><span class="s2">, </span><span class="s3">'*.bam'</span><span class="s2">),</span>
                         <span class="s2">(</span><span class="s3">'All files'</span><span class="s2">, </span><span class="s3">'*'</span><span class="s2">)),</span>
            <span class="s1">initialdir </span><span class="s2">= </span><span class="s1">path</span><span class="s2">,</span>
            <span class="s1">title </span><span class="s2">= </span><span class="s3">'Save Nurbs Curve as'</span><span class="s2">,</span>
            <span class="s1">parent </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">)</span>
        <span class="s5">if </span><span class="s1">mopathFilename</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">curveCollection</span><span class="s2">.</span><span class="s1">writeEgg</span><span class="s2">(</span><span class="s1">Filename</span><span class="s2">(</span><span class="s1">mopathFilename</span><span class="s2">))</span>

    <span class="s5">def </span><span class="s1">followTerrain</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">height </span><span class="s2">= </span><span class="s6">1.0</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">iRay</span><span class="s2">.</span><span class="s1">rayCollisionNodePath</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">)</span>
        <span class="s1">entry </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">iRay</span><span class="s2">.</span><span class="s1">pickGeom3D</span><span class="s2">()</span>
        <span class="s5">if </span><span class="s1">entry</span><span class="s2">:</span>
            <span class="s1">hitPtDist </span><span class="s2">= </span><span class="s1">Vec3</span><span class="s2">(</span><span class="s1">entry</span><span class="s2">.</span><span class="s1">getFromIntersectionPoint</span><span class="s2">()).</span><span class="s1">length</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">.</span><span class="s1">setZ</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodePath</span><span class="s2">, </span><span class="s1">height </span><span class="s2">- </span><span class="s1">hitPtDist</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">iRay</span><span class="s2">.</span><span class="s1">rayCollisionNodePath</span><span class="s2">.</span><span class="s1">reparentTo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">recorderNodePath</span><span class="s2">)</span>

    <span class="s4">## WIDGET UTILITY FUNCTIONS ##</span>
    <span class="s5">def </span><span class="s1">addWidget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">widget</span>

    <span class="s5">def </span><span class="s1">getWidget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">):</span>
        <span class="s5">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">]</span>

    <span class="s5">def </span><span class="s1">getVariable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">):</span>
        <span class="s5">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">variableDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">]</span>

    <span class="s5">def </span><span class="s1">createLabeledEntry</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">,</span>
                           <span class="s1">value </span><span class="s2">= </span><span class="s3">''</span><span class="s2">, </span><span class="s1">command </span><span class="s2">= </span><span class="s5">None</span><span class="s2">,</span>
                           <span class="s1">relief </span><span class="s2">= </span><span class="s3">'sunken'</span><span class="s2">, </span><span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">,</span>
                           <span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">, </span><span class="s1">width </span><span class="s2">= </span><span class="s6">12</span><span class="s2">):</span>
        <span class="s1">frame </span><span class="s2">= </span><span class="s1">Frame</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">)</span>
        <span class="s1">variable </span><span class="s2">= </span><span class="s1">StringVar</span><span class="s2">()</span>
        <span class="s1">variable</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">label </span><span class="s2">= </span><span class="s1">Label</span><span class="s2">(</span><span class="s1">frame</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s1">text</span><span class="s2">)</span>
        <span class="s1">label</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">label</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text </span><span class="s2">+ </span><span class="s3">'-Label'</span><span class="s2">] = </span><span class="s1">label</span>
        <span class="s1">entry </span><span class="s2">= </span><span class="s1">Entry</span><span class="s2">(</span><span class="s1">frame</span><span class="s2">, </span><span class="s1">width </span><span class="s2">= </span><span class="s1">width</span><span class="s2">, </span><span class="s1">relief </span><span class="s2">= </span><span class="s1">relief</span><span class="s2">,</span>
                      <span class="s1">textvariable </span><span class="s2">= </span><span class="s1">variable</span><span class="s2">)</span>
        <span class="s1">entry</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s1">expand</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">entry</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">entry</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">variableDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">variable</span>
        <span class="s5">if </span><span class="s1">command</span><span class="s2">:</span>
            <span class="s1">entry</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">'&lt;Return&gt;'</span><span class="s2">, </span><span class="s1">command</span><span class="s2">)</span>
        <span class="s1">frame</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">side</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s1">expand</span><span class="s2">)</span>
        <span class="s5">return </span><span class="s2">(</span><span class="s1">frame</span><span class="s2">, </span><span class="s1">label</span><span class="s2">, </span><span class="s1">entry</span><span class="s2">)</span>

    <span class="s5">def </span><span class="s1">createButton</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">, </span><span class="s1">command</span><span class="s2">,</span>
                     <span class="s1">side </span><span class="s2">= </span><span class="s3">'top'</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">):</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">Button</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s1">text</span><span class="s2">)</span>
        <span class="s4"># Do this after the widget so command isn't called on creation</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'command'</span><span class="s2">] = </span><span class="s1">command</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">side</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">fill</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s1">expand</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">widget</span>
        <span class="s5">return </span><span class="s1">widget</span>

    <span class="s5">def </span><span class="s1">createCheckbutton</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">,</span>
                          <span class="s1">balloonHelp</span><span class="s2">, </span><span class="s1">command</span><span class="s2">, </span><span class="s1">initialState</span><span class="s2">,</span>
                          <span class="s1">side </span><span class="s2">= </span><span class="s3">'top'</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">):</span>
        <span class="s1">bool </span><span class="s2">= </span><span class="s1">BooleanVar</span><span class="s2">()</span>
        <span class="s1">bool</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">initialState</span><span class="s2">)</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">Checkbutton</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s1">text</span><span class="s2">, </span><span class="s1">anchor </span><span class="s2">= </span><span class="s1">W</span><span class="s2">,</span>
                         <span class="s1">variable </span><span class="s2">= </span><span class="s1">bool</span><span class="s2">)</span>
        <span class="s4"># Do this after the widget so command isn't called on creation</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'command'</span><span class="s2">] = </span><span class="s1">command</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">side</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">fill</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s1">expand</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">widget</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">variableDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">bool</span>
        <span class="s5">return </span><span class="s1">widget</span>

    <span class="s5">def </span><span class="s1">createRadiobutton</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">, </span><span class="s1">side</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">,</span>
                          <span class="s1">balloonHelp</span><span class="s2">, </span><span class="s1">variable</span><span class="s2">, </span><span class="s1">value</span><span class="s2">,</span>
                          <span class="s1">command </span><span class="s2">= </span><span class="s5">None</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">):</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">Radiobutton</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, </span><span class="s1">text </span><span class="s2">= </span><span class="s1">text</span><span class="s2">, </span><span class="s1">anchor </span><span class="s2">= </span><span class="s1">W</span><span class="s2">,</span>
                             <span class="s1">variable </span><span class="s2">= </span><span class="s1">variable</span><span class="s2">, </span><span class="s1">value </span><span class="s2">= </span><span class="s1">value</span><span class="s2">)</span>
        <span class="s4"># Do this after the widget so command isn't called on creation</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'command'</span><span class="s2">] = </span><span class="s1">command</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">side</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">fill</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s1">expand</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">widget</span>
        <span class="s5">return </span><span class="s1">widget</span>

    <span class="s5">def </span><span class="s1">createFloater</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">,</span>
                      <span class="s1">command </span><span class="s2">= </span><span class="s5">None</span><span class="s2">, </span><span class="s1">min </span><span class="s2">= </span><span class="s6">0.0</span><span class="s2">, </span><span class="s1">resolution </span><span class="s2">= </span><span class="s5">None</span><span class="s2">,</span>
                      <span class="s1">maxVelocity </span><span class="s2">= </span><span class="s6">10.0</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'text'</span><span class="s2">] = </span><span class="s1">text</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'min'</span><span class="s2">] = </span><span class="s1">min</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'maxVelocity'</span><span class="s2">] = </span><span class="s1">maxVelocity</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'resolution'</span><span class="s2">] = </span><span class="s1">resolution</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">Floater</span><span class="s2">.</span><span class="s1">Floater</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>
        <span class="s4"># Do this after the widget so command isn't called on creation</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'command'</span><span class="s2">] = </span><span class="s1">command</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">widget</span>
        <span class="s5">return </span><span class="s1">widget</span>

    <span class="s5">def </span><span class="s1">createAngleDial</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">,</span>
                        <span class="s1">command </span><span class="s2">= </span><span class="s5">None</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'text'</span><span class="s2">] = </span><span class="s1">text</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">Dial</span><span class="s2">.</span><span class="s1">AngleDial</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>
        <span class="s4"># Do this after the widget so command isn't called on creation</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'command'</span><span class="s2">] = </span><span class="s1">command</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">widget</span>
        <span class="s5">return </span><span class="s1">widget</span>

    <span class="s5">def </span><span class="s1">createSlider</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">,</span>
                         <span class="s1">command </span><span class="s2">= </span><span class="s5">None</span><span class="s2">, </span><span class="s1">min </span><span class="s2">= </span><span class="s6">0.0</span><span class="s2">, </span><span class="s1">max </span><span class="s2">= </span><span class="s6">1.0</span><span class="s2">,</span>
                         <span class="s1">resolution </span><span class="s2">= </span><span class="s5">None</span><span class="s2">,</span>
                         <span class="s1">side </span><span class="s2">= </span><span class="s1">TOP</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'text'</span><span class="s2">] = </span><span class="s1">text</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'min'</span><span class="s2">] = </span><span class="s1">min</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'max'</span><span class="s2">] = </span><span class="s1">max</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'resolution'</span><span class="s2">] = </span><span class="s1">resolution</span>
        <span class="s4">#widget = apply(EntryScale.EntryScale, (parent,), kw)</span>
        <span class="s5">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">tkwidgets </span><span class="s5">import </span><span class="s1">Slider</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">Slider</span><span class="s2">.</span><span class="s1">Slider</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>
        <span class="s4"># Do this after the widget so command isn't called on creation</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'command'</span><span class="s2">] = </span><span class="s1">command</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">side</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">fill</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s1">expand</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">widget</span>
        <span class="s5">return </span><span class="s1">widget</span>

    <span class="s5">def </span><span class="s1">createEntryScale</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">,</span>
                         <span class="s1">command </span><span class="s2">= </span><span class="s5">None</span><span class="s2">, </span><span class="s1">min </span><span class="s2">= </span><span class="s6">0.0</span><span class="s2">, </span><span class="s1">max </span><span class="s2">= </span><span class="s6">1.0</span><span class="s2">,</span>
                         <span class="s1">resolution </span><span class="s2">= </span><span class="s5">None</span><span class="s2">,</span>
                         <span class="s1">side </span><span class="s2">= </span><span class="s1">TOP</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">1</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'text'</span><span class="s2">] = </span><span class="s1">text</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'min'</span><span class="s2">] = </span><span class="s1">min</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'max'</span><span class="s2">] = </span><span class="s1">max</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'resolution'</span><span class="s2">] = </span><span class="s1">resolution</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">EntryScale</span><span class="s2">.</span><span class="s1">EntryScale</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>
        <span class="s4"># Do this after the widget so command isn't called on creation</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'command'</span><span class="s2">] = </span><span class="s1">command</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">side</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">fill</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s1">expand</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">widget</span>
        <span class="s5">return </span><span class="s1">widget</span>

    <span class="s5">def </span><span class="s1">createVector2Entry</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">,</span>
                           <span class="s1">command </span><span class="s2">= </span><span class="s5">None</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
        <span class="s4"># Set label's text</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'text'</span><span class="s2">] = </span><span class="s1">text</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">VectorWidgets</span><span class="s2">.</span><span class="s1">Vector2Entry</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>
        <span class="s4"># Do this after the widget so command isn't called on creation</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'command'</span><span class="s2">] = </span><span class="s1">command</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">widget</span>
        <span class="s5">return </span><span class="s1">widget</span>

    <span class="s5">def </span><span class="s1">createVector3Entry</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">,</span>
                           <span class="s1">command </span><span class="s2">= </span><span class="s5">None</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
        <span class="s4"># Set label's text</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'text'</span><span class="s2">] = </span><span class="s1">text</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">VectorWidgets</span><span class="s2">.</span><span class="s1">Vector3Entry</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>
        <span class="s4"># Do this after the widget so command isn't called on creation</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'command'</span><span class="s2">] = </span><span class="s1">command</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">widget</span>
        <span class="s5">return </span><span class="s1">widget</span>

    <span class="s5">def </span><span class="s1">createColorEntry</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">,</span>
                         <span class="s1">command </span><span class="s2">= </span><span class="s5">None</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
        <span class="s4"># Set label's text</span>
        <span class="s1">kw</span><span class="s2">[</span><span class="s3">'text'</span><span class="s2">] = </span><span class="s1">text</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">VectorWidgets</span><span class="s2">.</span><span class="s1">ColorEntry</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>
        <span class="s4"># Do this after the widget so command isn't called on creation</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'command'</span><span class="s2">] = </span><span class="s1">command</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">widget</span>
        <span class="s5">return </span><span class="s1">widget</span>

    <span class="s5">def </span><span class="s1">createOptionMenu</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">,</span>
                         <span class="s1">items</span><span class="s2">, </span><span class="s1">command</span><span class="s2">):</span>
        <span class="s1">optionVar </span><span class="s2">= </span><span class="s1">StringVar</span><span class="s2">()</span>
        <span class="s5">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">items</span><span class="s2">) &gt; </span><span class="s6">0</span><span class="s2">:</span>
            <span class="s1">optionVar</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">items</span><span class="s2">[</span><span class="s6">0</span><span class="s2">])</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">Pmw</span><span class="s2">.</span><span class="s1">OptionMenu</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">, </span><span class="s1">labelpos </span><span class="s2">= </span><span class="s1">W</span><span class="s2">, </span><span class="s1">label_text </span><span class="s2">= </span><span class="s1">text</span><span class="s2">,</span>
                                <span class="s1">label_width </span><span class="s2">= </span><span class="s6">12</span><span class="s2">, </span><span class="s1">menu_tearoff </span><span class="s2">= </span><span class="s6">1</span><span class="s2">,</span>
                                <span class="s1">menubutton_textvariable </span><span class="s2">= </span><span class="s1">optionVar</span><span class="s2">,</span>
                                <span class="s1">items </span><span class="s2">= </span><span class="s1">items</span><span class="s2">)</span>
        <span class="s4"># Do this after the widget so command isn't called on creation</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'command'</span><span class="s2">] = </span><span class="s1">command</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">.</span><span class="s1">component</span><span class="s2">(</span><span class="s3">'menubutton'</span><span class="s2">), </span><span class="s1">balloonHelp</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">widget</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">variableDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">optionVar</span>
        <span class="s5">return </span><span class="s1">optionVar</span>

    <span class="s5">def </span><span class="s1">createComboBox</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">, </span><span class="s1">category</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">,</span>
                       <span class="s1">items</span><span class="s2">, </span><span class="s1">command</span><span class="s2">, </span><span class="s1">history </span><span class="s2">= </span><span class="s6">0</span><span class="s2">,</span>
                       <span class="s1">side </span><span class="s2">= </span><span class="s1">LEFT</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s6">0</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">X</span><span class="s2">):</span>
        <span class="s1">widget </span><span class="s2">= </span><span class="s1">Pmw</span><span class="s2">.</span><span class="s1">ComboBox</span><span class="s2">(</span><span class="s1">parent</span><span class="s2">,</span>
                              <span class="s1">labelpos </span><span class="s2">= </span><span class="s1">W</span><span class="s2">,</span>
                              <span class="s1">label_text </span><span class="s2">= </span><span class="s1">text</span><span class="s2">,</span>
                              <span class="s1">label_anchor </span><span class="s2">= </span><span class="s3">'e'</span><span class="s2">,</span>
                              <span class="s1">label_width </span><span class="s2">= </span><span class="s6">12</span><span class="s2">,</span>
                              <span class="s1">entry_width </span><span class="s2">= </span><span class="s6">16</span><span class="s2">,</span>
                              <span class="s1">history </span><span class="s2">= </span><span class="s1">history</span><span class="s2">,</span>
                              <span class="s1">scrolledlist_items </span><span class="s2">= </span><span class="s1">items</span><span class="s2">)</span>
        <span class="s4"># Don't allow user to edit entryfield</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">configure</span><span class="s2">(</span><span class="s1">entryfield_entry_state </span><span class="s2">= </span><span class="s3">'disabled'</span><span class="s2">)</span>
        <span class="s4"># Select first item if it exists</span>
        <span class="s5">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">items</span><span class="s2">) &gt; </span><span class="s6">0</span><span class="s2">:</span>
            <span class="s1">widget</span><span class="s2">.</span><span class="s1">selectitem</span><span class="s2">(</span><span class="s1">items</span><span class="s2">[</span><span class="s6">0</span><span class="s2">])</span>
        <span class="s4"># Bind selection command</span>
        <span class="s1">widget</span><span class="s2">[</span><span class="s3">'selectioncommand'</span><span class="s2">] = </span><span class="s1">command</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">pack</span><span class="s2">(</span><span class="s1">side </span><span class="s2">= </span><span class="s1">side</span><span class="s2">, </span><span class="s1">fill </span><span class="s2">= </span><span class="s1">fill</span><span class="s2">, </span><span class="s1">expand </span><span class="s2">= </span><span class="s1">expand</span><span class="s2">)</span>
        <span class="s4"># Bind help</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">balloonHelp</span><span class="s2">)</span>
        <span class="s4"># Record widget</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">widgetDict</span><span class="s2">[</span><span class="s1">category </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">text</span><span class="s2">] = </span><span class="s1">widget</span>
        <span class="s5">return </span><span class="s1">widget</span>

    <span class="s5">def </span><span class="s1">makeCameraWindow</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># First, we need to make a new layer on the window.</span>
        <span class="s1">chan </span><span class="s2">= </span><span class="s1">base</span><span class="s2">.</span><span class="s1">win</span><span class="s2">.</span><span class="s1">getChannel</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cLayer </span><span class="s2">= </span><span class="s1">chan</span><span class="s2">.</span><span class="s1">makeLayer</span><span class="s2">(</span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">layerIndex </span><span class="s2">= </span><span class="s6">1</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cDr </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cLayer</span><span class="s2">.</span><span class="s1">makeDisplayRegion</span><span class="s2">(</span><span class="s6">0.6</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0.4</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cDr</span><span class="s2">.</span><span class="s1">setClearDepthActive</span><span class="s2">(</span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cDr</span><span class="s2">.</span><span class="s1">setClearColorActive</span><span class="s2">(</span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cDr</span><span class="s2">.</span><span class="s1">setClearColor</span><span class="s2">(</span><span class="s1">Vec4</span><span class="s2">(</span><span class="s6">0</span><span class="s2">))</span>

        <span class="s4"># It gets its own camera</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cCamera </span><span class="s2">= </span><span class="s1">render</span><span class="s2">.</span><span class="s1">attachNewNode</span><span class="s2">(</span><span class="s3">'cCamera'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cCamNode </span><span class="s2">= </span><span class="s1">Camera</span><span class="s2">(</span><span class="s3">'cCam'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cLens </span><span class="s2">= </span><span class="s1">PerspectiveLens</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cLens</span><span class="s2">.</span><span class="s1">setFov</span><span class="s2">(</span><span class="s6">40</span><span class="s2">, </span><span class="s6">40</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cLens</span><span class="s2">.</span><span class="s1">setNear</span><span class="s2">(</span><span class="s6">0.1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cLens</span><span class="s2">.</span><span class="s1">setFar</span><span class="s2">(</span><span class="s6">100.0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cCamNode</span><span class="s2">.</span><span class="s1">setLens</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">cLens</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cCamNode</span><span class="s2">.</span><span class="s1">setScene</span><span class="s2">(</span><span class="s1">render</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cCam </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cCamera</span><span class="s2">.</span><span class="s1">attachNewNode</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">cCamNode</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">cDr</span><span class="s2">.</span><span class="s1">setCamera</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">cCam</span><span class="s2">)</span>
</pre>
</body>
</html>
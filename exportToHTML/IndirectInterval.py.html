<html>
<head>
<title>IndirectInterval.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #cf8e6d;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
IndirectInterval.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;IndirectInterval module: contains the IndirectInterval class&quot;&quot;&quot;</span>

<span class="s1">__all__ </span><span class="s2">= [</span><span class="s3">'IndirectInterval'</span><span class="s2">]</span>

<span class="s4">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">core </span><span class="s4">import </span><span class="s2">*</span>
<span class="s4">from </span><span class="s1">panda3d</span><span class="s2">.</span><span class="s1">direct </span><span class="s4">import </span><span class="s2">*</span>
<span class="s4">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">directnotify</span><span class="s2">.</span><span class="s1">DirectNotifyGlobal </span><span class="s4">import </span><span class="s2">*</span>
<span class="s4">from </span><span class="s2">. </span><span class="s4">import </span><span class="s1">Interval</span>
<span class="s4">from </span><span class="s2">. </span><span class="s4">import </span><span class="s1">LerpBlendHelpers</span>

<span class="s4">class </span><span class="s1">IndirectInterval</span><span class="s2">(</span><span class="s1">Interval</span><span class="s2">.</span><span class="s1">Interval</span><span class="s2">):</span>
    <span class="s0">&quot;&quot;&quot; 
    This class can be used to play samples of another interval, so 
    that only a subset of the interval is played, or the time is 
    compressed, or some such nonsense. 
 
    It keeps a reference to the interval itself and repeatedly calls 
    setT() on it, rather than actually starting the interval or 
    copying its members like Sequence() or Parallel().  This means two 
    IndirectIntervals that operate on the same nested interval may 
    have some interaction that you should be aware of. 
    &quot;&quot;&quot;</span>

    <span class="s5"># Interval counter</span>
    <span class="s1">indirectIntervalNum </span><span class="s2">= </span><span class="s6">1</span>

    <span class="s1">notify </span><span class="s2">= </span><span class="s1">directNotify</span><span class="s2">.</span><span class="s1">newCategory</span><span class="s2">(</span><span class="s3">'IndirectInterval'</span><span class="s2">)</span>

    <span class="s5"># Class methods</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">interval</span><span class="s2">,</span>
                 <span class="s1">startT </span><span class="s2">= </span><span class="s6">0</span><span class="s2">, </span><span class="s1">endT </span><span class="s2">= </span><span class="s4">None</span><span class="s2">, </span><span class="s1">playRate </span><span class="s2">= </span><span class="s6">1</span><span class="s2">,</span>
                 <span class="s1">duration </span><span class="s2">= </span><span class="s4">None</span><span class="s2">, </span><span class="s1">blendType </span><span class="s2">= </span><span class="s3">'noBlend'</span><span class="s2">, </span><span class="s1">name </span><span class="s2">= </span><span class="s4">None</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">interval </span><span class="s2">= </span><span class="s1">interval</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">startAtStart </span><span class="s2">= (</span><span class="s1">startT </span><span class="s2">== </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">endAtEnd </span><span class="s2">= (</span><span class="s1">endT </span><span class="s2">== </span><span class="s4">None or </span><span class="s1">endT </span><span class="s2">== </span><span class="s1">interval</span><span class="s2">.</span><span class="s1">getDuration</span><span class="s2">())</span>

        <span class="s4">if </span><span class="s1">endT </span><span class="s2">== </span><span class="s4">None</span><span class="s2">:</span>
            <span class="s1">endT </span><span class="s2">= </span><span class="s1">interval</span><span class="s2">.</span><span class="s1">getDuration</span><span class="s2">()</span>

        <span class="s4">if </span><span class="s1">duration </span><span class="s2">== </span><span class="s4">None</span><span class="s2">:</span>
            <span class="s1">duration </span><span class="s2">= </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">endT </span><span class="s2">- </span><span class="s1">startT</span><span class="s2">) / </span><span class="s1">playRate</span>

        <span class="s4">if </span><span class="s2">(</span><span class="s1">name </span><span class="s2">== </span><span class="s4">None</span><span class="s2">):</span>
            <span class="s1">name </span><span class="s2">= (</span><span class="s3">'IndirectInterval-%d' </span><span class="s2">%</span>
                    <span class="s1">IndirectInterval</span><span class="s2">.</span><span class="s1">indirectIntervalNum</span><span class="s2">)</span>
            <span class="s1">IndirectInterval</span><span class="s2">.</span><span class="s1">indirectIntervalNum </span><span class="s2">+= </span><span class="s6">1</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">startT </span><span class="s2">= </span><span class="s1">startT</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">endT </span><span class="s2">= </span><span class="s1">endT</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">deltaT </span><span class="s2">= </span><span class="s1">endT </span><span class="s2">- </span><span class="s1">startT</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">blendType </span><span class="s2">= </span><span class="s1">LerpBlendHelpers</span><span class="s2">.</span><span class="s1">getBlend</span><span class="s2">(</span><span class="s1">blendType</span><span class="s2">)</span>

        <span class="s1">Interval</span><span class="s2">.</span><span class="s1">Interval</span><span class="s2">.</span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">duration</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">__calcT</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">t</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">startT </span><span class="s2">+ </span><span class="s1">self</span><span class="s2">.</span><span class="s1">deltaT </span><span class="s2">* </span><span class="s1">self</span><span class="s2">.</span><span class="s1">blendType</span><span class="s2">(</span><span class="s1">t </span><span class="s2">/ </span><span class="s1">self</span><span class="s2">.</span><span class="s1">duration</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">privInitialize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">t</span><span class="s2">):</span>
        <span class="s1">state </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">getState</span><span class="s2">()</span>
        <span class="s4">if </span><span class="s1">state </span><span class="s2">== </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SInitial </span><span class="s4">or </span><span class="s1">state </span><span class="s2">== </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SFinal</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privInitialize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__calcT</span><span class="s2">(</span><span class="s1">t</span><span class="s2">))</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privStep</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__calcT</span><span class="s2">(</span><span class="s1">t</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">currT </span><span class="s2">= </span><span class="s1">t</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SStarted</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privPostEvent</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">privInstant</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">state </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">getState</span><span class="s2">()</span>
        <span class="s4">if </span><span class="s2">(</span><span class="s1">state </span><span class="s2">== </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SInitial </span><span class="s4">or </span><span class="s1">state </span><span class="s2">== </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SFinal</span><span class="s2">) </span><span class="s4">and </span><span class="s1">\</span>
           <span class="s1">self</span><span class="s2">.</span><span class="s1">endAtEnd</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privInstant</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">currT </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getDuration</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privPostEvent</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">intervalDone</span><span class="s2">()</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">state </span><span class="s2">== </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SInitial </span><span class="s4">or </span><span class="s1">state </span><span class="s2">== </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SFinal</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privInitialize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">startT</span><span class="s2">)</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privStep</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">startT</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">privFinalize</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">privStep</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">t</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privStep</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__calcT</span><span class="s2">(</span><span class="s1">t</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">currT </span><span class="s2">= </span><span class="s1">t</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SStarted</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privPostEvent</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">privFinalize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">endAtEnd</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privFinalize</span><span class="s2">()</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privStep</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">endT</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privInterrupt</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">currT </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getDuration</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SFinal</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privPostEvent</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">intervalDone</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">privReverseInitialize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">t</span><span class="s2">):</span>
        <span class="s1">state </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">getState</span><span class="s2">()</span>
        <span class="s4">if </span><span class="s1">state </span><span class="s2">== </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SInitial </span><span class="s4">or </span><span class="s1">state </span><span class="s2">== </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SFinal</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privReverseInitialize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__calcT</span><span class="s2">(</span><span class="s1">t</span><span class="s2">))</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privStep</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__calcT</span><span class="s2">(</span><span class="s1">t</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">currT </span><span class="s2">= </span><span class="s1">t</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SStarted</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privPostEvent</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">privReverseInstant</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">state </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">getState</span><span class="s2">()</span>
        <span class="s4">if </span><span class="s2">(</span><span class="s1">state </span><span class="s2">== </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SInitial </span><span class="s4">or </span><span class="s1">state </span><span class="s2">== </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SFinal</span><span class="s2">) </span><span class="s4">and </span><span class="s1">\</span>
           <span class="s1">self</span><span class="s2">.</span><span class="s1">startAtStart</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privReverseInstant</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">currT </span><span class="s2">= </span><span class="s6">0</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privPostEvent</span><span class="s2">()</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">state </span><span class="s2">== </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SInitial </span><span class="s4">or </span><span class="s1">state </span><span class="s2">== </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SFinal</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privReverseInitialize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">endT</span><span class="s2">)</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privStep</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">endT</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">privReverseFinalize</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">privReverseFinalize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">startAtStart</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privReverseFinalize</span><span class="s2">()</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privStep</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">endT</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privInterrupt</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">currT </span><span class="s2">= </span><span class="s6">0</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s1">CInterval</span><span class="s2">.</span><span class="s1">SInitial</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privPostEvent</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">privInterrupt</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privInterrupt</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">interval</span><span class="s2">.</span><span class="s1">privPostEvent</span><span class="s2">()</span>
</pre>
</body>
</html>
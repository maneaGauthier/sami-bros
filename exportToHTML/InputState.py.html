<html>
<head>
<title>InputState.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
InputState.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">directnotify </span><span class="s0">import </span><span class="s1">DirectNotifyGlobal</span>
<span class="s0">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">showbase </span><span class="s0">import </span><span class="s1">DirectObject</span>
<span class="s0">from </span><span class="s1">direct</span><span class="s2">.</span><span class="s1">showbase</span><span class="s2">.</span><span class="s1">PythonUtil </span><span class="s0">import </span><span class="s1">SerialNumGen</span>

<span class="s3"># internal class, don't create these on your own</span>
<span class="s0">class </span><span class="s1">InputStateToken</span><span class="s2">:</span>
    <span class="s1">_SerialGen </span><span class="s2">= </span><span class="s1">SerialNumGen</span><span class="s2">()</span>
    <span class="s1">Inval </span><span class="s2">= </span><span class="s4">'invalidatedToken'</span>
    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">inputState</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_id </span><span class="s2">= </span><span class="s1">InputStateToken</span><span class="s2">.</span><span class="s1">_SerialGen</span><span class="s2">.</span><span class="s1">next</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_hash </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_id</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_inputState </span><span class="s2">= </span><span class="s1">inputState</span>
    <span class="s0">def </span><span class="s1">release</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># subclasses will override</span>
        <span class="s0">assert False</span>
    <span class="s0">def </span><span class="s1">isValid</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_id </span><span class="s2">!= </span><span class="s1">InputStateToken</span><span class="s2">.</span><span class="s1">Inval</span>
    <span class="s0">def </span><span class="s1">invalidate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_id </span><span class="s2">= </span><span class="s1">InputStateToken</span><span class="s2">.</span><span class="s1">Inval</span>
    <span class="s0">def </span><span class="s1">__hash__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_hash</span>

    <span class="s3">#snake_case alias:</span>
    <span class="s1">is_valid </span><span class="s2">= </span><span class="s1">isValid</span>

<span class="s0">class </span><span class="s1">InputStateWatchToken</span><span class="s2">(</span><span class="s1">InputStateToken</span><span class="s2">, </span><span class="s1">DirectObject</span><span class="s2">.</span><span class="s1">DirectObject</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">release</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_inputState</span><span class="s2">.</span><span class="s1">_ignore</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ignoreAll</span><span class="s2">()</span>
<span class="s0">class </span><span class="s1">InputStateForceToken</span><span class="s2">(</span><span class="s1">InputStateToken</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">release</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_inputState</span><span class="s2">.</span><span class="s1">_unforce</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

<span class="s0">class </span><span class="s1">InputStateTokenGroup</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_tokens </span><span class="s2">= []</span>
    <span class="s0">def </span><span class="s1">addToken</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">token</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_tokens</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">token</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">release</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">token </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tokens</span><span class="s2">:</span>
            <span class="s1">token</span><span class="s2">.</span><span class="s1">release</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_tokens </span><span class="s2">= []</span>

    <span class="s3">#snake_case alias:</span>
    <span class="s1">add_token </span><span class="s2">= </span><span class="s1">addToken</span>

<span class="s0">class </span><span class="s1">InputState</span><span class="s2">(</span><span class="s1">DirectObject</span><span class="s2">.</span><span class="s1">DirectObject</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot; 
    InputState is for tracking the on/off state of some events. 
    The initial usage is to watch some keyboard keys so that another 
    task can poll the key states.  By the way, in general polling is 
    not a good idea, but it is useful in some situations.  Know when 
    to use it:)  If in doubt, don't use this class and listen for 
    events instead. 
    &quot;&quot;&quot;</span>

    <span class="s1">notify </span><span class="s2">= </span><span class="s1">DirectNotifyGlobal</span><span class="s2">.</span><span class="s1">directNotify</span><span class="s2">.</span><span class="s1">newCategory</span><span class="s2">(</span><span class="s4">&quot;InputState&quot;</span><span class="s2">)</span>

    <span class="s3"># standard input sources</span>
    <span class="s1">WASD </span><span class="s2">= </span><span class="s4">'WASD'</span>
    <span class="s1">QE </span><span class="s2">= </span><span class="s4">'QE'</span>
    <span class="s1">ArrowKeys </span><span class="s2">= </span><span class="s4">'ArrowKeys'</span>
    <span class="s1">Keyboard </span><span class="s2">= </span><span class="s4">'Keyboard'</span>
    <span class="s1">Mouse </span><span class="s2">= </span><span class="s4">'Mouse'</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># stateName-&gt;set(SourceNames)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_state </span><span class="s2">= {}</span>
        <span class="s3"># stateName-&gt;set(SourceNames)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOn </span><span class="s2">= {}</span>
        <span class="s3"># stateName-&gt;set(SourceNames)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOff </span><span class="s2">= {}</span>
        <span class="s3"># tables to look up the info needed to undo operations</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_token2inputSource </span><span class="s2">= {}</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_token2forceInfo </span><span class="s2">= {}</span>
        <span class="s3"># inputSource-&gt;token-&gt;(name, eventOn, eventOff)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_watching </span><span class="s2">= {}</span>
        <span class="s0">assert </span><span class="s1">self</span><span class="s2">.</span><span class="s1">debugPrint</span><span class="s2">(</span><span class="s4">&quot;InputState()&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">delete</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_watching</span>
        <span class="s0">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_token2forceInfo</span>
        <span class="s0">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_token2inputSource</span>
        <span class="s0">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOff</span>
        <span class="s0">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOn</span>
        <span class="s0">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_state</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ignoreAll</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">isSet</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">inputSource</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        returns True/False 
        &quot;&quot;&quot;</span>
        <span class="s3">#assert self.debugPrint(&quot;isSet(name=%s)&quot;%(name))</span>
        <span class="s0">if </span><span class="s1">name </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOn</span><span class="s2">:</span>
            <span class="s0">return True</span>
        <span class="s0">elif </span><span class="s1">name </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOff</span><span class="s2">:</span>
            <span class="s0">return False</span>
        <span class="s0">if </span><span class="s1">inputSource</span><span class="s2">:</span>
            <span class="s1">s </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_state</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">s</span><span class="s2">:</span>
                <span class="s0">return </span><span class="s1">inputSource </span><span class="s0">in </span><span class="s1">s</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s0">return False</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">name </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_state</span>

    <span class="s0">def </span><span class="s1">getEventName</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s4">&quot;InputState-%s&quot; </span><span class="s2">% (</span><span class="s1">name</span><span class="s2">,)</span>

    <span class="s0">def </span><span class="s1">set</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">isActive</span><span class="s2">, </span><span class="s1">inputSource</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">self</span><span class="s2">.</span><span class="s1">debugPrint</span><span class="s2">(</span><span class="s4">&quot;set(name=%s, isActive=%s, inputSource=%s)&quot;</span><span class="s2">%(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">isActive</span><span class="s2">, </span><span class="s1">inputSource</span><span class="s2">))</span>
        <span class="s3"># inputSource is a string that identifies where this input change</span>
        <span class="s3"># is coming from (like 'WASD', 'ArrowKeys', etc.)</span>
        <span class="s3"># Each unique inputSource is allowed to influence this input item</span>
        <span class="s3"># once: it's either 'active' or 'not active'. If at least one source</span>
        <span class="s3"># activates this input item, the input item is considered to be active</span>
        <span class="s0">if </span><span class="s1">inputSource </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">inputSource </span><span class="s2">= </span><span class="s4">'anonymous'</span>
        <span class="s0">if </span><span class="s1">isActive</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_state</span><span class="s2">.</span><span class="s1">setdefault</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">set</span><span class="s2">())</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_state</span><span class="s2">[</span><span class="s1">name</span><span class="s2">].</span><span class="s1">add</span><span class="s2">(</span><span class="s1">inputSource</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">name </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_state</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_state</span><span class="s2">[</span><span class="s1">name</span><span class="s2">].</span><span class="s1">discard</span><span class="s2">(</span><span class="s1">inputSource</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_state</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]) == </span><span class="s6">0</span><span class="s2">:</span>
                    <span class="s0">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_state</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]</span>
        <span class="s3"># We change the name before sending it because this may</span>
        <span class="s3"># be the same name that messenger used to call InputState.set()</span>
        <span class="s3"># this avoids running in circles:</span>
        <span class="s1">messenger</span><span class="s2">.</span><span class="s1">send</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">getEventName</span><span class="s2">(</span><span class="s1">name</span><span class="s2">), [</span><span class="s1">self</span><span class="s2">.</span><span class="s1">isSet</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)])</span>

    <span class="s0">def </span><span class="s1">releaseInputs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s3"># call this to act as if all inputs affecting this state have been released</span>
        <span class="s0">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_state</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">watch</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">eventOn</span><span class="s2">, </span><span class="s1">eventOff</span><span class="s2">, </span><span class="s1">startState</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">inputSource</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        This returns a token; hold onto the token and call token.release() when 
        you no longer want to watch for these events. 
 
        Example:: 
 
            # set up 
            token = inputState.watch('forward', 'w', 'w-up', inputSource=inputState.WASD) 
            ... 
            # tear down 
            token.release() 
        &quot;&quot;&quot;</span>
        <span class="s0">assert </span><span class="s1">self</span><span class="s2">.</span><span class="s1">debugPrint</span><span class="s2">(</span>
            <span class="s4">&quot;watch(name=%s, eventOn=%s, eventOff=%s, startState=%s)&quot;</span><span class="s2">%(</span>
            <span class="s1">name</span><span class="s2">, </span><span class="s1">eventOn</span><span class="s2">, </span><span class="s1">eventOff</span><span class="s2">, </span><span class="s1">startState</span><span class="s2">))</span>
        <span class="s0">if </span><span class="s1">inputSource </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">inputSource </span><span class="s2">= </span><span class="s4">&quot;eventPair('%s','%s')&quot; </span><span class="s2">% (</span><span class="s1">eventOn</span><span class="s2">, </span><span class="s1">eventOff</span><span class="s2">)</span>
        <span class="s3"># Do we really need to reset the input state just because</span>
        <span class="s3"># we're watching it?  Remember, there may be multiple things</span>
        <span class="s3"># watching this input state.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">startState</span><span class="s2">, </span><span class="s1">inputSource</span><span class="s2">)</span>
        <span class="s1">token </span><span class="s2">= </span><span class="s1">InputStateWatchToken</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s3"># make the token listen for the events, to allow multiple listeners for the same event</span>
        <span class="s1">token</span><span class="s2">.</span><span class="s1">accept</span><span class="s2">(</span><span class="s1">eventOn</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">set</span><span class="s2">, [</span><span class="s1">name</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s1">inputSource</span><span class="s2">])</span>
        <span class="s1">token</span><span class="s2">.</span><span class="s1">accept</span><span class="s2">(</span><span class="s1">eventOff</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">set</span><span class="s2">, [</span><span class="s1">name</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">inputSource</span><span class="s2">])</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_token2inputSource</span><span class="s2">[</span><span class="s1">token</span><span class="s2">] = </span><span class="s1">inputSource</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_watching</span><span class="s2">.</span><span class="s1">setdefault</span><span class="s2">(</span><span class="s1">inputSource</span><span class="s2">, {})</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_watching</span><span class="s2">[</span><span class="s1">inputSource</span><span class="s2">][</span><span class="s1">token</span><span class="s2">] = (</span><span class="s1">name</span><span class="s2">, </span><span class="s1">eventOn</span><span class="s2">, </span><span class="s1">eventOff</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">token</span>

    <span class="s0">def </span><span class="s1">watchWithModifiers</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">event</span><span class="s2">, </span><span class="s1">startState</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">inputSource</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s1">patterns </span><span class="s2">= (</span><span class="s4">'%s'</span><span class="s2">, </span><span class="s4">'control-%s'</span><span class="s2">, </span><span class="s4">'shift-control-%s'</span><span class="s2">, </span><span class="s4">'alt-%s'</span><span class="s2">,</span>
                    <span class="s4">'control-alt-%s'</span><span class="s2">, </span><span class="s4">'shift-%s'</span><span class="s2">, </span><span class="s4">'shift-alt-%s'</span><span class="s2">)</span>
        <span class="s1">tGroup </span><span class="s2">= </span><span class="s1">InputStateTokenGroup</span><span class="s2">()</span>
        <span class="s0">for </span><span class="s1">pattern </span><span class="s0">in </span><span class="s1">patterns</span><span class="s2">:</span>
            <span class="s1">tGroup</span><span class="s2">.</span><span class="s1">addToken</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">watch</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">pattern </span><span class="s2">% </span><span class="s1">event</span><span class="s2">, </span><span class="s4">'%s-up' </span><span class="s2">% </span><span class="s1">event</span><span class="s2">, </span><span class="s1">startState</span><span class="s2">=</span><span class="s1">startState</span><span class="s2">, </span><span class="s1">inputSource</span><span class="s2">=</span><span class="s1">inputSource</span><span class="s2">))</span>
        <span class="s0">return </span><span class="s1">tGroup</span>

    <span class="s0">def </span><span class="s1">_ignore</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">token</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Undo a watch(). Don't call this directly, call release() on the token that watch() returned. 
        &quot;&quot;&quot;</span>
        <span class="s1">inputSource </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_token2inputSource</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s1">token</span><span class="s2">)</span>
        <span class="s1">name</span><span class="s2">, </span><span class="s1">eventOn</span><span class="s2">, </span><span class="s1">eventOff </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_watching</span><span class="s2">[</span><span class="s1">inputSource</span><span class="s2">].</span><span class="s1">pop</span><span class="s2">(</span><span class="s1">token</span><span class="s2">)</span>
        <span class="s1">token</span><span class="s2">.</span><span class="s1">invalidate</span><span class="s2">()</span>
        <span class="s1">DirectObject</span><span class="s2">.</span><span class="s1">DirectObject</span><span class="s2">.</span><span class="s1">ignore</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">eventOn</span><span class="s2">)</span>
        <span class="s1">DirectObject</span><span class="s2">.</span><span class="s1">DirectObject</span><span class="s2">.</span><span class="s1">ignore</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">eventOff</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_watching</span><span class="s2">[</span><span class="s1">inputSource</span><span class="s2">]) == </span><span class="s6">0</span><span class="s2">:</span>
            <span class="s0">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_watching</span><span class="s2">[</span><span class="s1">inputSource</span><span class="s2">]</span>

        <span class="s3"># I commented this out because we shouldn't be modifying an</span>
        <span class="s3"># input state simply because we're not looking at it anymore.</span>
        <span class="s3"># self.set(name, False, inputSource)</span>


    <span class="s0">def </span><span class="s1">force</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">inputSource</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Force isSet(name) to return 'value'. 
 
        This returns a token; hold onto the token and call token.release() when 
        you no longer want to force the state. 
 
        Example:: 
 
            # set up 
            token = inputState.force('forward', True, inputSource='myForwardForcer') 
            ... 
            # tear down 
            token.release() 
        &quot;&quot;&quot;</span>
        <span class="s1">token </span><span class="s2">= </span><span class="s1">InputStateForceToken</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_token2forceInfo</span><span class="s2">[</span><span class="s1">token</span><span class="s2">] = (</span><span class="s1">name</span><span class="s2">, </span><span class="s1">inputSource</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">value</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">name </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOff</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">notify</span><span class="s2">.</span><span class="s1">error</span><span class="s2">(</span>
                    <span class="s4">&quot;%s is trying to force '%s' to ON, but '%s' is already being forced OFF by %s&quot; </span><span class="s2">%</span>
                    <span class="s2">(</span><span class="s1">inputSource</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOff</span><span class="s2">[</span><span class="s1">name</span><span class="s2">])</span>
                    <span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOn</span><span class="s2">.</span><span class="s1">setdefault</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">set</span><span class="s2">())</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOn</span><span class="s2">[</span><span class="s1">name</span><span class="s2">].</span><span class="s1">add</span><span class="s2">(</span><span class="s1">inputSource</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">name </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOn</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">notify</span><span class="s2">.</span><span class="s1">error</span><span class="s2">(</span>
                    <span class="s4">&quot;%s is trying to force '%s' to OFF, but '%s' is already being forced ON by %s&quot; </span><span class="s2">%</span>
                    <span class="s2">(</span><span class="s1">inputSource</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOn</span><span class="s2">[</span><span class="s1">name</span><span class="s2">])</span>
                    <span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOff</span><span class="s2">.</span><span class="s1">setdefault</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">set</span><span class="s2">())</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOff</span><span class="s2">[</span><span class="s1">name</span><span class="s2">].</span><span class="s1">add</span><span class="s2">(</span><span class="s1">inputSource</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">token</span>

    <span class="s0">def </span><span class="s1">_unforce</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">token</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Stop forcing a value. Don't call this directly, call release() on your token. 
        &quot;&quot;&quot;</span>
        <span class="s1">name</span><span class="s2">, </span><span class="s1">inputSource </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_token2forceInfo</span><span class="s2">[</span><span class="s1">token</span><span class="s2">]</span>
        <span class="s1">token</span><span class="s2">.</span><span class="s1">invalidate</span><span class="s2">()</span>
        <span class="s0">if </span><span class="s1">name </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOn</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOn</span><span class="s2">[</span><span class="s1">name</span><span class="s2">].</span><span class="s1">discard</span><span class="s2">(</span><span class="s1">inputSource</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOn</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]) == </span><span class="s6">0</span><span class="s2">:</span>
                <span class="s0">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOn</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]</span>
        <span class="s0">if </span><span class="s1">name </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOff</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOff</span><span class="s2">[</span><span class="s1">name</span><span class="s2">].</span><span class="s1">discard</span><span class="s2">(</span><span class="s1">inputSource</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOff</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]) == </span><span class="s6">0</span><span class="s2">:</span>
                <span class="s0">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_forcingOff</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">debugPrint</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">message</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot;for debugging&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">notify</span><span class="s2">.</span><span class="s1">debug</span><span class="s2">(</span>
            <span class="s4">&quot;%s (%s) %s&quot;</span><span class="s2">%(</span><span class="s1">id</span><span class="s2">(</span><span class="s1">self</span><span class="s2">), </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_state</span><span class="s2">), </span><span class="s1">message</span><span class="s2">))</span>

    <span class="s3">#snake_case alias:</span>
    <span class="s1">watch_with_modifiers </span><span class="s2">= </span><span class="s1">watchWithModifiers</span>
    <span class="s1">is_set </span><span class="s2">= </span><span class="s1">isSet</span>
    <span class="s1">get_event_name </span><span class="s2">= </span><span class="s1">getEventName</span>
    <span class="s1">debug_print </span><span class="s2">= </span><span class="s1">debugPrint</span>
    <span class="s1">release_inputs </span><span class="s2">= </span><span class="s1">releaseInputs</span>
</pre>
</body>
</html>